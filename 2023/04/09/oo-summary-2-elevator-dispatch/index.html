<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Charles">
    
    <meta name="author" content="Charles">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://charles2530.github.io/2023/04/09/oo-summary-2-elevator-dispatch/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="post by Charles in 2023-04-09 21:21:22">
<meta property="og:type" content="article">
<meta property="og:title" content="OO_summary_2.Elevator_dispatch">
<meta property="og:url" content="http://charles2530.github.io/2023/04/09/oo-summary-2-elevator-dispatch/index.html">
<meta property="og:site_name" content="Charles&#39;s Castle">
<meta property="og:description" content="post by Charles in 2023-04-09 21:21:22">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://charles2530.github.io/image/hw7.png">
<meta property="og:image" content="https://charles2530.github.io/image/Dispatcher_run.png">
<meta property="article:published_time" content="2023-04-09T13:21:22.000Z">
<meta property="article:modified_time" content="2023-06-17T06:13:59.329Z">
<meta property="article:author" content="Du Jinyang">
<meta property="article:tag" content="OO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://charles2530.github.io/image/hw7.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="https://charles2530.github.io/image/background/favicon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="https://charles2530.github.io/image/background/favicon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="https://charles2530.github.io/image/background/favicon.png">
    <!--- Page Info-->
    
    <title>
        
            OO_summary_2.Elevator_dispatch -
        
        Charles&#39;s Castle
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/assets/build/styles.css">
    

    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fonts/fonts.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fonts/Satoshi/satoshi.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fonts/Chillax/chillax.css">
    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
        
            
                
                    <script data-swup-reload-script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?8e0e5f382d14d87cbeadc33a36e71e86"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script>
                
    
            
    
    <script id="hexo-configurations">
    window.config = {"hostname":"charles2530.github.io","root":"/","language":"en","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["lol","Neo","God"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":true,"title":"recommend_articles","limit":3,"mobile_limit":2,"placeholder":"https://charles2530.github.io/image/background/p3.jfif","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":"#1890ff"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"https://charles2530.github.io/image/background/background-light1.jpg","dark":"https://charles2530.github.io/image/background/background-dark1.jpg"},"title":"Charles's Castle","subtitle":{"text":["Happiness is best!","Never give up!","Everyday is a gift!"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000000","dark":"#d1d1b6"},"text_style":{"title_size":"3.2rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Charles2530/","zhihu":"https://www.zhihu.com/people/yang-guang-xiao-zi-55-55","email":"charles2530@163.com"},"qrs":{"weixin":"https://charles2530.github.io/image/background/Wechat_icon.png"}}},"plugins":{"feed":{"enable":true},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.5.0","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Categories":{"path":"/categories","icon":"fas fa-bookmark"},"Tags":{"path":"/tags","icon":"fas fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/Charles2530/","Blog":"https://charles2530.github.io","Statistics":"https://tongji.baidu.com/"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"This is Charles's Castle","links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Photos":{"icon":"fa-solid fa-image","path":"/masonry/"},"Essays":{"icon":"fa-solid fa-message-lines","path":"/essay/"},"Friends":{"icon":"fa-solid fa-user-group","path":"/friends/"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/12/27 00:00:00"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Charles's Castle" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


  <body>
    <div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="/">
                    <img src="https://charles2530.github.io/image/background/logo.jpg">
                </a>
            
            <a class="logo-title" href="/">
                
                Charles&#39;s Castle
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fas fa-bookmark"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fas fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="https://charles2530.github.io">BLOG
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://tongji.baidu.com/">STATISTICS
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fas fa-bookmark"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/tags"  >
                             
                                
                                    <i class="fas fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="https://charles2530.github.io">BLOG</a>
                            </li>
                        
                            <li class="drawer-navbar-item text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://tongji.baidu.com/">STATISTICS</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title">
            
                
                
                <img src="https://charles2530.github.io/image/background/p1.jpg" alt="OO_summary_2.Elevator_dispatch" class="max-w-none"/>
                
                <h1 class="article-title-cover">OO_summary_2.Elevator_dispatch</h1>
            
            </div>
            
                    
        
        
            <div class="article-header flex flex-row gap-2 items-center">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="https://charles2530.github.io/image/background/logo2.jpg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Charles</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv7</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2023-04-09 21:21:22</span>
        <span class="mobile">2023-04-09 21:21:22</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-06-17 14:13:59</span>
            <span class="mobile">2023-06-17 14:13:59</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Lesson/">Lesson</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/Lesson/OO/">OO</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/Lesson/OO/OO-lab/">OO-lab</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/OO/">OO</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>7.9k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>30 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body">
            <h1 id="oo_summary_2elevator_dispatch"><a class="markdownIt-Anchor" href="#oo_summary_2elevator_dispatch"></a> OO_summary_2.Elevator_dispatch</h1>
<h2 id="前言"><a class="markdownIt-Anchor" href="#前言"></a> 前言</h2>
<p>OO第二单元的主题是 <strong>“多线程”</strong>，主要是让我们初步学习多线程的编程思想，理解和解决线程交互和线程安全问题，进一步深化对 <strong>“面向对象”</strong> 的理解。</p>
<p>本单元的三次作业都是和 <strong>“电梯调度问题”</strong> 有关，需要我们根据不同要求对电梯调度系统进行模拟。这三次作业不仅要求我们关注 <strong>“如何正确的加锁来解决线程安全问题”</strong>，还要求我们考虑到<strong>调度策略的整体性能</strong>。</p>
<p>由于以前没有接触过多线程编程，因此刚开始做作业时稍微有些吃力。但是我随着对 <strong>“多线程”</strong> 和 <strong>“线程同步”</strong> 理解的加深，在做后面的作业时越来越得心应手。同时，我也学会在代码中使用一些常用的设计模式，例如 <strong>“单例模式”、“工厂模式”、“流水线模式”</strong> 等等，进一步降低代码的耦合度，让代码层次更加清晰。</p>
<h2 id="知识点总结"><a class="markdownIt-Anchor" href="#知识点总结"></a> 知识点总结</h2>
<blockquote>
<p>以下部分是对线程知识点的简单总结</p>
</blockquote>
<h3 id="进程知识的通俗介绍"><a class="markdownIt-Anchor" href="#进程知识的通俗介绍"></a> 进程知识的通俗介绍</h3>
<p>什么是进程呢？在计算机中，我们把一个任务称为一个进程，浏览器就是一个进程，视频播放器是另一个进程，类似的，音乐播放器和Word都是进程。某些进程内部还需要同时执行多个子任务。例如，我们在使用Word时，Word可以让我们一边打字，一边进行拼写检查，同时还可以在后台进行打印，我们把子任务称为线程。</p>
<p>所以我们可以知道，<strong>进程和线程的关系</strong>就是：一个进程可以包含一个或多个线程，但至少会有一个线程。</p>
<p>操作系统调度的最小任务单位其实不是进程，而是线程。常用的Windows、Linux等操作系统都采用抢占式多任务，如何调度线程完全由操作系统决定，程序自己不能决定什么时候执行，以及执行多长时间。因为同一个应用程序，既可以有多个进程，也可以有多个线程，因此，实现多任务的方法，可以选择多进程模式（每个进程只有一个线程），多线程模式（一个进程有多个线程）和多进程＋多线程模式（复杂度最高）。</p>
<p>而Java语言内置了多线程支持。当Java程序启动的时候，实际上是启动了一个JVM进程，然后，JVM启动主线程来执行<code>main()</code>方法。在<code>main()</code>方法中，我们又可以启动其他线程。所以我们实验中所写的代码实际采用了多线程模式。</p>
<h3 id="同步块与锁"><a class="markdownIt-Anchor" href="#同步块与锁"></a> 同步块与锁</h3>
<p>​		多线程编程目的是为了加快程序运行速度，线程之间会共享资源，由此自然而然会产生类似于计组C流水线PU中读写不一致的问题，故必须要正确地加锁。</p>
<p>​		通过阅读训练教程和相关资料，了解到了原子操作的概念以及各种加锁的方法。虽然有更高级的条件锁以及读写锁等等，但它们对于电梯作业性能的提升并无裨益而且更容易出错，故我最终采用了最简单的synchronized锁。</p>
<p>​		接下来就是同步块的设计。大体上会有两个地方涉及同步块：</p>
<p>​		其一是共享对象本身。因为每次引用都有可能修改内部变量，故除了构造器外内部每个方法都需要加锁，锁住该对象本身（JAVA的特性决定了对象基本都是以类似于C语言中“指针”的形式出现，故只需要传参并加锁就好）</p>
<p>​		其二是线程内部对共享对象进行操作时。虽然共享对象内部方法已经加锁了，但其线程内部会对共享对象进行读写操作，其中写操作显然要加锁，而读操作若不加锁可能其他线程会向其中写入改变状态，故也要加锁。此处就涉及到了加锁粒度的问题，由于一个方法中不是所有语句都涉及读写操作，故我仅在涉及读写之处加锁。这样使得加锁更加灵活，同步块不会过于臃肿，在有较多线程之时也可以提升性能。</p>
<h3 id="代码实现的一些注意点"><a class="markdownIt-Anchor" href="#代码实现的一些注意点"></a> 代码实现的一些注意点</h3>
<p>在简单介绍了一下进程和线程的相关知识后，我来进一步介绍一下我们在编写电梯时的一些有关多线程的知识。</p>
<h4 id="start和run的关系"><a class="markdownIt-Anchor" href="#start和run的关系"></a> start()和run()的关系</h4>
<h5 id="基础款"><a class="markdownIt-Anchor" href="#基础款"></a> 基础款</h5>
<p>要创建一个新线程非常容易，我们需要实例化一个<code>Thread</code>实例，然后调用它的<code>start()</code>方法，<code>start()</code>方法会在内部自动调用实例的<code>run()</code>方法，从而运行一个新的线程，就像下面几行那样。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        t.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread start&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h5 id="拓展点"><a class="markdownIt-Anchor" href="#拓展点"></a> 拓展点</h5>
<p>这些相信大家在看了OO课程和电梯的历练后都是会的，但其实这两个方法还有一些注意点。就比如我在写电梯时，由于老是遇到电梯wait后无法notify的情况，于是就直接在调度器加入新的乘客后进行了相应电梯线程的run方法，这样在逻辑上虽然非常合理，但在JVM中的行为却是大相径庭的。</p>
<p>我们要知道，run()其实也就是个重写的普通方法，并不属于某个线程，换言之，直接调用<code>run()</code>方法，相当于调用了一个普通的Java方法，当前线程并没有任何改变，也不会启动新线程。上述代码如果将<code>t.start()</code>改成<code>t.run()</code>的话，实际上是在<code>main()</code>方法内部又调用了<code>run()</code>方法，打印<code>hello</code>语句是在<code>main</code>线程中执行的，没有任何新线程被创建。这一点即使在线程已经start()后也是如此，而这显然不是我们刻意调用了run()方法的本意。</p>
<p>总而言之，必须调用<code>Thread</code>实例的<code>start()</code>方法才能启动新线程，如果我们查看<code>Thread</code>类的源代码，会看到<code>start()</code>方法内部调用了一个<code>private native void start0()</code>方法，<code>native</code>修饰符表示这个方法是由JVM虚拟机内部的C代码实现的，不是由Java代码实现的。</p>
<h4 id="线程同步"><a class="markdownIt-Anchor" href="#线程同步"></a> 线程同步</h4>
<h5 id="线程安全的简单介绍"><a class="markdownIt-Anchor" href="#线程安全的简单介绍"></a> 线程安全的简单介绍</h5>
<p>上面那点相信大家即使不是很清楚应该也影响不大，毕竟我当时好像也是被逼急了才给出调用run()方法这种<s>下三滥的</s>手段,但线程同步就是毫无疑问对于每个电梯选手必须了解的课题了。</p>
<p>简单介绍一下线程同步吧。在Java中，当多个线程同时运行时，线程的调度由操作系统决定，程序本身无法决定。因此，任何一个线程都有可能在任何指令处被操作系统暂停，然后在某个时间段后继续执行。这个时候，有个单线程模型下不存在的问题就来了：如果多个线程同时读写共享变量，会出现数据不一致的问题。这时候就不得不提到这次作业的一个重要难题——合理的加锁和解锁。</p>
<p>Java程序使用<code>synchronized</code>关键字对一个对象进行加锁,<code>synchronized</code>保证了代码块在任意时刻最多只有一个线程能执行,从而解决了多线程同步访问共享变量的正确性问题。但是，它的缺点是带来了性能下降。因为<code>synchronized</code>代码块无法并发执行。此外，加锁和解锁需要消耗一定的时间，所以，<code>synchronized</code>会降低程序的执行效率。</p>
<p>在了解这些之后，线程锁的使用还是比较简单的，如果你使用的是非线程安全容器（如ArrayList)作为共享容器时，找出修改共享变量的线程代码块，选择一个共享实例作为锁，最后用synchronized套起来就可以了。</p>
<h5 id="如何省略synchronized减少运行时间"><a class="markdownIt-Anchor" href="#如何省略synchronized减少运行时间"></a> 如何省略synchronized减少运行时间</h5>
<p>好吧，相信这些大家都是知道的，下面我来讲一些可以不用synchronized的地方，毕竟就像前文所说的那样其实synchronized代码块会增加代码运行时间的。</p>
<p>首先，单条原子操作的语句不需要同步。原子操作是在操作系统的辅助下可以一步执行完的语句（引语），所以他不存在线程安全的风险，所以也就没有嵌套的synchronized的必要。如下面这个例子中的synchronized就可以省略。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(<span class="type">int</span> m)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>除此之外，synchronized关键词虽然表面上叫做对于读写的安全加锁，但我们可以简单考虑一下，如果两个线程同时要获得一个共享数据的值，他们同时读取这个数据的值并不会有什么影响，换言之，我们真正需要加锁的线程是那些写操作的线程，只要保证共享数据完成被改写的过程中不会被其他线程读取，也就完成了线程安全的功能了。</p>
<h5 id="synchronized在方法中的使用"><a class="markdownIt-Anchor" href="#synchronized在方法中的使用"></a> synchronized在方法中的使用</h5>
<p>我们知道Java程序依靠<code>synchronized</code>对线程进行同步，使用<code>synchronized</code>的时候，锁住的是哪个对象非常重要。让线程自己选择锁对象往往会使得代码逻辑混乱，也不利于封装，更好的方法是把<code>synchronized</code>逻辑封装起来。</p>
<p>换言之，我们可以自己定义一个线程安全的容器，在源头上解决线程同步问题，这样在其他类里使用这个容器的数据时也可以更加省心。（其实java中有许多帮你包装好的线程安全容器，如CopyOnWriteArrayList，但我觉得这样没有达到练习的目的，所以没有选择走这条捷径，但去看一看这些线程安全容器的内部代码书写还是非常涨知识的）。</p>
<p>而在容器内部，我们就不可避免的要将一些方法设为synchronized的，那我们要怎么理解synchronized的方法呢，我写一个简单的例子，相信大家就明白了。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    count += n;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure></div>
<p>这是一个被synchronized了的代码，将其用我们容器的synchronized来转化其实可以写成下面几行语句，他们在使用时是完全相同的。</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123; </span><br><span class="line">        count += n;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>因此，用<code>synchronized</code>修饰的方法就是同步方法，它表示整个方法都必须用<code>this</code>实例加锁，这样理解也就易懂了许多。</p>
<p>我们再思考一下，如果对一个静态方法添加<code>synchronized</code>修饰符，它锁住的是哪个对象？</p>
<p>对于<code>static</code>方法，是没有<code>this</code>实例的，因为<code>static</code>方法是针对类而不是实例。但是我们注意到任何一个类都有一个由JVM自动创建的<code>Class</code>实例，因此，对<code>static</code>方法添加<code>synchronized</code>，锁住的是该类的<code>Class</code>实例。上述<code>synchronized static</code>方法实际上相当于：</p>
<div class="highlight-container" data-rel="Java"><figure class="iseeu highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Counter.class) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="wait和notifyall"><a class="markdownIt-Anchor" href="#wait和notifyall"></a> wait()和notifyAll()</h4>
<p>在debug过程中，我经历了很多不同的TLE的情况，所有都是拜这两个函数所赐，一会是notifyAll()多了导致轮询最终CPU_TIME_TLE,一会又是notifyAll()少了导致某些线程不能顺利结束造成REAL_TIME_TLE，感觉自己就不停在两个极端反复横跳，究其原因，一方面是我没有使用线程安全容器而是可以使用synchronized导致编码难度偏高，另一方面也确实对多线程不够了解，所以在此简单总结一下并给出一些细节点。（当然帆姐那篇已经讲的很好了，在此引流一下——<a class="link"   target="_blank" rel="noopener" href="http://oo.buaa.edu.cn/assignment/423/discussion/1353" >学习《图解JAVA多线程设计模式》分享  <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>）</p>
<h5 id="基础知识"><a class="markdownIt-Anchor" href="#基础知识"></a> 基础知识</h5>
<p>在Java程序中，<code>synchronized</code>解决了多线程竞争的问题，但是<code>synchronized</code>并没有解决多线程协调的问题。我们在使用while()循环时，如果没有wait(),<code>while()</code>循环永远不会退出。因为线程在执行<code>while()</code>循环时，已经在函数入口获取了<code>this</code>锁，其他线程根本无法调用该函数，因为该函数执行条件也是获取<code>this</code>锁。</p>
<p>因此，多线程协调运行的原则就是：当条件不满足时，线程进入等待状态；当条件满足时，线程被唤醒，继续执行任务。</p>
<p>使用<code>notifyAll()</code>将唤醒所有当前正在<code>this</code>锁等待的线程，而<code>notify()</code>只会唤醒其中一个）。通常来说，<code>notifyAll()</code>更安全。有些时候，如果我们的代码逻辑考虑不周，用<code>notify()</code>会导致只唤醒了一个线程，而其他线程可能永远等待下去醒不过来了。</p>
<h5 id="一个细节点"><a class="markdownIt-Anchor" href="#一个细节点"></a> 一个细节点</h5>
<p>首先重要的事情说三遍，我们一定要在在<code>while()</code>循环中调用<code>wait()</code>，而不是<code>if</code>语句，这个是我真的使我de了很久非常痛苦的bug。</p>
<p>为什么一定要用while呢，因为线程被唤醒时，需要再次获取<code>this</code>锁，而在每部电梯都wait()一次之后，锁又自动回到了第一部电梯的手上，此时已经没有wait()了，也就跳出了if语句，最终导致如果长时间没有乘客加入，就会造成非常严重的轮询。所以，要始终在<code>while</code>循环中<code>wait()</code>，并且每次被唤醒后拿到<code>this</code>锁就必须再次判断。</p>
<p>所以，正确编写多线程代码是非常困难的，需要仔细考虑的条件非常多，任何一个地方考虑不周，都会导致多线程运行时不正常。</p>
<h2 id="作业分析"><a class="markdownIt-Anchor" href="#作业分析"></a> 作业分析</h2>
<h3 id="作业总体概况"><a class="markdownIt-Anchor" href="#作业总体概况"></a> 作业总体概况</h3>
<p>这一单元作业三次的结构结合度非常高，三次下来完成了一个简单的电梯调度问题，总体下来还是非常有难度的。，但同样也是收获满满。</p>
<p>第一单元要求我们实现了对于一栋楼的6部电梯接送乘客的调度要求，主要在于让我们初步熟悉多线程的相关操作。第二单元是在此基础上添加了维护电梯和动态增加电梯的操作，算是比较简单的一轮迭代。这次作业的主要难度在于第三次作业，这次作业要求我们实现控制每层楼的接送人以及纯接人的电梯数量，并限制了电梯可停靠的楼层数，要求实现电梯多次换乘的操作。</p>
<p>在三次作业迭代下我的uml类图如下：</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/hw7.png"
                      alt="hw7" 
                ></p>
<p>时序图如下：<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/Dispatcher_run.png"
                      alt="Dispatcher_run" 
                ></p>
<h4 id="行数分析"><a class="markdownIt-Anchor" href="#行数分析"></a> 行数分析</h4>
<table>
<thead>
<tr>
<th>文件</th>
<th>行数</th>
</tr>
</thead>
<tbody>
<tr>
<td>Building.java</td>
<td>17</td>
</tr>
<tr>
<td>Dispatcher.java</td>
<td>66</td>
</tr>
<tr>
<td>Elevator.java</td>
<td>485</td>
</tr>
<tr>
<td>ElevatorQueue.java</td>
<td>59</td>
</tr>
<tr>
<td>Floor.java</td>
<td>35</td>
</tr>
<tr>
<td>Graph.java</td>
<td>92</td>
</tr>
<tr>
<td>Main.java</td>
<td>39</td>
</tr>
<tr>
<td>Person.java</td>
<td>109</td>
</tr>
<tr>
<td>RequestQueue.java</td>
<td>44</td>
</tr>
<tr>
<td>Schedule.java</td>
<td>68</td>
</tr>
<tr>
<td>Strategy.java</td>
<td>243</td>
</tr>
</tbody>
</table>
<p>和大多数架构相同，由于电梯的本身运行逻辑比较复杂，所以也就导致虽然我为电梯类单独写了调度器和策略类，但还是会出现电梯类的复杂冗长的问题，这应该是因为我写的调度策略非常类似ALS，这本身就比look算法要更加难写，而其他部分代码的行数均处于正常水平。</p>
<h4 id="复杂度分析"><a class="markdownIt-Anchor" href="#复杂度分析"></a> 复杂度分析</h4>
<table>
<thead>
<tr>
<th>method</th>
<th>CogC</th>
<th>ev(G)</th>
<th>iv(G)</th>
<th>v(G)</th>
</tr>
</thead>
<tbody>
<tr>
<td>Building.Building()</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Building.getBuilding()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Dispatcher.Dispatcher(RequestQueue, ElevatorQueue, Building)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Dispatcher.run()</td>
<td>14.0</td>
<td>3.0</td>
<td>7.0</td>
<td>8.0</td>
</tr>
<tr>
<td>Elevator.checkRoad()</td>
<td>12.0</td>
<td>1.0</td>
<td>8.0</td>
<td>8.0</td>
</tr>
<tr>
<td>Elevator.close(boolean)</td>
<td>3.0</td>
<td>1.0</td>
<td>2.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Elevator.echo()</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Elevator.Elevator(int, RequestQueue, ElevatorQueue, int, Building)</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Elevator.Elevator(int, RequestQueue, int, int, double, ElevatorQueue, int, …)</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Elevator.elevatorClear(int, boolean)</td>
<td>11.0</td>
<td>1.0</td>
<td>6.0</td>
<td>6.0</td>
</tr>
<tr>
<td>Elevator.elevatorCommonOpen(boolean)</td>
<td>23.0</td>
<td>1.0</td>
<td>8.0</td>
<td>8.0</td>
</tr>
<tr>
<td>Elevator.elevatorErrorOpen()</td>
<td>18.0</td>
<td>1.0</td>
<td>7.0</td>
<td>7.0</td>
</tr>
<tr>
<td>Elevator.elevatorMove()</td>
<td>3.0</td>
<td>1.0</td>
<td>1.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Elevator.elevatorOpen()</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Elevator.elevatorOpenAccept()</td>
<td>5.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Elevator.elevatorReverse()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.elevatorStop()</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Elevator.elevatorWait()</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Elevator.getBuffers()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.getId()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.getPos()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.getRequests()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.getRes()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.isEmpty()</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Elevator.isRequestEmpty()</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Elevator.notEnd()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.open()</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Elevator.run()</td>
<td>14.0</td>
<td>4.0</td>
<td>10.0</td>
<td>10.0</td>
</tr>
<tr>
<td>Elevator.setEnd(boolean)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.setRes(int)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Elevator.stop()</td>
<td>6.0</td>
<td>1.0</td>
<td>4.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Elevator.synchronizedBuffers(Vector, RequestQueue)</td>
<td>14.0</td>
<td>3.0</td>
<td>9.0</td>
<td>9.0</td>
</tr>
<tr>
<td>Elevator.synchronizedList(Vector, Vector)</td>
<td>10.0</td>
<td>3.0</td>
<td>10.0</td>
<td>10.0</td>
</tr>
<tr>
<td>Elevator.toString()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>ElevatorQueue.add(Elevator)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>ElevatorQueue.ElevatorQueue(RequestQueue)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>ElevatorQueue.getRequests()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>ElevatorQueue.hasEmpty()</td>
<td>12.0</td>
<td>5.0</td>
<td>7.0</td>
<td>8.0</td>
</tr>
<tr>
<td>ElevatorQueue.isEmpty()</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>ElevatorQueue.remove(int)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>ElevatorQueue.toString()</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Floor.addLayers()</td>
<td>1.0</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Floor.addOpen()</td>
<td>2.0</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Floor.reduceLayers()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Floor.reduceOpen()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Graph.add(Elevator)</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Graph.dfs(int, int, Vector)</td>
<td>15.0</td>
<td>7.0</td>
<td>7.0</td>
<td>8.0</td>
</tr>
<tr>
<td>Graph.getGraph()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Graph.hasRoad(Vector, Vector)</td>
<td>7.0</td>
<td>4.0</td>
<td>6.0</td>
<td>7.0</td>
</tr>
<tr>
<td>Graph.printVector(Vector, int)</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Graph.remove(Elevator)</td>
<td>3.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Graph.searchNext(int, int, int)</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Graph.setGraph(ConcurrentHashMap&gt;)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Main.main(String[])</td>
<td>2.0</td>
<td>1.0</td>
<td>3.0</td>
<td>3.0</td>
</tr>
<tr>
<td>Person.getFromFloor()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.getPersonId()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.getTempFromFloor()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.getTempToFloor()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.getToFloor()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td><a class="link"   target="_blank" rel="noopener" href="http://Person.in" >Person.in <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a>(Elevator)</td>
<td>5.0</td>
<td>3.0</td>
<td>4.0</td>
<td>5.0</td>
</tr>
<tr>
<td>Person.init(int)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.isOut()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.next()</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Person.notEnd()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.out()</td>
<td>4.0</td>
<td>2.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Person.Person(int, int, int)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.Person(PersonRequest)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Person.setChangePos(Vector)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>RequestQueue.addRequest(Person)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>RequestQueue.checkSame(Person, Elevator)</td>
<td>4.0</td>
<td>3.0</td>
<td>5.0</td>
<td>5.0</td>
</tr>
<tr>
<td>RequestQueue.getRequests()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>RequestQueue.isEmpty()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>RequestQueue.isEnd()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>RequestQueue.RequestQueue()</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>RequestQueue.setEnd(boolean)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Schedule.run()</td>
<td>38.0</td>
<td>8.0</td>
<td>20.0</td>
<td>21.0</td>
</tr>
<tr>
<td>Schedule.Schedule(RequestQueue, ElevatorQueue)</td>
<td>0.0</td>
<td>1.0</td>
<td>1.0</td>
<td>1.0</td>
</tr>
<tr>
<td>Strategy.checkDir(ConcurrentHashMap&gt;, RequestQueue, boolean, int, Vector)</td>
<td>2.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Strategy.checkEmpty(ConcurrentHashMap&gt;)</td>
<td>4.0</td>
<td>3.0</td>
<td>3.0</td>
<td>4.0</td>
</tr>
<tr>
<td>Strategy.checkReverse(ConcurrentHashMap&gt;, RequestQueue, boolean, int, Vector)</td>
<td>20.0</td>
<td>9.0</td>
<td>13.0</td>
<td>14.0</td>
</tr>
<tr>
<td>Strategy.checkSignDir(ConcurrentHashMap&gt;, RequestQueue, int, Vector)</td>
<td>22.0</td>
<td>10.0</td>
<td>14.0</td>
<td>15.0</td>
</tr>
<tr>
<td>Strategy.checkUnSignDir(ConcurrentHashMap&gt;, RequestQueue, int, Vector)</td>
<td>22.0</td>
<td>10.0</td>
<td>14.0</td>
<td>15.0</td>
</tr>
<tr>
<td>Strategy.isOpen(ConcurrentHashMap&gt;, int)</td>
<td>1.0</td>
<td>1.0</td>
<td>2.0</td>
<td>2.0</td>
</tr>
<tr>
<td>Strategy.isOpenAccept(ConcurrentHashMap&gt;, Vector, int, int, boolean, Vector)</td>
<td>18.0</td>
<td>9.0</td>
<td>18.0</td>
<td>20.0</td>
</tr>
<tr>
<td>Strategy.lookStrategy(int, int, boolean, ConcurrentHashMap&gt;, RequestQueue, Vector, boolean, …)</td>
<td>16.0</td>
<td>8.0</td>
<td>11.0</td>
<td>13.0</td>
</tr>
<tr>
<td>Total</td>
<td>366.0</td>
<td>172.0</td>
<td>286.0</td>
<td>315.0</td>
</tr>
</tbody>
</table>
<p>从上表不难看出，我的架构复杂度主要来自两个因素，一方面来自于图遍历算法dfs本身O(n!)的复杂度加成，另一方面来自于各种run()进程及其包含的类共同加成的结果。这里我们需要重点关注Strategy这个类，这个类是我用于调度出电梯行为的类，由于我在我的架构中设计了缓冲区，带来的后遗症也就是判断电梯行为时的逻辑非常复杂，也就间接导致了我的Strategy类难以处理，复杂度较高。</p>
<h4 id="bug分享及debug思路"><a class="markdownIt-Anchor" href="#bug分享及debug思路"></a> bug分享及debug思路</h4>
<p>这三次作业互测都没有出bug，但第二次强测我被狠狠橄榄了，主要出了一个由于线程不同步的问题，导致我维护电梯的id会多次出现，最终只改了4行就改掉了，但还是避免不了被橄榄的事实。</p>
<p>由于多线程的bug非常不好复现，所以我选择使用了朴实无华的println方法来debug，虽然方法简单，但很有效，甚至帮我解决了查轮询很麻烦的问题（真的奇效orz）。</p>
<h3 id="研讨课收获"><a class="markdownIt-Anchor" href="#研讨课收获"></a> 研讨课收获</h3>
<p>在这几次研讨课上我主要更加深入地了解了solid算法，更让我有了更加深刻的需要在自己编码时时刻注重于代码结构，必要时强迫自己使用合适的工程模式。</p>
<h3 id="架构设计体验"><a class="markdownIt-Anchor" href="#架构设计体验"></a> 架构设计体验</h3>
<h4 id="第五次作业简单架构介绍"><a class="markdownIt-Anchor" href="#第五次作业简单架构介绍"></a> 第五次作业简单架构介绍</h4>
<h5 id="基本情况"><a class="markdownIt-Anchor" href="#基本情况"></a> 基本情况</h5>
<p>首先设计了一个<code>Dispatcher</code>作为输入线程不断从<code>ElevatorInput</code>读取请求，然后将请求装入<code>RequestQueue</code>中，此时<code>RequestQueue</code>就是我们要保护线程安全的公共资源，与此同时，我为每个电梯<code>Elevator</code>编写了<code>Schedule</code>调度器类和<code>Strateg</code>y策略类，从而降低耦合，让每个线程可以做好自己主要负责的部分</p>
<h5 id="调度策略"><a class="markdownIt-Anchor" href="#调度策略"></a> 调度策略</h5>
<p>调度方面，我使用的是<code>ALS</code>策略。如果将ALS和LOOK策略进行了横向对比，认为ALS策略的最大优势在于省电，且在小数据集的表现较优，而LOOK算法可能导致多部电梯同时响应，但在大数据方面表现良好。</p>
<h4 id="细节剖析"><a class="markdownIt-Anchor" href="#细节剖析"></a> 细节剖析</h4>
<p>这次作业按照生产者，消费者进程理解的话，<code>Input</code>是生产者，<code>Elevator</code>是消费者，而消费的盘子即公共资源是<code>Person</code>，所以我还额外编写了<code>Person</code>类继承了课程组提供的<code>PersonRequest</code>类，并在里面编写了in和out方法，这样封装后就更加接近生产者消费者模式。</p>
<h4 id="第六次作业迭代思路"><a class="markdownIt-Anchor" href="#第六次作业迭代思路"></a> 第六次作业迭代思路</h4>
<h5 id="新增电梯"><a class="markdownIt-Anchor" href="#新增电梯"></a> 新增电梯</h5>
<p>把电梯类中的相关可变参数改为成员变量，并增加一个新增电梯的构造方法。Dispatcher每读到一个新增请求就多开一个电梯线程。</p>
<p>同时设计了ElevatorQueue来控制此时正在运行的电梯，这个设计同样适用于维护电梯。</p>
<h5 id="维护电梯"><a class="markdownIt-Anchor" href="#维护电梯"></a> 维护电梯</h5>
<p>在电梯收到维护指令后，首先将电梯的end成员变量设置为true，这样就会调用Strategy类的STOP方法，在stop中分为电梯为空和不为空两种情况，为空则省略了维护电梯开关的过程，不为空则将当时所有电梯内人排出，并在判断此时的楼层pos和tofloor的关系，如果不同则重新加入电梯队列。</p>
<h5 id="小tips"><a class="markdownIt-Anchor" href="#小tips"></a> 小tips：</h5>
<p>电梯为停止状态需要从第一次架构产生修改。即需要保证所有电梯和等待队列均为空才可以结束电梯线程，剩下情况需要等待。</p>
<p>这样还会出现所有电梯都已经停止但最后指令是maintain的情况，所以我们需要额外设置保证输入结束之后才结束线程。</p>
<h4 id="第七次作业迭代思路"><a class="markdownIt-Anchor" href="#第七次作业迭代思路"></a> 第七次作业迭代思路</h4>
<h5 id="换乘"><a class="markdownIt-Anchor" href="#换乘"></a> 换乘</h5>
<p>由于题目中最后很有可能会关闭所有的全能电梯，所以实现换乘是绝对必要的。</p>
<h5 id="换乘图的设计"><a class="markdownIt-Anchor" href="#换乘图的设计"></a> 换乘图的设计</h5>
<p>我们可以设计一个图结构来进行换乘操作的实现。</p>
<p>对于图本身而言，由于对于我们的电梯调度本质上只需要一个图，我选用了ConcurrentHashMap&lt;Integer, Vector<Elevator>&gt;来存储每个楼层当时可达电梯的集合。所以我们可以设置为一个静态类，然后通过调用图的静态方法即可实现全局性的调控。</p>
<p>在图的算法方面，可以选用最短路径算法和dfs来实现，但这次作业而言，使用最短路径会导致大量请求堆积于全能电梯，所以我更倾向于选用dfs求出可达解即可。（这里在使用dfs时需要用book数组进行到过的楼层标记，否则可能会出现圈的情况）</p>
<p>最后我们可以把这个要走的路线按照一个数组存起来，叫做path。并将其作为每个请求person的一个属性。</p>
<h5 id="换乘时的设计"><a class="markdownIt-Anchor" href="#换乘时的设计"></a> 换乘时的设计</h5>
<p>首先在前两次作业没有换成的需求，所以我们也就只有tofloor和fromfloor两个变量，但在这次迭代中，我们需要将这两个变量改为对外露出路径中某一步的起点和终点。并将当前终点和目的地相同时作为结束条件即可。</p>
<p>由于调度过程中会出现maintain指令，所以可能出现在调度一半后需要换路径的情况，这里其实我们只需要考虑person在等待队列还未进电梯时电梯被maintain的情况，因为如果在电梯内被maintain，在放下乘客后自然是需要重现规划路径的。当放入乘客，由于我写了Strategy类，所以我会在每次电梯决定是否开门前如果发现某个乘客的路径上有被维护的电梯（即不可达）就选择重新规划路线。</p>
<h4 id="电梯门数量控制"><a class="markdownIt-Anchor" href="#电梯门数量控制"></a> 电梯门数量控制</h4>
<p>对于电梯开门数量来说我们可以设置一个新的公共变量来作为锁进行楼层开门数量控制。我选择的是设置了楼层floor类作为公共变量，并对floor写了addOpen()，addLayers()，reduceOpen()，reduceLayers()，之后用类似信号量机制当成一把lock锁使用即可。（当然也可以直接使用semaphore，但我是周五前写完的所以没有用）</p>
<h5 id="每层电梯门数量控制"><a class="markdownIt-Anchor" href="#每层电梯门数量控制"></a> 每层电梯门数量控制</h5>
<p>每层电梯门的数量用addlayers（）和reducelayers（）直接控制即可。</p>
<h5 id="只进电梯数量控制"><a class="markdownIt-Anchor" href="#只进电梯数量控制"></a> 只进电梯数量控制</h5>
<p>如何判断是否为只进电梯呢？最好的办法是看电梯open进出后前一个电梯内id集合的状态是否为后一个id集合状态的子集，之后可以通过这个因素来判断是否为只接人电梯。</p>
<div class="highlight-container" data-rel="C++"><figure class="iseeu highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">synchronized</span> (floor) &#123;</span><br><span class="line">    <span class="keyword">while</span> (!floor.<span class="built_in">addLayers</span>()) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            floor.<span class="built_in">wait</span>();</span><br><span class="line">        &#125; <span class="built_in">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">open</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h3 id="迭代细节"><a class="markdownIt-Anchor" href="#迭代细节"></a> 迭代细节</h3>
<p>如何在迭代中保持高内聚低耦合？</p>
<p>首先我们要从solid原则的单一功能原则出发。在我的架构中，增加和删除维护电梯的操作全部交给了ElevatorQueue来维护，而电梯在知道自己被end前一直保持着正常的调度不受影响。Strategy负责给出电梯下一步行为的指导，Schedule专门负责调度等待队列，Graph专门用于调度路线，这样专职专用可以很好地降低耦合度。（高内聚——<strong>功能内聚</strong>，低耦合——<strong>控制耦合</strong>）</p>
<p>第二点是不要重复造轮子，对于一些很常用或者使用类型比较相似的方法，我比较喜欢写一个静态类存储一些静态方法（如Graph和Strategy类）专门供全局调用和一些小的private的方法。这样就起到了类似函数的作用，便于修改和维护。（高内聚——<strong>功能内聚</strong>）</p>
<p>第三点是需要减少非必要的公共数据的传递，例如我在第一次架构设计时在Elevator中传入了ElevatorQueue这个参数，这个就是一个十分不合理的公共数据分享，甚至可能出现线程安全问题，这种设计就需要优化掉，经可能避免非必要的公共数据传递。（低耦合——<strong>数据耦合</strong>）</p>
<h3 id="设计模式"><a class="markdownIt-Anchor" href="#设计模式"></a> 设计模式</h3>
<ul>
<li>
<p>生产者消费者模式：输入类作为生产者，任务表作为托盘，电梯作为消费者</p>
</li>
<li>
<p>工厂模式：自定义电梯的实现</p>
</li>
<li>
<p>状态模式：电梯可以有好几种状态，上行下行，开门关门，满员，故障</p>
</li>
<li>
<p>策略模式：主要考虑到，电梯策略的选择，与分派器策略的选择</p>
</li>
<li>
<p>单例模式：Graph的实现</p>
</li>
</ul>
<h2 id="心得体会"><a class="markdownIt-Anchor" href="#心得体会"></a> 心得体会</h2>
<h3 id="线程安全"><a class="markdownIt-Anchor" href="#线程安全"></a> 线程安全</h3>
<p>​		线程安全是多线程相较于单线程而言难度较大的地方。其存在三个问题：读写、死锁以及轮询。</p>
<p>​		对于读写，其有些类似于上学期计组课设流水线CPU设计。通过本单元的学习，我掌握了基本的确保线程安全的方式，学会了正确地加锁以及如何尽可能灵活地加锁（而不是一味地使用笨重的synchronized对整个方法加锁）。</p>
<p>​		对于死锁，应该采用正确的wait–notifyAll方式编程，并回避循环引用。</p>
<p>​		对于轮询，我设置了合理的等待条件，使得电梯以及调度器线程可以在合适的时候进入休眠，避免占用过多的CPU资源。</p>
<h3 id="总结"><a class="markdownIt-Anchor" href="#总结"></a> 总结</h3>
<p>第二单元作为<code>OO</code>的重中之重，还是非常让人舒爽的，多线程bug难以复现的问题真的让人非常折磨，这三周在非常忙碌的学习生活中真的让我从来没有这么充实过，减少了不少摸鱼的时间~。</p>
<p>从<code>OO</code>学习到的经验而言，首先我们一定<strong>多多关注讨论区</strong>。当某个地方陷入死局时，<strong>阅读一下同学的思路和分享</strong>也许会让你豁然开朗,更有机会可以白嫖各种大佬的评测机等“神器”。第二是要<strong>关注代码复杂度</strong>，尽量不要写太长的方法。即使不得不写，也要多加小心，因为很有可能有bug藏匿其中。如果迫不得已要写，尽量强迫自己不要写大量相似的代码，<strong>提高代码的复用性</strong>。第三是<strong>优化时要慎重</strong>，正确性一定要放在第一位，如果没有正确性，性能分一点没有，还会有很多补bug的痛苦经历，得不偿失的。第四是<strong>注意测试的全面性</strong>。 在测试的时候不能只进行<strong>随机测试</strong>，还要针对我们做的优化多测几组特殊数据。最后，我们一定要<strong>注意代码可扩展性</strong>。写代码时不仅仅要着眼于本次作业的要求，还需要思考下一次作业中可能会有哪些新的要求，为迭代开发做好准备。</p>
<p>最后，在本单元作业中，老师、助教和同学们都给予了我相当大的帮助，数千行代码的书写也进一步提升了我的代码能力，并将我从<strong>面向过程的舒适区</strong>中拽了出来,希望后面的<code>OO</code>课程我可以取得更好的成绩，互测成绩越来越好。</p>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> OO_summary_2.Elevator_dispatch</li>
        <li><strong>Author:</strong> Charles</li>
        <li><strong>Created at
                :</strong> 2023-04-09 21:21:22</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2023-06-17 14:13:59
            </li>
        
        <li>
            <strong>Link:</strong> https://charles2530.github.io/2023/04/09/oo-summary-2-elevator-dispatch/
        </li>
        <li>
            <strong>
                License:
            </strong>
            
            This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.
            

        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/OO/">#OO</a>&nbsp;
                    </li>
                
            </ul>
        

        
  <div class="recommended-article">
   <div class="recommended-desktop">
    <div class="recommended-article-header">
     <i aria-hidden="true"></i><span>recommend_articles</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/06/08/lab6-challenge-report/" title="lab6-challenge-report" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p5.jfif" alt="lab6-challenge-report" class="!max-w-none">
  <span class="title">lab6-challenge-report</span>
</a><a class="recommended-article-item" href="/2022/12/26/p5-design-documents/" title="P5 Design documents" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p4.jfif" alt="P5 Design documents" class="!max-w-none">
  <span class="title">P5 Design documents</span>
</a><a class="recommended-article-item" href="/2023/07/17/swift-note-16/" title="Swift-note-16" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p1.png" alt="Swift-note-16" class="!max-w-none">
  <span class="title">Swift-note-16</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header">
     <i aria-hidden="true"></i><span>recommend_articles</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/06/08/lab6-challenge-report/" title="lab6-challenge-report" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p5.jfif" alt="lab6-challenge-report" class="!max-w-none">
  <span class="title">lab6-challenge-report</span>
</a><a class="recommended-article-item" href="/2022/12/26/p5-design-documents/" title="P5 Design documents" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p4.jfif" alt="P5 Design documents" class="!max-w-none">
  <span class="title">P5 Design documents</span>
</a></div>
   </div>
  </div>

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                        rel="prev"
                        href="/2023/04/10/turtle-soup-game-for-is-or-not/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">Turtle-soup-game-for-is-or-not</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                        rel="next"
                        href="/2023/03/30/os-quick-abbreviation/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">OS-quick-abbreviation</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container">
                <div class="comments-container pjax">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        <!-- 
            
    <div id="gitalk-container"></div>
    <script data-swup-reload-script
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script data-swup-reload-script>

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: '8083299a8ee2aaf23879',
                    clientSecret: 'a8161e81d4872181e884fdb69f7be24916b6a9d0',
                    repo: 'charles2530_issues',
                    owner: 'Charles2530',
                    admin: ['Charles2530'],
                    id: __gitalk__pathname,
                    language: 'en'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('true') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>



         -->
        <script src="https://utteranc.es/client.js" repo="Charles2530/Charles2530.github.io" issue-term="pathname"
            label="Comment" theme="preferred-color-scheme" crossorigin="anonymous" async>
            </script>
        
</div>
            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">OO_summary_2.Elevator_dispatch</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#oo_summary_2elevator_dispatch"><span class="nav-text"> OO_summary_2.Elevator_dispatch</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-text"> 前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E6%80%BB%E7%BB%93"><span class="nav-text"> 知识点总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%9B%E7%A8%8B%E7%9F%A5%E8%AF%86%E7%9A%84%E9%80%9A%E4%BF%97%E4%BB%8B%E7%BB%8D"><span class="nav-text"> 进程知识的通俗介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5%E5%9D%97%E4%B8%8E%E9%94%81"><span class="nav-text"> 同步块与锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0%E7%9A%84%E4%B8%80%E4%BA%9B%E6%B3%A8%E6%84%8F%E7%82%B9"><span class="nav-text"> 代码实现的一些注意点</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#start%E5%92%8Crun%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="nav-text"> start()和run()的关系</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E6%AC%BE"><span class="nav-text"> 基础款</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8B%93%E5%B1%95%E7%82%B9"><span class="nav-text"> 拓展点</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%90%8C%E6%AD%A5"><span class="nav-text"> 线程同步</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="nav-text"> 线程安全的简单介绍</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E7%9C%81%E7%95%A5synchronized%E5%87%8F%E5%B0%91%E8%BF%90%E8%A1%8C%E6%97%B6%E9%97%B4"><span class="nav-text"> 如何省略synchronized减少运行时间</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#synchronized%E5%9C%A8%E6%96%B9%E6%B3%95%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-text"> synchronized在方法中的使用</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#wait%E5%92%8Cnotifyall"><span class="nav-text"> wait()和notifyAll()</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86"><span class="nav-text"> 基础知识</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%80%E4%B8%AA%E7%BB%86%E8%8A%82%E7%82%B9"><span class="nav-text"> 一个细节点</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BD%9C%E4%B8%9A%E5%88%86%E6%9E%90"><span class="nav-text"> 作业分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%9C%E4%B8%9A%E6%80%BB%E4%BD%93%E6%A6%82%E5%86%B5"><span class="nav-text"> 作业总体概况</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A1%8C%E6%95%B0%E5%88%86%E6%9E%90"><span class="nav-text"> 行数分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90"><span class="nav-text"> 复杂度分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#bug%E5%88%86%E4%BA%AB%E5%8F%8Adebug%E6%80%9D%E8%B7%AF"><span class="nav-text"> bug分享及debug思路</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A0%94%E8%AE%A8%E8%AF%BE%E6%94%B6%E8%8E%B7"><span class="nav-text"> 研讨课收获</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1%E4%BD%93%E9%AA%8C"><span class="nav-text"> 架构设计体验</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%BA%94%E6%AC%A1%E4%BD%9C%E4%B8%9A%E7%AE%80%E5%8D%95%E6%9E%B6%E6%9E%84%E4%BB%8B%E7%BB%8D"><span class="nav-text"> 第五次作业简单架构介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%83%85%E5%86%B5"><span class="nav-text"> 基本情况</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5"><span class="nav-text"> 调度策略</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%86%E8%8A%82%E5%89%96%E6%9E%90"><span class="nav-text"> 细节剖析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E5%85%AD%E6%AC%A1%E4%BD%9C%E4%B8%9A%E8%BF%AD%E4%BB%A3%E6%80%9D%E8%B7%AF"><span class="nav-text"> 第六次作业迭代思路</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%96%B0%E5%A2%9E%E7%94%B5%E6%A2%AF"><span class="nav-text"> 新增电梯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%B4%E6%8A%A4%E7%94%B5%E6%A2%AF"><span class="nav-text"> 维护电梯</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B0%8Ftips"><span class="nav-text"> 小tips：</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AC%AC%E4%B8%83%E6%AC%A1%E4%BD%9C%E4%B8%9A%E8%BF%AD%E4%BB%A3%E6%80%9D%E8%B7%AF"><span class="nav-text"> 第七次作业迭代思路</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8D%A2%E4%B9%98"><span class="nav-text"> 换乘</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8D%A2%E4%B9%98%E5%9B%BE%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="nav-text"> 换乘图的设计</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8D%A2%E4%B9%98%E6%97%B6%E7%9A%84%E8%AE%BE%E8%AE%A1"><span class="nav-text"> 换乘时的设计</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%B5%E6%A2%AF%E9%97%A8%E6%95%B0%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="nav-text"> 电梯门数量控制</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%AF%8F%E5%B1%82%E7%94%B5%E6%A2%AF%E9%97%A8%E6%95%B0%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="nav-text"> 每层电梯门数量控制</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%AA%E8%BF%9B%E7%94%B5%E6%A2%AF%E6%95%B0%E9%87%8F%E6%8E%A7%E5%88%B6"><span class="nav-text"> 只进电梯数量控制</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E7%BB%86%E8%8A%82"><span class="nav-text"> 迭代细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="nav-text"> 设计模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BF%83%E5%BE%97%E4%BD%93%E4%BC%9A"><span class="nav-text"> 心得体会</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-text"> 线程安全</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-text"> 总结</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Charles</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">Visitor Count</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">Total Page Views</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">Powered by Charles</span>
            <span class="text-sm lg:block">Theme&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.0</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
            
                
        
                
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="right-bottom-tools rss flex justify-center items-center">
                <a class="flex justify-center items-center"
                   href="/atom.xml"
                   target="_blank"
                >
                <i class="fa-regular fa-rss"></i>
                </a>
            </li>
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/SwupScrollPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/SwupPreloadPlugin.min.js"></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>





 <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/imageViewer.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/layouts/categoryList.js"></script>


    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/localSearch.js"></script>



    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/codeBlock.js"></script>



    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/layouts/lazyload.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/runtime.js"></script>
    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/odometer.min.js"></script>
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/assets/odometer-theme-minimal.css">



  <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/Typed.min.js"></script>
  <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/plugins/typed.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/mermaid.min.js"></script>
    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/plugins/mermaid.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/minimasonry.min.js"></script>
    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/plugins/masonry.js"></script>



<div class="post-scripts" data-swup-reload-script>
    
        <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/libs/anime.min.js"></script>
        <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/tools/tocToggle.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/layouts/toc.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.5.0/source/js/plugins/tabs.js"></script>
    
</div>
 
  <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
