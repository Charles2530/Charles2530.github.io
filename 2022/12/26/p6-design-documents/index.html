<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Charles">
    
    <meta name="author" content="Charles">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://charles2530.github.io/2022/12/26/p6-design-documents/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="post by Charles in 2022-12-26 21:11:47">
<meta property="og:type" content="article">
<meta property="og:title" content="P6 Design documents">
<meta property="og:url" content="http://charles2530.github.io/2022/12/26/p6-design-documents/index.html">
<meta property="og:site_name" content="Charles&#39;s Castle">
<meta property="og:description" content="post by Charles in 2022-12-26 21:11:47">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://charles2530.github.io/image/simple_cpu.png">
<meta property="og:image" content="https://charles2530.github.io/image/4.png">
<meta property="og:image" content="https://charles2530.github.io/image/5.png">
<meta property="og:image" content="https://charles2530.github.io/image/6.png">
<meta property="og:image" content="https://charles2530.github.io/image/7.png">
<meta property="og:image" content="https://charles2530.github.io/image/9.png">
<meta property="og:image" content="https://charles2530.github.io/image/1.jpg">
<meta property="article:published_time" content="2022-12-26T13:11:47.000Z">
<meta property="article:modified_time" content="2023-06-17T06:13:59.318Z">
<meta property="article:author" content="Du Jinyang">
<meta property="article:tag" content="CO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://charles2530.github.io/image/simple_cpu.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="https://charles2530.github.io/image/background/favicon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="https://charles2530.github.io/image/background/favicon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="https://charles2530.github.io/image/background/favicon.png">
    <!--- Page Info-->
    
    <title>
        
            P6 Design documents -
        
        Charles&#39;s Castle
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    
<link rel="stylesheet" href="/assets/fonts.css">

    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"charles2530.github.io","root":"/","language":"en","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["lol","Neo","God"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":true,"title":"recommend_articles","limit":3,"placeholder":"https://charles2530.github.io/image/background/p3.jfif","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":"#1890ff"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"https://charles2530.github.io/image/background/background-light1.jpg","dark":"https://charles2530.github.io/image/background/background-dark1.jpg"},"title":"Charles's Castle","subtitle":{"text":["Happiness is best!","Never give up!","Everyday is a gift!"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000000","dark":"#d1d1b6"},"text_style":{"title_size":"3.2rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Charles2530/","zhihu":"https://www.zhihu.com/people/yang-guang-xiao-zi-55-55","email":"charles2530@163.com"}}},"plugins":{"feed":{"enable":true},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.1.4","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Categories":{"path":"/categories","icon":"fas fa-bookmark"},"Tags":{"path":"/tags","icon":"fas fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/Charles2530/","Blog":"https://charles2530.github.io"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"This is Charles's Castle","links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Photos":{"icon":"fa-solid fa-image","path":"/masonry/"},"Essays":{"icon":"fa-solid fa-message-lines","path":"/essay/"},"Friends":{"icon":"fa-solid fa-user-group","path":"/friends/"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}}};
    Global.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    Global.data_config = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    
<link rel="stylesheet" href="/fontawesome/fontawesome.min.css">

    
<link rel="stylesheet" href="/fontawesome/brands.min.css">

    
<link rel="stylesheet" href="/fontawesome/solid.min.css">

    
<link rel="stylesheet" href="/fontawesome/regular.min.css">

    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Charles's Castle" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>



<body>
  <div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Charles&#39;s Castle
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fas fa-bookmark"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fas fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="https://charles2530.github.io">BLOG
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/categories"  >
                             
                                
                                    <i class="fas fa-bookmark"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/tags"  >
                             
                                
                                    <i class="fas fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/about">ME</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="https://charles2530.github.io">BLOG</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
                      
                <div class="article-title">
                    <img src="https://charles2530.github.io/image/background/p5.jfif" alt="P6 Design documents" />
                    <h1 class="article-title-cover">P6 Design documents</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="https://charles2530.github.io/image/background/logo.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Charles</span>
                            
                                <span class="author-label">Lv6</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2022-12-26 21:11:47</span>
        <span class="mobile">2022-12-26 21:11</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-06-17 14:13:59</span>
            <span class="mobile">2023-06-17 14:13</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Lesson/">Lesson</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/Lesson/CO/">CO</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/Lesson/CO/CO-files/">CO-files</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/CO/">CO</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>11.1k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>53 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="Verilog流水线CPU设计文档"><a href="#Verilog流水线CPU设计文档" class="headerlink" title="Verilog流水线CPU设计文档"></a>Verilog流水线CPU设计文档</h1><h3 id="一、-CPU设计方案综述"><a href="#一、-CPU设计方案综述" class="headerlink" title="一、 CPU设计方案综述"></a>一、 CPU设计方案综述</h3><h4 id="（一）-总体设计概述"><a href="#（一）-总体设计概述" class="headerlink" title="（一） 总体设计概述"></a>（一） 总体设计概述</h4><p>使用Verilog开发一个简单的流水线CPU，总体概述如下：</p>
<ol>
<li><p>此CPU为32位CPU</p>
</li>
<li><p>此CPU为流水线设计</p>
</li>
<li><p>此CPU支持的指令集为：</p>
<p>{add, sub, ori, lw, sw, beq, lui, nop,jal,j,jr}</p>
</li>
<li><p>add, sub不支持溢出</p>
</li>
</ol>
<h4 id="（二）-关键模块定义"><a href="#（二）-关键模块定义" class="headerlink" title="（二） 关键模块定义"></a>（二） 关键模块定义</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/simple_cpu.png"
                      alt="img"
                ></p>
<h2 id="宏的定义"><a href="#宏的定义" class="headerlink" title="宏的定义"></a>宏的定义</h2><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="comment">//alu</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _ADD 12&#x27;b000000000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SUB 12&#x27;b000000000010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _AND 12&#x27;b000000000100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _OR  12&#x27;b000000001000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _XOR 12&#x27;b000000010000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _NOR 12&#x27;b000000100000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SLL 12&#x27;b000001000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SRA 12&#x27;b000010000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SRL 12&#x27;b000100000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SLT 12&#x27;b001000000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SLTU 12&#x27;b010000000000</span></span><br><span class="line"><span class="comment">//ifu</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> PC_Initial 32&#x27;h0000_3000</span></span><br><span class="line"><span class="comment">//ext</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Zero_Ext 3&#x27;b001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Sign_Ext 3&#x27;b010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Lui_Ext  3&#x27;b100</span></span><br><span class="line"><span class="comment">//NPC</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> PC4_NPC 4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> B_transfer_NPC 4&#x27;b0010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> J_transfer_NPC 4&#x27;b0100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Jr_NPC 4&#x27;b1000</span></span><br><span class="line"><span class="comment">//Controller_for_Reg</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ALUop_Initial 7&#x27;b0000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> AluSrc1_Initial 4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> AluSrc2_Initial 4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> WhichtoReg_Initial 8&#x27;b00000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> RegDst_Initial 4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> DM_type_Initial 6&#x27;b000001</span></span><br><span class="line"><span class="comment">//DM</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Word_DM 6&#x27;b000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Half_DM 6&#x27;b000010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Byte_DM 6&#x27;b000100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Unsigned_Half_DM 6&#x27;b001000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Unsigned_Byte_DM 6&#x27;b010000</span></span><br><span class="line"><span class="comment">//B_transfer</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> nop_B_trans 4&#x27;b0000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> beq_B_trans 4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bgez_B_trans 4&#x27;b0010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bgtz_B_trans 4&#x27;b0011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> blez_B_trans 4&#x27;b0100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bltz_B_trans 4&#x27;b0101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bne_B_trans 4&#x27;b0110</span></span><br><span class="line"><span class="comment">//MD_Unit</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> nop_MDU 4&#x27;b0000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mult_MDU 4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> multu_MDU 4&#x27;b0010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> div_MDU 4&#x27;b0011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> divu_MDU 4&#x27;b0100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mfhi_MDU 4&#x27;b0101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mflo_MDU 4&#x27;b0110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mthi_MDU 4&#x27;b0111</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mtlo_MDU 4&#x27;b1000</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="F级流水线"><a href="#F级流水线" class="headerlink" title="F级流水线"></a>F级流水线</h2><h4 id="1-PC"><a href="#1-PC" class="headerlink" title="1. PC"></a>1. PC</h4><p>（1） 端口说明</p>
<center>表1-IFU端口说明</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>同步复位信号，将PC值置为0x0000_3000：<br>0：无效<br>1：复位</td>
</tr>
<tr>
<td>3</td>
<td>en</td>
<td>I</td>
<td>使能信号，决定是否阻塞</td>
</tr>
<tr>
<td>4</td>
<td>NPC[31:0]</td>
<td>I</td>
<td>下一周期PC的地址</td>
</tr>
<tr>
<td>6</td>
<td>PC[31:0]</td>
<td>O</td>
<td>当前执行的PC</td>
</tr>
</tbody>
</table>
</div>
<p>（2） 功能定义</p>
<center>表2-IFU功能定义</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>复位</td>
<td>reset有效时，PC置为0x00003000</td>
</tr>
<tr>
<td>2</td>
<td>更新PC的值</td>
<td>将PC赋值为NPC</td>
</tr>
</tbody>
</table>
</div>
<h2 id="D级流水线"><a href="#D级流水线" class="headerlink" title="D级流水线"></a>D级流水线</h2><h4 id="1-GRF"><a href="#1-GRF" class="headerlink" title="1. GRF"></a>1. GRF</h4><p>（1） 端口说明</p>
<center>表3-GRF端口说明</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>同步复位信号，将32个寄存器中全部清零<br>1：清零<br>0：无效</td>
</tr>
<tr>
<td>3</td>
<td>WE</td>
<td>I</td>
<td>写使能信号<br>1：可向GRF中写入数据<br>0：不能向GRF中写入数据</td>
</tr>
<tr>
<td>4</td>
<td>A1[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，将其中存储的数据读出到RD1</td>
</tr>
<tr>
<td>5</td>
<td>A2[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，将其中存储的数据读出到RD2</td>
</tr>
<tr>
<td>6</td>
<td>A3[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，作为RD的写入地址</td>
</tr>
<tr>
<td>7</td>
<td>WD[31:0]</td>
<td>I</td>
<td>32位写入数据</td>
</tr>
<tr>
<td>8</td>
<td>WPC[31:0]</td>
<td>I</td>
<td>当前写入GRF的PC</td>
</tr>
<tr>
<td>9</td>
<td>RD1[31:0]</td>
<td>O</td>
<td>输出A1指定的寄存器的32位数据</td>
</tr>
<tr>
<td>10</td>
<td>RD2[31:0]</td>
<td>O</td>
<td>输出A2指定的寄存器的32位数据</td>
</tr>
</tbody>
</table>
</div>
<p>（2） 功能定义</p>
<center>表4-GRF功能定义</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>同步复位</td>
<td>reset为1时，将所有寄存器清零</td>
</tr>
<tr>
<td>2</td>
<td>读数据</td>
<td>将A1和A2地址对应的寄存器的值分别通过RD1和RD2读出</td>
</tr>
<tr>
<td>3</td>
<td>写数据</td>
<td>当WE为1且时钟上升沿来临时，将WD写入到A3对应的寄存器内部</td>
</tr>
<tr>
<td>4</td>
<td>内部转发</td>
<td>当A1和A2之一与A3相等且写入信号为1时，用WD代替RD1或RD2的输出</td>
</tr>
</tbody>
</table>
</div>
<h4 id="2-EXT"><a href="#2-EXT" class="headerlink" title="2. EXT"></a>2. EXT</h4><p>(1) 端口说明</p>
<center>表9-EXT端口说明</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>imm16[15:0]</td>
<td>I</td>
<td>代扩展的16位信号</td>
</tr>
<tr>
<td>2</td>
<td>sign[2:0]</td>
<td>I</td>
<td>无符号或符号扩展选择信号<br/>3’b001：无符号扩展<br/>3’b010：符号扩展<br>3’b100:   寄存到高位</td>
</tr>
<tr>
<td>3</td>
<td>imm32[31:0]</td>
<td>O</td>
<td>扩展后的32位的信号</td>
</tr>
</tbody>
</table>
</div>
<p>(2) 功能定义</p>
<center>表10-EXT功能定义</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>无符号扩展</td>
<td>当sign为3’b001时，将imm16无符号扩展输出</td>
</tr>
<tr>
<td>2</td>
<td>符号扩展</td>
<td>当sign为3‘b010时，将imm16符号扩展输出</td>
</tr>
<tr>
<td>3</td>
<td>存储到高位</td>
<td>当sign为3’100时，将imm16存在高16位</td>
</tr>
</tbody>
</table>
</div>
<h4 id="3-Controller"><a href="#3-Controller" class="headerlink" title="3. Controller"></a>3. Controller</h4><p>(1) 端口说明</p>
<center>表11-Controller端口说明</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>op[5:0]</td>
<td>I</td>
<td>instr[31:26]6位控制信号</td>
</tr>
<tr>
<td>2</td>
<td>func[5:0]</td>
<td>I</td>
<td>instr[5:0]6位控制信号</td>
</tr>
<tr>
<td>3</td>
<td>rt[4:0]</td>
<td>I</td>
<td>instr[20:16]5位控制信号</td>
</tr>
<tr>
<td>4</td>
<td>AluOp[11:0]</td>
<td>O</td>
<td>ALU的控制信号</td>
</tr>
<tr>
<td>5</td>
<td>WeGrf</td>
<td>O</td>
<td>GRF写使能信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>6</td>
<td>WeDm</td>
<td>O</td>
<td>DM的写入信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>7</td>
<td>branch[3:0]</td>
<td>O</td>
<td>PC转移位置选择信号<br>4’b0001:其他情况<br>4’b0010:beq<br>4’b0100:j\</td>
<td>\</td>
<td>jal<br>4’b1000:jr;</td>
</tr>
<tr>
<td>8</td>
<td>AluSrc1[3:0]</td>
<td>O</td>
<td>参与ALU运算的第一个数<br/>4’b0001：RD1<br/>4’b0010：RD2</td>
</tr>
<tr>
<td>9</td>
<td>AluSrc2[3:0]</td>
<td>O</td>
<td>参与ALU运算的第二个数，来自GRF还是imm<br/>4’b0001：RD2<br/>4’b0010：imm32<br/>4’b0100: offset</td>
</tr>
<tr>
<td>10</td>
<td>WhichtoReg[7:0]</td>
<td>O</td>
<td>将何种数据写入GRF？<br/>8’b0000_0001：ALU计算结果<br/>8’b0000_0010：DM读出信号<br/>8’b0000_0100：upperImm<br/>8’b0000_1000: PC+4</td>
</tr>
<tr>
<td>11</td>
<td>RegDst[3:0]</td>
<td>O</td>
<td>写入GRF的哪个寄存器？<br>4’b0001:rd<br>4’b0010:rt<br>4’b0100:31号寄存器</td>
</tr>
<tr>
<td>12</td>
<td>SignExt[2:0]</td>
<td>O</td>
<td>拓展方式：<br>3’b001:0拓展<br>3’b010:符号拓展<br>3’b100:存储到高位</td>
</tr>
<tr>
<td>13</td>
<td>B_change[3:0]</td>
<td>O</td>
<td>B转移的类型<br>4’b0001:beq<br>4’b0010:slt<br>4’b0100:blez</td>
</tr>
<tr>
<td>14</td>
<td>DM_type[5:0]</td>
<td>O</td>
<td>存取指令类型：<br>6’b000001:lw/sw<br>6’b000010:lh/sh<br>6’b000100:lb/sb<br />6’b001000:lhu<br />6’b010000:lbu</td>
</tr>
<tr>
<td>15</td>
<td>MDop[3:0]</td>
<td>O</td>
<td>乘除指令选择信号：<br />4‘b0000:无操作<br />4’b0001:mult<br />4’b0010:multu<br />4’b0011:div<br />4’b0100:divu<br />4’b0101:mfhi<br />4’b0110:mflo<br />4’b0111:mthi<br />4’b1000:mtlo</td>
</tr>
<tr>
<td>16</td>
<td>D_Tuse_rs[1:0]</td>
<td>O</td>
<td>指令的rs寄存器的值从第一次进入D级到被使用的周期数</td>
</tr>
<tr>
<td>17</td>
<td>D_Tuse_rt[1:0]</td>
<td>O</td>
<td>指令的rt寄存器的值从第一次进入D级到被使用的周期数</td>
</tr>
<tr>
<td>18</td>
<td>D_Tnew[1:0]</td>
<td>O</td>
<td>指令从进入D开始到产生运算结果需要的周期数</td>
</tr>
</tbody>
</table>
</div>
<h4 id="4-NPC"><a href="#4-NPC" class="headerlink" title="4.NPC"></a>4.NPC</h4><h4 id="NPC（下一指令计算单元）"><a href="#NPC（下一指令计算单元）" class="headerlink" title="NPC（下一指令计算单元）"></a>NPC（下一指令计算单元）</h4><p> 该模块根据当前pc（包括D级和F级）和其他控制信号（NPCOp，CMP输出信息），计算出下一指令所在的地址npc，传入IFU模块。</p>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">信号名</th>
<th style="text-align:left">方向</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F_pc</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级指令地址</td>
</tr>
<tr>
<td style="text-align:left">D_pc</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级指令地址</td>
</tr>
<tr>
<td style="text-align:left">offset</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">地址偏移量，用于计算B类指令所要跳转的地址</td>
</tr>
<tr>
<td style="text-align:left">imm26</td>
<td style="text-align:left">I</td>
<td style="text-align:left">26</td>
<td style="text-align:left">当前指令数据的前26位（0~25），用于计算jal和j指令所要跳转的地址</td>
</tr>
<tr>
<td style="text-align:left">ra</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">储存在寄存器（$ra或是jalr指令中存储“PC+4”的寄存器）中的地址数据，用于实现jr和jalr指令</td>
</tr>
<tr>
<td style="text-align:left">ALU_change</td>
<td style="text-align:left">I</td>
<td style="text-align:left">1</td>
<td style="text-align:left">B类指令判断结果 1：说明当前B类指令的判断结果为真 0：说明判断结果为假</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">I</td>
<td style="text-align:left">4</td>
<td style="text-align:left">NPC功能选择 0x000：顺序执行 0x001：B类指令跳转 0x010: jal/j跳转 0x011: jr/jalr跳转</td>
</tr>
<tr>
<td style="text-align:left">npc</td>
<td style="text-align:left">O</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输出下一指令地址</td>
</tr>
<tr>
<td style="text-align:left">PC8</td>
<td style="text-align:left">O</td>
<td style="text-align:left">32</td>
<td style="text-align:left">jr指令时存储PC+8的值</td>
</tr>
</tbody>
</table>
</div>
<h4 id="5-B-transfer-B类指令比较单元"><a href="#5-B-transfer-B类指令比较单元" class="headerlink" title="5.B_transfer(B类指令比较单元)"></a>5.B_transfer(B类指令比较单元)</h4><p> 该单元根据输入的CMPOp信号对当前B指令的类型进行判断，进而对当前输入的数值进行相应比较，最后输出结果。</p>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">信号名</th>
<th style="text-align:left">方向</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输入B_transfer单元的第一个数据</td>
</tr>
<tr>
<td style="text-align:left">B</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输入B_transfer单元的第二个数据</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:left">I</td>
<td style="text-align:left">4</td>
<td style="text-align:left">Type功能选择信号<br> 0x0001：beq判断<br> 0x0010：slt判断 <br>0x0100：blez判断</td>
</tr>
<tr>
<td style="text-align:left">ALU_change</td>
<td style="text-align:left">O</td>
<td style="text-align:left">1</td>
<td style="text-align:left">判断结果输出 <br>1: 判断结果为真<br> 0：判断结果为假</td>
</tr>
</tbody>
</table>
</div>
<h2 id="E级流水线"><a href="#E级流水线" class="headerlink" title="E级流水线"></a>E级流水线</h2><h4 id="1-ALU"><a href="#1-ALU" class="headerlink" title="1. ALU"></a>1. ALU</h4><p>(1) 端口说明</p>
<center>表5-ALU端口说明</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A[31:0]</td>
<td>I</td>
<td>参与运算的第一个数</td>
</tr>
<tr>
<td>2</td>
<td>B[31:0]</td>
<td>I</td>
<td>参与运算的第二个数</td>
</tr>
<tr>
<td>3</td>
<td>ALUop[11:0]</td>
<td>I</td>
<td>决定ALU做何种操作<br>12’b0000_0000_0001：无符号加<br/>12’b0000_0000_0010：无符号减<br/>12’b0000_0000_0100：与<br/>12’b0000_0000_1000：或<br/>12‘b0000_0001_0000:异或<br />12‘b0000_0010_0000:或非<br />12‘b0000_0100_0000:sll<br />12‘b0000_1000_0000:sra<br />12‘b0001_0000_0000:srl<br />12‘b0010_0000_0000:slt<br />12‘b0100_0000_0000:sltu</td>
</tr>
<tr>
<td>4</td>
<td>res</td>
<td>O</td>
<td>A与B做运算后的结果</td>
</tr>
</tbody>
</table>
</div>
<p>(2) 功能定义</p>
<center>表6-ALU功能定义</center>

<div class="table-container">
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>加运算</td>
<td>res = A + B</td>
</tr>
<tr>
<td>2</td>
<td>减运算</td>
<td>res = A - B</td>
</tr>
<tr>
<td>3</td>
<td>与运算</td>
<td>res = A &amp; B</td>
</tr>
<tr>
<td>4</td>
<td>或运算</td>
<td>res = A \</td>
<td>B</td>
</tr>
<tr>
<td>5</td>
<td>左移位运算</td>
<td>Res=A&lt;&lt;B</td>
</tr>
</tbody>
</table>
</div>
<h4 id="2-MD-Unit"><a href="#2-MD-Unit" class="headerlink" title="2.MD_Unit"></a>2.MD_Unit</h4><ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">MD_Unit使能信号</td>
<td style="text-align:left">判断是否为乘除计算</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">MDop</td>
<td style="text-align:left">4</td>
<td style="text-align:left">指令选择信号</td>
<td style="text-align:left">Controller</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">A</td>
<td style="text-align:left">32</td>
<td style="text-align:left">第一个计算数</td>
<td style="text-align:left">e_A</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">B</td>
<td style="text-align:left">32</td>
<td style="text-align:left">第二个计算数</td>
<td style="text-align:left">e_B</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">HI</td>
<td style="text-align:left">32</td>
<td style="text-align:left">HI寄存器输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">LO</td>
<td style="text-align:left">32</td>
<td style="text-align:left">LO寄存器输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">取出HI或LO的值</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">busy</td>
<td style="text-align:left">1</td>
<td style="text-align:left">是否在进行乘除计算</td>
</tr>
</tbody>
</table>
</div>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> MD_Unit(<span class="keyword">input</span> clk,</span><br><span class="line">               <span class="keyword">input</span> reset,</span><br><span class="line">               <span class="keyword">input</span> en,</span><br><span class="line">               <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] MDop,</span><br><span class="line">               <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] A,</span><br><span class="line">               <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] B,</span><br><span class="line">               <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] HI,</span><br><span class="line">               <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] LO,</span><br><span class="line">               <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] out,</span><br><span class="line">               <span class="keyword">output</span> busy);</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] cnt     = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">parameter</span> MU_cycle = <span class="number">5</span>,D_cycle = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            HI  &lt;= <span class="number">0</span>;</span><br><span class="line">            LO  &lt;= <span class="number">0</span>;</span><br><span class="line">            cnt &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (busy)<span class="keyword">begin</span></span><br><span class="line">            cnt &lt;= cnt-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">case</span>(MDop)</span><br><span class="line">                `nop_MDU:<span class="keyword">begin</span></span><br><span class="line">                    </span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `mult_MDU:<span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (en)<span class="keyword">begin</span></span><br><span class="line">                        &#123;HI,LO&#125; &lt;= <span class="built_in">$signed</span>(A)*<span class="built_in">$signed</span>(B);</span><br><span class="line">                        cnt     &lt;= MU_cycle;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `multu_MDU:<span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (en)<span class="keyword">begin</span></span><br><span class="line">                        &#123;HI,LO&#125; &lt;= A*B;</span><br><span class="line">                        cnt     &lt;= MU_cycle;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `div_MDU:<span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (en)<span class="keyword">begin</span></span><br><span class="line">                        HI  &lt;= <span class="built_in">$signed</span>(A)%<span class="built_in">$signed</span>(B);</span><br><span class="line">                        LO  &lt;= <span class="built_in">$signed</span>(A)/<span class="built_in">$signed</span>(B);</span><br><span class="line">                        cnt &lt;= D_cycle;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `divu_MDU:<span class="keyword">begin</span></span><br><span class="line">                    <span class="keyword">if</span> (en)<span class="keyword">begin</span></span><br><span class="line">                        HI  &lt;= A%B;</span><br><span class="line">                        LO  &lt;= A/B;</span><br><span class="line">                        cnt &lt;= D_cycle;</span><br><span class="line">                    <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `mfhi_MDU:<span class="keyword">begin</span></span><br><span class="line">                   <span class="comment">//out &lt;= HI;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `mflo_MDU:<span class="keyword">begin</span></span><br><span class="line">                   <span class="comment">//out &lt;= LO;</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `mthi_MDU:<span class="keyword">begin</span></span><br><span class="line">                   HI &lt;= A;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                `mtlo_MDU:<span class="keyword">begin</span></span><br><span class="line">                   LO &lt;= A;</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">endcase</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> busy = (cnt != <span class="number">0</span>);</span><br><span class="line">    <span class="keyword">assign</span> out= (MDop==`mflo_MDU)?LO:</span><br><span class="line">                (MDop==`mfhi_MDU)?HI:</span><br><span class="line">                <span class="number">32&#x27;b0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="M级流水线"><a href="#M级流水线" class="headerlink" title="M级流水线"></a>M级流水线</h2><h4 id="1-DM-In"><a href="#1-DM-In" class="headerlink" title="1. DM_In"></a>1. DM_In</h4><ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">low2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">Address低两位</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">WD</td>
<td style="text-align:left">31</td>
<td style="text-align:left">处理前写入结果</td>
<td style="text-align:left">32位写入数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">决定存取指令类型</td>
<td style="text-align:left">存取指令类型：<br/>6’b000001:lw/sw<br/>6’b000010:lh/sh<br/>6’b000100:lb/sb<br />6’b001000:lhu<br />6’b010000:lbu</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">data_byteen</td>
<td style="text-align:left">4</td>
<td style="text-align:left">字节使能信号</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">DM_input</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理后的写入结果</td>
</tr>
</tbody>
</table>
</div>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> DM_In(<span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] low2,</span><br><span class="line">             <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WD,</span><br><span class="line">             <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] DM_type,</span><br><span class="line"></span><br><span class="line">             <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] data_byteen,</span><br><span class="line">             <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] DM_input</span><br><span class="line">             );</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] new_b;</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] new_h;</span><br><span class="line"><span class="comment">//initial</span></span><br><span class="line"><span class="keyword">assign</span> new_b=WD[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line"><span class="comment">// assign new_b =  (low2 == 2&#x27;b00)?WD[7:0]:</span></span><br><span class="line">                <span class="comment">// (low2 == 2&#x27;b01)?WD[15:8]:</span></span><br><span class="line">                <span class="comment">// (low2 == 2&#x27;b10)?WD[23:16]:</span></span><br><span class="line">                <span class="comment">//                 WD[31:24];</span></span><br><span class="line"><span class="comment">// assign new_h = (low2[1] == 1&#x27;b1)? WD[31:16]:</span></span><br><span class="line"><span class="comment">//                                   WD[15:0];</span></span><br><span class="line"><span class="keyword">assign</span> new_h=WD[<span class="number">15</span>:<span class="number">0</span>];</span><br><span class="line"><span class="comment">//lb,sb</span></span><br><span class="line"><span class="keyword">assign</span> data_byteen =  (DM_type == `Word_DM)?<span class="number">4&#x27;b1111</span>:</span><br><span class="line">                      (DM_type == `Half_DM||DM_type == `Unsigned_Half_DM)?( (low2[<span class="number">1</span>] == <span class="number">1&#x27;b1</span>)?<span class="number">4&#x27;b1100</span>:<span class="number">4&#x27;b0011</span>):</span><br><span class="line">                      (DM_type == `Byte_DM||DM_type == `Unsigned_Byte_DM)?( (low2 == <span class="number">2&#x27;b00</span>)?<span class="number">4&#x27;b0001</span>:</span><br><span class="line">                                                                            (low2 == <span class="number">2&#x27;b01</span>)?<span class="number">4&#x27;b0010</span>:</span><br><span class="line">                                                                            (low2 == <span class="number">2&#x27;b10</span>)?<span class="number">4&#x27;b0100</span>:</span><br><span class="line">                                                                            <span class="number">4&#x27;b1000</span>):</span><br><span class="line">                                                                            <span class="number">4&#x27;b0000</span>;</span><br><span class="line"><span class="comment">//lh,sh</span></span><br><span class="line"><span class="keyword">assign</span> DM_input =   (DM_type == `Word_DM)?WD:</span><br><span class="line">                    (DM_type == `Half_DM||DM_type == `Unsigned_Half_DM)?((low2[<span class="number">1</span>] == <span class="number">1&#x27;b1</span>)?&#123;new_h,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:&#123;&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,new_h&#125;):</span><br><span class="line">                    (DM_type == `Byte_DM||DM_type == `Unsigned_Byte_DM)?((low2 == <span class="number">2&#x27;b00</span>)?&#123;&#123;<span class="number">24</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,new_b&#125;:</span><br><span class="line">                                                                        (low2 == <span class="number">2&#x27;b01</span>)?&#123;&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,new_b,&#123;<span class="number">8</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                                                                        (low2 == <span class="number">2&#x27;b10</span>)?&#123;&#123;<span class="number">8</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,new_b,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                                                                        &#123;new_b,&#123;<span class="number">24</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;):</span><br><span class="line">                                                                        <span class="number">32&#x27;d0</span>;</span><br><span class="line"><span class="comment">// assign DM_input = WD;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="2-DM-Out"><a href="#2-DM-Out" class="headerlink" title="2.DM_Out"></a>2.DM_Out</h4><ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">low2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">Address低两位</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_output</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理前读入信号</td>
<td style="text-align:left">32位读入数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">决定存取指令类型</td>
<td style="text-align:left">存取指令类型：<br/>6’b000001:lw/sw<br/>6’b000010:lh/sh<br/>6’b000100:lb/sb<br />6’b001000:lhu<br />6’b010000:lbu</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理后的读入结果</td>
</tr>
</tbody>
</table>
</div>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> DM_Out(<span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] low2,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] DM_type,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] DM_output,</span><br><span class="line"></span><br><span class="line">              <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RD</span><br><span class="line">              );</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] DM_output_3,DM_output_2,DM_output_1,DM_output_0;</span><br><span class="line">    <span class="keyword">assign</span> DM_output_0 = DM_output[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> DM_output_1 = DM_output[<span class="number">15</span>:<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">assign</span> DM_output_2 = DM_output[<span class="number">23</span>:<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">assign</span> DM_output_3 = DM_output[<span class="number">31</span>:<span class="number">24</span>];</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] out_h,out_b,out_hu,out_bu;</span><br><span class="line">    <span class="comment">//sb,lb</span></span><br><span class="line">    <span class="keyword">assign</span> out_bu = (low2 == <span class="number">2&#x27;b00</span>)?&#123;&#123;<span class="number">24</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,DM_output_0&#125;:</span><br><span class="line">                    (low2 == <span class="number">2&#x27;b01</span>)?&#123;&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,DM_output_1,&#123;<span class="number">8</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                    (low2 == <span class="number">2&#x27;b10</span>)?&#123;&#123;<span class="number">8</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,DM_output_2,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                    &#123;DM_output_3,&#123;<span class="number">24</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;;</span><br><span class="line">    <span class="keyword">assign</span> out_b =  (low2 == <span class="number">2&#x27;b00</span>)?&#123;&#123;<span class="number">24</span>&#123;DM_output_0[<span class="number">7</span>]&#125;&#125;,DM_output_0&#125;:</span><br><span class="line">                    (low2 == <span class="number">2&#x27;b01</span>)?&#123;&#123;<span class="number">16</span>&#123;DM_output_1[<span class="number">7</span>]&#125;&#125;,DM_output_1,&#123;<span class="number">8</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                    (low2 == <span class="number">2&#x27;b10</span>)?&#123;&#123;<span class="number">8</span>&#123;DM_output_2[<span class="number">7</span>]&#125;&#125;,DM_output_2,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                    &#123;DM_output_3,&#123;<span class="number">24</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;;</span><br><span class="line">    <span class="comment">//sh,lh</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] low_h;</span><br><span class="line">    <span class="keyword">assign</span> low_h = (low2 == <span class="number">2&#x27;b00</span>)? &#123;DM_output_1,DM_output_0&#125;:</span><br><span class="line">                                    &#123;DM_output_3,DM_output_2&#125;;</span><br><span class="line">    <span class="keyword">assign</span> out_hu =(low2[<span class="number">1</span>] == <span class="number">1&#x27;b1</span>)?&#123;low_h,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;: </span><br><span class="line">                                    &#123;&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,low_h&#125;;</span><br><span class="line">    <span class="keyword">assign</span> out_h = (low2[<span class="number">1</span>] == <span class="number">1&#x27;b1</span>)? &#123;low_h,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;:</span><br><span class="line">                                    &#123;&#123;<span class="number">16</span>&#123;low_h[<span class="number">15</span>]&#125;&#125;,low_h&#125;;</span><br><span class="line">    <span class="comment">//output</span></span><br><span class="line">    <span class="keyword">assign</span> RD = (DM_type == `Word_DM)?DM_output:</span><br><span class="line">                (DM_type == `Half_DM)?(out_h):</span><br><span class="line">                (DM_type == `Byte_DM)?out_b:</span><br><span class="line">                (DM_type == `Unsigned_Half_DM)?out_hu:</span><br><span class="line">                (DM_type == `Unsigned_Byte_DM)?out_bu:</span><br><span class="line">                <span class="number">32&#x27;b0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="各级流水线寄存器"><a href="#各级流水线寄存器" class="headerlink" title="各级流水线寄存器"></a>各级流水线寄存器</h2><h4 id="1-IF-ID"><a href="#1-IF-ID" class="headerlink" title="1.IF_ID"></a>1.IF_ID</h4><h4 id="D-Reg（IF-ID流水寄存器）"><a href="#D-Reg（IF-ID流水寄存器）" class="headerlink" title="D_Reg（IF/ID流水寄存器）"></a>D_Reg（IF/ID流水寄存器）</h4><ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级寄存器使能信号</td>
<td style="text-align:left">stall信号取反</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_instr</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级instr输入</td>
<td style="text-align:left">IFU_instr</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_pc</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级pc输入</td>
<td style="text-align:left">IFU_pc</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_instr</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级instr输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_pc</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级pc输出</td>
</tr>
</tbody>
</table>
</div>
<h4 id="2-ID-EX"><a href="#2-ID-EX" class="headerlink" title="2.ID_EX"></a>2.ID_EX</h4><h4 id="E-Reg（ID-EX流水寄存器）"><a href="#E-Reg（ID-EX流水寄存器）" class="headerlink" title="E_Reg（ID/EX流水寄存器）"></a>E_Reg（ID/EX流水寄存器）</h4><ul>
<li><strong>端口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clr</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级寄存器清空信号</td>
<td style="text-align:left">HazardUnit中stall信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RD1</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级GRF输出RD1</td>
<td style="text-align:left">通过B_transfer_D1转发的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级GRF输出RD2</td>
<td style="text-align:left">通过B_transfer_D2转发的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_instr_s</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级instr的shamt</td>
<td style="text-align:left">D_instr的s域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A1输入</td>
<td style="text-align:left">D_instr的rs域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A2输入</td>
<td style="text-align:left">D_instr的rt域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A3输入</td>
<td style="text-align:left">通过MUX_A3选择出的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级imm32输入</td>
<td style="text-align:left">通过EXT模块扩展出的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Tnew_D</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D级指令的Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_ALUop</td>
<td style="text-align:left">7</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_AluSrc1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_AluSrc2</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级ALU_change输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_MDop</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级MDop输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RD1</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD1输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_instr_s</td>
<td style="text-align:left">5</td>
<td style="text-align:left">移位指令的位移数</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A1输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级指令的Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_ALUop</td>
<td style="text-align:left">7</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_AluSrc1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_AluSrc2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RegDst</td>
<td style="text-align:left">3</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级ALU_change输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_MDop</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级MDop输出</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><strong>运算功能</strong></p>
<p>Tnew_E = (Tnew_D &gt; 0) ? Tnew_D - 1: 0Tnew_E=(Tnew_D&gt;0)?Tnew_D−1:0</p>
</li>
</ul>
<h5 id="3-EX-MEM"><a href="#3-EX-MEM" class="headerlink" title="3.EX_MEM"></a>3.EX_MEM</h5><h4 id="M-Reg（EX-MEM流水寄存器）"><a href="#M-Reg（EX-MEM流水寄存器）" class="headerlink" title="M_Reg（EX/MEM流水寄存器）"></a>M_Reg（EX/MEM流水寄存器）</h4><ul>
<li>端口定义</li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2输入</td>
<td style="text-align:left">ALU_out数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3输入（转发值）</td>
<td style="text-align:left">MUX_ALU选择出来的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD2输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级res输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级ALU_change输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级imm32输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级RD2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级res输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级ALU_change输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级imm32输出</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><p><strong>运算功能</strong></p>
<p>Tnew_M = (Tnew_E &gt; 0) ? Tnew_E - 1: 0Tnew_M=(Tnew_E&gt;0)?Tnew_E−1:0</p>
</li>
</ul>
<h5 id="4-MEM-WB"><a href="#4-MEM-WB" class="headerlink" title="4.MEM_WB"></a>4.MEM_WB</h5><h4 id="W-Reg（MEM-WB流水寄存器）"><a href="#W-Reg（MEM-WB流水寄存器）" class="headerlink" title="W_Reg（MEM/WB流水寄存器）"></a>W_Reg（MEM/WB流水寄存器）</h4><ul>
<li><strong>接口定义</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级RD输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级imm32输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级ALU_change输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">W级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级res输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级RD输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级ALU_change输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">W级Tnew输出</td>
</tr>
</tbody>
</table>
</div>
<h2 id="暂停、转发处理及相关多路选择器"><a href="#暂停、转发处理及相关多路选择器" class="headerlink" title="暂停、转发处理及相关多路选择器"></a>暂停、转发处理及相关多路选择器</h2><h3 id="（一）-冲突综合单元（HazardUnit"><a href="#（一）-冲突综合单元（HazardUnit" class="headerlink" title="（一）.冲突综合单元（HazardUnit)"></a>（一）.冲突综合单元（HazardUnit)</h3><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A1端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A1端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">W级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Tuse_rs</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D_Tuse_rs输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Tuse_rt</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D_Tuse_rt输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">W级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">E级WhichtoReg输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">M级WhichtoReg输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">start</td>
<td style="text-align:left">1</td>
<td style="text-align:left">乘除开始信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">busy</td>
<td style="text-align:left">1</td>
<td style="text-align:left">乘除忙碌信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">MDU_en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级将进行乘除运算信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelB_D1</td>
<td style="text-align:left">2</td>
<td style="text-align:left">B_transfer的D1输入转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelB_D2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">B_transfer的D2输入转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelALU_A</td>
<td style="text-align:left">2</td>
<td style="text-align:left">ALU输入A转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelALU_B</td>
<td style="text-align:left">2</td>
<td style="text-align:left">ALU输入B转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelDM</td>
<td style="text-align:left">1</td>
<td style="text-align:left">DM写入WD转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">stall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">冲突信号</td>
</tr>
</tbody>
</table>
</div>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> HazardUnit(<span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A1,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A2,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A1,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A2,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] M_A2,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A3,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] M_A3,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] W_A3,</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tuse_rs,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tuse_rt,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] E_Tnew,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] M_Tnew,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] W_Tnew,</span><br><span class="line">                  <span class="keyword">input</span> E_Wegrf,</span><br><span class="line">                  <span class="keyword">input</span> M_Wegrf,</span><br><span class="line">                  <span class="keyword">input</span> W_Wegrf,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] E_WhichtoReg,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] M_WhichtoReg,</span><br><span class="line">                  <span class="keyword">input</span> start,</span><br><span class="line">                  <span class="keyword">input</span> busy,</span><br><span class="line">                  <span class="keyword">input</span> MDU_en,</span><br><span class="line"></span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] SelB_D1,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>] SelB_D2,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelALU_A,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelALU_B,</span><br><span class="line">                  <span class="keyword">output</span> SelDM,</span><br><span class="line">                  <span class="keyword">output</span> stall</span><br><span class="line">                  );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//stall</span></span><br><span class="line"><span class="keyword">wire</span> stall_rs,stall_rt,stall_md;</span><br><span class="line"><span class="comment">//stop</span></span><br><span class="line"><span class="keyword">assign</span> stall_rs = (D_A1!= <span class="number">0</span>)&amp;&amp;((D_Tuse_rs&lt;E_Tnew)&amp;&amp;(D_A1 == E_A3)&amp;&amp;E_Wegrf||</span><br><span class="line">						(D_Tuse_rs&lt;M_Tnew)&amp;&amp;(D_A1 == M_A3)&amp;&amp;M_Wegrf||</span><br><span class="line">						(D_Tuse_rs&lt;W_Tnew)&amp;&amp;(D_A1 == W_A3)&amp;&amp;W_Wegrf);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall_rt = (D_A2!= <span class="number">0</span>)&amp;&amp;((D_Tuse_rt&lt;E_Tnew)&amp;&amp;(D_A2 == E_A3)&amp;&amp;E_Wegrf||</span><br><span class="line">						(D_Tuse_rt&lt;M_Tnew)&amp;&amp;(D_A2 == M_A3)&amp;&amp;M_Wegrf||</span><br><span class="line">						(D_Tuse_rt&lt;W_Tnew)&amp;&amp;(D_A2 == W_A3)&amp;&amp;W_Wegrf);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall_md=(start||busy)&amp;&amp;(MDU_en);</span><br><span class="line"></span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelB_D1 =(D_A1 == E_A3)&amp;&amp;(E_Tnew == <span class="number">0</span>)&amp;&amp;D_A1&amp;&amp;E_Wegrf&amp;&amp;(E_WhichtoReg==<span class="number">8&#x27;b0000_1000</span>)?<span class="number">3&#x27;b100</span>:</span><br><span class="line">                (D_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;D_A1&amp;&amp;M_Wegrf&amp;&amp;(M_WhichtoReg==<span class="number">8&#x27;b0000_1000</span>)?<span class="number">3&#x27;b011</span>:</span><br><span class="line">                (D_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;D_A1&amp;&amp;M_Wegrf?<span class="number">3&#x27;b010</span>:</span><br><span class="line">                (D_A1 == W_A3)&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;D_A1&amp;&amp;W_Wegrf?<span class="number">3&#x27;b001</span>:</span><br><span class="line">                <span class="number">3&#x27;b000</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelB_D2 =(D_A2 == E_A3)&amp;&amp;(E_Tnew == <span class="number">0</span>)&amp;&amp;D_A2&amp;&amp;E_Wegrf&amp;&amp;(E_WhichtoReg==<span class="number">8&#x27;b0000_1000</span>)?<span class="number">3&#x27;b100</span>:</span><br><span class="line">                (D_A2 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;D_A2&amp;&amp;M_Wegrf&amp;&amp;(M_WhichtoReg==<span class="number">8&#x27;b0000_1000</span>)?<span class="number">3&#x27;b011</span>:</span><br><span class="line">                (D_A2 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;D_A2&amp;&amp;M_Wegrf?<span class="number">3&#x27;b010</span>:</span><br><span class="line">                (D_A2 == W_A3)&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;D_A2&amp;&amp;W_Wegrf?<span class="number">3&#x27;b001</span>:</span><br><span class="line">                <span class="number">3&#x27;b000</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelALU_A = (E_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;E_A1&amp;&amp;M_Wegrf&amp;&amp;(M_WhichtoReg==<span class="number">8&#x27;b0000_1000</span>)?<span class="number">2&#x27;b11</span>:</span><br><span class="line">                  (E_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;E_A1&amp;&amp;M_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">						      (E_A1 == W_A3)&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;E_A1&amp;&amp;W_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">						      <span class="number">2&#x27;b00</span>;</span><br><span class="line"><span class="comment">//assign SelALU_A = 2&#x27;b00;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelALU_B = (E_A2 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;E_A2&amp;&amp;M_Wegrf&amp;&amp;(M_WhichtoReg==<span class="number">8&#x27;b0000_1000</span>)?<span class="number">2&#x27;b11</span>:</span><br><span class="line">                  (E_A2 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;E_A2&amp;&amp;M_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">						      (E_A2 == W_A3)&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;E_A2&amp;&amp;W_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">						      <span class="number">2&#x27;b00</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelDM   = (M_A3 == W_A3)&amp;&amp;M_A3&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;W_Wegrf;</span><br><span class="line"><span class="comment">//assign SelDM = 1&#x27;b0;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall = stall_rs||stall_rt||stall_md;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h3 id="（二）-控制和冒险简述"><a href="#（二）-控制和冒险简述" class="headerlink" title="（二）.控制和冒险简述"></a>（二）.控制和冒险简述</h3><ul>
<li><p>对于控制冒险，本实验要求大家实现<strong>比较过程前移至 D 级</strong>，并<strong>采用延迟槽</strong>。</p>
</li>
<li><p>对于数据冒险，两大策略及其应用：</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假设当前我需要的数据，其实已经计算出来，只是还没有进入寄存器堆，那么我们可以用<span class="strong">**转发**</span>( Forwarding )来解决，即不引用寄存器堆的值，而是直接从后面的流水级的供给者把计算结果发送到前面流水级的需求者来引用。如果我们需要的数据还没有算出来。则我们就只能<span class="strong">**暂停**</span>( Stall )，让流水线停止工作，等到我们需要的数据计算完毕，再开始下面的工作。</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
<h3 id="三）-冒险处理"><a href="#三）-冒险处理" class="headerlink" title="(三）.冒险处理"></a>(三）.冒险处理</h3><p>冒险处理我们均通过“A_T”法实现——</p>
<h4 id="转发（forward）"><a href="#转发（forward）" class="headerlink" title="转发（forward）"></a>转发（forward）</h4><p>当前面的指令要写寄存器但还未写入，而后面的指令需要用到没有被写入的值时，这时候会产生<strong>数据冒险</strong>，我们首先考虑进行转发。我们<strong>假设所有的数据冒险均可通过转发解决</strong>。也就是说，当某一指令前进到必须使用某一寄存器的值的流水阶段时，这个寄存器的值一定已经产生，并<strong>存储于后续某个流水线寄存器中</strong>。</p>
<p>在这一阶段，我们不管需要的值有没由计算出，都要进行转发，即暴力转发。为实现这一机制，我们要清楚哪些模块需要转发后的数据（<strong>需求者</strong>）和保存着写入值的流水寄存器（<strong>供应者</strong>）</p>
<ul>
<li><strong>供应者及其产生的数据</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">流水级</th>
<th style="text-align:left">产生数据</th>
<th style="text-align:left">MUX名&amp;选择信号名</th>
<th style="text-align:left">MUX输出名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">E</td>
<td style="text-align:left">E_imm32，<br/>E_PC8</td>
<td style="text-align:left">直接流水线传递</td>
<td style="text-align:left">直接流水线传递</td>
</tr>
<tr>
<td style="text-align:left">M</td>
<td style="text-align:left">M_ALUout，<br/>M_PC8</td>
<td style="text-align:left">直接流水线传递</td>
<td style="text-align:left">直接流水线传递</td>
</tr>
<tr>
<td style="text-align:left">W</td>
<td style="text-align:left">w_res，<br/>w_RD，<br/>w_imm32,<br>W_PC8</td>
<td style="text-align:left">w_WhichtoReg</td>
<td style="text-align:left">WD</td>
</tr>
</tbody>
</table>
</div>
<p>  注：当M级指令为读hi和lo的指令时， M_AO中的结果是从上一周期在乘除槽中读取的hi或lo的值；如果是其他指令，M_AO是上一周期ALU的计算结果。</p>
<ul>
<li><strong>需求者及其产生的数据</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">接收端口</th>
<th style="text-align:left">选择数据</th>
<th style="text-align:left">HMUX名&amp;选择信号名</th>
<th style="text-align:left">MUX输出名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">B_transfer_D1</td>
<td style="text-align:left">D_V1,<br/>M_out,<br/>E_out</td>
<td style="text-align:left">SelB_D1</td>
<td style="text-align:left">d_b_transfer1</td>
</tr>
<tr>
<td style="text-align:left">B_transfer_D2</td>
<td style="text-align:left">d_RD2,<br>m_res,<br>e_res</td>
<td style="text-align:left">SelB_D2</td>
<td style="text-align:left">d_b_transfer2</td>
</tr>
<tr>
<td style="text-align:left">ALU_A</td>
<td style="text-align:left">e_RD1，<br/> WD，<br/>m_res</td>
<td style="text-align:left">SelALU_A</td>
<td style="text-align:left">e_A</td>
</tr>
<tr>
<td style="text-align:left">ALU_B</td>
<td style="text-align:left">e_RD2，<br/>WD，<br/>m_res</td>
<td style="text-align:left">SelALU_B</td>
<td style="text-align:left">e_B</td>
</tr>
<tr>
<td style="text-align:left">DM_WD</td>
<td style="text-align:left">m_RD2，<br/> WD</td>
<td style="text-align:left">SelDM</td>
<td style="text-align:left">M_WD_f</td>
</tr>
<tr>
<td style="text-align:left">NPC_ra</td>
<td style="text-align:left">D_V1_f ,<br/> E_PC8 ,<br/> M_PC8</td>
<td style="text-align:left">SelJr</td>
<td style="text-align:left">ra</td>
</tr>
</tbody>
</table>
</div>
<p>从上表可以看出，W级中的数据没有转发到D级，原因是我们在GRF内实现了内部转发机制，将GRF输入端的数据（还未写入）及时反映到RD1或这RD2，判断条件为<code>A3 == A2</code>或者<code>A3 == A1</code>。</p>
<p>此时为了生成HMUX的选择信号，我们需要向HCU（冒险控制器）输入”A”数据，然后进行选择信号的计算，执行转发的条件为——</p>
<ul>
<li><p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为 0</strong></p>
</li>
<li><p><strong>写使能信号有效</strong></p>
<h4 id="转发的构造"><a href="#转发的构造" class="headerlink" title="转发的构造"></a>转发的构造</h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/4.png"
                      alt="img"
                ></p>
</li>
</ul>
<h4 id="暂停（stall）"><a href="#暂停（stall）" class="headerlink" title="暂停（stall）"></a>暂停（stall）</h4><p>接下来，我们来处理通过转发不能处理的数据冒险。在这种情况下，新的数据还未来得及产生。我们只能暂停流水线，等待新的数据产生。为了方便处理，我们仅仅为D级的指令进行暂停处理。</p>
<p>我们把Tuse和Tnew作为暂停的判断依据——</p>
<ul>
<li>Tuse：指令进入 <strong>D 级</strong>后，其后的某个功能部件<strong>再</strong>经过多少时钟周期就<strong>必须</strong>要使用寄存器值。对于有两个操作数的指令，其<strong>每个操作数的 Tuse 值可能不等</strong>（如 store 型指令 rs、rt 的 Tuse 分别为 1 和 2 ）。</li>
<li>Tnew：位于 <strong>E 级及其后各级</strong>的指令，再经过多少周期就能够产生要写入寄存器的结果。在我们目前的 CPU 中，W 级的指令Tnew 恒为 0；对于同一条指令，Tnew@M = max(Tnew@E - 1, 0)、</li>
</ul>
<p>在这一阶段，我们找到D级生成的Tuse_rs和Tuse_rt和在E,M,W级寄存器中流水的Tnew_D，Tnew_M，Tnew_W，如下表所示</p>
<ul>
<li><strong>Tuse表和计算表达式</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">指令类型</th>
<th style="text-align:left">Tuse_rs</th>
<th style="text-align:left">Tuse_rt</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">calc_R</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">calc_I</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:left">X</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">shiftv</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">load</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">store</td>
<td style="text-align:left">1</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">md</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">mt</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mf</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">j / jr</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">jal / jalr</td>
<td style="text-align:left">0</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">lui</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
</tbody>
</table>
</div>
<ul>
<li><strong>Tnew表和计算表达式</strong></li>
</ul>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">指令类型</th>
<th style="text-align:left">Tnew_D</th>
<th style="text-align:left">Tnew_E</th>
<th style="text-align:left">Tnew_M</th>
<th style="text-align:left">Tnew_W</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">calc_R</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">calc_I</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">shiftv</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">load</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">store</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">md</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mt</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mf</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">jal / jalr</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">j / jr</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">lui</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
</tbody>
</table>
</div>
<p>然后我们Tnew和Tuse传入HCU（冒险控制器中），然后进行stall信号的计算。如果满足以下条件则stall有效——</p>
<ul>
<li><p><strong>Tnew &gt; Tuse</strong></p>
</li>
<li><p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为 0</strong></p>
</li>
<li><p><strong>写使能信号有效</strong></p>
</li>
<li><p><strong>当E级延迟槽在进行运算（<code>start | busy</code>）时，D级为md、mt、mf指令</strong></p>
</li>
<li><h4 id="阻塞的构造（D级）"><a href="#阻塞的构造（D级）" class="headerlink" title="阻塞的构造（D级）"></a><strong>阻塞的构造（D级）</strong></h4><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/5.png"
                      alt=""
                ></p>
</li>
</ul>
<h2 id="真值表"><a href="#真值表" class="headerlink" title="真值表"></a>真值表</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">端口</th>
<th>addu</th>
<th>subu</th>
<th>ori</th>
<th>lw</th>
<th>sw</th>
<th>lui</th>
<th>beq</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">op</td>
<td>000000</td>
<td>000000</td>
<td>001101</td>
<td>100011</td>
<td>101011</td>
<td>001111</td>
<td>000100</td>
</tr>
<tr>
<td style="text-align:center">func</td>
<td>100001</td>
<td>100011</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">AluOp</td>
<td>0000001</td>
<td>0000010</td>
<td>0001000</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
</tr>
<tr>
<td style="text-align:center">WeGrf</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">WeDm</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">branch</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
</tr>
<tr>
<td style="text-align:center">AluSrc1</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc2</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">WhichtoReg</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0001</td>
<td>0100</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">RegDst</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>1010</td>
</tr>
<tr>
<td style="text-align:center">SignExt</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center"><strong>端口</strong></td>
<td><strong>andi</strong></td>
<td><strong>jal</strong></td>
<td><strong>j</strong></td>
<td><strong>jr</strong></td>
<td><strong>sll</strong></td>
<td><strong>add</strong></td>
<td><strong>sub</strong></td>
</tr>
<tr>
<td style="text-align:center">op</td>
<td>001100</td>
<td>000011</td>
<td>000010</td>
<td>000000</td>
<td>000000</td>
<td>000000</td>
<td>000000</td>
</tr>
<tr>
<td style="text-align:center">func</td>
<td></td>
<td></td>
<td></td>
<td>001000</td>
<td>000000</td>
<td>100000</td>
<td>100010</td>
</tr>
<tr>
<td style="text-align:center">AluOp</td>
<td>0000100</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
<td>0010000</td>
<td>0000000</td>
<td>0000001</td>
</tr>
<tr>
<td style="text-align:center">WeGrf</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center">WeDm</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">branch</td>
<td>0001</td>
<td>0100</td>
<td>0100</td>
<td>1000</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc1</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc2</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0100</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">WhichtoReg</td>
<td>0001</td>
<td>1000</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">RegDst</td>
<td>0010</td>
<td>0100</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">SignExt</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
</div>
<h3 id="二、-测试方案"><a href="#二、-测试方案" class="headerlink" title="二、 测试方案"></a>二、 测试方案</h3><p>（1） 测试代码：<br><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <p>.text</p><p>ori $a0,$0,0x100<br><br>ori $a1,$a0,0x123<br><br>lui $a2,456<br><br>lui $a3,0xffff<br><br>ori $a3,$a3,0xffff<br><br>addu $s0,$a0,$a2<br><br>addu $s1,$a0,$a3<br><br>addu $s4,$a3,$a3<br><br>subu $s2,$a0,$a2<br><br>subu $s3,$a0,$a3<br><br>sw $a0,0($0)<br><br>sw $a1,4($0)<br><br>sw $a2,8($0)<br><br>sw $a3,12($0)<br><br>sw $s0,16($0)<br><br>sw $s1,20($0)<br><br>sw $s2,24($0)<br><br>sw $s3,44($0)<br><br>sw $s4,48($0)<br><br>lw $a0,0($0)<br><br>lw $a1,12($0)<br><br>sw $a0,28($0)<br><br>sw $a1,32($0)<br><br>ori $a0,$0,1<br><br>ori $a1,$0,2<br><br>ori $a2,$0,1<br><br>beq $a0,$a1,loop1<br><br>beq $a0,$a2,loop2<br><br>loop1: sw $a0,36($t0)<br><br>loop2: sw $a1,40($t0)<br><br>jal loop3<br><br>jal loop3<br><br>sw $s5,64($t0)<br><br>ori $a1,$a1,4<br><br>jal loop4<br><br>loop3:sw $a1,56($t0)<br><br>sw $ra,60($t0)<br><br>ori $s5,$s5,5<br><br>jr $ra<br><br>loop4: sw $a1,68($t0)<br><br>sw $ra,72($t0)<br></p>
              </div>
            </details><br>（2） 该CPU运行结果<br><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <p>@00003000: $ 4 &lt;= 00000100<br>@00003004: $ 5 &lt;= 00000123<br>@00003008: $ 6 &lt;= 01c80000<br>@0000300c: $ 7 &lt;= ffff0000<br>@00003010: $ 7 &lt;= ffffffff<br>@00003014: $16 &lt;= 01c80100<br>@00003018: $17 &lt;= 000000ff<br>@0000301c: $20 &lt;= fffffffe<br>@00003020: $18 &lt;= fe380100<br>@00003024: $19 &lt;= 00000101<br>@00003028: <em>00000000 &lt;= 00000100<br>@0000302c: </em>00000004 &lt;= 00000123<br>@00003030: <em>00000008 &lt;= 01c80000<br>@00003034: </em>0000000c &lt;= ffffffff<br>@00003038: <em>00000010 &lt;= 01c80100<br>@0000303c: </em>00000014 &lt;= 000000ff<br>@00003040: <em>00000018 &lt;= fe380100<br>@00003044: </em>0000002c &lt;= 00000101<br>@00003048: <em>00000030 &lt;= fffffffe<br>@0000304c: $ 4 &lt;= 00000100<br>@00003050: $ 5 &lt;= ffffffff<br>@00003054: </em>0000001c &lt;= 00000100<br>@00003058: <em>00000020 &lt;= ffffffff<br>@0000305c: $ 4 &lt;= 00000001<br>@00003060: $ 5 &lt;= 00000002<br>@00003064: $ 6 &lt;= 00000001<br>@00003074: </em>00000028 &lt;= 00000002<br>@00003078: $31 &lt;= 0000307c<br>@0000308c: <em>00000038 &lt;= 00000002<br>@00003090: </em>0000003c &lt;= 0000307c</p>
              </div>
            </details><br><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//testbench模块</span></span><br><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns/1ps</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">module</span> mips_txt;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">reg</span> clk;</span><br><span class="line">    <span class="keyword">reg</span> reset;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] i_inst_addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] i_inst_rdata;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] m_data_addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] m_data_rdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] m_data_wdata;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span> :<span class="number">0</span>] m_data_byteen;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] m_inst_addr;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> w_grf_we;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">4</span>:<span class="number">0</span>] w_grf_addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] w_grf_wdata;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] w_inst_addr;</span><br><span class="line"></span><br><span class="line">    mips uut(</span><br><span class="line">        <span class="variable">.clk</span>(clk),</span><br><span class="line">        <span class="variable">.reset</span>(reset),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.i_inst_addr</span>(i_inst_addr),</span><br><span class="line">        <span class="variable">.i_inst_rdata</span>(i_inst_rdata),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.m_data_addr</span>(m_data_addr),</span><br><span class="line">        <span class="variable">.m_data_rdata</span>(m_data_rdata),</span><br><span class="line">        <span class="variable">.m_data_wdata</span>(m_data_wdata),</span><br><span class="line">        <span class="variable">.m_data_byteen</span>(m_data_byteen),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.m_inst_addr</span>(m_inst_addr),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.w_grf_we</span>(w_grf_we),</span><br><span class="line">        <span class="variable">.w_grf_addr</span>(w_grf_addr),</span><br><span class="line">        <span class="variable">.w_grf_wdata</span>(w_grf_wdata),</span><br><span class="line"></span><br><span class="line">        <span class="variable">.w_inst_addr</span>(w_inst_addr)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="keyword">integer</span> i;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] fixed_addr;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] fixed_wdata;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] data[<span class="number">0</span>:<span class="number">4095</span>];</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] inst[<span class="number">0</span>:<span class="number">4095</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assign</span> m_data_rdata = data[m_data_addr &gt;&gt; <span class="number">2</span>];</span><br><span class="line">    <span class="keyword">assign</span> i_inst_rdata = inst[(i_inst_addr - <span class="number">32&#x27;h3000</span>) &gt;&gt; <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="built_in">$readmemh</span>(<span class="string">&quot;code.txt&quot;</span>, inst);</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4096</span>; i = i + <span class="number">1</span>) data[i] &lt;= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        clk = <span class="number">0</span>;</span><br><span class="line">        reset = <span class="number">1</span>;</span><br><span class="line">        #<span class="number">20</span> reset = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(*) <span class="keyword">begin</span></span><br><span class="line">        fixed_wdata = data[m_data_addr &gt;&gt; <span class="number">2</span>];</span><br><span class="line">        fixed_addr = m_data_addr &amp; <span class="number">32&#x27;hfffffffc</span>;</span><br><span class="line">        <span class="keyword">if</span> (m_data_byteen[<span class="number">3</span>]) fixed_wdata[<span class="number">31</span>:<span class="number">24</span>] = m_data_wdata[<span class="number">31</span>:<span class="number">24</span>];</span><br><span class="line">        <span class="keyword">if</span> (m_data_byteen[<span class="number">2</span>]) fixed_wdata[<span class="number">23</span>:<span class="number">16</span>] = m_data_wdata[<span class="number">23</span>:<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">if</span> (m_data_byteen[<span class="number">1</span>]) fixed_wdata[<span class="number">15</span>: <span class="number">8</span>] = m_data_wdata[<span class="number">15</span>: <span class="number">8</span>];</span><br><span class="line">        <span class="keyword">if</span> (m_data_byteen[<span class="number">0</span>]) fixed_wdata[<span class="number">7</span> : <span class="number">0</span>] = m_data_wdata[<span class="number">7</span> : <span class="number">0</span>];</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (~reset) <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (w_grf_we &amp;&amp; (w_grf_addr != <span class="number">0</span>)) <span class="keyword">begin</span></span><br><span class="line">                <span class="built_in">$display</span>(<span class="string">&quot;%d@%h: $%d &lt;= %h&quot;</span>, <span class="built_in">$time</span>, w_inst_addr, w_grf_addr, w_grf_wdata);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset) <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4096</span>; i = i + <span class="number">1</span>) data[i] &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (|m_data_byteen) <span class="keyword">begin</span></span><br><span class="line">            data[fixed_addr &gt;&gt; <span class="number">2</span>] &lt;= fixed_wdata;</span><br><span class="line">            <span class="built_in">$display</span>(<span class="string">&quot;%d@%h: *%h &lt;= %h&quot;</span>, <span class="built_in">$time</span>, m_inst_addr, fixed_addr, fixed_wdata);</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> #<span class="number">2</span> clk &lt;= ~clk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></p>
<h3 id="三、-思考题"><a href="#三、-思考题" class="headerlink" title="三、 思考题"></a>三、 思考题</h3><h4 id="（一）为什么需要有单独的乘除法部件而不是整合进-ALU？为何需要有独立的-HI、LO-寄存器？"><a href="#（一）为什么需要有单独的乘除法部件而不是整合进-ALU？为何需要有独立的-HI、LO-寄存器？" class="headerlink" title="（一）为什么需要有单独的乘除法部件而不是整合进 ALU？为何需要有独立的 HI、LO 寄存器？"></a>（一）为什么需要有单独的乘除法部件而不是整合进 ALU？为何需要有独立的 HI、LO 寄存器？</h4><p>因为ALU在计算乘除延迟的周期中时依然可以支持如加减法之类的其他计算，如果将乘除法部件整合进ALU，将不利于乘除运算时的加减法运算，也不符合“高内聚，低耦合”的设计思想。</p>
<p>而增加独立的HI和LO寄存器，获得了更多的操作空间，将更有利于各种运算操作的实现。</p>
<h4 id="（二）真实的流水线-CPU-是如何使用实现乘除法的？请查阅相关资料进行简单说明。"><a href="#（二）真实的流水线-CPU-是如何使用实现乘除法的？请查阅相关资料进行简单说明。" class="headerlink" title="（二）真实的流水线 CPU 是如何使用实现乘除法的？请查阅相关资料进行简单说明。"></a>（二）真实的流水线 CPU 是如何使用实现乘除法的？请查阅相关资料进行简单说明。</h4><p>​        真实的CPU是通过多次加减法来实现乘法和除法的，所以显而易见乘除法所消耗的时间明显长于加减法。</p>
<p>​        乘法的计算语言加法和左移运算，并通过另一个寄存器{HI,LO}来保留计算结果，而除法则是依靠减法和左移。由此可以很清晰的分析出为什么HI存储乘法高位及除法的余数，而LO存储乘法低位和除法的商。</p>
<h4 id="（三）请结合自己的实现分析，你是如何处理-Busy-信号带来的周期阻塞的？"><a href="#（三）请结合自己的实现分析，你是如何处理-Busy-信号带来的周期阻塞的？" class="headerlink" title="（三）请结合自己的实现分析，你是如何处理 Busy 信号带来的周期阻塞的？"></a>（三）请结合自己的实现分析，你是如何处理 Busy 信号带来的周期阻塞的？</h4><p>​        当MDU处于Busy信号或者en信号时将进行乘除法运算，如果此时位于D级的指令为乘除运算，则我们会选择在HazardUnit中控制产生阻塞信号，从而形成周期阻塞。</p>
<h4 id="（四）-请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）"><a href="#（四）-请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）" class="headerlink" title="（四） 请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）"></a>（四） 请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）</h4><p>​        这样的方式写入字节有利于保持字对齐，清晰度较高，而从统一性处理将一个字分成四个字节，将有利于对字，半字和字节的处理保持统一，有利于维护代码的运行及debug</p>
<h4 id="（五）请思考，我们在按字节读和按字节写时，实际从-DM-获得的数据和向-DM-写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？"><a href="#（五）请思考，我们在按字节读和按字节写时，实际从-DM-获得的数据和向-DM-写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？" class="headerlink" title="（五）请思考，我们在按字节读和按字节写时，实际从 DM 获得的数据和向 DM 写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？"></a>（五）请思考，我们在按字节读和按字节写时，实际从 DM 获得的数据和向 DM 写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？</h4><p>​    不是，当按字节写和按字节读时那个字是非对齐的位置时会高于按字读和按字写。</p>
<h4 id="（六）为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？"><a href="#（六）为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？" class="headerlink" title="（六）为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？"></a>（六）为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？</h4><p>​    增加更多的板块，如分出多路选择器等让代码实现“高内聚，低耦合”的要求。尽可能简化<strong>每一个</strong>模块的复杂度，尽量使他们彼此独立。将指令分析和模块的功能分离，让模块<strong>只受</strong>译码器给出的信号的控制。</p>
<p>​    除此之外，增加宏的定义，避免对相同常量段的重复修改，同时宏的定义也有利于使代码更加清晰。</p>
<h4 id="（七）在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？"><a href="#（七）在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？" class="headerlink" title="（七）在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？"></a>（七）在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？</h4><p>对于乘除模块的冲突我们是直接选择延迟的方式进行处理的，而对于其他方式则见上方冲突转发部分。        </p>
<h4 id="（八）如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证覆盖了所有需要测试的情况；如果你是完全随机生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了特殊的策略，比如构造连续数据冒险序列，请你描述一下你使用的策略如何结合了随机性达到强测的效果。"><a href="#（八）如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证覆盖了所有需要测试的情况；如果你是完全随机生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了特殊的策略，比如构造连续数据冒险序列，请你描述一下你使用的策略如何结合了随机性达到强测的效果。" class="headerlink" title="（八）如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证覆盖了所有需要测试的情况；如果你是完全随机生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了特殊的策略，比如构造连续数据冒险序列，请你描述一下你使用的策略如何结合了随机性达到强测的效果。"></a>（八）如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证覆盖了所有需要测试的情况；如果你是完全随机生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了特殊的策略，比如构造连续数据冒险序列，请你描述一下你使用的策略如何结合了随机性达到强测的效果。</h4><p>我使用的是完全随机生成的测试样例，并对其缩小输出寄存器的范围，从而构造更多的数据冒险，但由于数据容易超出Mars的data区，这种方式不利于对 存储指令进行测试，需要单独设立板块进行测试。</p>
<p>为了达到强测效果，我们要尽可能的增加代码长度，并多设计冒险方式的代码段。</p>
<h3 id="选做题"><a href="#选做题" class="headerlink" title="选做题"></a>选做题</h3><h4 id="（一）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。"><a href="#（一）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。" class="headerlink" title="（一）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。"></a>（一）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。</h4><p>​        由于转发比阻塞的效率更高，所以我们在编码时的基本原则是尽可能转发，而在这个模型中，转发的得分明显高于阻塞，合理。</p>
<p>​        本覆盖率分析模型的指令集按需分类，更有利于集中式处理，使效率更高。</p>
<h3 id="四-自动化测试模块"><a href="#四-自动化测试模块" class="headerlink" title="四.自动化测试模块"></a>四.自动化测试模块</h3><h5 id="命令行自动测试"><a href="#命令行自动测试" class="headerlink" title="命令行自动测试"></a>命令行自动测试</h5><p>具体源码可见：<a class="link"   target="_blank" rel="noopener" href="https://github.com/Charles2530/Charles_BUAA_CO_2022/tree/main/p7/statistic" >Charles_BUAA_CO_2022/p7/statistic at main · Charles2530/Charles_BUAA_CO_2022 (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="tabs" id="tab-first-unique-name"><ul class="nav-tabs"><li class="tab active"><a class="#first-unique-name-1">new_test.py</a></li><li class="tab"><a class="#first-unique-name-2">test.py</a></li><li class="tab"><a class="#first-unique-name-3">diff.py</a></li><li class="tab"><a class="#first-unique-name-4">cmp.cpp</a></li></ul><div class="tab-content"><div class="tab-pane active" id="first-unique-name-1"><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> i &lt;= <span class="number">5000</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;num = &#x27;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">    os.chdir(<span class="string">&#x27;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;python test.py&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;java -jar Mars.jar nc db lg ex mc LargeText 100000 test.asm &gt;mips_out.txt&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;java -jar mars.jar db mc CompactDataAtZero a dump .text HexText ../mips/code.txt test.asm &gt; mips_log.txt&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;java -jar Mars.jar a db mc CompactDataAtZero dump 0x00004180-0x00004ffc HexText ../mips/handler.txt test.asm &gt; mips_log.txt&#x27;</span>)</span><br><span class="line">    os.chdir(<span class="string">&#x27;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\mips&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;D:\\SoftWare\\ISE\\14.7\\ISE_DS\\ISE\\bin\\nt64\\fuse -nodebug -prj mips.prj \</span></span><br><span class="line"><span class="string">        -o mips.exe mips_txt 1&gt;../statistic/isim_log.txt 2&gt;../statistic/isim_warning_log.txt&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;mips.exe -nolog -tclbatch mips.tcl &gt; isim_out.txt&#x27;</span>)</span><br><span class="line">    os.chdir(<span class="string">&#x27;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;python diff.py&#x27;</span>)</span><br><span class="line">    i = i+<span class="number">1</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-2"><details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment">#Calc_r = [&#x27;add&#x27;]</span></span><br><span class="line">Calc_r = [<span class="string">&#x27;add&#x27;</span>, <span class="string">&#x27;sub&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;slt&#x27;</span>, <span class="string">&#x27;sltu&#x27;</span>]</span><br><span class="line">Calc_i = [<span class="string">&#x27;ori&#x27;</span>, <span class="string">&#x27;addi&#x27;</span>, <span class="string">&#x27;ori&#x27;</span>]</span><br><span class="line">Load = [<span class="string">&#x27;lb&#x27;</span>]</span><br><span class="line"><span class="comment"># Load = [&#x27;lw&#x27;, &#x27;lb&#x27;, &#x27;lh&#x27;]</span></span><br><span class="line">Store = [<span class="string">&#x27;sb&#x27;</span>]</span><br><span class="line"><span class="comment"># Store = [&#x27;sw&#x27;, &#x27;sb&#x27;, &#x27;sh&#x27;]</span></span><br><span class="line">B_type = [<span class="string">&#x27;beq&#x27;</span>, <span class="string">&#x27;bne&#x27;</span>]</span><br><span class="line">J_type = [<span class="string">&#x27;jal&#x27;</span>]</span><br><span class="line">Shift = []</span><br><span class="line">Shift_v = []</span><br><span class="line">md = [<span class="string">&#x27;mult&#x27;</span>, <span class="string">&#x27;multu&#x27;</span>, <span class="string">&#x27;div&#x27;</span>, <span class="string">&#x27;divu&#x27;</span>]</span><br><span class="line">mf_mt = [<span class="string">&#x27;mfhi&#x27;</span>, <span class="string">&#x27;mflo&#x27;</span>, <span class="string">&#x27;mthi&#x27;</span>, <span class="string">&#x27;mtlo&#x27;</span>]</span><br><span class="line"></span><br><span class="line">filename = <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p6\\statistic\\test.asm&quot;</span></span><br><span class="line"><span class="comment"># 输出文件位置</span></span><br><span class="line">label = [<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 输出label的编号范围，事先存入0防止在第一次输出标签前出现跳转指令</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="comment"># 可执行代码的行数</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"><span class="comment"># 当前所标出过的编号号码</span></span><br><span class="line">jal = []</span><br><span class="line"><span class="comment"># 使用过的jal对应标签编号</span></span><br><span class="line">R_num = <span class="built_in">len</span>(Calc_r)</span><br><span class="line">I_num = <span class="built_in">len</span>(Calc_i)</span><br><span class="line">L_num = <span class="built_in">len</span>(Load)</span><br><span class="line">S_num = <span class="built_in">len</span>(Store)</span><br><span class="line">B_num = <span class="built_in">len</span>(B_type)</span><br><span class="line">J_num = <span class="built_in">len</span>(J_type)</span><br><span class="line">MD_num = <span class="built_in">len</span>(md)</span><br><span class="line">MF_num = <span class="built_in">len</span>(mf_mt)</span><br><span class="line"><span class="comment"># 各类指令出现频率设置</span></span><br><span class="line">f_R = <span class="number">10</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_I = <span class="number">10</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_L = <span class="number">40</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_S = <span class="number">40</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_B = <span class="number">0</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_J = <span class="number">0</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_md = <span class="number">5</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">f_mf = <span class="number">5</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">num = f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num + \</span><br><span class="line">    f_B*B_num+f_J*J_num+f_md*MD_num+f_mf*MF_num+<span class="number">1</span></span><br><span class="line">begin = <span class="number">28</span></span><br><span class="line">end = <span class="number">31</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">get_Ori</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 对应指令生成随机数</span></span><br><span class="line">        self.rs = random.randint(begin, end)</span><br><span class="line">        self.rt = random.randint(begin, end)</span><br><span class="line">        self.imm16 = random.randint(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; <span class="number">16</span>-<span class="number">1</span>)</span><br><span class="line">        self.main()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.rs == <span class="number">28</span> <span class="keyword">or</span> self.rs == <span class="number">29</span> <span class="keyword">or</span> self.rs == <span class="number">30</span>:</span><br><span class="line">            self.rs = self.rs-<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.rt == <span class="number">28</span> <span class="keyword">or</span> self.rt == <span class="number">29</span> <span class="keyword">or</span> self.rt == <span class="number">30</span>:</span><br><span class="line">            self.rt = self.rt-<span class="number">3</span></span><br><span class="line">        self.code = <span class="string">&#x27;ori&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">            <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">            <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">get_Code</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 对应指令生成随机数</span></span><br><span class="line">        self.rs = random.randint(begin, end)</span><br><span class="line">        self.rt = random.randint(begin, end)</span><br><span class="line">        self.rd = random.randint(begin, end)</span><br><span class="line">        self.imm16 = random.randint(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; <span class="number">8</span>-<span class="number">1</span>)</span><br><span class="line">        self.imm26 = random.randint(<span class="number">0</span>, <span class="number">1</span> &lt;&lt; <span class="number">26</span>-<span class="number">1</span>)</span><br><span class="line">        <span class="comment">#self.mem = random.randint(0, 100)</span></span><br><span class="line">        self.mem = random.randint(<span class="number">0</span>, <span class="number">3</span>) &lt;&lt; <span class="number">6</span></span><br><span class="line">        <span class="comment"># self.mem = random.randint(0, 3)</span></span><br><span class="line">        <span class="comment"># 存储指令类型</span></span><br><span class="line">        self.<span class="built_in">list</span> = []</span><br><span class="line">        <span class="comment"># get函数</span></span><br><span class="line">        self.get_R()</span><br><span class="line">        self.get_I()</span><br><span class="line">        self.get_L()</span><br><span class="line">        self.get_S()</span><br><span class="line">        self.get_B()</span><br><span class="line">        self.get_J()</span><br><span class="line">        self.get_MD()</span><br><span class="line">        self.get_MF()</span><br><span class="line">        self.get_Label()</span><br><span class="line">        self.main()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_R</span>(<span class="params">self</span>):</span><br><span class="line">        random1 = random.randint(<span class="number">0</span>, R_num - <span class="number">1</span>)</span><br><span class="line">        type1 = Calc_r[random1]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_I</span>(<span class="params">self</span>):</span><br><span class="line">        random2 = random.randint(<span class="number">0</span>, I_num - <span class="number">1</span>)</span><br><span class="line">        type2 = Calc_i[random2]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_L</span>(<span class="params">self</span>):</span><br><span class="line">        random3 = random.randint(<span class="number">0</span>, L_num - <span class="number">1</span>)</span><br><span class="line">        type3 = Load[random3]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_S</span>(<span class="params">self</span>):</span><br><span class="line">        random4 = random.randint(<span class="number">0</span>, S_num - <span class="number">1</span>)</span><br><span class="line">        type4 = Store[random4]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type4)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_B</span>(<span class="params">self</span>):</span><br><span class="line">        random5 = random.randint(<span class="number">0</span>, B_num - <span class="number">1</span>)</span><br><span class="line">        type5 = B_type[random5]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type5)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_J</span>(<span class="params">self</span>):</span><br><span class="line">        random6 = random.randint(<span class="number">0</span>, J_num - <span class="number">1</span>)</span><br><span class="line">        type6 = J_type[random6]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type6)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_MD</span>(<span class="params">self</span>):</span><br><span class="line">        random7 = random.randint(<span class="number">0</span>, MD_num - <span class="number">1</span>)</span><br><span class="line">        type7 = md[random7]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type7)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_MF</span>(<span class="params">self</span>):</span><br><span class="line">        random8 = random.randint(<span class="number">0</span>, MF_num - <span class="number">1</span>)</span><br><span class="line">        type8 = mf_mt[random8]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type8)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_Label</span>(<span class="params">self</span>):</span><br><span class="line">        random9 = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(label)-<span class="number">1</span>)</span><br><span class="line">        ran = label[random9]</span><br><span class="line">        <span class="keyword">return</span> ran</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        sel = random.randint(<span class="number">0</span>, num+<span class="number">100</span>)</span><br><span class="line">        <span class="keyword">if</span> self.rs == <span class="number">28</span> <span class="keyword">or</span> self.rs == <span class="number">29</span> <span class="keyword">or</span> self.rs == <span class="number">30</span>:</span><br><span class="line">            self.rs = self.rs-<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.rt == <span class="number">28</span> <span class="keyword">or</span> self.rt == <span class="number">29</span> <span class="keyword">or</span> self.rt == <span class="number">30</span>:</span><br><span class="line">            self.rt = self.rt-<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.rd == <span class="number">28</span> <span class="keyword">or</span> self.rd == <span class="number">29</span> <span class="keyword">or</span> self.rd == <span class="number">30</span>:</span><br><span class="line">            self.rd = self.rd-<span class="number">3</span></span><br><span class="line">        <span class="comment"># 控制参数类型</span></span><br><span class="line">        <span class="keyword">if</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, f_R*R_num):</span><br><span class="line">            <span class="comment"># 通过控制随机数的范围来决定输出各种指令的频率,并用各种指令的数目保证各指令出现概率基本相同</span></span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">0</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rd) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num, f_R*R_num+f_I*I_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num, f_R*R_num+f_I*I_num+f_L*L_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">3</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="string">&#x27;0&#x27;</span> + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">4</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;label_&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.get_Label()) + <span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">5</span>] == <span class="string">&#x27;jal&#x27;</span>:</span><br><span class="line">                node = self.get_Label()</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">5</span>] + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                    <span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(node) + <span class="string">&#x27;\n&#x27;</span>+<span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                jal.append(node)</span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">5</span>] == <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">5</span>] + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                    <span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(self.get_Label()) + <span class="string">&#x27;\n&#x27;</span> + <span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">6</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num+f_mf*MF_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">7</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.code = <span class="string">&#x27;lui&#x27;</span> + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*begin, <span class="number">2</span>*end):</span><br><span class="line">        b = get_Ori()</span><br><span class="line">        f.write(b.code)</span><br><span class="line"></span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num):</span><br><span class="line">        a = get_Code()</span><br><span class="line">        f.write(a.code)</span><br><span class="line">        <span class="keyword">if</span> random.randint(<span class="number">0</span>, num) == <span class="number">1</span> <span class="keyword">and</span> label != []:</span><br><span class="line">            <span class="comment"># 通过控制random范围来决定标签和jr出现的概率</span></span><br><span class="line">            f.write(<span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(flag) + <span class="string">&#x27;:&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            label.append(flag)</span><br><span class="line">            flag = flag+<span class="number">1</span></span><br><span class="line">            <span class="comment"># f.write(&#x27;jr $ra&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">            <span class="comment"># f.write(&#x27;nop&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="comment"># if cnt == 10:</span></span><br><span class="line">        <span class="comment">#     f.write(&#x27;jr $ra&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="comment">#     f.write(&#x27;nop&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="keyword">if</span> cnt == num-<span class="number">5</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;label_0&#x27;</span> + <span class="string">&#x27;:&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-3"><details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from filediff.diff import file_diff_compare</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">tmp = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\mips_out.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">out = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\mips_out_another.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">std = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\mips\\isim_out.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">isim = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\isim_out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = tmp.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    line = line.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    line = line.replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    out.write(line)</span><br><span class="line">out.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = std.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> line[<span class="number">0</span>].isspace():</span><br><span class="line">        line = line.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        line = line.replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        isim.write(line)</span><br><span class="line">    <span class="keyword">elif</span> line[<span class="number">0</span>] == <span class="string">&#x27;@&#x27;</span>:</span><br><span class="line">        line = line.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        line = line.replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        isim.write(line)</span><br><span class="line">isim.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">out.close()</span><br><span class="line">tmp.close()</span><br><span class="line">std.close()</span><br><span class="line">isim.close()</span><br><span class="line">result = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\result.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>)</span><br><span class="line">os.system(<span class="string">&quot;cmp.exe&quot;</span>)</span><br><span class="line">result.write(</span><br><span class="line">    <span class="string">&quot;---------------------------------test------------------------------------------- &quot;</span>+<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line">result.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-4"><details class="orange" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 100007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> s1[<span class="number">400</span>], s2[<span class="number">400</span>];</span><br><span class="line">    <span class="type">char</span> s3[<span class="number">400</span>], s4[<span class="number">400</span>];</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">1</span>;</span><br><span class="line">    FILE* fp1;</span><br><span class="line">    FILE* fp2;</span><br><span class="line">    FILE* fp3;</span><br><span class="line">    FILE* fp4;</span><br><span class="line">    FILE* fp5;</span><br><span class="line">    FILE* fp6;</span><br><span class="line">    fp1 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\mips_out_another.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fp2 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\isim_out.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fp3 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\result.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">    fp4 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\test.asm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fp5 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\p7_&quot;</span></span><br><span class="line">        <span class="string">&quot;error_code.asm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">    fp6 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\isim_out_another.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> line = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> l1 = <span class="number">0</span>, l2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">fgets</span>(s1, <span class="number">400</span>, fp1)) &#123;</span><br><span class="line">        string s = s1;</span><br><span class="line">        <span class="comment">// printf(&quot;%d&quot;, s.find(&quot;$0&quot;));</span></span><br><span class="line">        <span class="keyword">if</span> (s.<span class="built_in">find</span>(<span class="string">&quot;$0&quot;</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        line++;</span><br><span class="line">        <span class="keyword">if</span> (s1[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">fgets</span>(s1, <span class="number">400</span>, fp1);</span><br><span class="line">            <span class="built_in">fgets</span>(s1, <span class="number">400</span>, fp1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fgets</span>(s2, <span class="number">400</span>, fp2);</span><br><span class="line">        <span class="keyword">if</span> (s2[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">fgets</span>(s2, <span class="number">400</span>, fp2);</span><br><span class="line">            <span class="built_in">fgets</span>(s2, <span class="number">400</span>, fp2);</span><br><span class="line">        &#125;</span><br><span class="line">        l1++;</span><br><span class="line">        l2++;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; s1[i] != <span class="string">&#x27;\0&#x27;</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1[i] == <span class="string">&#x27;@&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; s2[j] != <span class="string">&#x27;\0&#x27;</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s2[j] == <span class="string">&#x27;@&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp6, <span class="string">&quot;%s&quot;</span>, s2 + j);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s1 + i, s2 + j)) &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;Error in line %d\n&quot;</span>, line);</span><br><span class="line">            <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;get     :%s&quot;</span>, s2);</span><br><span class="line">            <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;expect  :%s\n\n&quot;</span>, s1 + i);</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;Accept\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Accept\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">fprintf</span>(fp5, <span class="string">&quot;#error begin with\n&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">fgets</span>(s3, <span class="number">400</span>, fp4)) &#123;</span><br><span class="line">            <span class="built_in">fputs</span>(s3, fp5);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp5, <span class="string">&quot;#error end\n\n\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(fp1);</span><br><span class="line">    <span class="built_in">fclose</span>(fp2);</span><br><span class="line">    <span class="built_in">fclose</span>(fp3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div></div></div>
<h2 id="五、规范化编码"><a href="#五、规范化编码" class="headerlink" title="五、规范化编码"></a>五、规范化编码</h2><h3 id="1、命名风格"><a href="#1、命名风格" class="headerlink" title="1、命名风格"></a>1、命名风格</h3><ul>
<li><p>各级之间使用<code>流水级_instr_方向</code>的方式，来有效地对它们进行区分，如：</p>
<p><code>D/E 寄存器的输入端口就可以命名为 D_instr_i</code></p>
</li>
<li><p>在顶层模块中，我们需要实例化调用子模块，这个过程会产生很多负责接线的“中间变量”，推荐<code>流水级_wirename</code>的方式，并且将同级的信号尽可能都声明在一起。</p>
</li>
</ul>
<h3 id="2、模块逻辑排布（看图说话）"><a href="#2、模块逻辑排布（看图说话）" class="headerlink" title="2、模块逻辑排布（看图说话）"></a>2、模块逻辑排布（看图说话）</h3><p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/6.png"
                      alt="img"
                ></p>
<h3 id="3、常量、字面量与宏"><a href="#3、常量、字面量与宏" class="headerlink" title="3、常量、字面量与宏"></a>3、<strong>常量、字面量与宏</strong></h3><p>对于指令不同的字段，直接定义 wire 型变量如 op、rs 映射到 instr 的对应位上，直观且简短。</p>
<p>对于控制器译出的信号，如果仅在一个模块内使用，可以使用 localparam 定义。但有很多信号需要被多个模块跨文件使用到（如 alu 的控制信号需要同时在控制器与 alu 出现），并且，我们需要为工程的扩展做好准备，因此更推荐编写一个单独的<strong>宏定义文件（如下）</strong>来供其他的模块用 `include 引用。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/7.png"
                      alt="img"
                ></p>
<h3 id="4、译码风格"><a href="#4、译码风格" class="headerlink" title="4、译码风格"></a>4、译码风格</h3><ul>
<li>指令驱动型：整体在一个 case 语句之下，通过判断指令的类型，来对所有的控制信号一一进行赋值。这种方法便于指令的添加，不易遗漏控制信号，但是整体代码量会随指令数量增多而显著增大。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/9.png"
                      alt="img"
                ></li>
<li><strong>控制信号驱动型</strong>：为每个指令定义一个 wire 型变量，使用或运算描述组合逻辑，对每个控制信号进行单独处理。这种方法在指令数量较多时适用，且代码量易于压缩，缺陷是如错添或漏添了某条指令，很难锁定出现错误的位置。<br><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/1.jpg"
                      alt="img"
                ></li>
</ul>

            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> P6 Design documents</li>
        <li><strong>Author:</strong> Charles</li>
        <li><strong>Created at:</strong> 2022-12-26 21:11:47</li>
        
            <li>
                <strong>Updated at:</strong> 2023-06-17 14:13:59
            </li>
        
        <li>
            <strong>Link:</strong> https://charles2530.github.io/2022/12/26/p6-design-documents/
        </li>
        <li>
            <strong>License:</strong> This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/CO/">#CO</a>&nbsp;
                        </li>
                    
                </ul>
            

            <div class="recommended-article">
  <div class="recommended-article-header">
    <i aria-hidden="true"></i><span>recommend_articles</span>
  </div>
  <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/02/01/latex-note-1/" title="Latex_note_1" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p3.jpg" alt="Latex_note_1">
  <span class="title">Latex_note_1</span>
</a><a class="recommended-article-item" href="/2023/01/12/dynamic-programming-advance/" title="dynamic-programming-advance" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p3.jfif" alt="dynamic-programming-advance">
  <span class="title">dynamic-programming-advance</span>
</a><a class="recommended-article-item" href="/2023/01/13/bfptr-algorithm/" title="bfptr-algorithm" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p3.jpg" alt="bfptr-algorithm">
  <span class="title">bfptr-algorithm</span>
</a></div>
</div>

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2022/12/26/p7-design-documents/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">P7 Design documents</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2022/12/26/p5-design-documents/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">P5 Design documents</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
  <div id="comment-anchor"></div>
  <div class="comment-area-title">
    <i class="fa-solid fa-comments"></i>&nbsp;Comments
  </div>
  

  <!--  -->
  <script src="https://utteranc.es/client.js" repo="Charles2530/Charles2530.github.io" issue-term="pathname"
    label="Comment" theme="preferred-color-scheme" crossorigin="anonymous" async>
  </script>
  
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">P6 Design documents</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Verilog%E6%B5%81%E6%B0%B4%E7%BA%BFCPU%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3"><span class="nav-text">Verilog流水线CPU设计文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81-CPU%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88%E7%BB%BC%E8%BF%B0"><span class="nav-text">一、 CPU设计方案综述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89-%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%BF%B0"><span class="nav-text">（一） 总体设计概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89-%E5%85%B3%E9%94%AE%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89"><span class="nav-text">（二） 关键模块定义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-text">宏的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#F%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text">F级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-PC"><span class="nav-text">1. PC</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#D%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text">D级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-GRF"><span class="nav-text">1. GRF</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-EXT"><span class="nav-text">2. EXT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-Controller"><span class="nav-text">3. Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-NPC"><span class="nav-text">4.NPC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NPC%EF%BC%88%E4%B8%8B%E4%B8%80%E6%8C%87%E4%BB%A4%E8%AE%A1%E7%AE%97%E5%8D%95%E5%85%83%EF%BC%89"><span class="nav-text">NPC（下一指令计算单元）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-B-transfer-B%E7%B1%BB%E6%8C%87%E4%BB%A4%E6%AF%94%E8%BE%83%E5%8D%95%E5%85%83"><span class="nav-text">5.B_transfer(B类指令比较单元)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#E%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text">E级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-ALU"><span class="nav-text">1. ALU</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-MD-Unit"><span class="nav-text">2.MD_Unit</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#M%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text">M级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-DM-In"><span class="nav-text">1. DM_In</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-DM-Out"><span class="nav-text">2.DM_Out</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text">各级流水线寄存器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-IF-ID"><span class="nav-text">1.IF_ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#D-Reg%EF%BC%88IF-ID%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%89"><span class="nav-text">D_Reg（IF&#x2F;ID流水寄存器）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ID-EX"><span class="nav-text">2.ID_EX</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#E-Reg%EF%BC%88ID-EX%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%89"><span class="nav-text">E_Reg（ID&#x2F;EX流水寄存器）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3-EX-MEM"><span class="nav-text">3.EX_MEM</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#M-Reg%EF%BC%88EX-MEM%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%89"><span class="nav-text">M_Reg（EX&#x2F;MEM流水寄存器）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4-MEM-WB"><span class="nav-text">4.MEM_WB</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#W-Reg%EF%BC%88MEM-WB%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%89"><span class="nav-text">W_Reg（MEM&#x2F;WB流水寄存器）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9A%82%E5%81%9C%E3%80%81%E8%BD%AC%E5%8F%91%E5%A4%84%E7%90%86%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%A4%9A%E8%B7%AF%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-text">暂停、转发处理及相关多路选择器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89-%E5%86%B2%E7%AA%81%E7%BB%BC%E5%90%88%E5%8D%95%E5%85%83%EF%BC%88HazardUnit"><span class="nav-text">（一）.冲突综合单元（HazardUnit)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89-%E6%8E%A7%E5%88%B6%E5%92%8C%E5%86%92%E9%99%A9%E7%AE%80%E8%BF%B0"><span class="nav-text">（二）.控制和冒险简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%EF%BC%89-%E5%86%92%E9%99%A9%E5%A4%84%E7%90%86"><span class="nav-text">(三）.冒险处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91%EF%BC%88forward%EF%BC%89"><span class="nav-text">转发（forward）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91%E7%9A%84%E6%9E%84%E9%80%A0"><span class="nav-text">转发的构造</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9A%82%E5%81%9C%EF%BC%88stall%EF%BC%89"><span class="nav-text">暂停（stall）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%BB%E5%A1%9E%E7%9A%84%E6%9E%84%E9%80%A0%EF%BC%88D%E7%BA%A7%EF%BC%89"><span class="nav-text">阻塞的构造（D级）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9C%9F%E5%80%BC%E8%A1%A8"><span class="nav-text">真值表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81-%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88"><span class="nav-text">二、 测试方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81-%E6%80%9D%E8%80%83%E9%A2%98"><span class="nav-text">三、 思考题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%9C%89%E5%8D%95%E7%8B%AC%E7%9A%84%E4%B9%98%E9%99%A4%E6%B3%95%E9%83%A8%E4%BB%B6%E8%80%8C%E4%B8%8D%E6%98%AF%E6%95%B4%E5%90%88%E8%BF%9B-ALU%EF%BC%9F%E4%B8%BA%E4%BD%95%E9%9C%80%E8%A6%81%E6%9C%89%E7%8B%AC%E7%AB%8B%E7%9A%84-HI%E3%80%81LO-%E5%AF%84%E5%AD%98%E5%99%A8%EF%BC%9F"><span class="nav-text">（一）为什么需要有单独的乘除法部件而不是整合进 ALU？为何需要有独立的 HI、LO 寄存器？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%BA%8C%EF%BC%89%E7%9C%9F%E5%AE%9E%E7%9A%84%E6%B5%81%E6%B0%B4%E7%BA%BF-CPU-%E6%98%AF%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8%E5%AE%9E%E7%8E%B0%E4%B9%98%E9%99%A4%E6%B3%95%E7%9A%84%EF%BC%9F%E8%AF%B7%E6%9F%A5%E9%98%85%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%E8%BF%9B%E8%A1%8C%E7%AE%80%E5%8D%95%E8%AF%B4%E6%98%8E%E3%80%82"><span class="nav-text">（二）真实的流水线 CPU 是如何使用实现乘除法的？请查阅相关资料进行简单说明。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%89%EF%BC%89%E8%AF%B7%E7%BB%93%E5%90%88%E8%87%AA%E5%B7%B1%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%88%86%E6%9E%90%EF%BC%8C%E4%BD%A0%E6%98%AF%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86-Busy-%E4%BF%A1%E5%8F%B7%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%91%A8%E6%9C%9F%E9%98%BB%E5%A1%9E%E7%9A%84%EF%BC%9F"><span class="nav-text">（三）请结合自己的实现分析，你是如何处理 Busy 信号带来的周期阻塞的？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E5%9B%9B%EF%BC%89-%E8%AF%B7%E9%97%AE%E9%87%87%E7%94%A8%E5%AD%97%E8%8A%82%E4%BD%BF%E8%83%BD%E4%BF%A1%E5%8F%B7%E7%9A%84%E6%96%B9%E5%BC%8F%E5%A4%84%E7%90%86%E5%86%99%E6%8C%87%E4%BB%A4%E6%9C%89%E4%BB%80%E4%B9%88%E5%A5%BD%E5%A4%84%EF%BC%9F%EF%BC%88%E6%8F%90%E7%A4%BA%EF%BC%9A%E4%BB%8E%E6%B8%85%E6%99%B0%E6%80%A7%E3%80%81%E7%BB%9F%E4%B8%80%E6%80%A7%E7%AD%89%E8%A7%92%E5%BA%A6%E8%80%83%E8%99%91%EF%BC%89"><span class="nav-text">（四） 请问采用字节使能信号的方式处理写指令有什么好处？（提示：从清晰性、统一性等角度考虑）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%BA%94%EF%BC%89%E8%AF%B7%E6%80%9D%E8%80%83%EF%BC%8C%E6%88%91%E4%BB%AC%E5%9C%A8%E6%8C%89%E5%AD%97%E8%8A%82%E8%AF%BB%E5%92%8C%E6%8C%89%E5%AD%97%E8%8A%82%E5%86%99%E6%97%B6%EF%BC%8C%E5%AE%9E%E9%99%85%E4%BB%8E-DM-%E8%8E%B7%E5%BE%97%E7%9A%84%E6%95%B0%E6%8D%AE%E5%92%8C%E5%90%91-DM-%E5%86%99%E5%85%A5%E7%9A%84%E6%95%B0%E6%8D%AE%E6%98%AF%E5%90%A6%E6%98%AF%E4%B8%80%E5%AD%97%E8%8A%82%EF%BC%9F%E5%9C%A8%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E6%88%91%E4%BB%AC%E6%8C%89%E5%AD%97%E8%8A%82%E8%AF%BB%E5%92%8C%E6%8C%89%E5%AD%97%E8%8A%82%E5%86%99%E7%9A%84%E6%95%88%E7%8E%87%E4%BC%9A%E9%AB%98%E4%BA%8E%E6%8C%89%E5%AD%97%E8%AF%BB%E5%92%8C%E6%8C%89%E5%AD%97%E5%86%99%E5%91%A2%EF%BC%9F"><span class="nav-text">（五）请思考，我们在按字节读和按字节写时，实际从 DM 获得的数据和向 DM 写入的数据是否是一字节？在什么情况下我们按字节读和按字节写的效率会高于按字读和按字写呢？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E5%85%AD%EF%BC%89%E4%B8%BA%E4%BA%86%E5%AF%B9%E6%8A%97%E5%A4%8D%E6%9D%82%E6%80%A7%E4%BD%A0%E9%87%87%E5%8F%96%E4%BA%86%E5%93%AA%E4%BA%9B%E6%8A%BD%E8%B1%A1%E5%92%8C%E8%A7%84%E8%8C%83%E6%89%8B%E6%AE%B5%EF%BC%9F%E8%BF%99%E4%BA%9B%E6%89%8B%E6%AE%B5%E5%9C%A8%E8%AF%91%E7%A0%81%E5%92%8C%E5%A4%84%E7%90%86%E6%95%B0%E6%8D%AE%E5%86%B2%E7%AA%81%E7%9A%84%E6%97%B6%E5%80%99%E6%9C%89%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%E7%89%B9%E7%82%B9%E4%B8%8E%E5%B8%AE%E5%8A%A9%EF%BC%9F"><span class="nav-text">（六）为了对抗复杂性你采取了哪些抽象和规范手段？这些手段在译码和处理数据冲突的时候有什么样的特点与帮助？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%83%EF%BC%89%E5%9C%A8%E6%9C%AC%E5%AE%9E%E9%AA%8C%E4%B8%AD%E4%BD%A0%E9%81%87%E5%88%B0%E4%BA%86%E5%93%AA%E4%BA%9B%E4%B8%8D%E5%90%8C%E6%8C%87%E4%BB%A4%E7%B1%BB%E5%9E%8B%E7%BB%84%E5%90%88%E4%BA%A7%E7%94%9F%E7%9A%84%E5%86%B2%E7%AA%81%EF%BC%9F%E4%BD%A0%E5%8F%88%E6%98%AF%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E7%9A%84%EF%BC%9F%E7%9B%B8%E5%BA%94%E7%9A%84%E6%B5%8B%E8%AF%95%E6%A0%B7%E4%BE%8B%E6%98%AF%E4%BB%80%E4%B9%88%E6%A0%B7%E7%9A%84%EF%BC%9F"><span class="nav-text">（七）在本实验中你遇到了哪些不同指令类型组合产生的冲突？你又是如何解决的？相应的测试样例是什么样的？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E5%85%AB%EF%BC%89%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%98%AF%E6%89%8B%E5%8A%A8%E6%9E%84%E9%80%A0%E7%9A%84%E6%A0%B7%E4%BE%8B%EF%BC%8C%E8%AF%B7%E8%AF%B4%E6%98%8E%E6%9E%84%E9%80%A0%E7%AD%96%E7%95%A5%EF%BC%8C%E8%AF%B4%E6%98%8E%E4%BD%A0%E7%9A%84%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F%E5%A6%82%E4%BD%95%E4%BF%9D%E8%AF%81%E8%A6%86%E7%9B%96%E4%BA%86%E6%89%80%E6%9C%89%E9%9C%80%E8%A6%81%E6%B5%8B%E8%AF%95%E7%9A%84%E6%83%85%E5%86%B5%EF%BC%9B%E5%A6%82%E6%9E%9C%E4%BD%A0%E6%98%AF%E5%AE%8C%E5%85%A8%E9%9A%8F%E6%9C%BA%E7%94%9F%E6%88%90%E7%9A%84%E6%B5%8B%E8%AF%95%E6%A0%B7%E4%BE%8B%EF%BC%8C%E8%AF%B7%E6%80%9D%E8%80%83%E5%AE%8C%E5%85%A8%E9%9A%8F%E6%9C%BA%E7%9A%84%E6%B5%8B%E8%AF%95%E7%A8%8B%E5%BA%8F%E6%9C%89%E4%BD%95%E4%B8%8D%E8%B6%B3%E4%B9%8B%E5%A4%84%EF%BC%9B%E5%A6%82%E6%9E%9C%E4%BD%A0%E5%9C%A8%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E6%A0%B7%E4%BE%8B%E6%97%B6%E9%87%87%E7%94%A8%E4%BA%86%E7%89%B9%E6%AE%8A%E7%9A%84%E7%AD%96%E7%95%A5%EF%BC%8C%E6%AF%94%E5%A6%82%E6%9E%84%E9%80%A0%E8%BF%9E%E7%BB%AD%E6%95%B0%E6%8D%AE%E5%86%92%E9%99%A9%E5%BA%8F%E5%88%97%EF%BC%8C%E8%AF%B7%E4%BD%A0%E6%8F%8F%E8%BF%B0%E4%B8%80%E4%B8%8B%E4%BD%A0%E4%BD%BF%E7%94%A8%E7%9A%84%E7%AD%96%E7%95%A5%E5%A6%82%E4%BD%95%E7%BB%93%E5%90%88%E4%BA%86%E9%9A%8F%E6%9C%BA%E6%80%A7%E8%BE%BE%E5%88%B0%E5%BC%BA%E6%B5%8B%E7%9A%84%E6%95%88%E6%9E%9C%E3%80%82"><span class="nav-text">（八）如果你是手动构造的样例，请说明构造策略，说明你的测试程序如何保证覆盖了所有需要测试的情况；如果你是完全随机生成的测试样例，请思考完全随机的测试程序有何不足之处；如果你在生成测试样例时采用了特殊的策略，比如构造连续数据冒险序列，请你描述一下你使用的策略如何结合了随机性达到强测的效果。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E5%81%9A%E9%A2%98"><span class="nav-text">选做题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%EF%BC%88%E4%B8%80%EF%BC%89%E8%AF%B7%E8%AF%84%E4%BC%B0%E6%88%91%E4%BB%AC%E7%BB%99%E5%87%BA%E7%9A%84%E8%A6%86%E7%9B%96%E7%8E%87%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%90%88%E7%90%86%E6%80%A7%EF%BC%8C%E5%A6%82%E6%9C%89%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%96%B9%E6%A1%88%EF%BC%8C%E5%8F%AF%E4%B8%80%E5%B9%B6%E6%8F%90%E5%87%BA%E3%80%82"><span class="nav-text">（一）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B-%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97"><span class="nav-text">四.自动化测试模块</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="nav-text">命令行自动测试</span></a></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E8%A7%84%E8%8C%83%E5%8C%96%E7%BC%96%E7%A0%81"><span class="nav-text">五、规范化编码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1%E3%80%81%E5%91%BD%E5%90%8D%E9%A3%8E%E6%A0%BC"><span class="nav-text">1、命名风格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2%E3%80%81%E6%A8%A1%E5%9D%97%E9%80%BB%E8%BE%91%E6%8E%92%E5%B8%83%EF%BC%88%E7%9C%8B%E5%9B%BE%E8%AF%B4%E8%AF%9D%EF%BC%89"><span class="nav-text">2、模块逻辑排布（看图说话）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3%E3%80%81%E5%B8%B8%E9%87%8F%E3%80%81%E5%AD%97%E9%9D%A2%E9%87%8F%E4%B8%8E%E5%AE%8F"><span class="nav-text">3、常量、字面量与宏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4%E3%80%81%E8%AF%91%E7%A0%81%E9%A3%8E%E6%A0%BC"><span class="nav-text">4、译码风格</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Charles</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        Total Page Views&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">Powered by Charles</span>
                <br>
            <span class="theme-version-container">Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.1.4</a>
        </div>
        
        
        
            <div id="start_div" style="display:none">
                2022/12/27 00:00:00
            </div>
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="right-bottom-tools rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                <i class="fa-regular fa-rss"></i>
                </a>
            </li>
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>



  
<script src="/js/utils.js"></script>

<script src="/js/main.js"></script>

<script src="/js/layouts/navbarShrink.js"></script>

<script src="/js/tools/scrollTopBottom.js"></script>

<script src="/js/tools/lightDarkSwitch.js"></script>



    
<script src="/js/tools/localSearch.js"></script>




    
<script src="/js/tools/codeBlock.js"></script>




    
<script src="/js/layouts/lazyload.js"></script>




    
<script src="/js/tools/runtime.js"></script>

    
<script src="/js/layouts/odometer.min.js"></script>

    
<link rel="stylesheet" href="/assets/odometer-theme-minimal.css">




  
<script src="/js/libs/Typed.min.js"></script>

  
<script src="/js/plugins/typed.js"></script>




    
<script src="/js/libs/mermaid.min.js"></script>

    
<script src="/js/plugins/mermaid.js"></script>




    
<script src="/js/libs/minimasonry.min.js"></script>

    
<script src="/js/plugins/masonry.js"></script>



<div class="post-scripts pjax">
    
        
<script src="/js/tools/tocToggle.js"></script>

<script src="/js/libs/anime.min.js"></script>

<script src="/js/layouts/toc.js"></script>

<script src="/js/plugins/tabs.js"></script>

    
</div>


    
<script src="/js/libs/pjax.min.js"></script>

<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>



  
</body>

</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
