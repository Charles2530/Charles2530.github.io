<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Charles">
    
    <meta name="author" content="Charles">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
        
            <link rel="preconnect" href="https://npm.elemecdn.com" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://charles2530.github.io/2022/12/26/p7-design-documents/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="post by Charles in 2022-12-26 21:12:09">
<meta property="og:type" content="article">
<meta property="og:title" content="P7 Design documents">
<meta property="og:url" content="http://charles2530.github.io/2022/12/26/p7-design-documents/index.html">
<meta property="og:site_name" content="Charles&#39;s Castle">
<meta property="og:description" content="post by Charles in 2022-12-26 21:12:09">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://charles2530.github.io/image/simple_cpu.png">
<meta property="og:image" content="https://charles2530.github.io/image/4.png">
<meta property="og:image" content="https://charles2530.github.io/image/5.png">
<meta property="og:image" content="https://charles2530.github.io/image/TC_mode.png">
<meta property="article:published_time" content="2022-12-26T13:12:09.000Z">
<meta property="article:modified_time" content="2023-06-17T06:13:59.319Z">
<meta property="article:author" content="Du Jinyang">
<meta property="article:tag" content="CO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://charles2530.github.io/image/simple_cpu.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="https://charles2530.github.io/image/background/favicon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="https://charles2530.github.io/image/background/favicon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="https://charles2530.github.io/image/background/favicon.png">
    <!--- Page Info-->
    
    <title>
        
            P7 Design documents -
        
        Charles&#39;s Castle
    </title>
    
<link rel="stylesheet" href="/css/style.css">

    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fonts/fonts.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fonts/Satoshi/satoshi.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fonts/Chillax/chillax.css">
    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"charles2530.github.io","root":"/","language":"en","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["lol","Neo","God"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":true,"title":"recommend_articles","limit":3,"mobile_limit":2,"placeholder":"https://charles2530.github.io/image/background/p3.jfif","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":"#1890ff"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"busuanzi_counter":{"enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"pjax":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"https://charles2530.github.io/image/background/background-light1.jpg","dark":"https://charles2530.github.io/image/background/background-dark1.jpg"},"title":"Charles's Castle","subtitle":{"text":["Happiness is best!","Never give up!","Everyday is a gift!"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000000","dark":"#d1d1b6"},"text_style":{"title_size":"3.2rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Charles2530/","zhihu":"https://www.zhihu.com/people/yang-guang-xiao-zi-55-55","email":"charles2530@163.com"}}},"plugins":{"feed":{"enable":true},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.2.0","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Categories":{"path":"/categories","icon":"fas fa-bookmark"},"Tags":{"path":"/tags","icon":"fas fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/Charles2530/","Blog":"https://charles2530.github.io"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"This is Charles's Castle","links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Photos":{"icon":"fa-solid fa-image","path":"/masonry/"},"Essays":{"icon":"fa-solid fa-message-lines","path":"/essay/"},"Friends":{"icon":"fa-solid fa-user-group","path":"/friends/"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/12/27 00:00:00"};
    Global.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    Global.data_config = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Charles's Castle" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>



<body>
  <div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="pjax-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container">

    

    <div class="main-content-container">

        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Charles&#39;s Castle
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fas fa-bookmark"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fas fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="https://charles2530.github.io">BLOG
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer">
        <ul class="drawer-navbar-list">
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/categories"  >
                             
                                
                                    <i class="fas fa-bookmark"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="" 
                        href="/tags"  >
                             
                                
                                    <i class="fas fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item flex-center">
                        <a class="has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="/about">ME</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB</a>
                            </li>
                        
                            <li class="dropdown-item flex-center">
                                <a class="dropdown-item" href="https://charles2530.github.io">BLOG</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="fade-in-down-animation">
    <div class="post-page-container">
        <div class="article-content-container">

            
                      
                <div class="article-title">
                    <img src="https://charles2530.github.io/image/background/p1.jpg" alt="P7 Design documents" />
                    <h1 class="article-title-cover">P7 Design documents</h1>
                </div>
            
                
            

            
                <div class="article-header">
                    <div class="avatar">
                        <img src="https://charles2530.github.io/image/background/logo.jpg">
                    </div>
                    <div class="info">
                        <div class="author">
                            <span class="name">Charles</span>
                            
                                <span class="author-label">Lv6</span>
                            
                        </div>
                        <div class="meta-info">
                            <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2022-12-26 21:12:09</span>
        <span class="mobile">2022-12-26 21:12</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-06-17 14:13:59</span>
            <span class="mobile">2023-06-17 14:13</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/categories/Lesson/">Lesson</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/Lesson/CO/">CO</a>&nbsp;
                    </li>
                
                    <li>
                        &gt; <a href="/categories/Lesson/CO/CO-files/">CO-files</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/CO/">CO</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>14.9k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>74 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                        </div>
                    </div>
                </div>
            

            <div class="article-content markdown-body">
                <h1 id="verilog流水线cpu设计文档"><a class="markdownIt-Anchor" href="#verilog流水线cpu设计文档"></a> Verilog流水线CPU设计文档</h1>
<h3 id="一-cpu设计方案综述"><a class="markdownIt-Anchor" href="#一-cpu设计方案综述"></a> 一、 CPU设计方案综述</h3>
<h4 id="一-总体设计概述"><a class="markdownIt-Anchor" href="#一-总体设计概述"></a> （一） 总体设计概述</h4>
<p>使用Verilog开发一个简单的流水线CPU，总体概述如下：</p>
<ol>
<li>
<p>此CPU为32位CPU</p>
</li>
<li>
<p>此CPU为流水线设计</p>
</li>
<li>
<p>此CPU支持的指令集为：</p>
<p>mips-c指令集所有指令</p>
</li>
<li>
<p>add, sub不支持溢出</p>
</li>
</ol>
<h4 id="二-关键模块定义"><a class="markdownIt-Anchor" href="#二-关键模块定义"></a> （二） 关键模块定义</h4>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/simple_cpu.png"
                      alt="img" 
                ></p>
<h2 id="主代码mips"><a class="markdownIt-Anchor" href="#主代码mips"></a> 主代码mips</h2>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> mips(<span class="keyword">input</span> clk,</span><br><span class="line">            <span class="keyword">input</span> reset,</span><br><span class="line">            <span class="keyword">input</span> interrupt,</span><br><span class="line">            <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] i_inst_rdata,<span class="comment">//IM_RD</span></span><br><span class="line">            <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] m_data_rdata,<span class="comment">//DM_RD</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] macroscopic_pc,<span class="comment">//PC</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] i_inst_addr,<span class="comment">//IM_Address</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] m_data_addr,<span class="comment">//DM_Address</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] m_data_wdata,<span class="comment">//DM_WD</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] m_data_byteen,<span class="comment">//DM_en</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] m_int_addr,<span class="comment">//Int_Address</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] m_int_byteen,<span class="comment">//Int_en</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] m_inst_addr,<span class="comment">//M_PC</span></span><br><span class="line">            <span class="keyword">output</span> w_grf_we,<span class="comment">//Grf_en</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">4</span>:<span class="number">0</span>] w_grf_addr,<span class="comment">//Grf_Address</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] w_grf_wdata,<span class="comment">//Grf_WD</span></span><br><span class="line">            <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] w_inst_addr<span class="comment">//W_PC</span></span><br><span class="line">            );</span><br><span class="line">    <span class="comment">/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line">    <span class="comment">////cpu</span></span><br><span class="line">    <span class="keyword">wire</span> inter_T0,inter_T1;</span><br><span class="line">    <span class="comment">//Bridge</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] WD_out,RD_out;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] Address_out;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">3</span>:<span class="number">0</span>] DM_en;</span><br><span class="line">    <span class="keyword">wire</span> T0_WE,T1_WE;</span><br><span class="line">    <span class="comment">//TC</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">2</span>] TC_Addr;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] T0_RD,T1_RD;</span><br><span class="line">    <span class="keyword">assign</span> TC_Addr=Address_out[<span class="number">31</span>:<span class="number">2</span>];</span><br><span class="line">    <span class="comment">//interrupt</span></span><br><span class="line">    <span class="comment">//cpu</span></span><br><span class="line">    cpu cpu (</span><br><span class="line">    <span class="variable">.clk</span>(clk), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.reset</span>(reset),<span class="comment">// </span></span><br><span class="line">    <span class="variable">.interrupt</span>(interrupt), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.inter_T0</span>(inter_T0), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.inter_T1</span>(inter_T1), <span class="comment">//</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">.i_inst_rdata</span>(i_inst_rdata),<span class="comment">// </span></span><br><span class="line">    <span class="variable">.Rdata</span>(RD_out), <span class="comment">//dm_read_data</span></span><br><span class="line"></span><br><span class="line">    <span class="variable">.macroscopic_pc</span>(macroscopic_pc),<span class="comment">//</span></span><br><span class="line">    <span class="variable">.i_inst_addr</span>(i_inst_addr),<span class="comment">// </span></span><br><span class="line">    <span class="variable">.m_data_addr</span>(m_data_addr), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.m_data_wdata</span>(m_data_wdata), <span class="comment">//dm_write_data</span></span><br><span class="line">    <span class="variable">.Byteen</span>(m_data_byteen),<span class="comment">// </span></span><br><span class="line">    <span class="variable">.m_int_addr</span>(m_int_addr),<span class="comment">//Int_Address</span></span><br><span class="line">    <span class="variable">.m_int_byteen</span>(m_int_byteen),<span class="comment">//Int_en</span></span><br><span class="line">    <span class="variable">.m_inst_addr</span>(m_inst_addr), </span><br><span class="line">    <span class="variable">.w_grf_we</span>(w_grf_we), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.w_grf_addr</span>(w_grf_addr), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.w_grf_wdata</span>(w_grf_wdata), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.w_inst_addr</span>(w_inst_addr)<span class="comment">//</span></span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Bridge</span></span><br><span class="line">    Bridge bridge (</span><br><span class="line">    <span class="variable">.Address_in</span>(m_int_addr), </span><br><span class="line">    <span class="variable">.WD_in</span>(m_data_wdata), </span><br><span class="line">    <span class="variable">.byteen</span>(m_data_byteen), </span><br><span class="line">    <span class="variable">.DM_RD</span>(m_data_rdata), <span class="comment">//</span></span><br><span class="line">    <span class="variable">.T0_RD</span>(T0_RD), </span><br><span class="line">    <span class="variable">.T1_RD</span>(T1_RD),</span><br><span class="line"></span><br><span class="line">    <span class="variable">.DM_WE</span>(DM_en),</span><br><span class="line">    <span class="variable">.T0_WE</span>(T0_WE), </span><br><span class="line">    <span class="variable">.T1_WE</span>(T1_WE), </span><br><span class="line">    <span class="variable">.Address_out</span>(Address_out), </span><br><span class="line">    <span class="variable">.WD_out</span>(WD_out), <span class="comment">//DM</span></span><br><span class="line">    <span class="variable">.RD_out</span>(RD_out)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">////T0</span></span><br><span class="line">    TC T0 (</span><br><span class="line">    <span class="variable">.clk</span>(clk), </span><br><span class="line">    <span class="variable">.reset</span>(reset), </span><br><span class="line">    <span class="variable">.Addr</span>(TC_Addr), </span><br><span class="line">    <span class="variable">.WE</span>(T0_WE), </span><br><span class="line">    <span class="variable">.Din</span>(WD_out), </span><br><span class="line"></span><br><span class="line">    <span class="variable">.Dout</span>(T0_RD), </span><br><span class="line">    <span class="variable">.IRQ</span>(inter_T0)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="comment">////T1</span></span><br><span class="line">    TC T1 (</span><br><span class="line">    <span class="variable">.clk</span>(clk), </span><br><span class="line">    <span class="variable">.reset</span>(reset), </span><br><span class="line">    <span class="variable">.Addr</span>(TC_Addr), </span><br><span class="line">    <span class="variable">.WE</span>(T1_WE), </span><br><span class="line">    <span class="variable">.Din</span>(WD_out), </span><br><span class="line"></span><br><span class="line">    <span class="variable">.Dout</span>(T1_RD), </span><br><span class="line">    <span class="variable">.IRQ</span>(inter_T1)</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="宏的定义"><a class="markdownIt-Anchor" href="#宏的定义"></a> 宏的定义</h2>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="comment">//alu</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _ADD    12&#x27;b000000000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SUB    12&#x27;b000000000010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _AND    12&#x27;b000000000100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _OR     12&#x27;b000000001000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _XOR    12&#x27;b000000010000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _NOR    12&#x27;b000000100000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SLL    12&#x27;b000001000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SRA    12&#x27;b000010000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SRL    12&#x27;b000100000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SLT    12&#x27;b001000000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _SLTU   12&#x27;b010000000000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> _ALUNew 12&#x27;b100000000000</span></span><br><span class="line"><span class="comment">//ifu</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> PC_Initial 32&#x27;h0000_3000</span></span><br><span class="line"><span class="comment">//ext</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Zero_Ext 3&#x27;b001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Sign_Ext 3&#x27;b010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Lui_Ext  3&#x27;b100</span></span><br><span class="line"><span class="comment">//NPC</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> PC4_NPC         5&#x27;b00001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> B_transfer_NPC  5&#x27;b00010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> J_transfer_NPC  5&#x27;b00100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Jr_NPC          5&#x27;b01000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> NEW_NPC         5&#x27;b10000</span></span><br><span class="line"><span class="comment">//Controller_for_Reg</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ALUop_Initial       7&#x27;b0000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> AluSrc1_Initial     4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> AluSrc2_Initial     4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> WhichtoReg_Initial  8&#x27;b00000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> RegDst_Initial      4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> DM_type_Initial     6&#x27;b000001</span></span><br><span class="line"><span class="comment">//DM</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Word_DM           6&#x27;b000001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Half_DM           6&#x27;b000010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Byte_DM           6&#x27;b000100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Unsigned_Half_DM  6&#x27;b001000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Unsigned_Byte_DM  6&#x27;b010000</span></span><br><span class="line"><span class="comment">//B_transfer</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> nop_B_trans   4&#x27;b0000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> beq_B_trans   4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bgez_B_trans  4&#x27;b0010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bgtz_B_trans  4&#x27;b0011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> blez_B_trans  4&#x27;b0100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bltz_B_trans  4&#x27;b0101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> bne_B_trans   4&#x27;b0110</span></span><br><span class="line"><span class="comment">//MD_Unit</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> nop_MDU   4&#x27;b0000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mult_MDU  4&#x27;b0001</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> multu_MDU 4&#x27;b0010</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> div_MDU   4&#x27;b0011</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> divu_MDU  4&#x27;b0100</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mfhi_MDU  4&#x27;b0101</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mflo_MDU  4&#x27;b0110</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mthi_MDU  4&#x27;b0111</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> mtlo_MDU  4&#x27;b1000</span></span><br><span class="line"><span class="comment">//TC</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> IDLE 2&#x27;b00</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> LOAD 2&#x27;b01</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> CNT  2&#x27;b10</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> INT  2&#x27;b11</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ctrl   mem[0]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> preset mem[1]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> count  mem[2]</span></span><br><span class="line"><span class="comment">//CP0</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> IM      SR[15:10]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> EXL     SR[1]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> IE      SR[0]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> BD      Cause[31]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> IP      Cause[15:10]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> ExcCode Cause[6:2]</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> SR_Address    5&#x27;d12</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Cause_Address 5&#x27;d13</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> EPC_Address   5&#x27;d14</span></span><br><span class="line"><span class="comment">//Bridge</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Data_Begin    32&#x27;h0000_0000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Data_End      32&#x27;h0000_2fff</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Text_Begin    32&#x27;h0000_3000</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Text_End      32&#x27;h0000_6fff</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_Entry   32&#x27;h0000_4180</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> T0_Begin      32&#x27;h0000_7f00</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> T0_End        32&#x27;h0000_7f0b</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> T1_Begin      32&#x27;h0000_7f10</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> T1_End        32&#x27;h0000_7f1b</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Echo_Begin    32&#x27;h0000_7f20</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Echo_End      32&#x27;h0000_7f23</span></span><br><span class="line"><span class="comment">//Error_Stream</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_Int     5&#x27;d0</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_AdEL    5&#x27;d4</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_AdES    5&#x27;d5</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_Syscall 5&#x27;d8</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_RI      5&#x27;d10</span></span><br><span class="line"><span class="meta">`<span class="keyword">define</span> Error_Ov      5&#x27;d12</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="cpu模块"><a class="markdownIt-Anchor" href="#cpu模块"></a> CPU模块</h2>
<h2 id="一f级流水线"><a class="markdownIt-Anchor" href="#一f级流水线"></a> &lt;一&gt;.F级流水线</h2>
<h4 id="1-pc"><a class="markdownIt-Anchor" href="#1-pc"></a> 1. PC</h4>
<p>（1） 端口说明</p>
<center>表1-IFU端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>同步复位信号，将PC值置为0x0000_3000：<br>0：无效<br>1：复位</td>
</tr>
<tr>
<td>3</td>
<td>en</td>
<td>I</td>
<td>使能信号，决定是否阻塞</td>
</tr>
<tr>
<td>4</td>
<td>NPC[31:0]</td>
<td>I</td>
<td>下一周期PC的地址</td>
</tr>
<tr>
<td>6</td>
<td>PC[31:0]</td>
<td>O</td>
<td>当前执行的PC</td>
</tr>
</tbody>
</table>
<p>（2） 功能定义</p>
<center>表2-IFU功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>复位</td>
<td>reset有效时，PC置为0x00003000</td>
</tr>
<tr>
<td>2</td>
<td>更新PC的值</td>
<td>将PC赋值为NPC</td>
</tr>
</tbody>
</table>
<h2 id="二d级流水线"><a class="markdownIt-Anchor" href="#二d级流水线"></a> &lt;二&gt;.D级流水线</h2>
<h4 id="1-grf"><a class="markdownIt-Anchor" href="#1-grf"></a> 1. GRF</h4>
<p>（1） 端口说明</p>
<center>表3-GRF端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>同步复位信号，将32个寄存器中全部清零<br>1：清零<br>0：无效</td>
</tr>
<tr>
<td>3</td>
<td>WE</td>
<td>I</td>
<td>写使能信号<br>1：可向GRF中写入数据<br>0：不能向GRF中写入数据</td>
</tr>
<tr>
<td>4</td>
<td>A1[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，将其中存储的数据读出到RD1</td>
</tr>
<tr>
<td>5</td>
<td>A2[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，将其中存储的数据读出到RD2</td>
</tr>
<tr>
<td>6</td>
<td>A3[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，作为RD的写入地址</td>
</tr>
<tr>
<td>7</td>
<td>WD[31:0]</td>
<td>I</td>
<td>32位写入数据</td>
</tr>
<tr>
<td>8</td>
<td>WPC[31:0]</td>
<td>I</td>
<td>当前写入GRF的PC</td>
</tr>
<tr>
<td>9</td>
<td>RD1[31:0]</td>
<td>O</td>
<td>输出A1指定的寄存器的32位数据</td>
</tr>
<tr>
<td>10</td>
<td>RD2[31:0]</td>
<td>O</td>
<td>输出A2指定的寄存器的32位数据</td>
</tr>
</tbody>
</table>
<p>（2） 功能定义</p>
<center>表4-GRF功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>同步复位</td>
<td>reset为1时，将所有寄存器清零</td>
</tr>
<tr>
<td>2</td>
<td>读数据</td>
<td>将A1和A2地址对应的寄存器的值分别通过RD1和RD2读出</td>
</tr>
<tr>
<td>3</td>
<td>写数据</td>
<td>当WE为1且时钟上升沿来临时，将WD写入到A3对应的寄存器内部</td>
</tr>
<tr>
<td>4</td>
<td>内部转发</td>
<td>当A1和A2之一与A3相等且写入信号为1时，用WD代替RD1或RD2的输出</td>
</tr>
</tbody>
</table>
<h4 id="2-ext"><a class="markdownIt-Anchor" href="#2-ext"></a> 2. EXT</h4>
<p>(1) 端口说明</p>
<center>表9-EXT端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>imm16[15:0]</td>
<td>I</td>
<td>代扩展的16位信号</td>
</tr>
<tr>
<td>2</td>
<td>sign[2:0]</td>
<td>I</td>
<td>无符号或符号扩展选择信号<br/>3’b001：无符号扩展<br/>3’b010：符号扩展<br>3’b100:   寄存到高位</td>
</tr>
<tr>
<td>3</td>
<td>imm32[31:0]</td>
<td>O</td>
<td>扩展后的32位的信号</td>
</tr>
</tbody>
</table>
<p>(2) 功能定义</p>
<center>表10-EXT功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>无符号扩展</td>
<td>当sign为3’b001时，将imm16无符号扩展输出</td>
</tr>
<tr>
<td>2</td>
<td>符号扩展</td>
<td>当sign为3‘b010时，将imm16符号扩展输出</td>
</tr>
<tr>
<td>3</td>
<td>存储到高位</td>
<td>当sign为3’100时，将imm16存在高16位</td>
</tr>
</tbody>
</table>
<h4 id="3-controller"><a class="markdownIt-Anchor" href="#3-controller"></a> 3. Controller</h4>
<p>(1) 端口说明</p>
<center>表11-Controller端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>op[5:0]</td>
<td>I</td>
<td>instr[31:26]6位控制信号</td>
</tr>
<tr>
<td>2</td>
<td>func[5:0]</td>
<td>I</td>
<td>instr[5:0]6位控制信号</td>
</tr>
<tr>
<td>3</td>
<td>rt[4:0]</td>
<td>I</td>
<td>instr[20:16]5位控制信号</td>
</tr>
<tr>
<td>4</td>
<td>AluOp[11:0]</td>
<td>O</td>
<td>ALU的控制信号</td>
</tr>
<tr>
<td>5</td>
<td>WeGrf</td>
<td>O</td>
<td>GRF写使能信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>6</td>
<td>WeDm</td>
<td>O</td>
<td>DM的写入信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>7</td>
<td>branch[3:0]</td>
<td>O</td>
<td>PC转移位置选择信号<br>4’b0001:其他情况<br>4’b0010:beq<br>4’b0100:j||jal<br>4’b1000:jr;</td>
</tr>
<tr>
<td>8</td>
<td>AluSrc1[3:0]</td>
<td>O</td>
<td>参与ALU运算的第一个数<br/>4’b0001：RD1<br/>4’b0010：RD2</td>
</tr>
<tr>
<td>9</td>
<td>AluSrc2[3:0]</td>
<td>O</td>
<td>参与ALU运算的第二个数，来自GRF还是imm<br/>4’b0001：RD2<br/>4’b0010：imm32<br/>4’b0100: offset</td>
</tr>
<tr>
<td>10</td>
<td>WhichtoReg[7:0]</td>
<td>O</td>
<td>将何种数据写入GRF？<br/>8’b0000_0001：ALU计算结果<br/>8’b0000_0010：DM读出信号<br/>8’b0000_0100：upperImm<br/>8’b0000_1000: PC+4</td>
</tr>
<tr>
<td>11</td>
<td>RegDst[3:0]</td>
<td>O</td>
<td>写入GRF的哪个寄存器？<br>4’b0001:rd<br>4’b0010:rt<br>4’b0100:31号寄存器</td>
</tr>
<tr>
<td>12</td>
<td>SignExt[2:0]</td>
<td>O</td>
<td>拓展方式：<br>3’b001:0拓展<br>3’b010:符号拓展<br>3’b100:存储到高位</td>
</tr>
<tr>
<td>13</td>
<td>B_change[3:0]</td>
<td>O</td>
<td>B转移的类型<br>4’b0001:beq<br>4’b0010:slt<br>4’b0100:blez</td>
</tr>
<tr>
<td>14</td>
<td>DM_type[5:0]</td>
<td>O</td>
<td>存取指令类型：<br>6’b000001:lw/sw<br>6’b000010:lh/sh<br>6’b000100:lb/sb<br />6’b001000:lhu<br />6’b010000:lbu</td>
</tr>
<tr>
<td>15</td>
<td>MDop[3:0]</td>
<td>O</td>
<td>乘除指令选择信号：<br />4‘b0000:无操作<br />4’b0001:mult<br />4’b0010:multu<br />4’b0011:div<br />4’b0100:divu<br />4’b0101:mfhi<br />4’b0110:mflo<br />4’b0111:mthi<br />4’b1000:mtlo</td>
</tr>
<tr>
<td>16</td>
<td>D_Tuse_rs[1:0]</td>
<td>O</td>
<td>指令的rs寄存器的值从第一次进入D级到被使用的周期数</td>
</tr>
<tr>
<td>17</td>
<td>D_Tuse_rt[1:0]</td>
<td>O</td>
<td>指令的rt寄存器的值从第一次进入D级到被使用的周期数</td>
</tr>
<tr>
<td>18</td>
<td>D_Tnew[1:0]</td>
<td>O</td>
<td>指令从进入D开始到产生运算结果需要的周期数</td>
</tr>
</tbody>
</table>
<h4 id="4npc"><a class="markdownIt-Anchor" href="#4npc"></a> 4.NPC</h4>
<h4 id="npc下一指令计算单元"><a class="markdownIt-Anchor" href="#npc下一指令计算单元"></a> NPC（下一指令计算单元）</h4>
<p>该模块根据当前pc（包括D级和F级）和其他控制信号（NPCOp，CMP输出信息），计算出下一指令所在的地址npc，传入IFU模块。</p>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">信号名</th>
<th style="text-align:left">方向</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F_pc</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级指令地址</td>
</tr>
<tr>
<td style="text-align:left">D_pc</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级指令地址</td>
</tr>
<tr>
<td style="text-align:left">offset</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">地址偏移量，用于计算B类指令所要跳转的地址</td>
</tr>
<tr>
<td style="text-align:left">imm26</td>
<td style="text-align:left">I</td>
<td style="text-align:left">26</td>
<td style="text-align:left">当前指令数据的前26位（0~25），用于计算jal和j指令所要跳转的地址</td>
</tr>
<tr>
<td style="text-align:left">ra</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">储存在寄存器（$ra或是jalr指令中存储“PC+4”的寄存器）中的地址数据，用于实现jr和jalr指令</td>
</tr>
<tr>
<td style="text-align:left">ALU_change</td>
<td style="text-align:left">I</td>
<td style="text-align:left">1</td>
<td style="text-align:left">B类指令判断结果 1：说明当前B类指令的判断结果为真 0：说明判断结果为假</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">I</td>
<td style="text-align:left">4</td>
<td style="text-align:left">NPC功能选择 0x000：顺序执行 0x001：B类指令跳转 0x010: jal/j跳转 0x011: jr/jalr跳转</td>
</tr>
<tr>
<td style="text-align:left">npc</td>
<td style="text-align:left">O</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输出下一指令地址</td>
</tr>
<tr>
<td style="text-align:left">PC8</td>
<td style="text-align:left">O</td>
<td style="text-align:left">32</td>
<td style="text-align:left">jr指令时存储PC+8的值</td>
</tr>
</tbody>
</table>
<h4 id="5b_transferb类指令比较单元"><a class="markdownIt-Anchor" href="#5b_transferb类指令比较单元"></a> 5.B_transfer(B类指令比较单元)</h4>
<p>该单元根据输入的CMPOp信号对当前B指令的类型进行判断，进而对当前输入的数值进行相应比较，最后输出结果。</p>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">信号名</th>
<th style="text-align:left">方向</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输入B_transfer单元的第一个数据</td>
</tr>
<tr>
<td style="text-align:left">B</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输入B_transfer单元的第二个数据</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:left">I</td>
<td style="text-align:left">4</td>
<td style="text-align:left">Type功能选择信号<br> 0x0001：beq判断<br> 0x0010：slt判断 <br>0x0100：blez判断</td>
</tr>
<tr>
<td style="text-align:left">ALU_change</td>
<td style="text-align:left">O</td>
<td style="text-align:left">1</td>
<td style="text-align:left">判断结果输出 <br>1: 判断结果为真<br> 0：判断结果为假</td>
</tr>
</tbody>
</table>
<h2 id="三e级流水线"><a class="markdownIt-Anchor" href="#三e级流水线"></a> &lt;三&gt;.E级流水线</h2>
<h4 id="1-alu"><a class="markdownIt-Anchor" href="#1-alu"></a> 1. ALU</h4>
<p>(1) 端口说明</p>
<center>表5-ALU端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A[31:0]</td>
<td>I</td>
<td>参与运算的第一个数</td>
</tr>
<tr>
<td>2</td>
<td>B[31:0]</td>
<td>I</td>
<td>参与运算的第二个数</td>
</tr>
<tr>
<td>3</td>
<td>ALUop[11:0]</td>
<td>I</td>
<td>决定ALU做何种操作<br>12’b0000_0000_0001：无符号加<br/>12’b0000_0000_0010：无符号减<br/>12’b0000_0000_0100：与<br/>12’b0000_0000_1000：或<br/>12‘b0000_0001_0000:异或<br />12‘b0000_0010_0000:或非<br />12‘b0000_0100_0000:sll<br />12‘b0000_1000_0000:sra<br />12‘b0001_0000_0000:srl<br />12‘b0010_0000_0000:slt<br />12‘b0100_0000_0000:sltu</td>
</tr>
<tr>
<td>4</td>
<td>res</td>
<td>O</td>
<td>A与B做运算后的结果</td>
</tr>
</tbody>
</table>
<p>(2) 功能定义</p>
<center>表6-ALU功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>加运算</td>
<td>res = A + B</td>
</tr>
<tr>
<td>2</td>
<td>减运算</td>
<td>res = A - B</td>
</tr>
<tr>
<td>3</td>
<td>与运算</td>
<td>res = A &amp; B</td>
</tr>
<tr>
<td>4</td>
<td>或运算</td>
<td>res = A | B</td>
</tr>
<tr>
<td>5</td>
<td>左移位运算</td>
<td>Res=A&lt;&lt;B</td>
</tr>
</tbody>
</table>
<h4 id="2md_unit"><a class="markdownIt-Anchor" href="#2md_unit"></a> 2.MD_Unit</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">MD_Unit使能信号</td>
<td style="text-align:left">判断是否为乘除计算</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">MDop</td>
<td style="text-align:left">4</td>
<td style="text-align:left">指令选择信号</td>
<td style="text-align:left">Controller</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">A</td>
<td style="text-align:left">32</td>
<td style="text-align:left">第一个计算数</td>
<td style="text-align:left">e_A</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">B</td>
<td style="text-align:left">32</td>
<td style="text-align:left">第二个计算数</td>
<td style="text-align:left">e_B</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">HI</td>
<td style="text-align:left">32</td>
<td style="text-align:left">HI寄存器输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">LO</td>
<td style="text-align:left">32</td>
<td style="text-align:left">LO寄存器输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">取出HI或LO的值</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">busy</td>
<td style="text-align:left">1</td>
<td style="text-align:left">是否在进行乘除计算</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h2 id="四m级流水线"><a class="markdownIt-Anchor" href="#四m级流水线"></a> &lt;四&gt;.M级流水线</h2>
<h4 id="1-dm_in"><a class="markdownIt-Anchor" href="#1-dm_in"></a> 1. DM_In</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">low2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">Address低两位</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">WD</td>
<td style="text-align:left">31</td>
<td style="text-align:left">处理前写入结果</td>
<td style="text-align:left">32位写入数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">决定存取指令类型</td>
<td style="text-align:left">存取指令类型：<br/>6’b000001:lw/sw<br/>6’b000010:lh/sh<br/>6’b000100:lb/sb<br />6’b001000:lhu<br />6’b010000:lbu</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">data_byteen</td>
<td style="text-align:left">4</td>
<td style="text-align:left">字节使能信号</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">DM_input</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理后的写入结果</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h4 id="2dm_out"><a class="markdownIt-Anchor" href="#2dm_out"></a> 2.DM_Out</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">low2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">Address低两位</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_output</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理前读入信号</td>
<td style="text-align:left">32位读入数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">决定存取指令类型</td>
<td style="text-align:left">存取指令类型：<br/>6’b000001:lw/sw<br/>6’b000010:lh/sh<br/>6’b000100:lb/sb<br />6’b001000:lhu<br />6’b010000:lbu</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理后的读入结果</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h4 id="3cp0"><a class="markdownIt-Anchor" href="#3cp0"></a> 3.CP0</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">cpu主时钟</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">复位信号</td>
<td style="text-align:left">cpu同步复位信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">WE</td>
<td style="text-align:left">1</td>
<td style="text-align:left">写入使能</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Address</td>
<td style="text-align:left">5</td>
<td style="text-align:left">CP0 寄存器编号</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">WD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">CP0 寄存器的写入数据</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">BD_in</td>
<td style="text-align:left">1</td>
<td style="text-align:left">分支延迟槽指令标志</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">VPC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">中断/异常时的 PC</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">ExcCode_in</td>
<td style="text-align:left">5</td>
<td style="text-align:left">中断/异常的类型</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">HWInt</td>
<td style="text-align:left">6</td>
<td style="text-align:left">6 个设备中断</td>
<td style="text-align:left">前一级相同信号输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">EXLClr</td>
<td style="text-align:left">1</td>
<td style="text-align:left">置 0 SR 的EXL 位</td>
<td style="text-align:left">m_eret控制信号输入</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">req</td>
<td style="text-align:left">1</td>
<td style="text-align:left">异常/中断请求</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">EPC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">处理后的读入结果</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">CP0 寄存器的输出数据</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> CP0(<span class="keyword">input</span> clk,</span><br><span class="line">           <span class="keyword">input</span> reset,</span><br><span class="line">           <span class="keyword">input</span> WE,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] Address,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WD,</span><br><span class="line">           <span class="keyword">input</span> BD_in,<span class="comment">//branch delay</span></span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] VPC,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] ExcCode_in,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">2</span>] HWInt,</span><br><span class="line">           <span class="keyword">input</span> EXLClr,</span><br><span class="line"></span><br><span class="line">           <span class="keyword">output</span> req,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] EPC,</span><br><span class="line">           <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] D_out</span><br><span class="line">           );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] SR;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] Cause;</span><br><span class="line">    <span class="keyword">assign</span> InterInt = (ExcCode_in!= `Error_None)&amp;&amp;(!`EXL);</span><br><span class="line">    <span class="keyword">assign</span> ExterInt = (|(HWInt&amp;`IM))&amp;&amp;`IE&amp;&amp;(!`EXL);</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            SR    &lt;= <span class="number">0</span>;</span><br><span class="line">            Cause &lt;= <span class="number">0</span>;</span><br><span class="line">            EPC   &lt;= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            `IP &lt;= HWInt;</span><br><span class="line">            <span class="keyword">if</span> (EXLClr) <span class="keyword">begin</span></span><br><span class="line">                `EXL &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (req) <span class="keyword">begin</span></span><br><span class="line">                `BD      &lt;= BD_in;</span><br><span class="line">                EPC      &lt;= BD_in?(VPC-<span class="number">32&#x27;d4</span>):VPC;</span><br><span class="line">                `ExcCode &lt;= ExterInt?`Error_Int:ExcCode_in;</span><br><span class="line">                `EXL     &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">                <span class="comment">// $display(&quot;BD: %h,EPC: %h,ExcCode: %h,EXL: %h&quot;,`BD,EPC,`ExcCode,`EXL);</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (WE)<span class="keyword">begin</span></span><br><span class="line">                <span class="keyword">if</span> (Address == `SR_Address)<span class="keyword">begin</span></span><br><span class="line">                    SR &lt;= WD;</span><br><span class="line">                    <span class="comment">//$display(&quot;SR: %h&quot;,WD);</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (Address == `EPC_Address)<span class="keyword">begin</span></span><br><span class="line">                    EPC &lt;= WD;</span><br><span class="line">                    <span class="comment">// $display(&quot;EPC: %h&quot;,WD);</span></span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> req =(ExterInt||InterInt);</span><br><span class="line">    <span class="keyword">assign</span> D_out =  (Address == `SR_Address)?SR:<span class="comment">//mfc0,mtc0</span></span><br><span class="line">                    (Address == `Cause_Address)?Cause:</span><br><span class="line">                    (Address == `EPC_Address)?EPC:<span class="comment">//eret</span></span><br><span class="line">                    <span class="number">32&#x27;b0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="五各级流水线寄存器"><a class="markdownIt-Anchor" href="#五各级流水线寄存器"></a> &lt;五&gt;.各级流水线寄存器</h2>
<h4 id="1if_id"><a class="markdownIt-Anchor" href="#1if_id"></a> 1.IF_ID</h4>
<h4 id="d_regifid流水寄存器"><a class="markdownIt-Anchor" href="#d_regifid流水寄存器"></a> D_Reg（IF/ID流水寄存器）</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级寄存器使能信号</td>
<td style="text-align:left">stall信号取反</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clr</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级寄存器清空信号</td>
<td style="text-align:left">是否清空延迟槽决定</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">req</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级寄存器异常/中断请求信号</td>
<td style="text-align:left">CP0</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_instr</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级instr输入</td>
<td style="text-align:left">IFU_instr</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_pc</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级pc输入</td>
<td style="text-align:left">IFU_pc</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_ExcCode</td>
<td style="text-align:left">5</td>
<td style="text-align:left">F级ExcCode输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_BD</td>
<td style="text-align:left">1</td>
<td style="text-align:left">F级BD输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_instr</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级instr输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_pc</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级pc输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_ExcCode</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级ExcCode输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_BD</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级BD输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h4 id="2id_ex"><a class="markdownIt-Anchor" href="#2id_ex"></a> 2.ID_EX</h4>
<h4 id="e_regidex流水寄存器"><a class="markdownIt-Anchor" href="#e_regidex流水寄存器"></a> E_Reg（ID/EX流水寄存器）</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clr</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级寄存器清空信号</td>
<td style="text-align:left">HazardUnit中stall信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">req</td>
<td style="text-align:left">1</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RD1</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级GRF输出RD1</td>
<td style="text-align:left">通过B_transfer_D1转发的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级GRF输出RD2</td>
<td style="text-align:left">通过B_transfer_D2转发的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_instr_s</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级instr的shamt</td>
<td style="text-align:left">D_instr的s域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A1输入</td>
<td style="text-align:left">D_instr的rs域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A2输入</td>
<td style="text-align:left">D_instr的rt域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A3输入</td>
<td style="text-align:left">通过MUX_A3选择出的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级imm32输入</td>
<td style="text-align:left">通过EXT模块扩展出的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Tnew_D</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D级指令的Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_ALUop</td>
<td style="text-align:left">7</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_AluSrc1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_AluSrc2</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级ALU_change输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_MDop</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级MDop输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_branch</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级branch输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_ExcCode</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级ExcCode输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_BD</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级BD输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_mfc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级mfc0输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_mtc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级mtc0输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_eret</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级eret输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_syscall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级syscall输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RD1</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD1输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_instr_s</td>
<td style="text-align:left">5</td>
<td style="text-align:left">移位指令的位移数</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A1输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级指令的Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_ALUop</td>
<td style="text-align:left">12</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_AluSrc1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_AluSrc2</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">11</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RegDst</td>
<td style="text-align:left">3</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级ALU_change输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_MDop</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级MDop输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_branch</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级branch输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_ExcCode</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级ExcCode输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_BD</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级BD输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_mfc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级mfc0输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_mtc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级mtc0输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_eret</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级eret输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_syscall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级syscall输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>运算功能</strong></p>
<p>Tnew_E = (Tnew_D &gt; 0) ? Tnew_D - 1: 0Tnew_E=(Tnew_D&gt;0)?Tnew_D−1:0</p>
</li>
</ul>
<h5 id="3ex_mem"><a class="markdownIt-Anchor" href="#3ex_mem"></a> 3.EX_MEM</h5>
<h4 id="m_regexmem流水寄存器"><a class="markdownIt-Anchor" href="#m_regexmem流水寄存器"></a> M_Reg（EX/MEM流水寄存器）</h4>
<ul>
<li>端口定义</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2输入</td>
<td style="text-align:left">ALU_out数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3输入（转发值）</td>
<td style="text-align:left">MUX_ALU选择出来的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD2输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级res输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级ALU_change输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级imm32输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_branch</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级branch输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_ExcCode</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级ExcCode输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_BD</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级BD输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_mfc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级mfc0输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_mtc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级mtc0输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_eret</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级eret输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_syscall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级syscall输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级RD2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级res输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_DM_type</td>
<td style="text-align:left">6</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级ALU_change输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_branch</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级branch输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_ExcCode</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级ExcCode输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_BD</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级BD输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_mfc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级mfc0输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_mtc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级mtc0输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_eret</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级eret输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_syscall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级syscall输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>运算功能</strong></p>
<p>Tnew_M = (Tnew_E &gt; 0) ? Tnew_E - 1: 0Tnew_M=(Tnew_E&gt;0)?Tnew_E−1:0</p>
</li>
</ul>
<h5 id="4mem_wb"><a class="markdownIt-Anchor" href="#4mem_wb"></a> 4.MEM_WB</h5>
<h4 id="w_regmemwb流水寄存器"><a class="markdownIt-Anchor" href="#w_regmemwb流水寄存器"></a> W_Reg（MEM/WB流水寄存器）</h4>
<ul>
<li><strong>接口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级RD输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级imm32输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级ALU_change输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">W级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级res输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级RD输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_ALU_change</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级ALU_change输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">W级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<h2 id="六暂停-转发处理及相关多路选择器"><a class="markdownIt-Anchor" href="#六暂停-转发处理及相关多路选择器"></a> &lt;六&gt;.暂停、转发处理及相关多路选择器</h2>
<h3 id="一冲突综合单元hazardunit"><a class="markdownIt-Anchor" href="#一冲突综合单元hazardunit"></a> （一）.冲突综合单元（HazardUnit)</h3>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A1端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A1端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">W级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Tuse_rs</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D_Tuse_rs输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Tuse_rt</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D_Tuse_rt输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">W级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">E级WhichtoReg输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">M级WhichtoReg输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">start</td>
<td style="text-align:left">1</td>
<td style="text-align:left">乘除开始信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">busy</td>
<td style="text-align:left">1</td>
<td style="text-align:left">乘除忙碌信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">MDU_en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级将进行乘除运算信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_eret</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级eret输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_mtc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级mtc0输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_mtc0</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级mtc0输入</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelB_D1</td>
<td style="text-align:left">2</td>
<td style="text-align:left">B_transfer的D1输入转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelB_D2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">B_transfer的D2输入转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelALU_A</td>
<td style="text-align:left">2</td>
<td style="text-align:left">ALU输入A转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelALU_B</td>
<td style="text-align:left">2</td>
<td style="text-align:left">ALU输入B转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelDM</td>
<td style="text-align:left">1</td>
<td style="text-align:left">DM写入WD转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">stall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">冲突信号</td>
</tr>
</tbody>
</table>
<h3 id="二控制和冒险简述"><a class="markdownIt-Anchor" href="#二控制和冒险简述"></a> （二）.控制和冒险简述</h3>
<ul>
<li>
<p>对于控制冒险，本实验要求大家实现<strong>比较过程前移至 D 级</strong>，并<strong>采用延迟槽</strong>。</p>
</li>
<li>
<p>对于数据冒险，两大策略及其应用：</p>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">假设当前我需要的数据，其实已经计算出来，只是还没有进入寄存器堆，那么我们可以用<span class="strong">**转发**</span>( Forwarding )来解决，即不引用寄存器堆的值，而是直接从后面的流水级的供给者把计算结果发送到前面流水级的需求者来引用。如果我们需要的数据还没有算出来。则我们就只能<span class="strong">**暂停**</span>( Stall )，让流水线停止工作，等到我们需要的数据计算完毕，再开始下面的工作。</span><br></pre></td></tr></table></figure></div>
</li>
</ul>
<h3 id="三冒险处理"><a class="markdownIt-Anchor" href="#三冒险处理"></a> (三）.冒险处理</h3>
<p>冒险处理我们均通过“A_T”法实现——</p>
<h4 id="转发forward"><a class="markdownIt-Anchor" href="#转发forward"></a> 转发（forward）</h4>
<p>当前面的指令要写寄存器但还未写入，而后面的指令需要用到没有被写入的值时，这时候会产生<strong>数据冒险</strong>，我们首先考虑进行转发。我们<strong>假设所有的数据冒险均可通过转发解决</strong>。也就是说，当某一指令前进到必须使用某一寄存器的值的流水阶段时，这个寄存器的值一定已经产生，并<strong>存储于后续某个流水线寄存器中</strong>。</p>
<p>在这一阶段，我们不管需要的值有没由计算出，都要进行转发，即暴力转发。为实现这一机制，我们要清楚哪些模块需要转发后的数据（<strong>需求者</strong>）和保存着写入值的流水寄存器（<strong>供应者</strong>）</p>
<ul>
<li><strong>供应者及其产生的数据</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">流水级</th>
<th style="text-align:left">产生数据</th>
<th style="text-align:left">MUX名&amp;选择信号名</th>
<th style="text-align:left">MUX输出名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">E</td>
<td style="text-align:left">E_imm32，<br/>E_PC8</td>
<td style="text-align:left">直接流水线传递</td>
<td style="text-align:left">直接流水线传递</td>
</tr>
<tr>
<td style="text-align:left">M</td>
<td style="text-align:left">M_ALUout，<br/>M_PC8</td>
<td style="text-align:left">直接流水线传递</td>
<td style="text-align:left">直接流水线传递</td>
</tr>
<tr>
<td style="text-align:left">W</td>
<td style="text-align:left">w_res，<br/>w_RD，<br/>w_imm32,<br>W_PC8</td>
<td style="text-align:left">w_WhichtoReg</td>
<td style="text-align:left">WD</td>
</tr>
</tbody>
</table>
<p>注：当M级指令为读hi和lo的指令时， M_AO中的结果是从上一周期在乘除槽中读取的hi或lo的值；如果是其他指令，M_AO是上一周期ALU的计算结果。</p>
<ul>
<li><strong>需求者及其产生的数据</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">接收端口</th>
<th style="text-align:left">选择数据</th>
<th style="text-align:left">HMUX名&amp;选择信号名</th>
<th style="text-align:left">MUX输出名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">B_transfer_D1</td>
<td style="text-align:left">D_V1,<br/>M_out,<br/>E_out</td>
<td style="text-align:left">SelB_D1</td>
<td style="text-align:left">d_b_transfer1</td>
</tr>
<tr>
<td style="text-align:left">B_transfer_D2</td>
<td style="text-align:left">d_RD2,<br>m_res,<br>e_res</td>
<td style="text-align:left">SelB_D2</td>
<td style="text-align:left">d_b_transfer2</td>
</tr>
<tr>
<td style="text-align:left">ALU_A</td>
<td style="text-align:left">e_RD1，<br/> WD，<br/>m_res</td>
<td style="text-align:left">SelALU_A</td>
<td style="text-align:left">e_A</td>
</tr>
<tr>
<td style="text-align:left">ALU_B</td>
<td style="text-align:left">e_RD2，<br/>WD，<br/>m_res</td>
<td style="text-align:left">SelALU_B</td>
<td style="text-align:left">e_B</td>
</tr>
<tr>
<td style="text-align:left">DM_WD</td>
<td style="text-align:left">m_RD2，<br/> WD</td>
<td style="text-align:left">SelDM</td>
<td style="text-align:left">M_WD_f</td>
</tr>
<tr>
<td style="text-align:left">NPC_ra</td>
<td style="text-align:left">D_V1_f ,<br/> E_PC8 ,<br/> M_PC8</td>
<td style="text-align:left">SelJr</td>
<td style="text-align:left">ra</td>
</tr>
</tbody>
</table>
<p>从上表可以看出，W级中的数据没有转发到D级，原因是我们在GRF内实现了内部转发机制，将GRF输入端的数据（还未写入）及时反映到RD1或这RD2，判断条件为<code>A3 == A2</code>或者<code>A3 == A1</code>。</p>
<p>此时为了生成HMUX的选择信号，我们需要向HCU（冒险控制器）输入”A”数据，然后进行选择信号的计算，执行转发的条件为——</p>
<ul>
<li>
<p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为 0</strong></p>
</li>
<li>
<p><strong>写使能信号有效</strong></p>
<h4 id="转发的构造"><a class="markdownIt-Anchor" href="#转发的构造"></a> 转发的构造</h4>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/4.png"
                      alt="" 
                ></p>
</li>
</ul>
<h4 id="暂停stall"><a class="markdownIt-Anchor" href="#暂停stall"></a> 暂停（stall）</h4>
<p>接下来，我们来处理通过转发不能处理的数据冒险。在这种情况下，新的数据还未来得及产生。我们只能暂停流水线，等待新的数据产生。为了方便处理，我们仅仅为D级的指令进行暂停处理。</p>
<p>我们把Tuse和Tnew作为暂停的判断依据——</p>
<ul>
<li>Tuse：指令进入 <strong>D 级</strong>后，其后的某个功能部件<strong>再</strong>经过多少时钟周期就<strong>必须</strong>要使用寄存器值。对于有两个操作数的指令，其<strong>每个操作数的 Tuse 值可能不等</strong>（如 store 型指令 rs、rt 的 Tuse 分别为 1 和 2 ）。</li>
<li>Tnew：位于 <strong>E 级及其后各级</strong>的指令，再经过多少周期就能够产生要写入寄存器的结果。在我们目前的 CPU 中，W 级的指令Tnew 恒为 0；对于同一条指令，Tnew@M = max(Tnew@E - 1, 0)、</li>
</ul>
<p>在这一阶段，我们找到D级生成的Tuse_rs和Tuse_rt和在E,M,W级寄存器中流水的Tnew_D，Tnew_M，Tnew_W，如下表所示</p>
<ul>
<li><strong>Tuse表和计算表达式</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">指令类型</th>
<th style="text-align:left">Tuse_rs</th>
<th style="text-align:left">Tuse_rt</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">calc_R</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">calc_I</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:left">X</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">shiftv</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">load</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">store</td>
<td style="text-align:left">1</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">md</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">mt</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mf</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">j / jr</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">jal / jalr</td>
<td style="text-align:left">0</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">lui</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Tnew表和计算表达式</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">指令类型</th>
<th style="text-align:left">Tnew_D</th>
<th style="text-align:left">Tnew_E</th>
<th style="text-align:left">Tnew_M</th>
<th style="text-align:left">Tnew_W</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">calc_R</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">calc_I</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">shiftv</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">load</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">store</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">md</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mt</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mf</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">jal / jalr</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">j / jr</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">lui</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
</tbody>
</table>
<p>然后我们Tnew和Tuse传入HCU（冒险控制器中），然后进行stall信号的计算。如果满足以下条件则stall有效——</p>
<ul>
<li>
<p><strong>Tnew &gt; Tuse</strong></p>
</li>
<li>
<p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为 0</strong></p>
</li>
<li>
<p><strong>写使能信号有效</strong></p>
</li>
<li>
<p><strong>当E级延迟槽在进行运算（<code>start | busy</code>）时，D级为md、mt、mf指令</strong></p>
</li>
<li>
<h4 id="阻塞的构造d级"><a class="markdownIt-Anchor" href="#阻塞的构造d级"></a> <strong>阻塞的构造（D级）</strong></h4>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/5.png"
                      alt="" 
                ></p>
</li>
</ul>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assign</span> stall_rs = (D_A1!= <span class="number">0</span>)&amp;&amp;((D_Tuse_rs&lt;E_Tnew)&amp;&amp;(D_A1 == E_A3)&amp;&amp;E_Wegrf||</span><br><span class="line">                  (D_Tuse_rs&lt;M_Tnew)&amp;&amp;(D_A1 == M_A3)&amp;&amp;M_Wegrf||</span><br><span class="line">                  (D_Tuse_rs&lt;W_Tnew)&amp;&amp;(D_A1 == W_A3)&amp;&amp;W_Wegrf);</span><br><span class="line"><span class="comment">//the pre is the condition</span></span><br><span class="line"><span class="keyword">assign</span> stall_rt = (D_A2!= <span class="number">0</span>)&amp;&amp;((D_Tuse_rt&lt;E_Tnew)&amp;&amp;(D_A2 == E_A3)&amp;&amp;E_Wegrf||</span><br><span class="line">                  (D_Tuse_rt&lt;M_Tnew)&amp;&amp;(D_A2 == M_A3)&amp;&amp;M_Wegrf||</span><br><span class="line">                  (D_Tuse_rt&lt;W_Tnew)&amp;&amp;(D_A2 == W_A3)&amp;&amp;W_Wegrf);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall_md=(start||busy)&amp;&amp;(MDU_en);</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall_eret=D_eret&amp;((E_mtc0&amp;(E_A3==<span class="number">5&#x27;d14</span>))||(M_mtc0&amp;&amp;(M_A3==<span class="number">5&#x27;d14</span>)));</span><br><span class="line"><span class="keyword">assign</span> stall = (stall_rs||stall_rt||stall_md||stall_eret)&amp;&amp;(~Is_nop);</span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="真值表"><a class="markdownIt-Anchor" href="#真值表"></a> 真值表</h2>
<table>
<thead>
<tr>
<th style="text-align:center">端口</th>
<th>addu</th>
<th>subu</th>
<th>ori</th>
<th>lw</th>
<th>sw</th>
<th>lui</th>
<th>beq</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">op</td>
<td>000000</td>
<td>000000</td>
<td>001101</td>
<td>100011</td>
<td>101011</td>
<td>001111</td>
<td>000100</td>
</tr>
<tr>
<td style="text-align:center">func</td>
<td>100001</td>
<td>100011</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">AluOp</td>
<td>0000001</td>
<td>0000010</td>
<td>0001000</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
</tr>
<tr>
<td style="text-align:center">WeGrf</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">WeDm</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">branch</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
</tr>
<tr>
<td style="text-align:center">AluSrc1</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc2</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">WhichtoReg</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0001</td>
<td>0100</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">RegDst</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>1010</td>
</tr>
<tr>
<td style="text-align:center">SignExt</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center"><strong>端口</strong></td>
<td><strong>andi</strong></td>
<td><strong>jal</strong></td>
<td><strong>j</strong></td>
<td><strong>jr</strong></td>
<td><strong>sll</strong></td>
<td><strong>add</strong></td>
<td><strong>sub</strong></td>
</tr>
<tr>
<td style="text-align:center">op</td>
<td>001100</td>
<td>000011</td>
<td>000010</td>
<td>000000</td>
<td>000000</td>
<td>000000</td>
<td>000000</td>
</tr>
<tr>
<td style="text-align:center">func</td>
<td></td>
<td></td>
<td></td>
<td>001000</td>
<td>000000</td>
<td>100000</td>
<td>100010</td>
</tr>
<tr>
<td style="text-align:center">AluOp</td>
<td>0000100</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
<td>0010000</td>
<td>0000000</td>
<td>0000001</td>
</tr>
<tr>
<td style="text-align:center">WeGrf</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center">WeDm</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">branch</td>
<td>0001</td>
<td>0100</td>
<td>0100</td>
<td>1000</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc1</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc2</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0100</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">WhichtoReg</td>
<td>0001</td>
<td>1000</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">RegDst</td>
<td>0010</td>
<td>0100</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">SignExt</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<h2 id="桥和计数器"><a class="markdownIt-Anchor" href="#桥和计数器"></a> 桥和计数器</h2>
<h4 id="1bridge"><a class="markdownIt-Anchor" href="#1bridge"></a> 1.Bridge</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Address_in</td>
<td style="text-align:left">32</td>
<td style="text-align:left">写入/读取的外设单元的地址</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">WD_in</td>
<td style="text-align:left">32</td>
<td style="text-align:left">写入外设单元的数据</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">byteen</td>
<td style="text-align:left">4</td>
<td style="text-align:left">写入外设单元的使能</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">DM_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">DM读取值的输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">T0_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">Timer1读取值的输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">T1_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">Timer0读取值的输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">DM_WE</td>
<td style="text-align:left">4</td>
<td style="text-align:left">DM写入使能</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">T0_WE</td>
<td style="text-align:left">1</td>
<td style="text-align:left">Timer1写入使能</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">T1_WE</td>
<td style="text-align:left">1</td>
<td style="text-align:left">Timer2写入使能</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">Address_out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">写入/读取的外设单元的地址</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">WD_out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">写入外设单元的数据</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">RD_out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">外设单元的读取值输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span>&quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> Bridge(<span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] Address_in,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WD_in,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] byteen,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] DM_RD,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] T0_RD,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] T1_RD,</span><br><span class="line"></span><br><span class="line">              <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] DM_WE,</span><br><span class="line">              <span class="keyword">output</span> T0_WE,</span><br><span class="line">              <span class="keyword">output</span> T1_WE,</span><br><span class="line">              <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] Address_out,</span><br><span class="line">              <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] WD_out,</span><br><span class="line">              <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RD_out</span><br><span class="line">              );</span><br><span class="line">    <span class="keyword">assign</span> DM_WE       = (Address_in &gt;= `Data_Begin&amp;&amp;Address_in &lt;= `Data_End)?byteen:<span class="number">4&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">assign</span> T0_WE       = (Address_in &gt;= `T0_Begin&amp;&amp;Address_in &lt;= `T0_End)?&amp;byteen:<span class="number">1&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">assign</span> T1_WE       = (Address_in &gt;= `T1_Begin&amp;&amp;Address_in &lt;= `T1_End)?&amp;byteen:<span class="number">1&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">assign</span> Address_out = Address_in;</span><br><span class="line">    <span class="keyword">assign</span> WD_out      = WD_in;</span><br><span class="line">    <span class="keyword">assign</span> RD_out      = (Address_in &gt;= `Data_Begin&amp;&amp;Address_in &lt;= `Data_End)?DM_RD:</span><br><span class="line">                         (Address_in &gt;= `T0_Begin&amp;&amp;Address_in &lt;= `T0_End)?T0_RD:</span><br><span class="line">                         (Address_in &gt;= `T1_Begin&amp;&amp;Address_in &lt;= `T1_End)?T1_RD:</span><br><span class="line">                         <span class="number">32&#x27;d0</span>;</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="2tc"><a class="markdownIt-Anchor" href="#2tc"></a> <a class="link"   target="_blank" rel="noopener" href="http://2.TC" >2.TC <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Addr</td>
<td style="text-align:left">30</td>
<td style="text-align:left">Timer写入地址</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">WE</td>
<td style="text-align:left">1</td>
<td style="text-align:left">Timer写入使能</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Din</td>
<td style="text-align:left">32</td>
<td style="text-align:left">Timer写入数据</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_out</td>
<td style="text-align:left">32</td>
<td style="text-align:left">Timer读取数据</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">IRQ</td>
<td style="text-align:left">1</td>
<td style="text-align:left">中断请求</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span>&quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> TC(<span class="keyword">input</span> clk,</span><br><span class="line">          <span class="keyword">input</span> reset,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">2</span>] Addr,</span><br><span class="line">          <span class="keyword">input</span> WE,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] Din,</span><br><span class="line"></span><br><span class="line">          <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] Dout,</span><br><span class="line">          <span class="keyword">output</span> IRQ</span><br><span class="line">          );</span><br><span class="line"></span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] state;</span><br><span class="line">	<span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] mem [<span class="number">2</span>:<span class="number">0</span>];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">reg</span> _IRQ;</span><br><span class="line">	<span class="keyword">assign</span> IRQ = `ctrl[<span class="number">3</span>] &amp; _IRQ;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">assign</span> Dout = mem[Addr[<span class="number">3</span>:<span class="number">2</span>]];</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] load = Addr[<span class="number">3</span>:<span class="number">2</span>] == <span class="number">0</span> ? &#123;<span class="number">28&#x27;h0</span>, Din[<span class="number">3</span>:<span class="number">0</span>]&#125; : Din;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">integer</span> i;</span><br><span class="line">	<span class="keyword">always</span> @(<span class="keyword">posedge</span> clk) <span class="keyword">begin</span></span><br><span class="line">		<span class="keyword">if</span>(reset) <span class="keyword">begin</span></span><br><span class="line">			state &lt;= <span class="number">0</span>; </span><br><span class="line">			<span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i = i+<span class="number">1</span>) mem[i] &lt;= <span class="number">0</span>;</span><br><span class="line">			_IRQ &lt;= <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span>(WE) <span class="keyword">begin</span></span><br><span class="line">			<span class="comment">// $display(&quot;%d@: *%h &lt;= %h&quot;, $time, &#123;Addr, 2&#x27;b00&#125;, load);</span></span><br><span class="line">			mem[Addr[<span class="number">3</span>:<span class="number">2</span>]] &lt;= load;</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">			<span class="keyword">case</span>(state)</span><br><span class="line">				`IDLE : <span class="keyword">if</span>(`ctrl[<span class="number">0</span>]) <span class="keyword">begin</span></span><br><span class="line">					state &lt;= `LOAD;</span><br><span class="line">					_IRQ &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">				<span class="keyword">end</span></span><br><span class="line">				`LOAD : <span class="keyword">begin</span></span><br><span class="line">					`count &lt;= `preset;</span><br><span class="line">					state &lt;= `CNT;</span><br><span class="line">				<span class="keyword">end</span></span><br><span class="line">				`CNT  : </span><br><span class="line">					<span class="keyword">if</span>(`ctrl[<span class="number">0</span>]) <span class="keyword">begin</span></span><br><span class="line">						<span class="keyword">if</span>(`count &gt; <span class="number">1</span>) `count &lt;= `count-<span class="number">1</span>;</span><br><span class="line">						<span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">							`count &lt;= <span class="number">0</span>;</span><br><span class="line">							state &lt;= `INT;</span><br><span class="line">							_IRQ &lt;= <span class="number">1&#x27;b1</span>;</span><br><span class="line">						<span class="keyword">end</span></span><br><span class="line">					<span class="keyword">end</span></span><br><span class="line">					<span class="keyword">else</span> state &lt;= `IDLE;</span><br><span class="line">				<span class="keyword">default</span> : <span class="keyword">begin</span></span><br><span class="line">					<span class="keyword">if</span>(`ctrl[<span class="number">2</span>:<span class="number">1</span>] == <span class="number">2&#x27;b00</span>) `ctrl[<span class="number">0</span>] &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">					<span class="keyword">else</span> _IRQ &lt;= <span class="number">1&#x27;b0</span>;</span><br><span class="line">					state &lt;= `IDLE;</span><br><span class="line">				<span class="keyword">end</span></span><br><span class="line">			<span class="keyword">endcase</span></span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="重要机制实现方法"><a class="markdownIt-Anchor" href="#重要机制实现方法"></a> 重要机制实现方法</h2>
<h3 id="cp0响应机制"><a class="markdownIt-Anchor" href="#cp0响应机制"></a> CP0响应机制</h3>
<p>CP0是检测异常和中断的重要部件，异常和中断通过以下接口传入——</p>
<ul>
<li><strong>中断信息</strong>通过 <strong>HWInt[7:2]</strong> 接口进入，其中HWInt[2]连接Timer0的终端请求，HWInt[3]连接Timer1的终端请求，HWInt[4]连接外部的中断请求。</li>
<li><strong>异常信息</strong>通过<strong>ExcCode_in</strong>和<strong>BD_in</strong>两个接口传入，ExcCode_in传入的是异常代码（ADEL，ADES，RI，OV），BD_in传入的是延迟槽指令标志（有效则表示当前指令为延迟槽指令）。</li>
</ul>
<p>检测到中断或者异常时，CP0会进行判断并响应，决定是否将req(<strong>CP0向CPU发出的中断请求</strong>)置1。判断逻辑如下——</p>
<div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wire inter_req  = (|(HWInt &amp; IM)) &amp; IE &amp; (!EXL);//中断有效判断</span><br><span class="line">wire exc_req    = (ExcCode_in != 5&#x27;d0) &amp; (!EXL);//异常有效判断</span><br><span class="line">assign req      = inter_req | exc_req;//</span><br></pre></td></tr></table></figure></div>
<p>当req有效，CP0还需要完成以下任务——</p>
<ul>
<li>
<p>EXL置1</p>
</li>
<li>
<p>将M级PC存入EPC（延迟槽指令中存入EPC-4）</p>
</li>
<li>
<p>如果当前响应中断，ExcCode寄存器写入0；若响应异常，ExcCode寄存器写入外部传入的异常代码ExcCode_in</p>
</li>
<li>
<p>BD寄存器写入外部传入的BD_in信号</p>
</li>
<li>
<p>此外，无论是否发出中断请求，在每一周期均需要将HWInt[6:2]写入Cause寄存器中的的IP域</p>
<h3 id="系统桥设计"><a class="markdownIt-Anchor" href="#系统桥设计"></a> 系统桥设计</h3>
<p>系统桥其实是充当一个“交换机”的角色，将CPU传来的地址写入相应的外设（DM、Timer0、Timer1），只需要组合逻辑便可实现。</p>
<h3 id="异常识别"><a class="markdownIt-Anchor" href="#异常识别"></a> 异常识别</h3>
<p>P7中我们考虑的异常情况有以下几种——</p>
<ul>
<li>F级异常：
<ul>
<li>PC地址没有字对齐（AdEL）</li>
<li>PC地址超过0x3000 ~ 0x6ffc（AdEL）</li>
</ul>
</li>
<li>D级异常：
<ul>
<li>未知的指令码（RI）</li>
</ul>
</li>
<li>E级异常：
<ul>
<li>addi、add、sub计算溢出（Ov）</li>
<li>load类指令计算地址时加法溢出（AdEL）</li>
<li>store类指令计算地址时加法溢出（AdES）</li>
</ul>
</li>
<li>M级异常：
<ul>
<li>lw取数地址未 4 字节对齐（AdEL）</li>
<li>lh、lhu取数地址未与 2 字节对齐（AdEL）</li>
<li>lh、lhu、lb、lbu取 Timer 寄存器的值（AdEL）</li>
<li>load型指令取数地址超出 DM、Timer0、Timer1 的范围（AdEL）</li>
<li>sw存数地址未 4 字节对齐（AdES）</li>
<li>sh存数地址未 2 字节对齐（AdES）</li>
<li>sh、sb存 Timer 寄存器的值（AdES）</li>
<li>sw向计时器的 Count 寄存器存值（AdES）</li>
<li>store型指令存数地址超出 DM、Timer0、Timer1 的范围（AdES）</li>
</ul>
</li>
</ul>
<p>针对以上列出的异常情况，我们在每一个流水级对异常进行检测。由于教程提出了以下要求——</p>
<ul>
<li>发生取指异常后视为 <code>nop</code> 直至提交到 CP0。</li>
<li>发生 <code>RI</code> 异常后视为 <code>nop</code> 直至提交到 CP0。</li>
<li><code>load</code> 与 <code>store</code> 类算址溢出按照 <code>AdEL</code> 与 <code>AdES</code> 处理。</li>
</ul>
<p>因此不会出现<strong>一个指令在多级出现异常</strong>的情况。如果某个流水级出现了新的异常，我们将这个异常流水到下一级即可，而不是流水上一级传来的异常；如果这个流水级没有出现新的异常，则将上一级传来的异常继续流水给下一级即可。</p>
</li>
</ul>
<h3 id="二-测试方案"><a class="markdownIt-Anchor" href="#二-测试方案"></a> 二、 测试方案</h3>
<p>（1） 测试代码：</p>
<p>注：本测试方案覆盖所有异常，并未测试中断</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line">.text</span><br><span class="line"><span class="code">    mtc0 $0, $12</span></span><br><span class="line"><span class="code">    ori $at, $0, 0xfffc</span></span><br><span class="line"><span class="code">	#====OV=====</span></span><br><span class="line"><span class="code">    lui $t0, 0x7fff</span></span><br><span class="line"><span class="code">    lui $t1, 0xffff</span></span><br><span class="line"><span class="code">    add $t2, $t0, $t1</span></span><br><span class="line"><span class="code">    sub $t2, $t0, $t1</span></span><br><span class="line"><span class="code">    sub $t2, $t1, $t0</span></span><br><span class="line"><span class="code">    lui $t1, 0x7fff</span></span><br><span class="line"><span class="code">    add $t2, $t0, $t1</span></span><br><span class="line"><span class="code">    ori $t1, $t1, 0xffff</span></span><br><span class="line"><span class="code">    addi $t2, $t1, 0xfffffff0</span></span><br><span class="line"><span class="code">    addi $t1, $t1, 0x0010</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">	#=====SYSCALL=====</span></span><br><span class="line"><span class="code">    syscall</span></span><br><span class="line"><span class="code">    </span></span><br><span class="line"><span class="code">    #=====ADEL=====</span></span><br><span class="line"><span class="code">    lui $t1, 0x7fff</span></span><br><span class="line"><span class="code">    jal label1</span></span><br><span class="line"><span class="code">    add $ra, $ra, $t1</span></span><br><span class="line"><span class="code">label1:</span></span><br><span class="line"><span class="code">    jr $ra</span></span><br><span class="line"><span class="code">    nop</span></span><br><span class="line"><span class="code">    jal label2</span></span><br><span class="line"><span class="code">    addi $ra, $ra, 1</span></span><br><span class="line"><span class="code">label2:</span></span><br><span class="line"><span class="code">    jr $ra</span></span><br><span class="line"><span class="code">    nop</span></span><br><span class="line"><span class="code">    ori $t0, $0, 0x7f00</span></span><br><span class="line"><span class="code">    ori $t2, $0, 0x7f20</span></span><br><span class="line"><span class="code">    sw $t0, 0($0)</span></span><br><span class="line"><span class="code">    lw $t0, 0($0)</span></span><br><span class="line"><span class="code">    lw $t0, 1($0)</span></span><br><span class="line"><span class="code">    lw $t0, 2($0)</span></span><br><span class="line"><span class="code">    lh $t0, 3($0)</span></span><br><span class="line"><span class="code">    lh $t0, 0($t0)</span></span><br><span class="line"><span class="code">    lh $t0, 2($t0)</span></span><br><span class="line"><span class="code">    lb $t0, 0($t0)</span></span><br><span class="line"><span class="code">    lb $t0, 3($t0)</span></span><br><span class="line"><span class="code">loop_timer1:</span></span><br><span class="line"><span class="code">    lw $t1, 0($t0)</span></span><br><span class="line"><span class="code">    addi $t0, $t0, 4</span></span><br><span class="line"><span class="code">    bne $t0, $t2, loop_timer1</span></span><br><span class="line"><span class="code">    nop</span></span><br><span class="line"><span class="code">    ori $t0, $0, 0x3000</span></span><br><span class="line"><span class="code">    lw $t0, 0($t0)</span></span><br><span class="line"><span class="code">    lui $t0, 0x7fff</span></span><br><span class="line"><span class="code">    ori $t0, $t0, 0xffff</span></span><br><span class="line"><span class="code">	lw $t0, 1($t0)</span></span><br><span class="line"><span class="code">	lw $t0, -4($0)</span></span><br><span class="line"><span class="code">	</span></span><br><span class="line"><span class="code">	#=====ADES=====</span></span><br><span class="line"><span class="code">	sw $0, 1($0)</span></span><br><span class="line"><span class="code">    sw $0, 2($0)</span></span><br><span class="line"><span class="code">    sh $0, 3($0)</span></span><br><span class="line"><span class="code">    sw $0, 4($0)</span></span><br><span class="line"><span class="code">    sh $0, 6($0)</span></span><br><span class="line"><span class="code">    sb $0, 7($0)</span></span><br><span class="line"><span class="code">    ori $t0, $0, 0x7f00</span></span><br><span class="line"><span class="code">    sh $0, 0($t0)</span></span><br><span class="line"><span class="code">    sh $0, 2($t0)</span></span><br><span class="line"><span class="code">    sb $0, 0($t0)</span></span><br><span class="line"><span class="code">    sb $0, 3($t0)</span></span><br><span class="line"><span class="code">    ori $t1, $0, 0x7f30</span></span><br><span class="line"><span class="code">loop_timer2:</span></span><br><span class="line"><span class="code">	sw $0, 0($t0)</span></span><br><span class="line"><span class="code">	addi $t0, $t0, 4</span></span><br><span class="line"><span class="code">    bne $t0, $t1, loop_timer2</span></span><br><span class="line"><span class="code">    nop</span></span><br><span class="line"><span class="code">    ori $t0, $0, 0x3000</span></span><br><span class="line"><span class="code">    sw $0, 0($t0)</span></span><br><span class="line"><span class="code">    lui $t0, 0x7fff</span></span><br><span class="line"><span class="code">    ori $t0, $t0, 0xffff</span></span><br><span class="line"><span class="code">	sw $0, 1($t0)</span></span><br><span class="line"><span class="code">	sw $0, -1($0)</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">	#=====ALTOGETHER=====</span></span><br><span class="line"><span class="code">	lui $t0, 0x7fff</span></span><br><span class="line"><span class="code">	ori $t1, $t0, 0xffff</span></span><br><span class="line"><span class="code">	sw $0, 0($t0)</span></span><br><span class="line"><span class="code">	addi $t1, $t1, 1</span></span><br><span class="line"><span class="code">	syscall</span></span><br><span class="line"><span class="code">	</span></span><br><span class="line"><span class="code">	sw $0, 0($t0)</span></span><br><span class="line"><span class="code">	addi $t1, $t1, 1</span></span><br><span class="line"><span class="code">	nop</span></span><br><span class="line"><span class="code">	</span></span><br><span class="line"><span class="code">	sw $0, 0($t0)</span></span><br><span class="line"><span class="code">	addi $t1, $t1, 0</span></span><br><span class="line"><span class="code">	syscall</span></span><br><span class="line"><span class="code">	</span></span><br><span class="line"><span class="code">	sw $0, 0($0)</span></span><br><span class="line"><span class="code">	addi $t1, $t1, 1</span></span><br><span class="line"><span class="code">	syscall</span></span><br><span class="line"><span class="code">	</span></span><br><span class="line"><span class="code">	lui $t0, 0x8000</span></span><br><span class="line"><span class="code">	addi $t1, $t1, 1</span></span><br><span class="line"><span class="code">	beq $t0, $t1, end</span></span><br><span class="line"><span class="code">	nop</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">end:</span><br><span class="line"><span class="code">    beq $0, $0, end</span></span><br><span class="line"><span class="code">    nop</span></span><br><span class="line"><span class="code"></span></span><br><span class="line">.ktext 0x4180</span><br><span class="line"><span class="emphasis">_main_</span>handler:</span><br><span class="line"><span class="code">    mfc0 $k0, $13</span></span><br><span class="line"><span class="code">    mfc0 $k0, $14</span></span><br><span class="line"><span class="code">    and $k0, $k0, $at</span></span><br><span class="line"><span class="code">    addi $k0, $k0, 4</span></span><br><span class="line"><span class="code">    mtc0 $k0, $14</span></span><br><span class="line"><span class="code">    sb $0, 0x7f20($0)</span></span><br><span class="line"><span class="code">    eret</span></span><br><span class="line"><span class="code"></span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<p>（2） 该CPU运行结果</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br></pre></td><td class="code"><pre><span class="line">42@00003004: $ 1 &lt;= 0000fffc</span><br><span class="line">46@00003008: $ 8 &lt;= 7fff0000</span><br><span class="line">50@0000300c: $ 9 &lt;= ffff0000</span><br><span class="line">54@00003010: $10 &lt;= 7ffe0000</span><br><span class="line">74@00004180: $26 &lt;= 00000030</span><br><span class="line">78@00004184: $26 &lt;= 00003014</span><br><span class="line">86@00004188: $26 &lt;= 00003014</span><br><span class="line">90@0000418c: $26 &lt;= 00003018</span><br><span class="line">110@00003018: $10 &lt;= 80000000</span><br><span class="line">114@0000301c: $ 9 &lt;= 7fff0000</span><br><span class="line">134@00004180: $26 &lt;= 00000030</span><br><span class="line">138@00004184: $26 &lt;= 00003020</span><br><span class="line">146@00004188: $26 &lt;= 00003020</span><br><span class="line">150@0000418c: $26 &lt;= 00003024</span><br><span class="line">170@00003024: $ 9 &lt;= 7fffffff</span><br><span class="line">174@00003028: $10 &lt;= 7fffffef</span><br><span class="line">194@00004180: $26 &lt;= 00000030</span><br><span class="line">198@00004184: $26 &lt;= 0000302c</span><br><span class="line">206@00004188: $26 &lt;= 0000302c</span><br><span class="line">210@0000418c: $26 &lt;= 00003030</span><br><span class="line">246@00004180: $26 &lt;= 00000020</span><br><span class="line">250@00004184: $26 &lt;= 00003030</span><br><span class="line">258@00004188: $26 &lt;= 00003030</span><br><span class="line">262@0000418c: $26 &lt;= 00003034</span><br><span class="line">282@00003034: $ 9 &lt;= 7fff0000</span><br><span class="line">286@00003038: $31 &lt;= 00003040</span><br><span class="line">290@0000303c: $31 &lt;= 7fff3040</span><br><span class="line">322@00004180: $26 &lt;= 00000010</span><br><span class="line">326@00004184: $26 &lt;= 7fff3040</span><br><span class="line">334@00004188: $26 &lt;= 00003040</span><br><span class="line">338@0000418c: $26 &lt;= 00003044</span><br><span class="line">362@00003048: $31 &lt;= 00003050</span><br><span class="line">366@0000304c: $31 &lt;= 00003051</span><br><span class="line">398@00004180: $26 &lt;= 00000010</span><br><span class="line">402@00004184: $26 &lt;= 00003051</span><br><span class="line">410@00004188: $26 &lt;= 00003050</span><br><span class="line">414@0000418c: $26 &lt;= 00003054</span><br><span class="line">438@00003058: $ 8 &lt;= 00007f00</span><br><span class="line">442@00003060: <span class="emphasis">*00000000 &lt;= 00007f00</span></span><br><span class="line"><span class="emphasis">442@0000305c: $10 &lt;= 00007f20</span></span><br><span class="line"><span class="emphasis">450@00003064: $ 8 &lt;= 00007f00</span></span><br><span class="line"><span class="emphasis">470@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">474@00004184: $26 &lt;= 00003068</span></span><br><span class="line"><span class="emphasis">482@00004188: $26 &lt;= 00003068</span></span><br><span class="line"><span class="emphasis">486@0000418c: $26 &lt;= 0000306c</span></span><br><span class="line"><span class="emphasis">522@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">526@00004184: $26 &lt;= 0000306c</span></span><br><span class="line"><span class="emphasis">534@00004188: $26 &lt;= 0000306c</span></span><br><span class="line"><span class="emphasis">538@0000418c: $26 &lt;= 00003070</span></span><br><span class="line"><span class="emphasis">574@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">578@00004184: $26 &lt;= 00003070</span></span><br><span class="line"><span class="emphasis">586@00004188: $26 &lt;= 00003070</span></span><br><span class="line"><span class="emphasis">590@0000418c: $26 &lt;= 00003074</span></span><br><span class="line"><span class="emphasis">626@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">630@00004184: $26 &lt;= 00003074</span></span><br><span class="line"><span class="emphasis">638@00004188: $26 &lt;= 00003074</span></span><br><span class="line"><span class="emphasis">642@0000418c: $26 &lt;= 00003078</span></span><br><span class="line"><span class="emphasis">678@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">682@00004184: $26 &lt;= 00003078</span></span><br><span class="line"><span class="emphasis">690@00004188: $26 &lt;= 00003078</span></span><br><span class="line"><span class="emphasis">694@0000418c: $26 &lt;= 0000307c</span></span><br><span class="line"><span class="emphasis">730@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">734@00004184: $26 &lt;= 0000307c</span></span><br><span class="line"><span class="emphasis">742@00004188: $26 &lt;= 0000307c</span></span><br><span class="line"><span class="emphasis">746@0000418c: $26 &lt;= 00003080</span></span><br><span class="line"><span class="emphasis">782@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">786@00004184: $26 &lt;= 00003080</span></span><br><span class="line"><span class="emphasis">794@00004188: $26 &lt;= 00003080</span></span><br><span class="line"><span class="emphasis">798@0000418c: $26 &lt;= 00003084</span></span><br><span class="line"><span class="emphasis">818@00003084: $ 9 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">822@00003088: $ 8 &lt;= 00007f04</span></span><br><span class="line"><span class="emphasis">838@00003084: $ 9 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">842@00003088: $ 8 &lt;= 00007f08</span></span><br><span class="line"><span class="emphasis">858@00003084: $ 9 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">862@00003088: $ 8 &lt;= 00007f0c</span></span><br><span class="line"><span class="emphasis">894@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">898@00004184: $26 &lt;= 00003084</span></span><br><span class="line"><span class="emphasis">906@00004188: $26 &lt;= 00003084</span></span><br><span class="line"><span class="emphasis">910@0000418c: $26 &lt;= 00003088</span></span><br><span class="line"><span class="emphasis">930@00003088: $ 8 &lt;= 00007f10</span></span><br><span class="line"><span class="emphasis">946@00003084: $ 9 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">950@00003088: $ 8 &lt;= 00007f14</span></span><br><span class="line"><span class="emphasis">966@00003084: $ 9 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">970@00003088: $ 8 &lt;= 00007f18</span></span><br><span class="line"><span class="emphasis">986@00003084: $ 9 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">990@00003088: $ 8 &lt;= 00007f1c</span></span><br><span class="line"><span class="emphasis">1022@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">1026@00004184: $26 &lt;= 00003084</span></span><br><span class="line"><span class="emphasis">1034@00004188: $26 &lt;= 00003084</span></span><br><span class="line"><span class="emphasis">1038@0000418c: $26 &lt;= 00003088</span></span><br><span class="line"><span class="emphasis">1058@00003088: $ 8 &lt;= 00007f20</span></span><br><span class="line"><span class="emphasis">1074@00003094: $ 8 &lt;= 00003000</span></span><br><span class="line"><span class="emphasis">1094@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">1098@00004184: $26 &lt;= 00003098</span></span><br><span class="line"><span class="emphasis">1106@00004188: $26 &lt;= 00003098</span></span><br><span class="line"><span class="emphasis">1110@0000418c: $26 &lt;= 0000309c</span></span><br><span class="line"><span class="emphasis">1130@0000309c: $ 8 &lt;= 7fff0000</span></span><br><span class="line"><span class="emphasis">1134@000030a0: $ 8 &lt;= 7fffffff</span></span><br><span class="line"><span class="emphasis">1154@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">1158@00004184: $26 &lt;= 000030a4</span></span><br><span class="line"><span class="emphasis">1166@00004188: $26 &lt;= 000030a4</span></span><br><span class="line"><span class="emphasis">1170@0000418c: $26 &lt;= 000030a8</span></span><br><span class="line"><span class="emphasis">1206@00004180: $26 &lt;= 00000010</span></span><br><span class="line"><span class="emphasis">1210@00004184: $26 &lt;= 000030a8</span></span><br><span class="line"><span class="emphasis">1218@00004188: $26 &lt;= 000030a8</span></span><br><span class="line"><span class="emphasis">1222@0000418c: $26 &lt;= 000030ac</span></span><br><span class="line"><span class="emphasis">1258@00004180: $26 &lt;= 00000014</span></span><br><span class="line"><span class="emphasis">1262@00004184: $26 &lt;= 000030ac</span></span><br><span class="line"><span class="emphasis">1270@00004188: $26 &lt;= 000030ac</span></span><br><span class="line"><span class="emphasis">1274@0000418c: $26 &lt;= 000030b0</span></span><br><span class="line"><span class="emphasis">1310@00004180: $26 &lt;= 00000014</span></span><br><span class="line"><span class="emphasis">1314@00004184: $26 &lt;= 000030b0</span></span><br><span class="line"><span class="emphasis">1322@00004188: $26 &lt;= 000030b0</span></span><br><span class="line"><span class="emphasis">1326@0000418c: $26 &lt;= 000030b4</span></span><br><span class="line"><span class="emphasis">1362@00004180: $26 &lt;= 00000014</span></span><br><span class="line"><span class="emphasis">1366@00004184: $26 &lt;= 000030b4</span></span><br><span class="line"><span class="emphasis">1374@00004188: $26 &lt;= 000030b4</span></span><br><span class="line"><span class="emphasis">1378@0000418c: $26 &lt;= 000030b8</span></span><br><span class="line"><span class="emphasis">1394@000030b8: *</span>00000004 &lt;= 00000000</span><br><span class="line">1398@000030bc: <span class="emphasis">*00000004 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">1402@000030c0: *</span>00000004 &lt;= 00000000</span><br><span class="line">1410@000030c4: $ 8 &lt;= 00007f00</span><br><span class="line">1430@00004180: $26 &lt;= 00000014</span><br><span class="line">1434@00004184: $26 &lt;= 000030c8</span><br><span class="line">1442@00004188: $26 &lt;= 000030c8</span><br><span class="line">1446@0000418c: $26 &lt;= 000030cc</span><br><span class="line">1482@00004180: $26 &lt;= 00000014</span><br><span class="line">1486@00004184: $26 &lt;= 000030cc</span><br><span class="line">1494@00004188: $26 &lt;= 000030cc</span><br><span class="line">1498@0000418c: $26 &lt;= 000030d0</span><br><span class="line">1534@00004180: $26 &lt;= 00000014</span><br><span class="line">1538@00004184: $26 &lt;= 000030d0</span><br><span class="line">1546@00004188: $26 &lt;= 000030d0</span><br><span class="line">1550@0000418c: $26 &lt;= 000030d4</span><br><span class="line">1586@00004180: $26 &lt;= 00000014</span><br><span class="line">1590@00004184: $26 &lt;= 000030d4</span><br><span class="line">1598@00004188: $26 &lt;= 000030d4</span><br><span class="line">1602@0000418c: $26 &lt;= 000030d8</span><br><span class="line">1622@000030d8: $ 9 &lt;= 00007f30</span><br><span class="line">1630@000030e0: $ 8 &lt;= 00007f04</span><br><span class="line">1650@000030e0: $ 8 &lt;= 00007f08</span><br><span class="line">1682@00004180: $26 &lt;= 00000014</span><br><span class="line">1686@00004184: $26 &lt;= 000030dc</span><br><span class="line">1694@00004188: $26 &lt;= 000030dc</span><br><span class="line">1698@0000418c: $26 &lt;= 000030e0</span><br><span class="line">1718@000030e0: $ 8 &lt;= 00007f0c</span><br><span class="line">1750@00004180: $26 &lt;= 00000014</span><br><span class="line">1754@00004184: $26 &lt;= 000030dc</span><br><span class="line">1762@00004188: $26 &lt;= 000030dc</span><br><span class="line">1766@0000418c: $26 &lt;= 000030e0</span><br><span class="line">1786@000030e0: $ 8 &lt;= 00007f10</span><br><span class="line">1806@000030e0: $ 8 &lt;= 00007f14</span><br><span class="line">1826@000030e0: $ 8 &lt;= 00007f18</span><br><span class="line">1858@00004180: $26 &lt;= 00000014</span><br><span class="line">1862@00004184: $26 &lt;= 000030dc</span><br><span class="line">1870@00004188: $26 &lt;= 000030dc</span><br><span class="line">1874@0000418c: $26 &lt;= 000030e0</span><br><span class="line">1894@000030e0: $ 8 &lt;= 00007f1c</span><br><span class="line">1926@00004180: $26 &lt;= 00000014</span><br><span class="line">1930@00004184: $26 &lt;= 000030dc</span><br><span class="line">1938@00004188: $26 &lt;= 000030dc</span><br><span class="line">1942@0000418c: $26 &lt;= 000030e0</span><br><span class="line">1962@000030e0: $ 8 &lt;= 00007f20</span><br><span class="line">1982@000030e0: $ 8 &lt;= 00007f24</span><br><span class="line">2014@00004180: $26 &lt;= 00000014</span><br><span class="line">2018@00004184: $26 &lt;= 000030dc</span><br><span class="line">2026@00004188: $26 &lt;= 000030dc</span><br><span class="line">2030@0000418c: $26 &lt;= 000030e0</span><br><span class="line">2050@000030e0: $ 8 &lt;= 00007f28</span><br><span class="line">2082@00004180: $26 &lt;= 00000014</span><br><span class="line">2086@00004184: $26 &lt;= 000030dc</span><br><span class="line">2094@00004188: $26 &lt;= 000030dc</span><br><span class="line">2098@0000418c: $26 &lt;= 000030e0</span><br><span class="line">2118@000030e0: $ 8 &lt;= 00007f2c</span><br><span class="line">2150@00004180: $26 &lt;= 00000014</span><br><span class="line">2154@00004184: $26 &lt;= 000030dc</span><br><span class="line">2162@00004188: $26 &lt;= 000030dc</span><br><span class="line">2166@0000418c: $26 &lt;= 000030e0</span><br><span class="line">2186@000030e0: $ 8 &lt;= 00007f30</span><br><span class="line">2202@000030ec: $ 8 &lt;= 00003000</span><br><span class="line">2222@00004180: $26 &lt;= 00000014</span><br><span class="line">2226@00004184: $26 &lt;= 000030f0</span><br><span class="line">2234@00004188: $26 &lt;= 000030f0</span><br><span class="line">2238@0000418c: $26 &lt;= 000030f4</span><br><span class="line">2258@000030f4: $ 8 &lt;= 7fff0000</span><br><span class="line">2262@000030f8: $ 8 &lt;= 7fffffff</span><br><span class="line">2282@00004180: $26 &lt;= 00000014</span><br><span class="line">2286@00004184: $26 &lt;= 000030fc</span><br><span class="line">2294@00004188: $26 &lt;= 000030fc</span><br><span class="line">2298@0000418c: $26 &lt;= 00003100</span><br><span class="line">2334@00004180: $26 &lt;= 00000014</span><br><span class="line">2338@00004184: $26 &lt;= 00003100</span><br><span class="line">2346@00004188: $26 &lt;= 00003100</span><br><span class="line">2350@0000418c: $26 &lt;= 00003104</span><br><span class="line">2370@00003104: $ 8 &lt;= 7fff0000</span><br><span class="line">2374@00003108: $ 9 &lt;= 7fffffff</span><br><span class="line">2394@00004180: $26 &lt;= 00000014</span><br><span class="line">2398@00004184: $26 &lt;= 0000310c</span><br><span class="line">2406@00004188: $26 &lt;= 0000310c</span><br><span class="line">2410@0000418c: $26 &lt;= 00003110</span><br><span class="line">2446@00004180: $26 &lt;= 00000030</span><br><span class="line">2450@00004184: $26 &lt;= 00003110</span><br><span class="line">2458@00004188: $26 &lt;= 00003110</span><br><span class="line">2462@0000418c: $26 &lt;= 00003114</span><br><span class="line">2498@00004180: $26 &lt;= 00000020</span><br><span class="line">2502@00004184: $26 &lt;= 00003114</span><br><span class="line">2510@00004188: $26 &lt;= 00003114</span><br><span class="line">2514@0000418c: $26 &lt;= 00003118</span><br><span class="line">2550@00004180: $26 &lt;= 00000014</span><br><span class="line">2554@00004184: $26 &lt;= 00003118</span><br><span class="line">2562@00004188: $26 &lt;= 00003118</span><br><span class="line">2566@0000418c: $26 &lt;= 0000311c</span><br><span class="line">2602@00004180: $26 &lt;= 00000030</span><br><span class="line">2606@00004184: $26 &lt;= 0000311c</span><br><span class="line">2614@00004188: $26 &lt;= 0000311c</span><br><span class="line">2618@0000418c: $26 &lt;= 00003120</span><br><span class="line">2658@00004180: $26 &lt;= 00000014</span><br><span class="line">2662@00004184: $26 &lt;= 00003124</span><br><span class="line">2670@00004188: $26 &lt;= 00003124</span><br><span class="line">2674@0000418c: $26 &lt;= 00003128</span><br><span class="line">2694@00003128: $ 9 &lt;= 7fffffff</span><br><span class="line">2714@00004180: $26 &lt;= 00000020</span><br><span class="line">2718@00004184: $26 &lt;= 0000312c</span><br><span class="line">2726@00004188: $26 &lt;= 0000312c</span><br><span class="line">2730@0000418c: $26 &lt;= 00003130</span><br><span class="line">2746@00003130: \<span class="emphasis">*00000000 &lt;= 00000000</span></span><br><span class="line"><span class="emphasis">2770@00004180: $26 &lt;= 00000030</span></span><br><span class="line"><span class="emphasis">2774@00004184: $26 &lt;= 00003134</span></span><br><span class="line"><span class="emphasis">2782@00004188: $26 &lt;= 00003134</span></span><br><span class="line"><span class="emphasis">2786@0000418c: $26 &lt;= 00003138</span></span><br><span class="line"><span class="emphasis">2822@00004180: $26 &lt;= 00000020</span></span><br><span class="line"><span class="emphasis">2826@00004184: $26 &lt;= 00003138</span></span><br><span class="line"><span class="emphasis">2834@00004188: $26 &lt;= 00003138</span></span><br><span class="line"><span class="emphasis">2838@0000418c: $26 &lt;= 0000313c</span></span><br><span class="line"><span class="emphasis">2858@0000313c: $ 8 &lt;= 80000000</span></span><br><span class="line"><span class="emphasis">2878@00004180: $26 &lt;= 00000030</span></span><br><span class="line"><span class="emphasis">2882@00004184: $26 &lt;= 00003140</span></span><br><span class="line"><span class="emphasis">2890@00004188: $26 &lt;= 00003140</span></span><br><span class="line"><span class="emphasis">2894@0000418c: $26 &lt;= 00003144</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h3 id="三-思考题"><a class="markdownIt-Anchor" href="#三-思考题"></a> 三、 思考题</h3>
<h5 id="一请查阅相关资料说明鼠标和键盘的输入信号是如何被-cpu-知晓的"><a class="markdownIt-Anchor" href="#一请查阅相关资料说明鼠标和键盘的输入信号是如何被-cpu-知晓的"></a> （一）请查阅相关资料，说明鼠标和键盘的输入信号是如何被 CPU 知晓的？</h5>
<pre><code>	鼠标和键盘等外设并不是直接与CPU相连的，中间需要通过软件来连接，这个软件也就是我们熟知的驱动。驱动和硬件之间通过操作系统进行处理。
</code></pre>
<h5 id="二请思考为什么我们的-cpu-处理中断异常必须是已经指定好的地址如果你的-cpu-支持用户自定义入口地址即处理中断异常的程序由用户提供其还能提供我们所希望的功能吗如果可以请说明这样可能会出现什么问题否则举例说明-假设用户提供的中断处理程序合法"><a class="markdownIt-Anchor" href="#二请思考为什么我们的-cpu-处理中断异常必须是已经指定好的地址如果你的-cpu-支持用户自定义入口地址即处理中断异常的程序由用户提供其还能提供我们所希望的功能吗如果可以请说明这样可能会出现什么问题否则举例说明-假设用户提供的中断处理程序合法"></a> （二）请思考为什么我们的 CPU 处理中断异常必须是已经指定好的地址？如果你的 CPU 支持用户自定义入口地址，即处理中断异常的程序由用户提供，其还能提供我们所希望的功能吗？如果可以，请说明这样可能会出现什么问题？否则举例说明。（假设用户提供的中断处理程序合法）</h5>
<p>​		CPU处理中断异常使用指定好的地址，有利于操作系统对中断处理程序的设计，更有利于异常中断的处理。如果CPU支持用户自定义入口地址，只要定义与其他外设设备的DM空间不冲突，理论上也是可以的，但如果发生地址冲突，则可能因为地址内容覆盖而造成无法挽回的损失。</p>
<h5 id="三为何与外设通信需要-bridge"><a class="markdownIt-Anchor" href="#三为何与外设通信需要-bridge"></a> （三）为何与外设通信需要 Bridge？</h5>
<p>​		因为实际生活中I/O设备相对于CPU是外置的，而系统桥正是模拟了各种I/O接口，通过Bridge来实现CPU和各种外设之间的数据交互。</p>
<h5 id="四-请阅读官方提供的定时器源代码阐述两种中断模式的异同并针对每一种模式绘制状态移图"><a class="markdownIt-Anchor" href="#四-请阅读官方提供的定时器源代码阐述两种中断模式的异同并针对每一种模式绘制状态移图"></a> （四） 请阅读官方提供的定时器源代码，阐述两种中断模式的异同，并针对每一种模式绘制状态移图</h5>
<p>在模式0下：当计数器倒计数为 0 后，计数器停止计数，此时控制寄存器中的使能 Enable 自动变为 0。当使能 Enable 被设置为 1 后，初值寄存器值再次被加载至计数器， 计数器重新启动倒计数。 模式 0 通常用于产生定时中断。例如，为操作系统的时间片调度机制提供定 时。模式 0 下的中断信号将持续有效，直至控制寄存器中的中断屏蔽位被设置为 0。</p>
<p>在模式1下：当计数器倒计数为 0 后，初值寄存器值被自动加载至计数器，计数器继续倒 计数。 模式 1 通常用于产生周期性脉冲。例如，可以用模式 1 产生步进电机所需的 步进控制信号。不同于模式 0，模式 1 下计数器每次计数循环中只产生一周期的中断信号。</p>
<p>模式0计时结束后，一直保持中断，直到en或IM被修改，模式1计时结束后，中断一个周期，再重新计数。可以理解为中断保持的逻辑不同。</p>
<p>​		<img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/TC_mode.png"
                      alt="img" 
                ></p>
<h5 id="五倘若中断信号流入的时候在检测宏观-pc-的一级如果是一条空泡你的-cpu-该级所有信息均为空指令此时会发生什么问题在此例基础上请思考在-p7-中清空流水线产生的空泡指令应该保留原指令的哪些信息"><a class="markdownIt-Anchor" href="#五倘若中断信号流入的时候在检测宏观-pc-的一级如果是一条空泡你的-cpu-该级所有信息均为空指令此时会发生什么问题在此例基础上请思考在-p7-中清空流水线产生的空泡指令应该保留原指令的哪些信息"></a> （五）倘若中断信号流入的时候，在检测宏观 PC 的一级如果是一条空泡（你的 CPU 该级所有信息均为空）指令，此时会发生什么问题？在此例基础上请思考：在 P7 中，清空流水线产生的空泡指令应该保留原指令的哪些信息？</h5>
<p>​	在阻塞时我们会往流水线中插入 nop，这个 nop 的 <code>pc</code> 和 <code>bd</code> 信号都是 <code>0</code>。此时宏观 PC 会显示错误的值。并且如果此时发生了中断，就会导致 EPC 存入错误的值。</p>
<p>​	所以在P7中，清空流水线产生的空泡指令应该保留原址令的 <code>PC</code> 和 <code>bd</code> 。</p>
<h5 id="六为什么-jalr-指令为什么不能写成-jalr-31-31"><a class="markdownIt-Anchor" href="#六为什么-jalr-指令为什么不能写成-jalr-31-31"></a> （六）为什么 jalr 指令为什么不能写成 jalr $31, $31？</h5>
<p>​	如果写成jalr $31 $31的话，相当于PC&lt;=GPR[$31],GPR[$31]&lt;=PC+4,按照流水线的执行顺序会先将PC+4进行Grf中内部转发，所以相当于进行了一次PC&lt;=PC+4,而没有起到跳转到GPR[$31]的效果。</p>
<h4 id="选做题"><a class="markdownIt-Anchor" href="#选做题"></a> 选做题</h4>
<h5 id="一请详细描述你的测试方案及测试数据构造策略"><a class="markdownIt-Anchor" href="#一请详细描述你的测试方案及测试数据构造策略"></a> （一）请详细描述你的测试方案及测试数据构造策略。</h5>
<p>​		由于p7的实现方式复杂性，所以通过自动化生成数据的效果并不好，所以我只能通过手动构造异常数据和各种支持不同位置中断的tb来实现，并使用数据对拍。</p>
<p>​    	数据构造策略就是分别实现不同的数据之间组合模拟各种常见的异常，以及在中断发生在跳转指令、延迟槽、阻塞指令等不同情况，从而实现测试方案。</p>
<p>​		之后后续借助于我自己的自动化测试工具和课程组的Mars，我实现了自行测试。</p>
<h3 id="四自动化测试"><a class="markdownIt-Anchor" href="#四自动化测试"></a> 四.自动化测试</h3>
<h5 id="命令行自动测试"><a class="markdownIt-Anchor" href="#命令行自动测试"></a> 命令行自动测试</h5>
<p>具体源码可见：<a class="link"   target="_blank" rel="noopener" href="https://github.com/Charles2530/Charles_BUAA_CO_2022/tree/main/p7/statistic" >Charles_BUAA_CO_2022/p7/statistic at main · Charles2530/Charles_BUAA_CO_2022 (github.com) <i class="fa-regular fa-arrow-up-right-from-square fa-sm"></i></a></p>
<div class="tabs" id="tab-first-unique-name"><ul class="nav-tabs"><li class="tab active"><a class="#first-unique-name-1">new_test.py</a></li><li class="tab"><a class="#first-unique-name-2">test.py</a></li><li class="tab"><a class="#first-unique-name-3">diff.py</a></li><li class="tab"><a class="#first-unique-name-4">cmp.cpp</a></li><li class="tab"><a class="#first-unique-name-5">disassembly.py</a></li></ul><div class="tab-content"><div class="tab-pane active" id="first-unique-name-1"><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> i &lt;= <span class="number">5000</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;num = &#x27;</span> + <span class="built_in">str</span>(i))</span><br><span class="line">    os.chdir(<span class="string">&#x27;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;python test.py&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;java -jar Mars.jar nc db lg ex mc LargeText 100000 test.asm &gt;mips_out.txt&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;java -jar mars.jar db mc CompactDataAtZero a dump .text HexText ../mips/code.txt test.asm &gt; mips_log.txt&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;java -jar Mars.jar a db mc CompactDataAtZero dump 0x00004180-0x00004ffc HexText ../mips/handler.txt test.asm &gt; mips_log.txt&#x27;</span>)</span><br><span class="line">    os.chdir(<span class="string">&#x27;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\mips&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;D:\\SoftWare\\ISE\\14.7\\ISE_DS\\ISE\\bin\\nt64\\fuse -nodebug -prj mips.prj \</span></span><br><span class="line"><span class="string">        -o mips.exe mips_txt 1&gt;../statistic/isim_log.txt 2&gt;../statistic/isim_warning_log.txt&#x27;</span>)</span><br><span class="line">    os.system(</span><br><span class="line">        <span class="string">&#x27;mips.exe -nolog -tclbatch mips.tcl &gt; isim_out.txt&#x27;</span>)</span><br><span class="line">    os.chdir(<span class="string">&#x27;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic&#x27;</span>)</span><br><span class="line">    os.system(<span class="string">&#x27;python diff.py&#x27;</span>)</span><br><span class="line">    i = i+<span class="number">1</span></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-2"><details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Calc_r = [&#x27;add&#x27;, &#x27;sub&#x27;, &#x27;and&#x27;, &#x27;or&#x27;, &#x27;slt&#x27;, &#x27;sltu&#x27;]</span></span><br><span class="line">Calc_r = [<span class="string">&#x27;add&#x27;</span>, <span class="string">&#x27;and&#x27;</span>, <span class="string">&#x27;or&#x27;</span>, <span class="string">&#x27;slt&#x27;</span>, <span class="string">&#x27;sltu&#x27;</span>]</span><br><span class="line">Calc_i = [<span class="string">&#x27;ori&#x27;</span>, <span class="string">&#x27;addi&#x27;</span>, <span class="string">&#x27;ori&#x27;</span>]</span><br><span class="line">Load = [<span class="string">&#x27;lb&#x27;</span>]</span><br><span class="line"><span class="comment"># Load = [&#x27;lw&#x27;, &#x27;lb&#x27;, &#x27;lh&#x27;]</span></span><br><span class="line"><span class="comment"># Store = [&#x27;sw&#x27;, &#x27;sb&#x27;, &#x27;sh&#x27;]</span></span><br><span class="line">Store = [<span class="string">&#x27;sb&#x27;</span>]</span><br><span class="line">B_type = [<span class="string">&#x27;beq&#x27;</span>, <span class="string">&#x27;bne&#x27;</span>]</span><br><span class="line">J_type = [<span class="string">&#x27;jal&#x27;</span>]</span><br><span class="line">Shift = []</span><br><span class="line">Shift_v = []</span><br><span class="line">md = [<span class="string">&#x27;mult&#x27;</span>, <span class="string">&#x27;multu&#x27;</span>]</span><br><span class="line"><span class="comment"># md = [&#x27;mult&#x27;, &#x27;multu&#x27;, &#x27;div&#x27;, &#x27;divu&#x27;]</span></span><br><span class="line">mf_mt = [<span class="string">&#x27;mfhi&#x27;</span>, <span class="string">&#x27;mflo&#x27;</span>, <span class="string">&#x27;mthi&#x27;</span>, <span class="string">&#x27;mtlo&#x27;</span>]</span><br><span class="line"><span class="comment"># exception = [&#x27;mfc0&#x27;, &#x27;mtc0&#x27;, &#x27;eret&#x27;]</span></span><br><span class="line">exception = [<span class="string">&#x27;mfc0&#x27;</span>, <span class="string">&#x27;mtc0&#x27;</span>]</span><br><span class="line"><span class="comment"># exception = []</span></span><br><span class="line"></span><br><span class="line">filename = <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\test.asm&quot;</span></span><br><span class="line"><span class="comment"># 输出文件位置</span></span><br><span class="line"><span class="comment"># label = [0, 1]</span></span><br><span class="line">label = [<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 输出label的编号范围，事先存入0防止在第一次输出标签前出现跳转指令</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="comment"># 可执行代码的行数</span></span><br><span class="line">flag = <span class="number">2</span></span><br><span class="line"><span class="comment"># 当前所标出过的编号号码</span></span><br><span class="line">jal = []</span><br><span class="line"><span class="comment"># 使用过的jal对应标签编号</span></span><br><span class="line">R_num = <span class="built_in">len</span>(Calc_r)</span><br><span class="line">I_num = <span class="built_in">len</span>(Calc_i)</span><br><span class="line">L_num = <span class="built_in">len</span>(Load)</span><br><span class="line">S_num = <span class="built_in">len</span>(Store)</span><br><span class="line">B_num = <span class="built_in">len</span>(B_type)</span><br><span class="line">J_num = <span class="built_in">len</span>(J_type)</span><br><span class="line">MD_num = <span class="built_in">len</span>(md)</span><br><span class="line">MF_num = <span class="built_in">len</span>(mf_mt)</span><br><span class="line">EX_num = <span class="built_in">len</span>(exception)</span><br><span class="line"><span class="comment"># 各类指令出现频率设置</span></span><br><span class="line">f_all = <span class="number">1</span></span><br><span class="line">f_R = <span class="number">4</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">f_I = <span class="number">4</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">f_L = <span class="number">4</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">f_S = <span class="number">4</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">f_B = <span class="number">0</span>*random.randint(<span class="number">1</span>, <span class="number">2</span>)*f_all</span><br><span class="line">f_J = <span class="number">0</span>*random.randint(<span class="number">1</span>, <span class="number">2</span>)*f_all</span><br><span class="line">f_md = <span class="number">2</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">f_mf = <span class="number">2</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">f_ex = <span class="number">20</span>*random.randint(<span class="number">1</span>, <span class="number">4</span>)*f_all</span><br><span class="line">num = f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num + \</span><br><span class="line">    f_B*B_num+f_J*J_num+f_md*MD_num+f_mf*MF_num+EX_num*f_ex+<span class="number">1</span></span><br><span class="line">begin = <span class="number">27</span></span><br><span class="line">end = <span class="number">31</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">get_Ori</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 对应指令生成随机数</span></span><br><span class="line">        self.rs = random.randint(begin, end)</span><br><span class="line">        self.rt = random.randint(begin, end)</span><br><span class="line">        self.imm16 = random.randint(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">        self.main()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.rs == <span class="number">28</span> <span class="keyword">or</span> self.rs == <span class="number">29</span> <span class="keyword">or</span> self.rs == <span class="number">30</span>:</span><br><span class="line">            self.rs = self.rs-<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.rt == <span class="number">28</span> <span class="keyword">or</span> self.rt == <span class="number">29</span> <span class="keyword">or</span> self.rt == <span class="number">30</span>:</span><br><span class="line">            self.rt = self.rt-<span class="number">3</span></span><br><span class="line">        self.code = <span class="string">&#x27;ori&#x27;</span> + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">            <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">            <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">get_Code</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 对应指令生成随机数</span></span><br><span class="line">        self.rs = random.randint(begin, end)</span><br><span class="line">        self.rt = random.randint(begin, end)</span><br><span class="line">        self.rd = random.randint(begin, end)</span><br><span class="line">        self.imm16 = random.randint(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">        self.imm26 = random.randint(<span class="number">0</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="comment"># self.mem = random.randint(0, 100)</span></span><br><span class="line">        self.ex = random.randint(<span class="number">6</span>, <span class="number">8</span>)*<span class="number">2</span></span><br><span class="line">        self.mem = random.randint(<span class="number">0</span>, <span class="number">3</span>)</span><br><span class="line">        <span class="comment"># self.mem = random.randint(0, 3)</span></span><br><span class="line">        <span class="comment"># 存储指令类型</span></span><br><span class="line">        self.<span class="built_in">list</span> = []</span><br><span class="line">        <span class="comment"># get函数</span></span><br><span class="line">        self.get_R()</span><br><span class="line">        self.get_I()</span><br><span class="line">        self.get_L()</span><br><span class="line">        self.get_S()</span><br><span class="line">        self.get_B()</span><br><span class="line">        self.get_J()</span><br><span class="line">        self.get_MD()</span><br><span class="line">        self.get_MF()</span><br><span class="line">        self.get_Label()</span><br><span class="line">        self.get_EX()</span><br><span class="line">        self.main()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_R</span>(<span class="params">self</span>):</span><br><span class="line">        random1 = random.randint(<span class="number">0</span>, R_num - <span class="number">1</span>)</span><br><span class="line">        type1 = Calc_r[random1]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_I</span>(<span class="params">self</span>):</span><br><span class="line">        random2 = random.randint(<span class="number">0</span>, I_num - <span class="number">1</span>)</span><br><span class="line">        type2 = Calc_i[random2]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_L</span>(<span class="params">self</span>):</span><br><span class="line">        random3 = random.randint(<span class="number">0</span>, L_num - <span class="number">1</span>)</span><br><span class="line">        type3 = Load[random3]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_S</span>(<span class="params">self</span>):</span><br><span class="line">        random4 = random.randint(<span class="number">0</span>, S_num - <span class="number">1</span>)</span><br><span class="line">        type4 = Store[random4]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type4)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_B</span>(<span class="params">self</span>):</span><br><span class="line">        random5 = random.randint(<span class="number">0</span>, B_num - <span class="number">1</span>)</span><br><span class="line">        type5 = B_type[random5]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type5)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_J</span>(<span class="params">self</span>):</span><br><span class="line">        random6 = random.randint(<span class="number">0</span>, J_num - <span class="number">1</span>)</span><br><span class="line">        type6 = J_type[random6]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type6)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_MD</span>(<span class="params">self</span>):</span><br><span class="line">        random7 = random.randint(<span class="number">0</span>, MD_num - <span class="number">1</span>)</span><br><span class="line">        type7 = md[random7]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type7)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_MF</span>(<span class="params">self</span>):</span><br><span class="line">        random8 = random.randint(<span class="number">0</span>, MF_num - <span class="number">1</span>)</span><br><span class="line">        type8 = mf_mt[random8]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type8)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_EX</span>(<span class="params">self</span>):</span><br><span class="line">        random9 = random.randint(<span class="number">0</span>, EX_num - <span class="number">1</span>)</span><br><span class="line">        type9 = exception[random9]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type9)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_Label</span>(<span class="params">self</span>):</span><br><span class="line">        random10 = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(label)-<span class="number">1</span>)</span><br><span class="line">        ran = label[random10]</span><br><span class="line">        <span class="keyword">return</span> ran</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        sel = random.randint(<span class="number">0</span>, num+<span class="number">100</span>)</span><br><span class="line">        <span class="keyword">if</span> self.rs == <span class="number">28</span> <span class="keyword">or</span> self.rs == <span class="number">29</span> <span class="keyword">or</span> self.rs == <span class="number">30</span>:</span><br><span class="line">            self.rs = self.rs-<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.rt == <span class="number">28</span> <span class="keyword">or</span> self.rt == <span class="number">29</span> <span class="keyword">or</span> self.rt == <span class="number">30</span>:</span><br><span class="line">            self.rt = self.rt-<span class="number">3</span></span><br><span class="line">        <span class="keyword">if</span> self.rd == <span class="number">28</span> <span class="keyword">or</span> self.rd == <span class="number">29</span> <span class="keyword">or</span> self.rd == <span class="number">30</span>:</span><br><span class="line">            self.rd = self.rd-<span class="number">3</span></span><br><span class="line">        <span class="comment"># 控制参数类型</span></span><br><span class="line">        <span class="keyword">if</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, f_R*R_num):</span><br><span class="line">            <span class="comment"># 通过控制随机数的范围来决定输出各种指令的频率,并用各种指令的数目保证各指令出现概率基本相同</span></span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">0</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rd) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num, f_R*R_num+f_I*I_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num, f_R*R_num+f_I*I_num+f_L*L_num):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">2</span>] == <span class="string">&#x27;lb&#x27;</span> <span class="keyword">or</span> self.<span class="built_in">list</span>[<span class="number">2</span>] == <span class="string">&#x27;lbu&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$0&#x27;</span> + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">2</span>] == <span class="string">&#x27;lh&#x27;</span> <span class="keyword">or</span> self.<span class="built_in">list</span>[<span class="number">2</span>] == <span class="string">&#x27;lhu&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>((self.rt+<span class="number">1</span>) % <span class="number">17</span>+<span class="number">3</span>) + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>((self.rt+<span class="number">1</span>) % <span class="number">17</span>+<span class="number">3</span>) + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">3</span>] == <span class="string">&#x27;sb&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">3</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$0&#x27;</span> + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">3</span>] == <span class="string">&#x27;sh&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">3</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>((self.rt+<span class="number">1</span>) % <span class="number">17</span>+<span class="number">3</span>) + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">3</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.mem) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>((self.rt+<span class="number">1</span>) % <span class="number">17</span>+<span class="number">3</span>) + <span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">4</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;label_&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.get_Label()) + <span class="string">&#x27;\n&#x27;</span> +\</span><br><span class="line">                <span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">5</span>] == <span class="string">&#x27;jal&#x27;</span>:</span><br><span class="line">                node = self.get_Label()</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">5</span>] + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                    <span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(node) + <span class="string">&#x27;\n&#x27;</span> +\</span><br><span class="line">                    <span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                jal.append(node)</span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">5</span>] == <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">5</span>] + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                    <span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(self.get_Label()) + <span class="string">&#x27;\n&#x27;</span> +\</span><br><span class="line">                    <span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">6</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num+f_mf*MF_num):</span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">7</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num+f_mf*MF_num, f_R*R_num+f_I*I_num+f_L*L_num+f_S*S_num+f_B*B_num+f_J*J_num+f_md*MD_num+f_mf*MF_num+EX_num*f_ex):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">8</span>] == <span class="string">&#x27;eret&#x27;</span>:</span><br><span class="line">                self.code = <span class="string">&#x27;eret&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">8</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span>+<span class="string">&#x27;$14&#x27;</span> + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.code = <span class="string">&#x27;lui&#x27;</span> + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;.text&#x27;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;mtc0 $0,$12&#x27;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">&#x27;ori $at,$0,0xfffc&#x27;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>*begin, <span class="number">2</span>*end):</span><br><span class="line">        b = get_Ori()</span><br><span class="line">        f.write(b.code)</span><br><span class="line">    cnt = <span class="number">0</span></span><br><span class="line">    f.write(<span class="string">&#x27;syscall&#x27;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num):</span><br><span class="line">        a = get_Code()</span><br><span class="line">        <span class="comment"># if cnt == 0:</span></span><br><span class="line">        <span class="comment"># f.write(&#x27;jal&#x27;+&#x27; label_0&#x27;+&#x27;\n&#x27;+&#x27;nop&#x27;+&#x27;\n&#x27;)</span></span><br><span class="line">        f.write(a.code)</span><br><span class="line">        <span class="keyword">if</span> random.randint(<span class="number">0</span>, num) == <span class="number">1</span> <span class="keyword">and</span> label != []:</span><br><span class="line">            <span class="comment"># 通过控制random范围来决定标签和jr出现的概率</span></span><br><span class="line">            f.write(<span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(flag) + <span class="string">&#x27;:&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            label.append(flag)</span><br><span class="line">            flag = flag+<span class="number">1</span></span><br><span class="line">            <span class="comment"># f.write(&#x27;jr $ra&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">            <span class="comment"># f.write(&#x27;nop&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="comment"># if cnt == 10:</span></span><br><span class="line">        <span class="comment">#     f.write(&#x27;jr $ra&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="comment">#     f.write(&#x27;nop&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="comment"># if cnt == 5:</span></span><br><span class="line">        <span class="keyword">if</span> cnt == num-<span class="number">20</span>:</span><br><span class="line">            <span class="comment">#     f.write(&#x27;jal&#x27;+&#x27; label_1&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">            <span class="comment">#     f.write(&#x27;nop&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">            f.write(<span class="string">&#x27;label_0&#x27;</span> + <span class="string">&#x27;:&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            <span class="comment"># f.write(&#x27;addi $ra,$ra,1&#x27;+&#x27;\n&#x27;)</span></span><br><span class="line">            <span class="comment"># f.write(&#x27;jr $ra&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">            <span class="comment"># f.write(&#x27;nop&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">        <span class="comment">#     f.write(&#x27;label_1&#x27; + &#x27;:&#x27; + &#x27;\n&#x27;)</span></span><br><span class="line">    f.write(<span class="string">&#x27;.ktext 0x4180&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;_main_handler:&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    mfc0 $k0, $13&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    mfc0 $k0, $14&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    andi $k0, $k0, 0xfffc&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    addi $k0, $k0, 4&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    mtc0 $k0, $14&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    sb $0, 0x7f20($0)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;    eret&#x27;</span>+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-3"><details class="red" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># from filediff.diff import file_diff_compare</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">tmp = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\mips_out.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">out = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\mips_out_another.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">std = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\mips\\isim_out.txt&quot;</span>, <span class="string">&quot;r&quot;</span>)</span><br><span class="line">isim = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\isim_out.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = tmp.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    line = line.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    line = line.replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">    out.write(line)</span><br><span class="line">out.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    line = std.readline()</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> line[<span class="number">0</span>].isspace():</span><br><span class="line">        line = line.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        line = line.replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        isim.write(line)</span><br><span class="line">    <span class="keyword">elif</span> line[<span class="number">0</span>] == <span class="string">&#x27;@&#x27;</span>:</span><br><span class="line">        line = line.replace(<span class="string">&quot; &quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        line = line.replace(<span class="string">&quot;\t&quot;</span>, <span class="string">&quot;&quot;</span>)</span><br><span class="line">        isim.write(line)</span><br><span class="line">isim.write(<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">out.close()</span><br><span class="line">tmp.close()</span><br><span class="line">std.close()</span><br><span class="line">isim.close()</span><br><span class="line">result = <span class="built_in">open</span>(</span><br><span class="line">    <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\result.txt&quot;</span>, <span class="string">&quot;a+&quot;</span>)</span><br><span class="line">os.system(<span class="string">&quot;cmp.exe&quot;</span>)</span><br><span class="line">result.write(</span><br><span class="line">    <span class="string">&quot;---------------------------------test------------------------------------------- &quot;</span>+<span class="string">&quot;\n\n&quot;</span>)</span><br><span class="line">result.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-4"><details class="orange" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Cpp"><figure class="iseeu highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> M 100007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> N 1007</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> INF 0x3f3f3f3f</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> ll long long</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> db double</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="type">char</span> s1[<span class="number">400</span>], s2[<span class="number">400</span>];</span><br><span class="line">    <span class="type">char</span> s3[<span class="number">400</span>], s4[<span class="number">400</span>];</span><br><span class="line">    <span class="type">int</span> flag = <span class="number">1</span>;</span><br><span class="line">    FILE* fp1;</span><br><span class="line">    FILE* fp2;</span><br><span class="line">    FILE* fp3;</span><br><span class="line">    FILE* fp4;</span><br><span class="line">    FILE* fp5;</span><br><span class="line">    FILE* fp6;</span><br><span class="line">    fp1 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\mips_out_another.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fp2 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\isim_out.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fp3 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\result.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">    fp4 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\test.asm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    fp5 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p7\\statistic\\p7_&quot;</span></span><br><span class="line">        <span class="string">&quot;error_code.asm&quot;</span>,</span><br><span class="line">        <span class="string">&quot;a+&quot;</span>);</span><br><span class="line">    fp6 = <span class="built_in">fopen</span>(</span><br><span class="line">        <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_&quot;</span></span><br><span class="line">        <span class="string">&quot;lesson\\lesson\\p7\\statistic\\isim_out_another.txt&quot;</span>,</span><br><span class="line">        <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="type">int</span> i = <span class="number">0</span>, j = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> n = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> line = <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> l1 = <span class="number">0</span>, l2 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">fgets</span>(s1, <span class="number">400</span>, fp1)) &#123;</span><br><span class="line">        string s = s1;</span><br><span class="line">        <span class="comment">// printf(&quot;%d&quot;, s.find(&quot;$0&quot;));</span></span><br><span class="line">        <span class="keyword">if</span> (s.<span class="built_in">find</span>(<span class="string">&quot;$0&quot;</span>) != <span class="number">-1</span>) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        line++;</span><br><span class="line">        <span class="keyword">if</span> (s1[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">fgets</span>(s1, <span class="number">400</span>, fp1);</span><br><span class="line">            <span class="built_in">fgets</span>(s1, <span class="number">400</span>, fp1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fgets</span>(s2, <span class="number">400</span>, fp2);</span><br><span class="line">        <span class="keyword">if</span> (s2[<span class="number">0</span>] == <span class="string">&#x27;I&#x27;</span>) &#123;</span><br><span class="line">            <span class="built_in">fgets</span>(s2, <span class="number">400</span>, fp2);</span><br><span class="line">            <span class="built_in">fgets</span>(s2, <span class="number">400</span>, fp2);</span><br><span class="line">        &#125;</span><br><span class="line">        l1++;</span><br><span class="line">        l2++;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; s1[i] != <span class="string">&#x27;\0&#x27;</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s1[i] == <span class="string">&#x27;@&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (j = <span class="number">0</span>; s2[j] != <span class="string">&#x27;\0&#x27;</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (s2[j] == <span class="string">&#x27;@&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp6, <span class="string">&quot;%s&quot;</span>, s2 + j);</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">strcmp</span>(s1 + i, s2 + j)) &#123;</span><br><span class="line">            <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;Error in line %d\n&quot;</span>, line);</span><br><span class="line">            <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;get     :%s&quot;</span>, s2);</span><br><span class="line">            <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;expect  :%s\n\n&quot;</span>, s1 + i);</span><br><span class="line">            flag = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (flag) &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp3, <span class="string">&quot;Accept\n&quot;</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Accept\n&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Error\n&quot;</span>);</span><br><span class="line">        <span class="built_in">fprintf</span>(fp5, <span class="string">&quot;#error begin with\n&quot;</span>);</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">fgets</span>(s3, <span class="number">400</span>, fp4)) &#123;</span><br><span class="line">            <span class="built_in">fputs</span>(s3, fp5);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">fprintf</span>(fp5, <span class="string">&quot;#error end\n\n\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(fp1);</span><br><span class="line">    <span class="built_in">fclose</span>(fp2);</span><br><span class="line">    <span class="built_in">fclose</span>(fp3);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="first-unique-name-5"><details class="pink" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>反编译工具 </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Function: machine code to mips code\n\</span></span><br><span class="line"><span class="string">Instructions included: 56 (55 from mips-c instruction set and &#x27;nop&#x27;)\n\</span></span><br><span class="line"><span class="string">Please copy the machine code into in.txt and put it into the same folder \</span></span><br><span class="line"><span class="string">as this .py file.\nPress Enter to continue&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">bi_to_hex</span>(<span class="params">a</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">hex</span>(<span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">int</span>(a, <span class="number">2</span>))))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">machine = []</span><br><span class="line">hex_to_bi = &#123;<span class="string">&quot;0&quot;</span>: <span class="string">&quot;0000&quot;</span>, <span class="string">&quot;1&quot;</span>: <span class="string">&quot;0001&quot;</span>, <span class="string">&quot;2&quot;</span>: <span class="string">&quot;0010&quot;</span>, <span class="string">&quot;3&quot;</span>: <span class="string">&quot;0011&quot;</span>,</span><br><span class="line">             <span class="string">&quot;4&quot;</span>: <span class="string">&quot;0100&quot;</span>, <span class="string">&quot;5&quot;</span>: <span class="string">&quot;0101&quot;</span>, <span class="string">&quot;6&quot;</span>: <span class="string">&quot;0110&quot;</span>, <span class="string">&quot;7&quot;</span>: <span class="string">&quot;0111&quot;</span>,</span><br><span class="line">             <span class="string">&quot;8&quot;</span>: <span class="string">&quot;1000&quot;</span>, <span class="string">&quot;9&quot;</span>: <span class="string">&quot;1001&quot;</span>, <span class="string">&quot;a&quot;</span>: <span class="string">&quot;1010&quot;</span>, <span class="string">&quot;b&quot;</span>: <span class="string">&quot;1011&quot;</span>,</span><br><span class="line">             <span class="string">&quot;c&quot;</span>: <span class="string">&quot;1100&quot;</span>, <span class="string">&quot;d&quot;</span>: <span class="string">&quot;1101&quot;</span>, <span class="string">&quot;e&quot;</span>: <span class="string">&quot;1110&quot;</span>, <span class="string">&quot;f&quot;</span>: <span class="string">&quot;1111&quot;</span>&#125;</span><br><span class="line">reg = &#123;<span class="string">&quot;0&quot;</span>: <span class="string">&quot;$0&quot;</span>,  <span class="string">&quot;1&quot;</span>: <span class="string">&quot;$at&quot;</span>, <span class="string">&quot;2&quot;</span>: <span class="string">&quot;$v0&quot;</span>, <span class="string">&quot;3&quot;</span>: <span class="string">&quot;$v1&quot;</span>,</span><br><span class="line">       <span class="string">&quot;4&quot;</span>: <span class="string">&quot;$a0&quot;</span>, <span class="string">&quot;5&quot;</span>: <span class="string">&quot;$a1&quot;</span>, <span class="string">&quot;6&quot;</span>: <span class="string">&quot;$a2&quot;</span>, <span class="string">&quot;7&quot;</span>: <span class="string">&quot;$a3&quot;</span>,</span><br><span class="line">       <span class="string">&quot;8&quot;</span>: <span class="string">&quot;$t0&quot;</span>, <span class="string">&quot;9&quot;</span>: <span class="string">&quot;$t1&quot;</span>, <span class="string">&quot;10&quot;</span>: <span class="string">&quot;$t2&quot;</span>, <span class="string">&quot;11&quot;</span>: <span class="string">&quot;$t3&quot;</span>,</span><br><span class="line">       <span class="string">&quot;12&quot;</span>: <span class="string">&quot;$t4&quot;</span>, <span class="string">&quot;13&quot;</span>: <span class="string">&quot;$t5&quot;</span>, <span class="string">&quot;14&quot;</span>: <span class="string">&quot;$t6&quot;</span>, <span class="string">&quot;15&quot;</span>: <span class="string">&quot;$t7&quot;</span>,</span><br><span class="line">       <span class="string">&quot;16&quot;</span>: <span class="string">&quot;$s0&quot;</span>, <span class="string">&quot;17&quot;</span>: <span class="string">&quot;$s1&quot;</span>, <span class="string">&quot;18&quot;</span>: <span class="string">&quot;$s2&quot;</span>, <span class="string">&quot;19&quot;</span>: <span class="string">&quot;$s3&quot;</span>,</span><br><span class="line">       <span class="string">&quot;20&quot;</span>: <span class="string">&quot;$s4&quot;</span>, <span class="string">&quot;21&quot;</span>: <span class="string">&quot;$s5&quot;</span>, <span class="string">&quot;22&quot;</span>: <span class="string">&quot;$s6&quot;</span>, <span class="string">&quot;23&quot;</span>: <span class="string">&quot;$s7&quot;</span>,</span><br><span class="line">       <span class="string">&quot;24&quot;</span>: <span class="string">&quot;$t8&quot;</span>, <span class="string">&quot;25&quot;</span>: <span class="string">&quot;$t9&quot;</span>, <span class="string">&quot;26&quot;</span>: <span class="string">&quot;$k0&quot;</span>, <span class="string">&quot;27&quot;</span>: <span class="string">&quot;$k1&quot;</span>,</span><br><span class="line">       <span class="string">&quot;28&quot;</span>: <span class="string">&quot;$gp&quot;</span>, <span class="string">&quot;29&quot;</span>: <span class="string">&quot;$sp&quot;</span>, <span class="string">&quot;30&quot;</span>: <span class="string">&quot;$fp&quot;</span>, <span class="string">&quot;31&quot;</span>: <span class="string">&quot;$ra&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mark = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> mark == <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">input</span>()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        file_in = <span class="built_in">open</span>(<span class="string">&#x27;in.txt&#x27;</span>, <span class="string">&#x27;rt&#x27;</span>)</span><br><span class="line">        file_out = <span class="built_in">open</span>(<span class="string">&#x27;out.txt&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>)</span><br><span class="line">        mark = <span class="number">1</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;in.txt does not exist. Please try again.&quot;</span>)</span><br><span class="line"></span><br><span class="line">out = [<span class="string">&quot;&quot;</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20000</span>)]</span><br><span class="line">labelcount = <span class="number">1</span></span><br><span class="line">mipscount = <span class="number">0</span></span><br><span class="line">label = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> file_in:</span><br><span class="line">    machine.append(line[:-<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> hexcode <span class="keyword">in</span> machine:</span><br><span class="line"></span><br><span class="line">    bicode = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> hexcode:</span><br><span class="line">        bicode += hex_to_bi[char]</span><br><span class="line"></span><br><span class="line">    op = bicode[<span class="number">0</span>:<span class="number">6</span>]</span><br><span class="line">    func = bicode[<span class="number">26</span>:<span class="number">32</span>]</span><br><span class="line">    rs = reg[<span class="built_in">str</span>(<span class="built_in">int</span>(bicode[<span class="number">6</span>:<span class="number">11</span>], <span class="number">2</span>))]</span><br><span class="line">    rt = reg[<span class="built_in">str</span>(<span class="built_in">int</span>(bicode[<span class="number">11</span>:<span class="number">16</span>], <span class="number">2</span>))]</span><br><span class="line">    rd = reg[<span class="built_in">str</span>(<span class="built_in">int</span>(bicode[<span class="number">16</span>:<span class="number">21</span>], <span class="number">2</span>))]</span><br><span class="line">    shamt = bicode[<span class="number">21</span>:<span class="number">26</span>]</span><br><span class="line">    imm = bi_to_hex(bicode[<span class="number">16</span>:<span class="number">32</span>])</span><br><span class="line">    mips = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> op == <span class="string">&#x27;000000&#x27;</span>:</span><br><span class="line">        itype = <span class="string">&quot;R&quot;</span></span><br><span class="line">    <span class="keyword">elif</span> op == <span class="string">&#x27;000010&#x27;</span> <span class="keyword">or</span> op == <span class="string">&#x27;000011&#x27;</span>:</span><br><span class="line">        itype = <span class="string">&quot;J&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        itype = <span class="string">&quot;I&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> itype == <span class="string">&quot;J&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> op == <span class="string">&#x27;000010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;j &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;jal &quot;</span></span><br><span class="line">        linenum = <span class="built_in">int</span>((<span class="built_in">int</span>(<span class="built_in">str</span>(<span class="built_in">int</span>(bicode[<span class="number">6</span>:<span class="number">32</span>]+<span class="string">&quot;00&quot;</span>, <span class="number">2</span>)))-<span class="number">12288</span>)/<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> linenum <span class="keyword">in</span> label.keys():</span><br><span class="line">            labelname = <span class="string">&quot;label_&quot;</span>+<span class="built_in">str</span>(labelcount)</span><br><span class="line">            out[linenum] = labelname+<span class="string">&quot;: &quot;</span>+out[linenum]</span><br><span class="line">            <span class="keyword">if</span> linenum &gt; <span class="number">0</span>:</span><br><span class="line">                out[linenum-<span class="number">1</span>] += <span class="string">&quot;\n&quot;</span></span><br><span class="line">            label[linenum] = labelcount</span><br><span class="line">            labelcount += <span class="number">1</span></span><br><span class="line">            mips = mips+labelname</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            labelname = <span class="string">&quot;label_&quot;</span>+<span class="built_in">str</span>(label[linenum])</span><br><span class="line">            mips = mips+labelname</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> itype == <span class="string">&quot;R&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> bicode == <span class="string">&#x27;00000000000000000000000000000000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;nop&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;add &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;addu &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;and &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;001101&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;break&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;011010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;div &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;011011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;divu &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;001001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;jalr &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;001000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;jr &quot;</span>+rs</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;010000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mfhi &quot;</span>+rd</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;010010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mflo &quot;</span>+rd</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;010001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mthi &quot;</span>+rd</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;010011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mtlo &quot;</span>+rd</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;011000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mult &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;011001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;multu &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100111&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;nor &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100101&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;or &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;000000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sll &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+shamt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;000100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sllv &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;101010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;slt &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;101011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sltu &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;000011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sra &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+shamt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;000111&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;srav &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;000010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;srl &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+shamt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;000110&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;srlv &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sub &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;subu &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;001100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;syscall&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> func == <span class="string">&#x27;100110&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;xor &quot;</span>+rd+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> itype == <span class="string">&quot;I&quot;</span>:</span><br><span class="line">        <span class="keyword">if</span> op == <span class="string">&#x27;001000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;addi &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;addiu &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;andi &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;beq &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000001&#x27;</span> <span class="keyword">and</span> bicode[<span class="number">11</span>:<span class="number">16</span>] == <span class="string">&#x27;00001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;bgez &quot;</span>+rs+<span class="string">&quot;, &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000111&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;bgtz &quot;</span>+rs+<span class="string">&quot;, &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000110&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;blez &quot;</span>+rs+<span class="string">&quot;, &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000001&#x27;</span> <span class="keyword">and</span> bicode[<span class="number">11</span>:<span class="number">16</span>] == <span class="string">&#x27;00000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;bltz &quot;</span>+rs+<span class="string">&quot;, &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;000101&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;bne &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+rt+<span class="string">&quot;, &quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;010000&#x27;</span> <span class="keyword">and</span> func == <span class="string">&#x27;011000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;eret&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;100000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;lb &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;100100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;lbu &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;100001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;lh &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;100101&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;lhu &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001111&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;lui &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;100011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;lw &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;010000&#x27;</span> <span class="keyword">and</span> bicode[<span class="number">6</span>:<span class="number">11</span>] == <span class="string">&#x27;00000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mfc0 &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rd</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;010000&#x27;</span> <span class="keyword">and</span> bicode[<span class="number">6</span>:<span class="number">11</span>] == <span class="string">&#x27;00100&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;mtc0 &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rd</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001101&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;ori &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;101000&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sb &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;101001&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sh &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001010&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;slti &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sltiu &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;101011&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;sw &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+imm+<span class="string">&quot;(&quot;</span>+rs+<span class="string">&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">elif</span> op == <span class="string">&#x27;001110&#x27;</span>:</span><br><span class="line">            mips = <span class="string">&quot;xori &quot;</span>+rt+<span class="string">&quot;, &quot;</span>+rs+<span class="string">&quot;, &quot;</span>+imm</span><br><span class="line">        <span class="keyword">if</span> mips[<span class="number">0</span>] == <span class="string">&#x27;b&#x27;</span>:</span><br><span class="line">            imm = bicode[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">            immv = <span class="built_in">int</span>(<span class="number">15</span>*imm[<span class="number">0</span>]+imm, <span class="number">2</span>)</span><br><span class="line">            <span class="keyword">if</span> imm[<span class="number">0</span>] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                immv = -immv</span><br><span class="line">            linenum = <span class="built_in">int</span>((mipscount+<span class="number">1</span>+immv)/<span class="number">4</span>)</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> linenum <span class="keyword">in</span> label.keys():</span><br><span class="line">                labelname = <span class="string">&quot;label_&quot;</span>+<span class="built_in">str</span>(labelcount)</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    out[linenum] = labelname+<span class="string">&quot;: &quot;</span>+out[linenum]</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">pass</span></span><br><span class="line">                <span class="keyword">if</span> linenum &gt; <span class="number">0</span>:</span><br><span class="line">                    out[linenum-<span class="number">1</span>] += <span class="string">&quot;\n&quot;</span></span><br><span class="line">                label[linenum] = labelcount</span><br><span class="line">                labelcount += <span class="number">1</span></span><br><span class="line">                mips = mips+labelname</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                labelname = <span class="string">&quot;label_&quot;</span>+<span class="built_in">str</span>(label[linenum])</span><br><span class="line">                mips = mips+labelname</span><br><span class="line">    mips += <span class="string">&quot;\n&quot;</span></span><br><span class="line">    out[mipscount] += mips</span><br><span class="line">    mipscount += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.join(out))</span><br><span class="line">file_out.write(<span class="string">&quot;&quot;</span>.join(out))</span><br><span class="line"><span class="comment"># print(out)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;MIPS code has been written in out.txt&quot;</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">file_in.close()</span><br><span class="line">file_out.close()</span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div></div></div>
            </div>

            
                <div class="post-copyright-info">
                    <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> P7 Design documents</li>
        <li><strong>Author:</strong> Charles</li>
        <li><strong>Created at:</strong> 2022-12-26 21:12:09</li>
        
            <li>
                <strong>Updated at:</strong> 2023-06-17 14:13:59
            </li>
        
        <li>
            <strong>Link:</strong> https://charles2530.github.io/2022/12/26/p7-design-documents/
        </li>
        <li>
            <strong>License:</strong> This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.
        </li>
    </ul>
</div>

                </div>
            

            
                <ul class="post-tags-box">
                    
                        <li class="tag-item">
                            <a href="/tags/CO/">#CO</a>&nbsp;
                        </li>
                    
                </ul>
            

            
  <div class="recommended-article">
   <div class="recommended-desktop">
    <div class="recommended-article-header">
     <i aria-hidden="true"></i><span>recommend_articles</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/05/05/vue-note-2/" title="Vue-note-2" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p2.jpg" alt="Vue-note-2">
  <span class="title">Vue-note-2</span>
</a><a class="recommended-article-item" href="/2023/02/03/matlab-note-10/" title="matlab-note-10" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p4.jpg" alt="matlab-note-10">
  <span class="title">matlab-note-10</span>
</a><a class="recommended-article-item" href="/2023/01/12/game-theory-algorithm/" title="game-theory-algorithm" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p2.jpg" alt="game-theory-algorithm">
  <span class="title">game-theory-algorithm</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header">
     <i aria-hidden="true"></i><span>recommend_articles</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/05/05/vue-note-2/" title="Vue-note-2" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p2.jpg" alt="Vue-note-2">
  <span class="title">Vue-note-2</span>
</a><a class="recommended-article-item" href="/2023/02/03/matlab-note-10/" title="matlab-note-10" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p4.jpg" alt="matlab-note-10">
  <span class="title">matlab-note-10</span>
</a></div>
   </div>
  </div>

            
                <div class="article-nav">
                    
                        <div class="article-prev">
                            <a class="prev"
                            rel="prev"
                            href="/2022/12/26/p8-design-documents/"
                            >
                                <span class="left arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-left"></i>
                                </span>
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">P8 Design documents</span>
                                    <span class="post-nav-item">Prev posts</span>
                                </span>
                            </a>
                        </div>
                    
                    
                        <div class="article-next">
                            <a class="next"
                            rel="next"
                            href="/2022/12/26/p6-design-documents/"
                            >
                                <span class="title flex-center">
                                    <span class="post-nav-title-item">P6 Design documents</span>
                                    <span class="post-nav-item">Next posts</span>
                                </span>
                                <span class="right arrow-icon flex-center">
                                    <i class="fa-solid fa-chevron-right"></i>
                                </span>
                            </a>
                        </div>
                    
                </div>
            


            
                <div class="comment-container">
                    <div class="comments-container">
  <div id="comment-anchor"></div>
  <div class="comment-area-title">
    <i class="fa-solid fa-comments"></i>&nbsp;Comments
  </div>
  

  <!-- 
            
    <div id="gitalk-container"></div>
    <script data-pjax
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script data-pjax>

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: '8083299a8ee2aaf23879',
                    clientSecret: 'a8161e81d4872181e884fdb69f7be24916b6a9d0',
                    repo: 'charles2530_issues',
                    owner: 'Charles2530',
                    admin: ['Charles2530'],
                    id: __gitalk__pathname,
                    language: 'en'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('true') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>



         -->
  <script src="https://utteranc.es/client.js" repo="Charles2530/Charles2530.github.io" issue-term="pathname"
    label="Comment" theme="preferred-color-scheme" crossorigin="anonymous" async>
  </script>
  
</div>

                </div>
            
        </div>

        
            <div class="toc-content-container">
                <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">P7 Design documents</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#verilog%E6%B5%81%E6%B0%B4%E7%BA%BFcpu%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3"><span class="nav-text"> Verilog流水线CPU设计文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-cpu%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88%E7%BB%BC%E8%BF%B0"><span class="nav-text"> 一、 CPU设计方案综述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80-%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%BF%B0"><span class="nav-text"> （一） 总体设计概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-%E5%85%B3%E9%94%AE%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89"><span class="nav-text"> （二） 关键模块定义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E4%BB%A3%E7%A0%81mips"><span class="nav-text"> 主代码mips</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-text"> 宏的定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#cpu%E6%A8%A1%E5%9D%97"><span class="nav-text"> CPU模块</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80f%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> &lt;一&gt;.F级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-pc"><span class="nav-text"> 1. PC</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8Cd%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> &lt;二&gt;.D级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-grf"><span class="nav-text"> 1. GRF</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ext"><span class="nav-text"> 2. EXT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-controller"><span class="nav-text"> 3. Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4npc"><span class="nav-text"> 4.NPC</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#npc%E4%B8%8B%E4%B8%80%E6%8C%87%E4%BB%A4%E8%AE%A1%E7%AE%97%E5%8D%95%E5%85%83"><span class="nav-text"> NPC（下一指令计算单元）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5b_transferb%E7%B1%BB%E6%8C%87%E4%BB%A4%E6%AF%94%E8%BE%83%E5%8D%95%E5%85%83"><span class="nav-text"> 5.B_transfer(B类指令比较单元)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89e%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> &lt;三&gt;.E级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-alu"><span class="nav-text"> 1. ALU</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2md_unit"><span class="nav-text"> 2.MD_Unit</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9Bm%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> &lt;四&gt;.M级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-dm_in"><span class="nav-text"> 1. DM_In</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2dm_out"><span class="nav-text"> 2.DM_Out</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3cp0"><span class="nav-text"> 3.CP0</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E5%90%84%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> &lt;五&gt;.各级流水线寄存器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1if_id"><span class="nav-text"> 1.IF_ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#d_regifid%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> D_Reg（IF&#x2F;ID流水寄存器）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2id_ex"><span class="nav-text"> 2.ID_EX</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#e_regidex%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> E_Reg（ID&#x2F;EX流水寄存器）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3ex_mem"><span class="nav-text"> 3.EX_MEM</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#m_regexmem%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> M_Reg（EX&#x2F;MEM流水寄存器）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4mem_wb"><span class="nav-text"> 4.MEM_WB</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#w_regmemwb%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> W_Reg（MEM&#x2F;WB流水寄存器）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%AD%E6%9A%82%E5%81%9C-%E8%BD%AC%E5%8F%91%E5%A4%84%E7%90%86%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%A4%9A%E8%B7%AF%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-text"> &lt;六&gt;.暂停、转发处理及相关多路选择器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%86%B2%E7%AA%81%E7%BB%BC%E5%90%88%E5%8D%95%E5%85%83hazardunit"><span class="nav-text"> （一）.冲突综合单元（HazardUnit)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E6%8E%A7%E5%88%B6%E5%92%8C%E5%86%92%E9%99%A9%E7%AE%80%E8%BF%B0"><span class="nav-text"> （二）.控制和冒险简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%86%92%E9%99%A9%E5%A4%84%E7%90%86"><span class="nav-text"> (三）.冒险处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91forward"><span class="nav-text"> 转发（forward）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91%E7%9A%84%E6%9E%84%E9%80%A0"><span class="nav-text"> 转发的构造</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9A%82%E5%81%9Cstall"><span class="nav-text"> 暂停（stall）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%BB%E5%A1%9E%E7%9A%84%E6%9E%84%E9%80%A0d%E7%BA%A7"><span class="nav-text"> 阻塞的构造（D级）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9C%9F%E5%80%BC%E8%A1%A8"><span class="nav-text"> 真值表</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A1%A5%E5%92%8C%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-text"> 桥和计数器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1bridge"><span class="nav-text"> 1.Bridge</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2tc"><span class="nav-text"> 2.TC </span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%87%8D%E8%A6%81%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E6%96%B9%E6%B3%95"><span class="nav-text"> 重要机制实现方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#cp0%E5%93%8D%E5%BA%94%E6%9C%BA%E5%88%B6"><span class="nav-text"> CP0响应机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E6%A1%A5%E8%AE%BE%E8%AE%A1"><span class="nav-text"> 系统桥设计</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BC%82%E5%B8%B8%E8%AF%86%E5%88%AB"><span class="nav-text"> 异常识别</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C-%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88"><span class="nav-text"> 二、 测试方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-%E6%80%9D%E8%80%83%E9%A2%98"><span class="nav-text"> 三、 思考题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%80%E8%AF%B7%E6%9F%A5%E9%98%85%E7%9B%B8%E5%85%B3%E8%B5%84%E6%96%99%E8%AF%B4%E6%98%8E%E9%BC%A0%E6%A0%87%E5%92%8C%E9%94%AE%E7%9B%98%E7%9A%84%E8%BE%93%E5%85%A5%E4%BF%A1%E5%8F%B7%E6%98%AF%E5%A6%82%E4%BD%95%E8%A2%AB-cpu-%E7%9F%A5%E6%99%93%E7%9A%84"><span class="nav-text"> （一）请查阅相关资料，说明鼠标和键盘的输入信号是如何被 CPU 知晓的？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8C%E8%AF%B7%E6%80%9D%E8%80%83%E4%B8%BA%E4%BB%80%E4%B9%88%E6%88%91%E4%BB%AC%E7%9A%84-cpu-%E5%A4%84%E7%90%86%E4%B8%AD%E6%96%AD%E5%BC%82%E5%B8%B8%E5%BF%85%E9%A1%BB%E6%98%AF%E5%B7%B2%E7%BB%8F%E6%8C%87%E5%AE%9A%E5%A5%BD%E7%9A%84%E5%9C%B0%E5%9D%80%E5%A6%82%E6%9E%9C%E4%BD%A0%E7%9A%84-cpu-%E6%94%AF%E6%8C%81%E7%94%A8%E6%88%B7%E8%87%AA%E5%AE%9A%E4%B9%89%E5%85%A5%E5%8F%A3%E5%9C%B0%E5%9D%80%E5%8D%B3%E5%A4%84%E7%90%86%E4%B8%AD%E6%96%AD%E5%BC%82%E5%B8%B8%E7%9A%84%E7%A8%8B%E5%BA%8F%E7%94%B1%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E5%85%B6%E8%BF%98%E8%83%BD%E6%8F%90%E4%BE%9B%E6%88%91%E4%BB%AC%E6%89%80%E5%B8%8C%E6%9C%9B%E7%9A%84%E5%8A%9F%E8%83%BD%E5%90%97%E5%A6%82%E6%9E%9C%E5%8F%AF%E4%BB%A5%E8%AF%B7%E8%AF%B4%E6%98%8E%E8%BF%99%E6%A0%B7%E5%8F%AF%E8%83%BD%E4%BC%9A%E5%87%BA%E7%8E%B0%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E5%90%A6%E5%88%99%E4%B8%BE%E4%BE%8B%E8%AF%B4%E6%98%8E-%E5%81%87%E8%AE%BE%E7%94%A8%E6%88%B7%E6%8F%90%E4%BE%9B%E7%9A%84%E4%B8%AD%E6%96%AD%E5%A4%84%E7%90%86%E7%A8%8B%E5%BA%8F%E5%90%88%E6%B3%95"><span class="nav-text"> （二）请思考为什么我们的 CPU 处理中断异常必须是已经指定好的地址？如果你的 CPU 支持用户自定义入口地址，即处理中断异常的程序由用户提供，其还能提供我们所希望的功能吗？如果可以，请说明这样可能会出现什么问题？否则举例说明。（假设用户提供的中断处理程序合法）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%89%E4%B8%BA%E4%BD%95%E4%B8%8E%E5%A4%96%E8%AE%BE%E9%80%9A%E4%BF%A1%E9%9C%80%E8%A6%81-bridge"><span class="nav-text"> （三）为何与外设通信需要 Bridge？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%9B%9B-%E8%AF%B7%E9%98%85%E8%AF%BB%E5%AE%98%E6%96%B9%E6%8F%90%E4%BE%9B%E7%9A%84%E5%AE%9A%E6%97%B6%E5%99%A8%E6%BA%90%E4%BB%A3%E7%A0%81%E9%98%90%E8%BF%B0%E4%B8%A4%E7%A7%8D%E4%B8%AD%E6%96%AD%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%BC%82%E5%90%8C%E5%B9%B6%E9%92%88%E5%AF%B9%E6%AF%8F%E4%B8%80%E7%A7%8D%E6%A8%A1%E5%BC%8F%E7%BB%98%E5%88%B6%E7%8A%B6%E6%80%81%E7%A7%BB%E5%9B%BE"><span class="nav-text"> （四） 请阅读官方提供的定时器源代码，阐述两种中断模式的异同，并针对每一种模式绘制状态移图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%94%E5%80%98%E8%8B%A5%E4%B8%AD%E6%96%AD%E4%BF%A1%E5%8F%B7%E6%B5%81%E5%85%A5%E7%9A%84%E6%97%B6%E5%80%99%E5%9C%A8%E6%A3%80%E6%B5%8B%E5%AE%8F%E8%A7%82-pc-%E7%9A%84%E4%B8%80%E7%BA%A7%E5%A6%82%E6%9E%9C%E6%98%AF%E4%B8%80%E6%9D%A1%E7%A9%BA%E6%B3%A1%E4%BD%A0%E7%9A%84-cpu-%E8%AF%A5%E7%BA%A7%E6%89%80%E6%9C%89%E4%BF%A1%E6%81%AF%E5%9D%87%E4%B8%BA%E7%A9%BA%E6%8C%87%E4%BB%A4%E6%AD%A4%E6%97%B6%E4%BC%9A%E5%8F%91%E7%94%9F%E4%BB%80%E4%B9%88%E9%97%AE%E9%A2%98%E5%9C%A8%E6%AD%A4%E4%BE%8B%E5%9F%BA%E7%A1%80%E4%B8%8A%E8%AF%B7%E6%80%9D%E8%80%83%E5%9C%A8-p7-%E4%B8%AD%E6%B8%85%E7%A9%BA%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%BA%A7%E7%94%9F%E7%9A%84%E7%A9%BA%E6%B3%A1%E6%8C%87%E4%BB%A4%E5%BA%94%E8%AF%A5%E4%BF%9D%E7%95%99%E5%8E%9F%E6%8C%87%E4%BB%A4%E7%9A%84%E5%93%AA%E4%BA%9B%E4%BF%A1%E6%81%AF"><span class="nav-text"> （五）倘若中断信号流入的时候，在检测宏观 PC 的一级如果是一条空泡（你的 CPU 该级所有信息均为空）指令，此时会发生什么问题？在此例基础上请思考：在 P7 中，清空流水线产生的空泡指令应该保留原指令的哪些信息？</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%AD%E4%B8%BA%E4%BB%80%E4%B9%88-jalr-%E6%8C%87%E4%BB%A4%E4%B8%BA%E4%BB%80%E4%B9%88%E4%B8%8D%E8%83%BD%E5%86%99%E6%88%90-jalr-31-31"><span class="nav-text"> （六）为什么 jalr 指令为什么不能写成 jalr $31, $31？</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%89%E5%81%9A%E9%A2%98"><span class="nav-text"> 选做题</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%80%E8%AF%B7%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0%E4%BD%A0%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%9E%84%E9%80%A0%E7%AD%96%E7%95%A5"><span class="nav-text"> （一）请详细描述你的测试方案及测试数据构造策略。</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95"><span class="nav-text"> 四.自动化测试</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%87%AA%E5%8A%A8%E6%B5%8B%E8%AF%95"><span class="nav-text"> 命令行自动测试</span></a></li></ol></li></ol></li></ol></li></ol></li></ol>

    </div>
</div>
            </div>
        
    </div>
</div>


                

            </div>
            
            

        </div>

        <div class="main-content-footer">
            <footer class="footer">
    <div class="info-container">
        <div class="copyright-info">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Charles</a>
        </div>
        
            <script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="website-count info-item">
                
                    <span id="busuanzi_container_site_uv" class="busuanzi_container_site_uv">
                        Visitor Count&nbsp;<span id="busuanzi_value_site_uv" class="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="busuanzi_container_site_pv">
                        Total Page Views&nbsp;<span id="busuanzi_value_site_pv" class="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="theme-info info-item">
            <span class="powered-by-container">Powered by Charles</span>
                <br>
            <span class="theme-version-container">Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.2.0</a>
        </div>
        
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
        
            <script async data-pjax>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="right-bottom-tools rss flex-center">
                <a class="flex-center"
                   href="/atom.xml"
                   target="_blank"
                >
                <i class="fa-regular fa-rss"></i>
                </a>
            </li>
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    


</main>



  <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/utils.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/main.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/layouts/navbarShrink.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/tools/scrollTopBottom.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/tools/lightDarkSwitch.js"></script>


    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/tools/localSearch.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/tools/codeBlock.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/layouts/lazyload.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/tools/runtime.js"></script>
    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/libs/odometer.min.js"></script>
    <link rel="stylesheet" href="//npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/assets/odometer-theme-minimal.css">



  <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/libs/Typed.min.js"></script>
  <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/plugins/typed.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/libs/mermaid.min.js"></script>
    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/plugins/mermaid.js"></script>



    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/libs/minimasonry.min.js"></script>
    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/plugins/masonry.js"></script>


<div class="post-scripts pjax">
    
        <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/tools/tocToggle.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/libs/anime.min.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/layouts/toc.js"></script><script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/plugins/tabs.js"></script>
    
</div>


    <script src="https://npm.elemecdn.com/hexo-theme-redefine@2.2.0/source/js/libs/pjax.min.js"></script>
<script>
    window.addEventListener('DOMContentLoaded', () => {
        window.pjax = new Pjax({
            selectors: [
                'head title',
                '.page-container',
                '.pjax',
            ],
            history: true,
            debug: false,
            cacheBust: false,
            timeout: 0,
            analytics: false,
            currentUrlFullReload: false,
            scrollRestoration: false,
            // scrollTo: true,
        });

        document.addEventListener('pjax:send', () => {
            Global.utils.pjaxProgressBarStart();
        });

        document.addEventListener('pjax:complete', () => {
            Global.utils.pjaxProgressBarEnd();
            window.pjax.executeScripts(document.querySelectorAll('script[data-pjax], .pjax script'));
            Global.refresh();
        });
    });
</script>



  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>

</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>
