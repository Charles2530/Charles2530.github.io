<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Charles">
    
    <meta name="author" content="Charles">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
        
            <link rel="preconnect" href="https://npm.elemecdn.com" crossorigin>
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://charles2530.github.io/2022/12/26/p5-design-documents/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="post by Charles in 2022-12-26 21:10:00">
<meta property="og:type" content="article">
<meta property="og:title" content="P5 Design documents">
<meta property="og:url" content="http://charles2530.github.io/2022/12/26/p5-design-documents/index.html">
<meta property="og:site_name" content="Charles&#39;s Castle">
<meta property="og:description" content="post by Charles in 2022-12-26 21:10:00">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://charles2530.github.io/image/simple_cpu.png">
<meta property="og:image" content="https://charles2530.github.io/image/4.png">
<meta property="og:image" content="https://charles2530.github.io/image/5.png">
<meta property="og:image" content="https://charles2530.github.io/image/6.png">
<meta property="og:image" content="https://charles2530.github.io/image/7.png">
<meta property="article:published_time" content="2022-12-26T13:10:00.000Z">
<meta property="article:modified_time" content="2023-08-15T09:29:47.659Z">
<meta property="article:author" content="Du Jinyang">
<meta property="article:tag" content="CO">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://charles2530.github.io/image/simple_cpu.png">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="https://charles2530.github.io/image/background/favicon.png" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="https://charles2530.github.io/image/background/favicon.png">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="https://charles2530.github.io/image/background/favicon.png">
    <!--- Page Info-->
    
    <title>
        
            P5 Design documents -
        
        Charles&#39;s Castle
    </title>
    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/css/build/styles.css">
    

    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fonts/fonts.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fonts/Satoshi/satoshi.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fonts/Chillax/chillax.css">
    <!--- Font Part-->
    
    
    
    

    <!--- Inject Part-->
    
        
            
                
                    <script data-swup-reload-script> var _hmt = _hmt || []; (function() { var hm = document.createElement("script"); hm.src = "https://hm.baidu.com/hm.js?8e0e5f382d14d87cbeadc33a36e71e86"; var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s); })(); </script>
                
    
            
    
    <script id="hexo-configurations">
    let Global = window.Global || {};
    Global.hexo_config = {"hostname":"charles2530.github.io","root":"/","language":"en","path":"search.xml"};
    Global.theme_config = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":true,"list":["lol","Neo","God"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":6,"number":false,"expand":true,"init_open":true},"copyright":true,"lazyload":true,"recommendation":{"enable":true,"title":"recommend_articles","limit":3,"mobile_limit":2,"placeholder":"https://charles2530.github.io/image/background/p3.jfif","skip_dirs":[]}},"colors":{"primary":"#A31F34","secondary":"#1890ff"},"global":{"fonts":{"chinese":{"enable":false,"family":null,"url":null},"english":{"enable":false,"family":null,"url":null}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"https://charles2530.github.io/image/background/background-light1.jpg","dark":"https://charles2530.github.io/image/background/background-dark1.jpg"},"title":"Charles's Castle","subtitle":{"text":["Happiness is best!","Never give up!","Everyday is a gift!"],"hitokoto":{"enable":false,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#000000","dark":"#d1d1b6"},"text_style":{"title_size":"3.2rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":false,"family":null,"url":null},"social_links":{"enable":true,"links":{"github":"https://github.com/Charles2530/","zhihu":"https://www.zhihu.com/people/yang-guang-xiao-zi-55-55","email":"charles2530@163.com"},"qrs":{"weixin":"https://charles2530.github.io/image/background/Wechat_icon.png"}}},"plugins":{"feed":{"enable":true},"aplayer":{"enable":false,"type":"fixed","audios":[{"name":null,"artist":null,"url":null,"cover":null},{"name":null,"artist":null,"url":null,"cover":null}]},"mermaid":{"enable":true,"version":"9.3.0"}},"version":"2.4.4","navbar":{"auto_hide":true,"color":{"left":"#f78736","right":"#367df7","transparency":35},"links":{"Home":{"path":"/","icon":"fa-regular fa-house"},"Categories":{"path":"/categories","icon":"fas fa-bookmark"},"Tags":{"path":"/tags","icon":"fas fa-tags"},"About":{"icon":"fa-regular fa-user","submenus":{"Me":"/about","Github":"https://github.com/Charles2530/","Blog":"https://charles2530.github.io","Statistics":"https://tongji.baidu.com/"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":"This is Charles's Castle","links":{"Archives":{"path":"/archives","icon":"fa-regular fa-archive"},"Photos":{"icon":"fa-solid fa-image","path":"/masonry/"},"Essays":{"icon":"fa-solid fa-message-lines","path":"/essay/"},"Friends":{"icon":"fa-solid fa-user-group","path":"/friends/"}}},"article_date_format":"auto","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/12/27 00:00:00"};
    Global.language_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    Global.data_config = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="Charles's Castle" type="application/atom+xml">
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>



    <body>
        <div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
        <span class="swup-progress-icon">
            <i class="fa-solid fa-circle-notch fa-spin"></i>
        </span>
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container">
    
    <div class="navbar-content">
        <div class="left">
            
                <a class="logo-image" href="http://charles2530.github.io/">
                    <img src="https://charles2530.github.io/image/background/logo.jpg">
                </a>
            
            <a class="logo-title" href="http://charles2530.github.io/">
                
                Charles&#39;s Castle
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/"  >
                                    
                                        
                                            <i class="fa-regular fa-house"></i>
                                        
                                        HOME
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/categories"  >
                                    
                                        
                                            <i class="fas fa-bookmark"></i>
                                        
                                        CATEGORIES
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="" 
                                    href="/tags"  >
                                    
                                        
                                            <i class="fas fa-tags"></i>
                                        
                                        TAGS
                                    
                                </a>
                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown" 
                                    href="#" onClick="return false;">
                                    
                                        
                                            <i class="fa-regular fa-user"></i>
                                        
                                        ABOUT&nbsp;<i class="fa-solid fa-chevron-down"></i>
                                    
                                </a>
                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                    
                                        <li>
                                        <a href="/about">ME
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a href="https://charles2530.github.io">BLOG
                                        </a>
                                        </li>
                                    
                                        <li>
                                        <a target="_blank" rel="noopener" href="https://tongji.baidu.com/">STATISTICS
                                        </a>
                                        </li>
                                    
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile drawer -->
    <div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color">
        <ul class="drawer-navbar-list flex flex-col justify-start items-center">
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/"  >
                             
                                
                                    <i class="fa-regular fa-house"></i>
                                
                                HOME
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/categories"  >
                             
                                
                                    <i class="fas fa-bookmark"></i>
                                
                                CATEGORIES
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group " 
                        href="/tags"  >
                             
                                
                                    <i class="fas fa-tags"></i>
                                
                                TAGS
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                    
            
                
                    <li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center">
                        <a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group has-dropdown" 
                        href="#" onClick="return false;">
                            
                                
                                    <i class="fa-regular fa-user"></i>
                                
                                ABOUT&nbsp;<i class="group-hover:rotate-180 transition-transform fa-solid fa-chevron-down"></i>
                            
                        </a>
                    </li>
                    <!-- Submenu -->
                              
                        
                            <li class="text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="/about">ME</a>
                            </li>
                        
                            <li class="text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://github.com/Charles2530/">GITHUB</a>
                            </li>
                        
                            <li class="text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" href="https://charles2530.github.io">BLOG</a>
                            </li>
                        
                            <li class="text-base flex justify-center items-center hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                <a class="py-0.5" target="_blank" rel="noopener" href="https://tongji.baidu.com/">STATISTICS</a>
                            </li>
                        
                    
            

        </ul>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container">
    <div class="article-content-container">

        <div class="article-title">
            
                
                
                <img src="https://charles2530.github.io/image/background/p4.jfif" alt="P5 Design documents" class="max-w-none"/>
                
                <h1 class="article-title-cover">P5 Design documents</h1>
            
            </div>
            
                    
        
        
            <div class="article-header">
                <div class="avatar">
                    <img src="https://charles2530.github.io/image/background/logo2.jpg">
                </div>
                <div class="info">
                    <div class="author">
                        <span class="name">Charles</span>
                        
                            <span class="author-label">Lv6</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2022-12-26 21:10</span>
        <span class="mobile">2022-12-26 21:10</span>
        <span class="hover-info">Created</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2023-08-15 17:29:47</span>
            <span class="mobile">2023-08-15 17:29:47</span>
            <span class="hover-info">Updated</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/Lesson/">Lesson</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/Lesson/CO/">CO</a>&nbsp;
                        </li>
                    
                    
                
                    
                        
                            <li>></li>
                        
                        <li>
                            <a href="/categories/Lesson/CO/CO-files/">CO-files</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/CO/">CO</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>11.3k Words</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>54 Mins</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body">
            <h1 id="verilog流水线cpu设计文档"><a class="markdownIt-Anchor" href="#verilog流水线cpu设计文档"></a> Verilog流水线CPU设计文档</h1>
<h3 id="一-cpu设计方案综述"><a class="markdownIt-Anchor" href="#一-cpu设计方案综述"></a> 一、 CPU设计方案综述</h3>
<h4 id="一-总体设计概述"><a class="markdownIt-Anchor" href="#一-总体设计概述"></a> （一） 总体设计概述</h4>
<p>使用Verilog开发一个简单的流水线CPU，总体概述如下：</p>
<ol>
<li>
<p>此CPU为32位CPU</p>
</li>
<li>
<p>此CPU为流水线设计</p>
</li>
<li>
<p>此CPU支持的指令集为：</p>
<p>{add, sub, ori, lw, sw, beq, lui, nop,jal,j,jr}</p>
</li>
<li>
<p>add, sub不支持溢出</p>
</li>
</ol>
<h4 id="二-关键模块定义"><a class="markdownIt-Anchor" href="#二-关键模块定义"></a> （二） 关键模块定义</h4>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/simple_cpu.png"
                      alt="img" 
                ></p>
<h2 id="f级流水线"><a class="markdownIt-Anchor" href="#f级流水线"></a> F级流水线</h2>
<h4 id="1-pc"><a class="markdownIt-Anchor" href="#1-pc"></a> 1. PC</h4>
<p>（1） 端口说明</p>
<center>表1-IFU端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>同步复位信号，将PC值置为0x0000_3000：<br>0：无效<br>1：复位</td>
</tr>
<tr>
<td>3</td>
<td>en</td>
<td>I</td>
<td>使能信号，决定是否阻塞</td>
</tr>
<tr>
<td>4</td>
<td>NPC[31:0]</td>
<td>I</td>
<td>下一周期PC的地址</td>
</tr>
<tr>
<td>5</td>
<td>instr[31:0]</td>
<td>O</td>
<td>将IM中，要执行的指令输出</td>
</tr>
<tr>
<td>6</td>
<td>PC[31:0]</td>
<td>O</td>
<td>当前执行的PC</td>
</tr>
</tbody>
</table>
<p>（2） 功能定义</p>
<center>表2-IFU功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>复位</td>
<td>reset有效时，PC置为0x00000000</td>
</tr>
<tr>
<td>2</td>
<td>更新PC的值</td>
<td>将PC赋值为NPC</td>
</tr>
<tr>
<td>3</td>
<td>输出指令</td>
<td>根据PC的值，取出IM中的指令</td>
</tr>
</tbody>
</table>
<div class="tabs" id="tab-pc"><ul class="nav-tabs"><li class="tab active"><a class="#pc-1">PC</a></li><li class="tab"><a class="#pc-2">内置IM</a></li></ul><div class="tab-content"><div class="tab-pane active" id="pc-1"><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> PC(<span class="keyword">input</span> clk,</span><br><span class="line">          <span class="keyword">input</span> reset,</span><br><span class="line">          <span class="keyword">input</span> en,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] NPC,</span><br><span class="line">			 </span><br><span class="line">          <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] Instr,</span><br><span class="line">         <span class="comment">// output [31:0] PC8,</span></span><br><span class="line">          <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] PC</span><br><span class="line">			 );</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] now_PC = `PC_Initial;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">11</span>:<span class="number">0</span>] Address;</span><br><span class="line">    <span class="comment">//transfer</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            now_PC &lt;= `PC_Initial;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (en)<span class="keyword">begin</span></span><br><span class="line">                now_PC &lt;= NPC;</span><br><span class="line">					 <span class="keyword">if</span>(Instr!=<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                <span class="comment">//$display(&quot;%d Instr:%h,PC:%h&quot;,$time,Instr,PC);</span></span><br><span class="line">					 <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                now_PC &lt;= now_PC;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> Address = now_PC[<span class="number">13</span>:<span class="number">2</span>];</span><br><span class="line">    IM im(<span class="variable">.Address</span>(Address),<span class="variable">.Instr</span>(Instr));</span><br><span class="line">    <span class="keyword">assign</span> PC  = now_PC;</span><br><span class="line">    <span class="comment">//assign PC8  = now_PC+8;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="pc-2"><details class="green" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内置IM</span></span><br><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> IM(<span class="keyword">input</span> [<span class="number">11</span>:<span class="number">0</span>] Address,</span><br><span class="line">          <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] Instr);</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] _memory[<span class="number">12&#x27;hfff</span>:<span class="number">12&#x27;hc00</span>];</span><br><span class="line">    <span class="keyword">integer</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">12&#x27;hc00</span>;i&lt;=<span class="number">12&#x27;hfff</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">            _memory[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">		<span class="built_in">$readmemh</span>(<span class="string">&quot;code.txt&quot;</span>,_memory,(<span class="number">32&#x27;h3000</span>&gt;&gt;<span class="number">2</span>));</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> Instr = _memory[Address];</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div></div></div>
<h2 id="d级流水线"><a class="markdownIt-Anchor" href="#d级流水线"></a> D级流水线</h2>
<h4 id="1-grf"><a class="markdownIt-Anchor" href="#1-grf"></a> 1. GRF</h4>
<p>（1） 端口说明</p>
<center>表3-GRF端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>同步复位信号，将32个寄存器中全部清零<br>1：清零<br>0：无效</td>
</tr>
<tr>
<td>3</td>
<td>WE</td>
<td>I</td>
<td>写使能信号<br>1：可向GRF中写入数据<br>0：不能向GRF中写入数据</td>
</tr>
<tr>
<td>4</td>
<td>A1[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，将其中存储的数据读出到RD1</td>
</tr>
<tr>
<td>5</td>
<td>A2[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，将其中存储的数据读出到RD2</td>
</tr>
<tr>
<td>6</td>
<td>A3[4:0]</td>
<td>I</td>
<td>5位地址输入信号，指定32个寄存器中的一个，作为RD的写入地址</td>
</tr>
<tr>
<td>7</td>
<td>WD[31:0]</td>
<td>I</td>
<td>32位写入数据</td>
</tr>
<tr>
<td>8</td>
<td>WPC[31:0]</td>
<td>I</td>
<td>当前写入GRF的PC</td>
</tr>
<tr>
<td>9</td>
<td>RD1[31:0]</td>
<td>O</td>
<td>输出A1指定的寄存器的32位数据</td>
</tr>
<tr>
<td>10</td>
<td>RD2[31:0]</td>
<td>O</td>
<td>输出A2指定的寄存器的32位数据</td>
</tr>
</tbody>
</table>
<p>（2） 功能定义</p>
<center>表4-GRF功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>同步复位</td>
<td>reset为1时，将所有寄存器清零</td>
</tr>
<tr>
<td>2</td>
<td>读数据</td>
<td>将A1和A2地址对应的寄存器的值分别通过RD1和RD2读出</td>
</tr>
<tr>
<td>3</td>
<td>写数据</td>
<td>当WE为1且时钟上升沿来临时，将WD写入到A3对应的寄存器内部</td>
</tr>
<tr>
<td>4</td>
<td>内部转发</td>
<td>当A1和A2之一与A3相等且写入信号为1时，用WD代替RD1或RD2的输出</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> GRF(<span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] A1,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] A2,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] A3,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WD,</span><br><span class="line">           <span class="keyword">input</span> clk,</span><br><span class="line">           <span class="keyword">input</span> reset,</span><br><span class="line">           <span class="keyword">input</span> WE,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WPC,</span><br><span class="line">           <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RD1,</span><br><span class="line">           <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RD2);</span><br><span class="line">    <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] RF[<span class="number">31</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">integer</span> i = <span class="number">0</span>;</span><br><span class="line">	 <span class="keyword">wire</span> eq_A1,eq_A2;</span><br><span class="line">	 <span class="keyword">assign</span> eq_A1=(A1==A3)&amp;&amp;(A3!=<span class="number">0</span>)&amp;WE;	 </span><br><span class="line">	 <span class="keyword">assign</span> eq_A2=(A2==A3)&amp;&amp;(A3!=<span class="number">0</span>)&amp;WE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">            RF[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span>@(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">31</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                RF[i] &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (WE)<span class="keyword">begin</span></span><br><span class="line">                RF[A3] &lt;= WD;</span><br><span class="line">                RF[<span class="number">0</span>]  &lt;= <span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span> (A3!=<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">                    <span class="built_in">$display</span>(<span class="string">&quot;%d@%h: $%d &lt;= %h&quot;</span>,<span class="built_in">$time</span>, WPC, A3, WD);</span><br><span class="line">                <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                RF[A3] &lt;= RF[A3];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">assign</span> RD1 = eq_A1?WD:RF[A1];</span><br><span class="line">    <span class="keyword">assign</span> RD2 = eq_A2?WD:RF[A2];</span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="2-ext"><a class="markdownIt-Anchor" href="#2-ext"></a> 2. EXT</h4>
<p>(1) 端口说明</p>
<center>表9-EXT端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>imm16[15:0]</td>
<td>I</td>
<td>代扩展的16位信号</td>
</tr>
<tr>
<td>2</td>
<td>sign[2:0]</td>
<td>I</td>
<td>无符号或符号扩展选择信号<br/>3’b001：无符号扩展<br/>3’b010：符号扩展<br>3’b100:   寄存到高位</td>
</tr>
<tr>
<td>3</td>
<td>imm32[31:0]</td>
<td>O</td>
<td>扩展后的32位的信号</td>
</tr>
</tbody>
</table>
<p>(2) 功能定义</p>
<center>表10-EXT功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>无符号扩展</td>
<td>当sign为3’b001时，将imm16无符号扩展输出</td>
</tr>
<tr>
<td>2</td>
<td>符号扩展</td>
<td>当sign为3‘b010时，将imm16符号扩展输出</td>
</tr>
<tr>
<td>3</td>
<td>存储到高位</td>
<td>当sign为3’100时，将imm16存在高16位</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> EXT(<span class="keyword">input</span> [<span class="number">15</span>:<span class="number">0</span>] imm16,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">2</span>:<span class="number">0</span>] sign,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] imm32);</span><br><span class="line">    <span class="keyword">always</span> @(*)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (sign == <span class="number">3&#x27;b001</span>)<span class="keyword">begin</span></span><br><span class="line">            imm32 = &#123;&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,imm16&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (sign == <span class="number">3&#x27;b010</span>)<span class="keyword">begin</span></span><br><span class="line">            imm32 = &#123;&#123;<span class="number">16</span>&#123;imm16[<span class="number">15</span>]&#125;&#125;,imm16&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            imm32 = &#123;imm16,&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="3-controller"><a class="markdownIt-Anchor" href="#3-controller"></a> 3. Controller</h4>
<p>(1) 端口说明</p>
<center>表11-Controller端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>op[5:0]</td>
<td>I</td>
<td>instr[31:26]6位控制信号</td>
</tr>
<tr>
<td>2</td>
<td>func[5:0]</td>
<td>I</td>
<td>instr[5:0]6位控制信号</td>
</tr>
<tr>
<td>3</td>
<td>AluOp[6:0]</td>
<td>O</td>
<td>ALU的控制信号</td>
</tr>
<tr>
<td>4</td>
<td>WeGrf</td>
<td>O</td>
<td>GRF写使能信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>5</td>
<td>WeDm</td>
<td>O</td>
<td>DM的写入信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>6</td>
<td>branch[3:0]</td>
<td>O</td>
<td>PC转移位置选择信号<br>4’b0001:其他情况<br>4’b0010:beq<br>4’b0100:j||jal<br>4’b1000:jr;</td>
</tr>
<tr>
<td>7</td>
<td>AluSrc1[3:0]</td>
<td>O</td>
<td>参与ALU运算的第一个数<br/>4’b0001：RD1<br/>4’b0010：RD2</td>
</tr>
<tr>
<td>8</td>
<td>AluSrc2[3:0]</td>
<td>O</td>
<td>参与ALU运算的第二个数，来自GRF还是imm<br/>4’b0001：RD2<br/>4’b0010：imm32<br/>4’b0100: offset</td>
</tr>
<tr>
<td>9</td>
<td>WhichtoReg[3:0]</td>
<td>O</td>
<td>将何种数据写入GRF？<br/>4’b0001：ALU计算结果<br/>4’b0010：DM读出信号<br/>4’b0100：upperImm<br/>4’b1000: PC+4</td>
</tr>
<tr>
<td>10</td>
<td>RegDst[3:0]</td>
<td>O</td>
<td>写入GRF的哪个寄存器？<br>4’b0001:rd<br>4’b0010:rt<br>4’b0100:31号寄存器</td>
</tr>
<tr>
<td>11</td>
<td>SignExt[2:0]</td>
<td>O</td>
<td>拓展方式：<br>3’b001:0拓展<br>3’b010:符号拓展<br>3’b100:存储到高位</td>
</tr>
<tr>
<td>12</td>
<td>B_change[3:0]</td>
<td>O</td>
<td>B转移的类型<br>4’b0001:beq<br>4’b0010:slt<br>4’b0100:blez</td>
</tr>
<tr>
<td>13</td>
<td>DM_type[3:0]</td>
<td>O</td>
<td>存取指令类型：<br>4’b0001:lw/sw<br>4’b0010:lh/sh<br>4’b0100:lb/sb</td>
</tr>
<tr>
<td>14</td>
<td>D_Tuse_rs[1:0]</td>
<td>O</td>
<td>指令的rs寄存器的值从第一次进入D级到被使用的周期数</td>
</tr>
<tr>
<td>15</td>
<td>D_Tuse_rt[1:0]</td>
<td>O</td>
<td>指令的rt寄存器的值从第一次进入D级到被使用的周期数</td>
</tr>
<tr>
<td>16</td>
<td>D_Tnew[1:0]</td>
<td>O</td>
<td>指令从进入D开始到产生运算结果需要的周期数</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> Controller(<span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] op,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">5</span>:<span class="number">0</span>] func,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">6</span>:<span class="number">0</span>] ALUop,</span><br><span class="line">                  <span class="keyword">output</span> Wegrf,</span><br><span class="line">                  <span class="keyword">output</span> WeDm,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] branch,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] AluSrc1,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] AluSrc2,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">7</span>:<span class="number">0</span>] WhichtoReg,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] RegDst,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">2</span>:<span class="number">0</span>]SignExt,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] B_change,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">3</span>:<span class="number">0</span>] DM_type,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tuse_rs,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tuse_rt,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tnew);</span><br><span class="line"><span class="comment">//指令定义??</span></span><br><span class="line"><span class="keyword">wire</span> _addu,_subu,_ori,_lw,_sw,_lui,_beq,_andi,_jal,_j,_jr,_sll,_add,_sub,_slt,_lb,_sb,_lh,_sh,_addi,_and,_or,_sllv,_blez;</span><br><span class="line"><span class="comment">//R??</span></span><br><span class="line"><span class="keyword">assign</span> _addu = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b100001</span>);</span><br><span class="line"><span class="keyword">assign</span> _subu = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b100011</span>);</span><br><span class="line"><span class="keyword">assign</span> _add  = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b100000</span>);</span><br><span class="line"><span class="keyword">assign</span> _sub  = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b100010</span>);</span><br><span class="line"><span class="keyword">assign</span> _sll  = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b000000</span>);</span><br><span class="line"><span class="keyword">assign</span> _slt  = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b101010</span>);</span><br><span class="line"><span class="keyword">assign</span> _and  = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b100100</span>);</span><br><span class="line"><span class="keyword">assign</span> _or   = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b100101</span>);</span><br><span class="line"><span class="keyword">assign</span> _sllv = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b000100</span>);</span><br><span class="line"><span class="keyword">assign</span> _jr   = (op == <span class="number">6&#x27;b000000</span>)&amp;&amp;(func == <span class="number">6&#x27;b001000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//I??</span></span><br><span class="line"><span class="keyword">assign</span> _ori  = op == <span class="number">6&#x27;b001101</span>;</span><br><span class="line"><span class="keyword">assign</span> _lw   = op == <span class="number">6&#x27;b100011</span>;</span><br><span class="line"><span class="keyword">assign</span> _sw   = op == <span class="number">6&#x27;b101011</span>;</span><br><span class="line"><span class="keyword">assign</span> _lui  = op == <span class="number">6&#x27;b001111</span>;</span><br><span class="line"><span class="keyword">assign</span> _beq  = op == <span class="number">6&#x27;b000100</span>;</span><br><span class="line"><span class="keyword">assign</span> _andi = op == <span class="number">6&#x27;b001100</span>;</span><br><span class="line"><span class="keyword">assign</span> _addi = op == <span class="number">6&#x27;b001000</span>;</span><br><span class="line"><span class="keyword">assign</span> _lb   = op == <span class="number">6&#x27;b100000</span>;</span><br><span class="line"><span class="keyword">assign</span> _sb   = op == <span class="number">6&#x27;b101000</span>;</span><br><span class="line"><span class="keyword">assign</span> _lh   = op == <span class="number">6&#x27;b100001</span>;</span><br><span class="line"><span class="keyword">assign</span> _sh   = op == <span class="number">6&#x27;b101001</span>;</span><br><span class="line"><span class="keyword">assign</span> _blez = op == <span class="number">6&#x27;b000110</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//_j</span></span><br><span class="line"><span class="keyword">assign</span> _jal = op == <span class="number">6&#x27;b000011</span>;</span><br><span class="line"><span class="keyword">assign</span> _j   = op == <span class="number">6&#x27;b000010</span>;</span><br><span class="line"><span class="comment">//输出定义</span></span><br><span class="line"><span class="comment">/////////////////////////////////////</span></span><br><span class="line"><span class="comment">//category</span></span><br><span class="line"><span class="keyword">wire</span> calc_r,calc_i,shift,shift_v,load,store,b_type,j_type;</span><br><span class="line"><span class="keyword">assign</span> calc_r  = _add||_sub||_addu||_subu||_and||_or||_slt;</span><br><span class="line"><span class="keyword">assign</span> calc_i  = _andi||_ori;</span><br><span class="line"><span class="keyword">assign</span> shift   = _sll;</span><br><span class="line"><span class="keyword">assign</span> shift_v = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">assign</span> load    = _lw||_lh||_lb;</span><br><span class="line"><span class="keyword">assign</span> store   = _sw||_sh||_sb;</span><br><span class="line"><span class="keyword">assign</span> b_type  = _beq;</span><br><span class="line"><span class="keyword">assign</span> j_type  = _jal||_j;</span><br><span class="line"><span class="comment">/////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> ALUop_6,ALUop_5,ALUop_4,ALUop_3,ALUop_2,ALUop_1,ALUop_0;</span><br><span class="line"><span class="keyword">assign</span> ALUop_0 = ~ALUop_6&amp;&amp;~ALUop_5&amp;&amp;~ALUop_4&amp;&amp;~ALUop_3&amp;&amp;~ALUop_2&amp;&amp;~ALUop_1;</span><br><span class="line"><span class="keyword">assign</span> ALUop_1 = _subu||_sub;</span><br><span class="line"><span class="keyword">assign</span> ALUop_2 = _andi||_and;</span><br><span class="line"><span class="keyword">assign</span> ALUop_3 = _ori||_or;</span><br><span class="line"><span class="keyword">assign</span> ALUop_4 = _sll||_sllv;</span><br><span class="line"><span class="keyword">assign</span> ALUop_5 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">assign</span> ALUop_6 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> branch_3,branch_2,branch_1,branch_0;</span><br><span class="line"><span class="keyword">assign</span> branch_0 = ~branch_3&amp;&amp;~branch_2&amp;&amp;~branch_1;</span><br><span class="line"><span class="keyword">assign</span> branch_1 = _beq||_blez;</span><br><span class="line"><span class="keyword">assign</span> branch_2 = _j||_jal;</span><br><span class="line"><span class="keyword">assign</span> branch_3 = _jr;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> AluSrc1_3,AluSrc1_2,AluSrc1_1,AluSrc1_0;</span><br><span class="line"><span class="keyword">assign</span> AluSrc1_0 = ~AluSrc1_3&amp;&amp;~AluSrc1_2&amp;&amp;~AluSrc1_1;</span><br><span class="line"><span class="keyword">assign</span> AluSrc1_1 = _sll;</span><br><span class="line"><span class="keyword">assign</span> AluSrc1_2 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">assign</span> AluSrc1_3 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> AluSrc2_3,AluSrc2_2,AluSrc2_1,AluSrc2_0;</span><br><span class="line"><span class="keyword">assign</span> AluSrc2_0   = ~AluSrc2_3&amp;&amp;~AluSrc2_2&amp;&amp;~AluSrc2_1;</span><br><span class="line"><span class="keyword">assign</span> AluSrc2_1   = _lw||_sw||_ori||_andi||_sb||_lb||_sh||_lh||_addi||_lui;</span><br><span class="line"><span class="keyword">assign</span> AluSrc2_2   = _sll;</span><br><span class="line"><span class="comment">//assign AluSrc2_2 = 1&#x27;b0;</span></span><br><span class="line"><span class="keyword">assign</span> AluSrc2_3   = _blez;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> WhichtoReg_7,WhichtoReg_6,WhichtoReg_5,WhichtoReg_4,WhichtoReg_3,WhichtoReg_2,WhichtoReg_1,WhichtoReg_0;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_0 = ~WhichtoReg_1&amp;&amp;~WhichtoReg_2&amp;&amp;~WhichtoReg_3&amp;&amp;~WhichtoReg_4&amp;&amp;~WhichtoReg_5&amp;&amp;~WhichtoReg_6&amp;&amp;~WhichtoReg_7;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_1 = _lw||_lh||_lb;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_2 = _lui;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_3 = _jal;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_4 = _slt;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_5 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_6 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg_7 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> RegDst_3,RegDst_2,RegDst_1,RegDst_0;</span><br><span class="line"><span class="keyword">assign</span> RegDst_0 = ~RegDst_1&amp;&amp;~RegDst_2&amp;&amp;~RegDst_3;</span><br><span class="line"><span class="keyword">assign</span> RegDst_1 = _beq||_lui||_lw||_sw||_ori||_andi||_sh||_lh||_sb||_lb||_addi;</span><br><span class="line"><span class="keyword">assign</span> RegDst_2 = _jal;</span><br><span class="line"><span class="keyword">assign</span> RegDst_3 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> SignExt_2,SignExt_1,SignExt_0;</span><br><span class="line"><span class="keyword">assign</span> SignExt_0 = ~SignExt_1&amp;&amp;~SignExt_2;</span><br><span class="line"><span class="keyword">assign</span> SignExt_1 = _lw||_sw||_beq||_andi||_lh||_sh||_lb||_sb||_blez||_addi;</span><br><span class="line"><span class="keyword">assign</span> SignExt_2 = _lui;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> B_change_3,B_change_2,B_change_1,B_change_0;</span><br><span class="line"><span class="keyword">assign</span> B_change_0 = _beq;</span><br><span class="line"><span class="keyword">assign</span> B_change_1 = _slt;</span><br><span class="line"><span class="keyword">assign</span> B_change_2 = _blez;</span><br><span class="line"><span class="keyword">assign</span> B_change_3 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="comment">/////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> DM_type_3,DM_type_2,DM_type_1,DM_type_0;</span><br><span class="line"><span class="keyword">assign</span> DM_type_0 = _lw||_sw;</span><br><span class="line"><span class="keyword">assign</span> DM_type_1 = _lh||_sh;</span><br><span class="line"><span class="keyword">assign</span> DM_type_2 = _lb||_sb;</span><br><span class="line"><span class="keyword">assign</span> DM_type_3 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> D_Tuse_rs_1,D_Tuse_rs_0;</span><br><span class="line"><span class="keyword">assign</span>  D_Tuse_rs_1 = <span class="number">1&#x27;b0</span>;</span><br><span class="line"><span class="keyword">assign</span>  D_Tuse_rs_0 = calc_r||calc_i||shift_v||load||store;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">wire</span> D_Tuse_rt_1,D_Tuse_rt_0;</span><br><span class="line"><span class="keyword">assign</span>  D_Tuse_rt_1 = store;</span><br><span class="line"><span class="keyword">assign</span>  D_Tuse_rt_0 = calc_r||shift||shift_v;</span><br><span class="line"><span class="comment">//////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">//输出结果??</span></span><br><span class="line"><span class="keyword">assign</span> ALUop      = &#123;ALUop_6,ALUop_5,ALUop_4,ALUop_3,ALUop_2,ALUop_1,ALUop_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> Wegrf      = _sub||_addu||_subu||_ori||_lui||_sll||_jal||_andi||_lw||_add;</span><br><span class="line"><span class="keyword">assign</span> WeDm       = _sw||_sh||_sb;</span><br><span class="line"><span class="keyword">assign</span> branch     = &#123;branch_3,branch_2,branch_1,branch_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> AluSrc1    = &#123;AluSrc1_3,AluSrc1_2,AluSrc1_1,AluSrc1_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> AluSrc2    = &#123;AluSrc2_3,AluSrc2_2,AluSrc2_1,AluSrc2_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> WhichtoReg = &#123;WhichtoReg_7,WhichtoReg_6,WhichtoReg_5,WhichtoReg_4,WhichtoReg_3,WhichtoReg_2,WhichtoReg_1,WhichtoReg_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> RegDst     = &#123;RegDst_3,RegDst_2,RegDst_1,RegDst_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> SignExt    = &#123;SignExt_2,SignExt_1,SignExt_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> B_change   = &#123;B_change_3,B_change_2,B_change_1,B_change_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> DM_type    = &#123;DM_type_3,DM_type_2,DM_type_1,DM_type_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> D_Tuse_rs  = &#123;D_Tuse_rs_1,D_Tuse_rs_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> D_Tuse_rt  = &#123;D_Tuse_rt_1,D_Tuse_rt_0&#125;;</span><br><span class="line"><span class="keyword">assign</span> D_Tnew = (load)?<span class="number">2&#x27;d3</span>:</span><br><span class="line">(calc_i||calc_r||shift||shift_v)?<span class="number">2&#x27;d2</span>:</span><br><span class="line">(_lui)?<span class="number">2&#x27;d1</span>:</span><br><span class="line"><span class="number">2&#x27;d0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="4npc下一指令计算单元"><a class="markdownIt-Anchor" href="#4npc下一指令计算单元"></a> 4.NPC（下一指令计算单元）</h4>
<p>该模块根据当前pc（包括D级和F级）和其他控制信号（NPCOp，CMP输出信息），计算出下一指令所在的地址npc，传入IFU模块。</p>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">信号名</th>
<th style="text-align:left">方向</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">F_pc</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级指令地址</td>
</tr>
<tr>
<td style="text-align:left">D_pc</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级指令地址</td>
</tr>
<tr>
<td style="text-align:left">offset</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">地址偏移量，用于计算B类指令所要跳转的地址</td>
</tr>
<tr>
<td style="text-align:left">imm26</td>
<td style="text-align:left">I</td>
<td style="text-align:left">26</td>
<td style="text-align:left">当前指令数据的前26位（0~25），用于计算jal和j指令所要跳转的地址</td>
</tr>
<tr>
<td style="text-align:left">ra</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">储存在寄存器（$ra或是jalr指令中存储“PC+4”的寄存器）中的地址数据，用于实现jr和jalr指令</td>
</tr>
<tr>
<td style="text-align:left">ALU_change</td>
<td style="text-align:left">I</td>
<td style="text-align:left">1</td>
<td style="text-align:left">B类指令判断结果 1：说明当前B类指令的判断结果为真 0：说明判断结果为假</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">I</td>
<td style="text-align:left">4</td>
<td style="text-align:left">NPC功能选择 0x000：顺序执行 0x001：B类指令跳转 0x010: jal/j跳转 0x011: jr/jalr跳转</td>
</tr>
<tr>
<td style="text-align:left">npc</td>
<td style="text-align:left">O</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输出下一指令地址</td>
</tr>
<tr>
<td style="text-align:left">PC8</td>
<td style="text-align:left">O</td>
<td style="text-align:left">32</td>
<td style="text-align:left">jr指令时存储PC+8的值</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> NPC(<span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] F_PC,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] D_PC,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] offset,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">25</span>:<span class="number">0</span>] imm26,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] ra,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] branch,</span><br><span class="line">           <span class="keyword">input</span> ALU_change,</span><br><span class="line">			  </span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] npc,</span><br><span class="line">			  <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] PC8</span><br><span class="line">			  );</span><br><span class="line"><span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] PC4;</span><br><span class="line"><span class="comment">//wire [31:0] PC8;</span></span><br><span class="line"><span class="keyword">assign</span> PC4 = F_PC+<span class="number">4</span>;</span><br><span class="line"><span class="keyword">assign</span> PC8 = D_PC+<span class="number">8</span>;</span><br><span class="line"><span class="keyword">always</span> @(*)<span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">if</span> (branch == <span class="number">4&#x27;b0001</span>)<span class="keyword">begin</span></span><br><span class="line">        npc = PC4;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (branch == <span class="number">4&#x27;b0010</span>)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (ALU_change)<span class="keyword">begin</span></span><br><span class="line">            npc = D_PC + <span class="number">4</span> +&#123;offset[<span class="number">29</span>:<span class="number">0</span>],&#123;<span class="number">2</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            npc = D_PC + <span class="number">8</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">	 <span class="keyword">else</span> <span class="keyword">if</span> (branch == <span class="number">4&#x27;b0100</span>)<span class="keyword">begin</span></span><br><span class="line">	     npc = &#123;D_PC[<span class="number">31</span>:<span class="number">28</span>],imm26,&#123;<span class="number">2</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;&#125;;</span><br><span class="line">		  <span class="comment">//F_Instr=0;</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">        npc = ra;</span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="5b_transferb类指令比较单元"><a class="markdownIt-Anchor" href="#5b_transferb类指令比较单元"></a> 5.B_transfer(B类指令比较单元)</h4>
<p>该单元根据输入的CMPOp信号对当前B指令的类型进行判断，进而对当前输入的数值进行相应比较，最后输出结果。</p>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">信号名</th>
<th style="text-align:left">方向</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">A</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输入B_transfer单元的第一个数据</td>
</tr>
<tr>
<td style="text-align:left">B</td>
<td style="text-align:left">I</td>
<td style="text-align:left">32</td>
<td style="text-align:left">输入B_transfer单元的第二个数据</td>
</tr>
<tr>
<td style="text-align:left">Type</td>
<td style="text-align:left">I</td>
<td style="text-align:left">4</td>
<td style="text-align:left">Type功能选择信号<br> 0x0001：beq判断<br> 0x0010：slt判断 <br>0x0100：blez判断</td>
</tr>
<tr>
<td style="text-align:left">ALU_change</td>
<td style="text-align:left">O</td>
<td style="text-align:left">1</td>
<td style="text-align:left">判断结果输出 <br>1: 判断结果为真<br> 0：判断结果为假</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> B_transfer(<span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] A,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] B,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] Type,</span><br><span class="line">                  <span class="keyword">output</span> ALU_change);</span><br><span class="line"><span class="keyword">wire</span> eq,less,more;</span><br><span class="line"><span class="comment">//calc ALU_change</span></span><br><span class="line"><span class="keyword">assign</span> eq   = (A == B);</span><br><span class="line"><span class="keyword">assign</span> less = <span class="built_in">$signed</span>(A)&lt;<span class="built_in">$signed</span>(B);</span><br><span class="line"><span class="keyword">assign</span> more = <span class="built_in">$signed</span>(A)&gt;<span class="built_in">$signed</span>(B);</span><br><span class="line"><span class="comment">//calc B</span></span><br><span class="line"><span class="keyword">wire</span> beq,slt,blez;</span><br><span class="line"><span class="keyword">assign</span> beq  = eq;</span><br><span class="line"><span class="keyword">assign</span> slt  = less;</span><br><span class="line"><span class="keyword">assign</span> blez = eq||less;</span><br><span class="line"><span class="comment">//mux</span></span><br><span class="line"><span class="keyword">assign</span> ALU_change = (Type == <span class="number">4&#x27;b0001</span>)?beq:</span><br><span class="line">(Type == <span class="number">4&#x27;b0010</span>)?slt:</span><br><span class="line">(Type == <span class="number">4&#x27;b0100</span>)?blez:</span><br><span class="line"><span class="number">1&#x27;b0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="e级流水线"><a class="markdownIt-Anchor" href="#e级流水线"></a> E级流水线</h2>
<h4 id="1-alu"><a class="markdownIt-Anchor" href="#1-alu"></a> 1. ALU</h4>
<p>(1) 端口说明</p>
<center>表5-ALU端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>A[31:0]</td>
<td>I</td>
<td>参与运算的第一个数</td>
</tr>
<tr>
<td>2</td>
<td>B[31:0]</td>
<td>I</td>
<td>参与运算的第二个数</td>
</tr>
<tr>
<td>3</td>
<td>ALUop[6:0]</td>
<td>I</td>
<td>决定ALU做何种操作<br>7’b000001：无符号加<br/>7’b000010：无符号减<br/>7’b000100：与<br/>7’b001000：或<br/>7’b010000：左移位运算</td>
</tr>
<tr>
<td>4</td>
<td>res</td>
<td>O</td>
<td>A与B做运算后的结果</td>
</tr>
</tbody>
</table>
<p>(2) 功能定义</p>
<center>表6-ALU功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>加运算</td>
<td>res = A + B</td>
</tr>
<tr>
<td>2</td>
<td>减运算</td>
<td>res = A - B</td>
</tr>
<tr>
<td>3</td>
<td>与运算</td>
<td>res = A &amp; B</td>
</tr>
<tr>
<td>4</td>
<td>或运算</td>
<td>res = A | B</td>
</tr>
<tr>
<td>5</td>
<td>左移位运算</td>
<td>Res=A&lt;&lt;B</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> ALU(<span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] A,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] B,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">6</span>:<span class="number">0</span>] ALUop,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span>[<span class="number">31</span>:<span class="number">0</span>] res);</span><br><span class="line"><span class="comment">//calc res</span></span><br><span class="line"><span class="keyword">always</span> @(*)<span class="keyword">begin</span></span><br><span class="line">    <span class="keyword">case</span>(ALUop)</span><br><span class="line">        `_ADD:</span><br><span class="line">        res = A+B;</span><br><span class="line">        `_SUB:</span><br><span class="line">        res = A+~B+<span class="number">1</span>;</span><br><span class="line">        `_AND:</span><br><span class="line">        res = A&amp;B;</span><br><span class="line">        `_OR:</span><br><span class="line">        res = A|B;</span><br><span class="line">        `_SLL:</span><br><span class="line">        res         = A&lt;&lt;B;</span><br><span class="line">        <span class="keyword">default</span>:res = <span class="number">32&#x27;d0</span>;</span><br><span class="line">    <span class="keyword">endcase</span></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="m级流水线"><a class="markdownIt-Anchor" href="#m级流水线"></a> M级流水线</h2>
<h4 id="1-dm"><a class="markdownIt-Anchor" href="#1-dm"></a> 1. DM</h4>
<p>(1) 端口说明</p>
<center>表7-DM端口说明</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>信号名</th>
<th>方向</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>clk</td>
<td>I</td>
<td>时钟信号</td>
</tr>
<tr>
<td>2</td>
<td>reset</td>
<td>I</td>
<td>异步复位信号<br/>0：无效<br/>1：内存值全部清零</td>
</tr>
<tr>
<td>3</td>
<td>WE</td>
<td>I</td>
<td>写使能信号<br/>0：禁止写入<br/>1：允许写入</td>
</tr>
<tr>
<td>4</td>
<td>Address[31:0]</td>
<td>I</td>
<td>读取或写入信号地址</td>
</tr>
<tr>
<td>5</td>
<td>WD[31:0]</td>
<td>I</td>
<td>32为写入数据</td>
</tr>
<tr>
<td>6</td>
<td>pc[31:0]</td>
<td>I</td>
<td>当前输入DM的PC值（用于测试）</td>
</tr>
<tr>
<td>7</td>
<td>RD[31:0]</td>
<td>O</td>
<td>32位读出数据</td>
</tr>
<tr>
<td>8</td>
<td>DM_type[3:0]</td>
<td>O</td>
<td>决定存取指令类型<br>4’b0001 lw/sw<br>4’b0010 lh/sh<br>4’b0100 lb/sb</td>
</tr>
</tbody>
</table>
<p>(2) 功能定义</p>
<center>表8-DM功能定义</center>
<table>
<thead>
<tr>
<th>序号</th>
<th>功能</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>异步复位</td>
<td>当reset为1时，DM中所有数据清零</td>
</tr>
<tr>
<td>2</td>
<td>写入数据</td>
<td>当WE有效时，时钟上升沿来临时，WD中数据写入A对应的DM地址中</td>
</tr>
<tr>
<td>3</td>
<td>读出数据</td>
<td>RD永远读出A对应的DM地址中的值</td>
</tr>
</tbody>
</table>
<div class="tabs" id="tab-dm"><ul class="nav-tabs"><li class="tab active"><a class="#dm-1">DM</a></li><li class="tab"><a class="#dm-2">DM_in</a></li><li class="tab"><a class="#dm-3">DM_out</a></li></ul><div class="tab-content"><div class="tab-pane active" id="dm-1"><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> DM(<span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] Address,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WD,</span><br><span class="line">          <span class="keyword">input</span> clk,</span><br><span class="line">          <span class="keyword">input</span> reset,</span><br><span class="line">          <span class="keyword">input</span> WE,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] DM_type,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] pc,</span><br><span class="line">          <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RD);</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">1</span>:<span class="number">0</span>] low2;</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] new_h,new_b,DM_input,DM_output;</span><br><span class="line">    <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>]dm[<span class="number">3071</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> low2 = Address[<span class="number">1</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">integer</span> i   = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">3071</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">            dm[i] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">for</span>(i=<span class="number">0</span>;i&lt;=<span class="number">3071</span>;i=i+<span class="number">1</span>)<span class="keyword">begin</span></span><br><span class="line">                dm[i] &lt;= <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (WE)<span class="keyword">begin</span></span><br><span class="line">                dm[Address[<span class="number">13</span>:<span class="number">2</span>]]    &lt;= DM_input;</span><br><span class="line">                <span class="built_in">$display</span>(<span class="string">&quot;%d@%h: *%h &lt;= %h&quot;</span>,<span class="built_in">$time</span>, pc, Address,DM_input);</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">                dm[Address[<span class="number">13</span>:<span class="number">2</span>]] &lt;= dm[Address[<span class="number">13</span>:<span class="number">2</span>]];</span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    DM_In din(<span class="variable">.low2</span>(low2),<span class="variable">.WD</span>(WD),<span class="variable">.RD</span>(DM_output),<span class="variable">.new_h</span>(new_h),<span class="variable">.new_b</span>(new_b));</span><br><span class="line">    <span class="keyword">assign</span> DM_input = (DM_type == <span class="number">4&#x27;b0001</span>)?WD:</span><br><span class="line">    (DM_type == <span class="number">4&#x27;b0010</span>)?new_h:</span><br><span class="line">    new_b;</span><br><span class="line">    <span class="keyword">assign</span> DM_output = dm[Address[<span class="number">13</span>:<span class="number">2</span>]];</span><br><span class="line">    DM_Out dot(<span class="variable">.low2</span>(low2),<span class="variable">.DM_type</span>(DM_type),<span class="variable">.DM_output</span>(DM_output),<span class="variable">.RD</span>(RD));</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="dm-2"><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DM_In DM输入信号</span></span><br><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> DM_In(<span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] low2,</span><br><span class="line">             <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] WD,</span><br><span class="line">             <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] RD,</span><br><span class="line">             <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] new_h,</span><br><span class="line">             <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] new_b);</span><br><span class="line"><span class="comment">//initial</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] WD0,WD1,WD2,WD3,RD0,RD1,RD2,RD3;</span><br><span class="line"><span class="keyword">assign</span> WD0 = WD[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">assign</span> WD1 = WD[<span class="number">15</span>:<span class="number">8</span>];</span><br><span class="line"><span class="keyword">assign</span> WD2 = WD[<span class="number">23</span>:<span class="number">16</span>];</span><br><span class="line"><span class="keyword">assign</span> WD3 = WD[<span class="number">31</span>:<span class="number">24</span>];</span><br><span class="line"><span class="keyword">assign</span> RD0 = RD[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line"><span class="keyword">assign</span> RD1 = RD[<span class="number">15</span>:<span class="number">8</span>];</span><br><span class="line"><span class="keyword">assign</span> RD2 = RD[<span class="number">23</span>:<span class="number">16</span>];</span><br><span class="line"><span class="keyword">assign</span> RD3 = RD[<span class="number">31</span>:<span class="number">24</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//lb,sb</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] new_b3,new_b2,new_b1,new_b0;</span><br><span class="line"><span class="keyword">assign</span> new_b0 = (low2 == <span class="number">2&#x27;b00</span>)?WD0:RD0;</span><br><span class="line"><span class="keyword">assign</span> new_b1 = (low2 == <span class="number">2&#x27;b01</span>)?WD1:RD1;</span><br><span class="line"><span class="keyword">assign</span> new_b2 = (low2 == <span class="number">2&#x27;b10</span>)?WD2:RD2;</span><br><span class="line"><span class="keyword">assign</span> new_b3 = (low2 == <span class="number">2&#x27;b11</span>)?WD3:RD3;</span><br><span class="line"><span class="keyword">assign</span> new_b  = &#123;new_b3,new_b2,new_b1,new_b0&#125;;</span><br><span class="line"><span class="comment">//lh,sh</span></span><br><span class="line"><span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] new_h3,new_h2,new_h1,new_h0;</span><br><span class="line"><span class="keyword">assign</span> new_h0 = (low2 == <span class="number">2&#x27;b00</span>)?WD0:RD0;</span><br><span class="line"><span class="keyword">assign</span> new_h1 = (low2 == <span class="number">2&#x27;b00</span>)?WD1:RD1;</span><br><span class="line"><span class="keyword">assign</span> new_h2 = (low2 == <span class="number">2&#x27;b10</span>)?WD2:RD2;</span><br><span class="line"><span class="keyword">assign</span> new_h3 = (low2 == <span class="number">2&#x27;b10</span>)?WD3:RD3;</span><br><span class="line"><span class="keyword">assign</span> new_h  = &#123;new_h3,new_h2,new_h1,new_h0&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div><div class="tab-pane" id="dm-3"><details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DM_Out DM输出信号</span></span><br><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> DM_Out(<span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] low2,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] DM_type,</span><br><span class="line">              <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] DM_output,</span><br><span class="line">              <span class="keyword">output</span> [<span class="number">31</span>:<span class="number">0</span>] RD);</span><br><span class="line">    <span class="keyword">wire</span> DM_output_3,DM_output_2,DM_output_1,DM_output_0;</span><br><span class="line">    <span class="keyword">assign</span> DM_output_0 = DM_output[<span class="number">7</span>:<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">assign</span> DM_output_1 = DM_output[<span class="number">15</span>:<span class="number">8</span>];</span><br><span class="line">    <span class="keyword">assign</span> DM_output_2 = DM_output[<span class="number">23</span>:<span class="number">16</span>];</span><br><span class="line">    <span class="keyword">assign</span> DM_output_3 = DM_output[<span class="number">31</span>:<span class="number">24</span>];</span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">31</span>:<span class="number">0</span>] out_h,out_b;</span><br><span class="line">    <span class="comment">//sb,lb</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">7</span>:<span class="number">0</span>] low_b;</span><br><span class="line">    <span class="keyword">assign</span> low_b = (low2 == <span class="number">2&#x27;b00</span>)?DM_output_0:</span><br><span class="line">    (low2 == <span class="number">2&#x27;b01</span>)?DM_output_1:</span><br><span class="line">    (low2 == <span class="number">2&#x27;b10</span>)?DM_output_2:</span><br><span class="line">    DM_output_3;</span><br><span class="line">    <span class="keyword">assign</span> out_b = &#123;&#123;<span class="number">24</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,low_b&#125;;</span><br><span class="line">    <span class="comment">//sh,lh</span></span><br><span class="line">    <span class="keyword">wire</span> [<span class="number">15</span>:<span class="number">0</span>] low_h;</span><br><span class="line">    <span class="keyword">assign</span> low_h = (low2 == <span class="number">2&#x27;b00</span>)?&#123;DM_output_1,DM_output_0&#125;:</span><br><span class="line">    &#123;DM_output_3,DM_output_2&#125;;</span><br><span class="line">    <span class="keyword">assign</span> out_h = &#123;&#123;<span class="number">16</span>&#123;<span class="number">1&#x27;b0</span>&#125;&#125;,low_h&#125;;</span><br><span class="line">    <span class="comment">//output</span></span><br><span class="line">    <span class="keyword">assign</span> RD = (DM_type == <span class="number">4&#x27;b0001</span>)?DM_output:</span><br><span class="line">    (DM_type == <span class="number">4&#x27;b0010</span>)?out_h:</span><br><span class="line">    out_b;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details></div></div></div>
<h2 id="各级流水线寄存器"><a class="markdownIt-Anchor" href="#各级流水线寄存器"></a> 各级流水线寄存器</h2>
<h4 id="1if_id"><a class="markdownIt-Anchor" href="#1if_id"></a> 1.IF_ID</h4>
<h4 id="d_regifid流水寄存器"><a class="markdownIt-Anchor" href="#d_regifid流水寄存器"></a> D_Reg（IF/ID流水寄存器）</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">en</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级寄存器使能信号</td>
<td style="text-align:left">stall信号取反</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_instr</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级instr输入</td>
<td style="text-align:left">IFU_instr</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_pc</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级pc输入</td>
<td style="text-align:left">IFU_pc</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">F_pc8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">F级pc8输入</td>
<td style="text-align:left">IFU_pc + 8</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_instr</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级instr输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_pc</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级pc输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">D_pc8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级pc8输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="meta">`<span class="keyword">include</span> &quot;macro.v&quot;</span></span><br><span class="line"><span class="keyword">module</span> IF(<span class="keyword">input</span> clk,</span><br><span class="line">          <span class="keyword">input</span> reset,</span><br><span class="line">          <span class="keyword">input</span> en,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] F_Instr,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] F_PC,</span><br><span class="line">         <span class="comment">// input [31:0] F_PC8,</span></span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] D_Instr,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] D_PC</span><br><span class="line">          <span class="comment">//output reg [31:0] D_PC8</span></span><br><span class="line">			 );</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            D_Instr &lt;= <span class="number">0</span>;</span><br><span class="line">            D_PC    &lt;= `PC_Initial;</span><br><span class="line">           <span class="comment">// D_PC8   &lt;= 0;</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            <span class="keyword">if</span> (en)<span class="keyword">begin</span></span><br><span class="line">                D_Instr &lt;= F_Instr;</span><br><span class="line">                D_PC    &lt;= F_PC;</span><br><span class="line">               <span class="comment">// D_PC8   &lt;= F_PC8;</span></span><br><span class="line">            <span class="keyword">end</span></span><br><span class="line">				<span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">					 D_Instr &lt;= D_Instr;</span><br><span class="line">                D_PC    &lt;= D_PC;</span><br><span class="line">              <span class="comment">//  D_PC8   &lt;= D_PC8;</span></span><br><span class="line">				<span class="keyword">end</span></span><br><span class="line">            <span class="comment">//$display(&quot;%d F_Instr:%h F_PC:%h&quot;,$time,F_Instr,F_PC);</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h4 id="2id_ex"><a class="markdownIt-Anchor" href="#2id_ex"></a> 2.ID_EX</h4>
<h4 id="e_regidex流水寄存器"><a class="markdownIt-Anchor" href="#e_regidex流水寄存器"></a> E_Reg（ID/EX流水寄存器）</h4>
<ul>
<li><strong>端口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clr</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级寄存器清空信号</td>
<td style="text-align:left">HazardUnit中stall信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RD1</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级GRF输出RD1</td>
<td style="text-align:left">通过B_transfer_D1转发的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级GRF输出RD2</td>
<td style="text-align:left">通过B_transfer_D2转发的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_instr_s</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级instr的shamt</td>
<td style="text-align:left">D_instr的s域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A1输入</td>
<td style="text-align:left">D_instr的rs域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A2输入</td>
<td style="text-align:left">D_instr的rt域数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A3输入</td>
<td style="text-align:left">通过MUX_A3选择出的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级imm32输入</td>
<td style="text-align:left">通过EXT模块扩展出的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">D级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">Tnew_D</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D级指令的Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_ALUop</td>
<td style="text-align:left">7</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_AluSrc1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_AluSrc2</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_DM_type</td>
<td style="text-align:left">4</td>
<td style="text-align:left">D级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RD1</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD1输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_instr_s</td>
<td style="text-align:left">5</td>
<td style="text-align:left">移位指令的位移数</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A1输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级指令的Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_ALUop</td>
<td style="text-align:left">7</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_AluSrc1</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_AluSrc2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_RegDst</td>
<td style="text-align:left">3</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">E_DM_type</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>运算功能</strong></p>
<p>Tnew_E = (Tnew_D &gt; 0) ? Tnew_D - 1: 0Tnew_E=(Tnew_D&gt;0)?Tnew_D−1:0</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> ID(<span class="keyword">input</span> clk,</span><br><span class="line">          <span class="keyword">input</span> reset,</span><br><span class="line">          <span class="keyword">input</span> clr,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] D_RD1,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] D_RD2,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_instr_s,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A1,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A2,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A3,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] D_imm32,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] D_PC,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] D_PC8,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tnew,</span><br><span class="line">          <span class="keyword">input</span> D_Wegrf,</span><br><span class="line">          <span class="keyword">input</span> D_WeDm,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">6</span>:<span class="number">0</span>] D_ALUop,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] D_AluSrc1,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] D_AluSrc2,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] D_WhichtoReg,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] D_RegDst,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] D_DM_type,</span><br><span class="line"></span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] E_RD1,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] E_RD2,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] E_instr_s,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] E_A1,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] E_A2,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] E_A3,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] E_imm32,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] E_PC,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] E_PC8,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] E_Tnew,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> E_Wegrf,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> E_WeDm,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">6</span>:<span class="number">0</span>] E_ALUop,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] E_AluSrc1,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] E_AluSrc2,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] E_WhichtoReg,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] E_RegDst,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] E_DM_type</span><br><span class="line">          );</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset || clr)<span class="keyword">begin</span></span><br><span class="line">		  <span class="comment">//if(reset)begin</span></span><br><span class="line">            E_instr_s    &lt;= <span class="number">0</span>;</span><br><span class="line">            E_RD1        &lt;= <span class="number">0</span>;</span><br><span class="line">            E_RD2        &lt;= <span class="number">0</span>;</span><br><span class="line">            E_A1         &lt;= <span class="number">0</span>;</span><br><span class="line">            E_A2         &lt;= <span class="number">0</span>;</span><br><span class="line">            E_A3         &lt;= <span class="number">0</span>;</span><br><span class="line">            E_imm32      &lt;= <span class="number">0</span>;</span><br><span class="line">            E_PC         &lt;= <span class="number">0</span>;</span><br><span class="line">            E_PC8        &lt;= <span class="number">0</span>;</span><br><span class="line">				E_Tnew &lt;=<span class="number">0</span>;</span><br><span class="line">            E_Wegrf      &lt;= <span class="number">0</span>;</span><br><span class="line">            E_WeDm       &lt;= <span class="number">0</span>;</span><br><span class="line">            E_ALUop      &lt;= <span class="number">7&#x27;b0000001</span>;</span><br><span class="line">            E_AluSrc1    &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">            E_AluSrc2    &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">            E_WhichtoReg &lt;= <span class="number">8&#x27;b00000001</span>;</span><br><span class="line">            E_RegDst     &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">            E_DM_type    &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">              E_instr_s    &lt;= D_instr_s;</span><br><span class="line">              E_RD1        &lt;= D_RD1;</span><br><span class="line">              E_RD2        &lt;= D_RD2;</span><br><span class="line">              E_A1         &lt;= D_A1;</span><br><span class="line">              E_A2         &lt;= D_A2;</span><br><span class="line">              E_A3         &lt;= D_A3;</span><br><span class="line">              E_imm32      &lt;= D_imm32;</span><br><span class="line">              E_PC         &lt;= D_PC;</span><br><span class="line">              E_PC8        &lt;= D_PC8;</span><br><span class="line">              E_Wegrf      &lt;= D_Wegrf;</span><br><span class="line">              E_WeDm       &lt;= D_WeDm;</span><br><span class="line">              E_ALUop      &lt;= D_ALUop;</span><br><span class="line">              E_AluSrc1    &lt;= D_AluSrc1;</span><br><span class="line">              E_AluSrc2    &lt;= D_AluSrc2;</span><br><span class="line">              E_WhichtoReg &lt;= D_WhichtoReg;</span><br><span class="line">              E_RegDst     &lt;= D_RegDst;</span><br><span class="line">              E_DM_type    &lt;= D_DM_type;</span><br><span class="line">				  <span class="keyword">if</span>(D_Tnew&gt;<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">				  E_Tnew&lt;=D_Tnew-<span class="number">1</span>;</span><br><span class="line">				  <span class="keyword">end</span></span><br><span class="line">				  <span class="keyword">else</span> E_Tnew&lt;=<span class="number">0</span>;</span><br><span class="line">              <span class="comment">//$display(&quot;%d D_RD1:%d ,D_RD2:%d ,D_imm32:%d,D_PC:%h&quot;,$time,D_RD1,D_RD2,D_imm32,D_PC);</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//assign E_Tnew = (D_Tnew&gt;0)?D_Tnew-1:0;</span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
</li>
</ul>
<h5 id="3ex_mem"><a class="markdownIt-Anchor" href="#3ex_mem"></a> 3.EX_MEM</h5>
<h4 id="m_regexmem流水寄存器"><a class="markdownIt-Anchor" href="#m_regexmem流水寄存器"></a> M_Reg（EX/MEM流水寄存器）</h4>
<ul>
<li>端口定义</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2输入</td>
<td style="text-align:left">ALU_out数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3输入（转发值）</td>
<td style="text-align:left">MUX_ALU选择出来的数据</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级RD2输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级res输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_DM_type</td>
<td style="text-align:left">4</td>
<td style="text-align:left">E级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">E级imm32输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_RD2</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级RD2输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级res输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_WeDm</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_DM_type</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">M_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级imm32输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<ul>
<li>
<p><strong>运算功能</strong></p>
<p>Tnew_M = (Tnew_E &gt; 0) ? Tnew_E - 1: 0Tnew_M=(Tnew_E&gt;0)?Tnew_E−1:0</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> EX(<span class="keyword">input</span> clk,</span><br><span class="line">          <span class="keyword">input</span> reset,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A2,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A3,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] E_RD2,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] E_ALUout,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] E_PC,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] E_PC8,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] E_Tnew,</span><br><span class="line">          <span class="keyword">input</span> E_Wegrf,</span><br><span class="line">          <span class="keyword">input</span> E_WeDm,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] E_WhichtoReg,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] E_RegDst,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] E_DM_type,</span><br><span class="line">          <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] E_imm32,</span><br><span class="line">          <span class="comment">//input E_SelDM,</span></span><br><span class="line"></span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] M_A2,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] M_A3,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] M_RD2,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] M_ALUout,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] M_PC,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] M_PC8,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] M_Tnew,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> M_Wegrf,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> M_WeDm,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] M_WhichtoReg,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] M_RegDst,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] M_DM_type,</span><br><span class="line">          <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] M_imm32</span><br><span class="line">          <span class="comment">//output reg M_SelDM</span></span><br><span class="line">          );</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            M_A2         &lt;= <span class="number">0</span>;</span><br><span class="line">            M_A3         &lt;= <span class="number">0</span>;</span><br><span class="line">            M_RD2        &lt;= <span class="number">0</span>;</span><br><span class="line">            M_ALUout     &lt;= <span class="number">0</span>;</span><br><span class="line">            M_PC         &lt;= <span class="number">0</span>;</span><br><span class="line">            M_PC8        &lt;= <span class="number">0</span>;</span><br><span class="line">            M_Wegrf      &lt;= <span class="number">0</span>;</span><br><span class="line">            M_WeDm       &lt;= <span class="number">0</span>;</span><br><span class="line">            M_WhichtoReg &lt;= <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">            M_RegDst     &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">            M_DM_type    &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">            M_imm32      &lt;= <span class="number">0</span>;</span><br><span class="line">				M_Tnew&lt;=<span class="number">0</span>;</span><br><span class="line">          <span class="comment">//  M_SelDM&lt;=0;</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            M_A2         &lt;= E_A2;</span><br><span class="line">            M_A3         &lt;= E_A3;</span><br><span class="line">            M_RD2        &lt;= E_RD2;</span><br><span class="line">            M_ALUout     &lt;= E_ALUout;</span><br><span class="line">            M_PC         &lt;= E_PC;</span><br><span class="line">            M_PC8        &lt;= E_PC8;</span><br><span class="line">            M_Wegrf      &lt;= E_Wegrf;</span><br><span class="line">            M_WeDm       &lt;= E_WeDm;</span><br><span class="line">            M_WhichtoReg &lt;= E_WhichtoReg;</span><br><span class="line">            M_RegDst     &lt;= E_RegDst;</span><br><span class="line">            M_DM_type    &lt;= E_DM_type;</span><br><span class="line">            M_imm32      &lt;= E_imm32;</span><br><span class="line">				<span class="keyword">if</span>(E_Tnew&gt;<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">				  M_Tnew&lt;=E_Tnew-<span class="number">1</span>;</span><br><span class="line">				  <span class="keyword">end</span></span><br><span class="line">				  <span class="keyword">else</span> M_Tnew&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="comment">//M_SelDM&lt;=E_SelDM;</span></span><br><span class="line">            <span class="comment">//$display(&quot;%d E_A3: %d,E_ALUout:%d ,E_RD2:%d ,E_PC:%h&quot;,$time,E_A3,E_ALUout,E_RD2,E_PC);</span></span><br><span class="line">            </span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">   <span class="comment">// assign M_Tnew = (E_Tnew&gt;0)?E_Tnew-1:0;</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
</li>
</ul>
<h5 id="4mem_wb"><a class="markdownIt-Anchor" href="#4mem_wb"></a> 4.MEM_WB</h5>
<h4 id="w_regmemwb流水寄存器"><a class="markdownIt-Anchor" href="#w_regmemwb流水寄存器"></a> W_Reg（MEM/WB流水寄存器）</h4>
<ul>
<li><strong>接口定义</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">输入来源</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">clk</td>
<td style="text-align:left">1</td>
<td style="text-align:left">时钟信号</td>
<td style="text-align:left">mips.v中的clk</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">reset</td>
<td style="text-align:left">1</td>
<td style="text-align:left">同步复位信号</td>
<td style="text-align:left">mips.v中的reset</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级RD输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级PC8输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_WhichtoReg</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">M级控制信号输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">M级imm32输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输入</td>
<td style="text-align:left">前一级相同信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">W级A3输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_ALUout</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级res输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_RD</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级RD输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_PC</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级PC输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_PC8</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级PC8输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_WhichtoReg</td>
<td style="text-align:left">8</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_RegDst</td>
<td style="text-align:left">4</td>
<td style="text-align:left">W级控制信号输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_imm32</td>
<td style="text-align:left">32</td>
<td style="text-align:left">W级imm32输出</td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">W_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">W级Tnew输出</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> MEM(<span class="keyword">input</span> clk,</span><br><span class="line">           <span class="keyword">input</span> reset,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] M_A3,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] M_ALUout,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] M_RD,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] M_PC,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] M_PC8,</span><br><span class="line">           <span class="keyword">input</span> M_Wegrf,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">7</span>:<span class="number">0</span>] M_WhichtoReg,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">3</span>:<span class="number">0</span>] M_RegDst,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">31</span>:<span class="number">0</span>] M_imm32,</span><br><span class="line">           <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] M_Tnew,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">4</span>:<span class="number">0</span>] W_A3,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] W_ALUout,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] W_RD,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] W_PC,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] W_PC8,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> W_Wegrf,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">7</span>:<span class="number">0</span>] W_WhichtoReg,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">3</span>:<span class="number">0</span>] W_RegDst,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">31</span>:<span class="number">0</span>] W_imm32,</span><br><span class="line">           <span class="keyword">output</span> <span class="keyword">reg</span> [<span class="number">1</span>:<span class="number">0</span>] W_Tnew);</span><br><span class="line">    <span class="keyword">always</span> @(<span class="keyword">posedge</span> clk)<span class="keyword">begin</span></span><br><span class="line">        <span class="keyword">if</span> (reset)<span class="keyword">begin</span></span><br><span class="line">            W_A3         &lt;= <span class="number">0</span>;</span><br><span class="line">            W_ALUout     &lt;= <span class="number">0</span>;</span><br><span class="line">            W_RD         &lt;= <span class="number">0</span>;</span><br><span class="line">            W_PC         &lt;= <span class="number">0</span>;</span><br><span class="line">            W_PC8        &lt;= <span class="number">0</span>;</span><br><span class="line">            W_Wegrf      &lt;= <span class="number">0</span>;</span><br><span class="line">            W_WhichtoReg &lt;= <span class="number">8&#x27;b0000_0001</span>;</span><br><span class="line">            W_RegDst     &lt;= <span class="number">4&#x27;b0001</span>;</span><br><span class="line">            W_imm32      &lt;= <span class="number">0</span>;</span><br><span class="line">				W_Tnew&lt;=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">begin</span></span><br><span class="line">            W_A3         &lt;= M_A3;</span><br><span class="line">            W_ALUout     &lt;= M_ALUout;</span><br><span class="line">            W_RD         &lt;= M_RD;</span><br><span class="line">            W_PC         &lt;= M_PC;</span><br><span class="line">            W_PC8        &lt;= M_PC8;</span><br><span class="line">            W_Wegrf      &lt;= M_Wegrf;</span><br><span class="line">            W_WhichtoReg &lt;= M_WhichtoReg;</span><br><span class="line">            W_RegDst     &lt;= M_RegDst;</span><br><span class="line">            W_imm32      &lt;= M_imm32;</span><br><span class="line">				<span class="keyword">if</span>(M_Tnew&gt;<span class="number">0</span>)<span class="keyword">begin</span></span><br><span class="line">				  W_Tnew&lt;=M_Tnew-<span class="number">1</span>;</span><br><span class="line">				  <span class="keyword">end</span></span><br><span class="line">				  <span class="keyword">else</span> W_Tnew&lt;=<span class="number">0</span>;</span><br><span class="line">            <span class="comment">//$display(&quot;%d M_ALUout:%d ,M_RD:%d ,M_PC:%h&quot;,$time,M_ALUout,M_RD,M_PC);</span></span><br><span class="line">        <span class="keyword">end</span></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line">    <span class="comment">//assign W_Tnew = (M_Tnew&gt;0)?M_Tnew-1:0;</span></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="暂停-转发处理及相关多路选择器"><a class="markdownIt-Anchor" href="#暂停-转发处理及相关多路选择器"></a> 暂停、转发处理及相关多路选择器</h2>
<h3 id="一冲突综合单元hazardunit"><a class="markdownIt-Anchor" href="#一冲突综合单元hazardunit"></a> （一）.冲突综合单元（HazardUnit)</h3>
<table>
<thead>
<tr>
<th style="text-align:left">方向</th>
<th style="text-align:left">信号名</th>
<th style="text-align:left">位宽</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A1端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">D级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A1</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A1端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A2</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A2端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">E级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">M级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_A3</td>
<td style="text-align:left">5</td>
<td style="text-align:left">W级A3端输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Tuse_rs</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D_Tuse_rs输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">D_Tuse_rt</td>
<td style="text-align:left">2</td>
<td style="text-align:left">D_Tuse_rt输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">E级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">M级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_Tnew</td>
<td style="text-align:left">2</td>
<td style="text-align:left">W级Tnew输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">E_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">E级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">M_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">M级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">I</td>
<td style="text-align:left">W_Wegrf</td>
<td style="text-align:left">1</td>
<td style="text-align:left">W级Wegrf输入</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelB_D1</td>
<td style="text-align:left">2</td>
<td style="text-align:left">B_transfer的D1输入转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelB_D2</td>
<td style="text-align:left">2</td>
<td style="text-align:left">B_transfer的D2输入转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelALU_A</td>
<td style="text-align:left">2</td>
<td style="text-align:left">ALU输入A转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelALU_B</td>
<td style="text-align:left">2</td>
<td style="text-align:left">ALU输入B转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelDM</td>
<td style="text-align:left">1</td>
<td style="text-align:left">DM写入WD转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">SelJr</td>
<td style="text-align:left">2</td>
<td style="text-align:left">Jr转发信号</td>
</tr>
<tr>
<td style="text-align:left">O</td>
<td style="text-align:left">stall</td>
<td style="text-align:left">1</td>
<td style="text-align:left">冲突信号</td>
</tr>
</tbody>
</table>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> HazardUnit(<span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A1,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] D_A2,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A1,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A2,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] M_A2,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] E_A3,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] M_A3,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">4</span>:<span class="number">0</span>] W_A3,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tuse_rs,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] D_Tuse_rt,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] E_Tnew,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] M_Tnew,</span><br><span class="line">                  <span class="keyword">input</span> [<span class="number">1</span>:<span class="number">0</span>] W_Tnew,</span><br><span class="line">                  <span class="keyword">input</span> E_Wegrf,</span><br><span class="line">                  <span class="keyword">input</span> M_Wegrf,</span><br><span class="line">                  <span class="keyword">input</span> W_Wegrf,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelB_D1,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelB_D2,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelALU_A,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelALU_B,</span><br><span class="line">                  <span class="keyword">output</span> SelDM,</span><br><span class="line">                  <span class="keyword">output</span> [<span class="number">1</span>:<span class="number">0</span>] SelJr,</span><br><span class="line">                  <span class="keyword">output</span> stall);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//stall</span></span><br><span class="line"><span class="keyword">wire</span> stall_rs,stall_rt;</span><br><span class="line"><span class="comment">//stop</span></span><br><span class="line"><span class="keyword">assign</span> stall_rs = (D_A1!= <span class="number">0</span>)&amp;&amp;((D_Tuse_rs&lt;E_Tnew)&amp;&amp;(D_A1 == E_A3)&amp;&amp;E_Wegrf||</span><br><span class="line">						(D_Tuse_rs&lt;M_Tnew)&amp;&amp;(D_A1 == M_A3)&amp;&amp;M_Wegrf||</span><br><span class="line">						(D_Tuse_rs&lt;W_Tnew)&amp;&amp;(D_A1 == W_A3)&amp;&amp;W_Wegrf);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall_rt = (D_A2!= <span class="number">0</span>)&amp;&amp;((D_Tuse_rt&lt;E_Tnew)&amp;&amp;(D_A2 == E_A3)&amp;&amp;E_Wegrf||</span><br><span class="line">						(D_Tuse_rt&lt;M_Tnew)&amp;&amp;(D_A2 == M_A3)&amp;&amp;M_Wegrf||</span><br><span class="line">						(D_Tuse_rt&lt;W_Tnew)&amp;&amp;(D_A2 == W_A3)&amp;&amp;W_Wegrf);</span><br><span class="line"></span><br><span class="line"><span class="comment">//output</span></span><br><span class="line"><span class="keyword">assign</span> SelB_D1 = 	(D_A1 == E_A3)&amp;&amp;(E_Tnew == <span class="number">0</span>)&amp;&amp;D_A1&amp;&amp;E_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">						(D_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;D_A1&amp;&amp;M_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">						<span class="number">2&#x27;b00</span>;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelB_D2 = 	(D_A2 == E_A3)&amp;&amp;(E_Tnew == <span class="number">0</span>)&amp;&amp;D_A2&amp;&amp;E_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">						(D_A2 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;D_A2&amp;&amp;M_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">						<span class="number">2&#x27;b00</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelALU_A = (E_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;E_A1&amp;&amp;M_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">						(E_A1 == W_A3)&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;E_A1&amp;&amp;W_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">						<span class="number">2&#x27;b00</span>;</span><br><span class="line"><span class="comment">//assign SelALU_A = 2&#x27;b00;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelALU_B = (E_A2 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;E_A2&amp;&amp;M_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">						(E_A2 == W_A3)&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;E_A2&amp;&amp;W_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">						<span class="number">2&#x27;b00</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelDM   = (M_A3 == W_A3)&amp;&amp;M_A3&amp;&amp;(W_Tnew == <span class="number">0</span>)&amp;&amp;W_Wegrf;</span><br><span class="line"><span class="comment">//assign SelDM = 1&#x27;b0;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> SelJr = (D_A1 == E_A3)&amp;&amp;(E_Tnew == <span class="number">0</span>)&amp;&amp;(D_A1 == <span class="number">5&#x27;d31</span>)&amp;&amp;E_Wegrf?<span class="number">2&#x27;b10</span>:</span><br><span class="line">					(D_A1 == M_A3)&amp;&amp;(M_Tnew == <span class="number">0</span>)&amp;&amp;(D_A1 == <span class="number">5&#x27;d31</span>)&amp;&amp;M_Wegrf?<span class="number">2&#x27;b01</span>:</span><br><span class="line">					<span class="number">2&#x27;b00</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">assign</span> stall = stall_rs||stall_rt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h3 id="二控制和冒险简述"><a class="markdownIt-Anchor" href="#二控制和冒险简述"></a> （二）.控制和冒险简述</h3>
<ul>
<li>
<p>对于控制冒险，本实验要求大家实现<strong>比较过程前移至 D 级</strong>，并<strong>采用延迟槽</strong>。</p>
</li>
<li>
<p>对于数据冒险，两大策略及其应用：</p>
<ul>
<li>假设当前我需要的数据，其实已经计算出来，只是还没有进入寄存器堆，那么我们可以用<strong>转发</strong>( Forwarding )来解决，即不引用寄存器堆的值，而是直接从后面的流水级的供给者把计算结果发送到前面流水级的需求者来引用。如果我们需要的数据还没有算出来。则我们就只能<strong>暂停</strong>( Stall )，让流水线停止工作，等到我们需要的数据计算完毕，再开始下面的工作。</li>
</ul>
</li>
</ul>
<h3 id="三冒险处理"><a class="markdownIt-Anchor" href="#三冒险处理"></a> (三）.冒险处理</h3>
<p>冒险处理我们均通过“A_T”法实现——</p>
<h4 id="转发forward"><a class="markdownIt-Anchor" href="#转发forward"></a> 转发（forward）</h4>
<p>当前面的指令要写寄存器但还未写入，而后面的指令需要用到没有被写入的值时，这时候会产生<strong>数据冒险</strong>，我们首先考虑进行转发。我们<strong>假设所有的数据冒险均可通过转发解决</strong>。也就是说，当某一指令前进到必须使用某一寄存器的值的流水阶段时，这个寄存器的值一定已经产生，并<strong>存储于后续某个流水线寄存器中</strong>。</p>
<p>在这一阶段，我们不管需要的值有没由计算出，都要进行转发，即暴力转发。为实现这一机制，我们要清楚哪些模块需要转发后的数据（<strong>需求者</strong>）和保存着写入值的流水寄存器（<strong>供应者</strong>）</p>
<ul>
<li><strong>供应者及其产生的数据</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">流水级</th>
<th style="text-align:left">产生数据</th>
<th style="text-align:left">MUX名&amp;选择信号名</th>
<th style="text-align:left">MUX输出名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">E</td>
<td style="text-align:left">E_imm32，<br/>E_PC8</td>
<td style="text-align:left">直接流水线传递</td>
<td style="text-align:left">直接流水线传递</td>
</tr>
<tr>
<td style="text-align:left">M</td>
<td style="text-align:left">M_ALUout，<br/>M_PC8</td>
<td style="text-align:left">直接流水线传递</td>
<td style="text-align:left">直接流水线传递</td>
</tr>
<tr>
<td style="text-align:left">W</td>
<td style="text-align:left">w_res，<br/>w_RD，<br/>w_imm32,<br>W_PC8</td>
<td style="text-align:left">w_WhichtoReg</td>
<td style="text-align:left">WD</td>
</tr>
</tbody>
</table>
<p>注：当M级指令为读hi和lo的指令时， M_AO中的结果是从上一周期在乘除槽中读取的hi或lo的值；如果是其他指令，M_AO是上一周期ALU的计算结果。</p>
<ul>
<li><strong>需求者及其产生的数据</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">接收端口</th>
<th style="text-align:left">选择数据</th>
<th style="text-align:left">HMUX名&amp;选择信号名</th>
<th style="text-align:left">MUX输出名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">B_transfer_D1</td>
<td style="text-align:left">D_V1,<br/>M_out,<br/>E_out</td>
<td style="text-align:left">SelB_D1</td>
<td style="text-align:left">d_b_transfer1</td>
</tr>
<tr>
<td style="text-align:left">B_transfer_D2</td>
<td style="text-align:left">d_RD2,<br>m_res,<br>e_res</td>
<td style="text-align:left">SelB_D2</td>
<td style="text-align:left">d_b_transfer2</td>
</tr>
<tr>
<td style="text-align:left">ALU_A</td>
<td style="text-align:left">e_RD1，<br/> WD，<br/>m_res</td>
<td style="text-align:left">SelALU_A</td>
<td style="text-align:left">e_A</td>
</tr>
<tr>
<td style="text-align:left">ALU_B</td>
<td style="text-align:left">e_RD2，<br/>WD，<br/>m_res</td>
<td style="text-align:left">SelALU_B</td>
<td style="text-align:left">e_B</td>
</tr>
<tr>
<td style="text-align:left">DM_WD</td>
<td style="text-align:left">m_RD2，<br/> WD</td>
<td style="text-align:left">SelDM</td>
<td style="text-align:left">M_WD_f</td>
</tr>
<tr>
<td style="text-align:left">NPC_ra</td>
<td style="text-align:left">D_V1_f ,<br/> E_PC8 ,<br/> M_PC8</td>
<td style="text-align:left">SelJr</td>
<td style="text-align:left">ra</td>
</tr>
</tbody>
</table>
<p>从上表可以看出，W级中的数据没有转发到D级，原因是我们在GRF内实现了内部转发机制，将GRF输入端的数据（还未写入）及时反映到RD1或这RD2，判断条件为<code>A3 == A2</code>或者<code>A3 == A1</code>。</p>
<p>此时为了生成HMUX的选择信号，我们需要向HCU（冒险控制器）输入”A”数据，然后进行选择信号的计算，执行转发的条件为——</p>
<ul>
<li>
<p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为 0</strong></p>
</li>
<li>
<p><strong>写使能信号有效</strong></p>
<h4 id="转发的构造"><a class="markdownIt-Anchor" href="#转发的构造"></a> 转发的构造</h4>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/4.png"
                      alt="" 
                ></p>
</li>
</ul>
<h4 id="暂停stall"><a class="markdownIt-Anchor" href="#暂停stall"></a> 暂停（stall）</h4>
<p>接下来，我们来处理通过转发不能处理的数据冒险。在这种情况下，新的数据还未来得及产生。我们只能暂停流水线，等待新的数据产生。为了方便处理，我们仅仅为D级的指令进行暂停处理。</p>
<p>我们把Tuse和Tnew作为暂停的判断依据——</p>
<ul>
<li>Tuse：指令进入 <strong>D 级</strong>后，其后的某个功能部件<strong>再</strong>经过多少时钟周期就<strong>必须</strong>要使用寄存器值。对于有两个操作数的指令，其<strong>每个操作数的 Tuse 值可能不等</strong>（如 store 型指令 rs、rt 的 Tuse 分别为 1 和 2 ）。</li>
<li>Tnew：位于 <strong>E 级及其后各级</strong>的指令，再经过多少周期就能够产生要写入寄存器的结果。在我们目前的 CPU 中，W 级的指令Tnew 恒为 0；对于同一条指令，Tnew@M = max(Tnew@E - 1, 0)、</li>
</ul>
<p>在这一阶段，我们找到D级生成的Tuse_rs和Tuse_rt和在E,M,W级寄存器中流水的Tnew_D，Tnew_M，Tnew_W，如下表所示</p>
<ul>
<li><strong>Tuse表和计算表达式</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">指令类型</th>
<th style="text-align:left">Tuse_rs</th>
<th style="text-align:left">Tuse_rt</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">calc_R</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">calc_I</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:left">X</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">shiftv</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">load</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">store</td>
<td style="text-align:left">1</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">md</td>
<td style="text-align:left">1</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">mt</td>
<td style="text-align:left">1</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mf</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">j / jr</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">jal / jalr</td>
<td style="text-align:left">0</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">lui</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>Tnew表和计算表达式</strong></li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:left">指令类型</th>
<th style="text-align:left">Tnew_D</th>
<th style="text-align:left">Tnew_E</th>
<th style="text-align:left">Tnew_M</th>
<th style="text-align:left">Tnew_W</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">calc_R</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">calc_I</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">shift</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">shiftv</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">load</td>
<td style="text-align:left">3</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">store</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">md</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mt</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">mf</td>
<td style="text-align:left">2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">branch</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">jal / jalr</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
<tr>
<td style="text-align:left">j / jr</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
<td style="text-align:left">X</td>
</tr>
<tr>
<td style="text-align:left">lui</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
<td style="text-align:left">0</td>
</tr>
</tbody>
</table>
<p>然后我们Tnew和Tuse传入HCU（冒险控制器中），然后进行stall信号的计算。如果满足以下条件则stall有效——</p>
<ul>
<li>
<p><strong>Tnew &gt; Tuse</strong></p>
</li>
<li>
<p><strong>前位点的读取寄存器地址和某转发输入来源的写入寄存器地址相等且不为 0</strong></p>
</li>
<li>
<p><strong>写使能信号有效</strong></p>
</li>
<li>
<p><strong>当E级延迟槽在进行运算（<code>start | busy</code>）时，D级为md、mt、mf指令</strong></p>
</li>
<li>
<h4 id="阻塞的构造d级"><a class="markdownIt-Anchor" href="#阻塞的构造d级"></a> <strong>阻塞的构造（D级）</strong></h4>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/5.png"
                      alt="" 
                ></p>
</li>
</ul>
<h2 id="真值表"><a class="markdownIt-Anchor" href="#真值表"></a> 真值表</h2>
<table>
<thead>
<tr>
<th style="text-align:center">端口</th>
<th>addu</th>
<th>subu</th>
<th>ori</th>
<th>lw</th>
<th>sw</th>
<th>lui</th>
<th>beq</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">op</td>
<td>000000</td>
<td>000000</td>
<td>001101</td>
<td>100011</td>
<td>101011</td>
<td>001111</td>
<td>000100</td>
</tr>
<tr>
<td style="text-align:center">func</td>
<td>100001</td>
<td>100011</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align:center">AluOp</td>
<td>0000001</td>
<td>0000010</td>
<td>0001000</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
</tr>
<tr>
<td style="text-align:center">WeGrf</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">WeDm</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">branch</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
</tr>
<tr>
<td style="text-align:center">AluSrc1</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc2</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">WhichtoReg</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0001</td>
<td>0100</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">RegDst</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>0010</td>
<td>1010</td>
</tr>
<tr>
<td style="text-align:center">SignExt</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center"><strong>端口</strong></td>
<td><strong>andi</strong></td>
<td><strong>jal</strong></td>
<td><strong>j</strong></td>
<td><strong>jr</strong></td>
<td><strong>sll</strong></td>
<td><strong>add</strong></td>
<td><strong>sub</strong></td>
</tr>
<tr>
<td style="text-align:center">op</td>
<td>001100</td>
<td>000011</td>
<td>000010</td>
<td>000000</td>
<td>000000</td>
<td>000000</td>
<td>000000</td>
</tr>
<tr>
<td style="text-align:center">func</td>
<td></td>
<td></td>
<td></td>
<td>001000</td>
<td>000000</td>
<td>100000</td>
<td>100010</td>
</tr>
<tr>
<td style="text-align:center">AluOp</td>
<td>0000100</td>
<td>0000000</td>
<td>0000000</td>
<td>0000000</td>
<td>0010000</td>
<td>0000000</td>
<td>0000001</td>
</tr>
<tr>
<td style="text-align:center">WeGrf</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
</tr>
<tr>
<td style="text-align:center">WeDm</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td style="text-align:center">branch</td>
<td>0001</td>
<td>0100</td>
<td>0100</td>
<td>1000</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc1</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">AluSrc2</td>
<td>0010</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0100</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">WhichtoReg</td>
<td>0001</td>
<td>1000</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">RegDst</td>
<td>0010</td>
<td>0100</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
<td>0001</td>
</tr>
<tr>
<td style="text-align:center">SignExt</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<h3 id="二-测试方案"><a class="markdownIt-Anchor" href="#二-测试方案"></a> 二、 测试方案</h3>
<p>（1） 测试代码：</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <p>.text</p><p>ori $a0,$0,0x100<br><br />ori $a1,$a0,0x123<br><br />lui $a2,456<br><br />lui $a3,0xffff<br><br />ori $a3,$a3,0xffff<br><br />addu $s0,$a0,$a2<br><br />addu $s1,$a0,$a3<br><br />addu $s4,$a3,$a3<br><br />subu $s2,$a0,$a2<br><br />subu $s3,$a0,$a3<br><br />sw $a0,0($0)<br><br />sw $a1,4($0)<br><br />sw $a2,8($0)<br><br />sw $a3,12($0)<br><br />sw $s0,16($0)<br><br />sw $s1,20($0)<br><br />sw $s2,24($0)<br><br />sw $s3,44($0)<br><br />sw $s4,48($0)<br><br />lw $a0,0($0)<br><br />lw $a1,12($0)<br><br />sw $a0,28($0)<br><br />sw $a1,32($0)<br><br />ori $a0,$0,1<br><br />ori $a1,$0,2<br><br />ori $a2,$0,1<br><br />beq $a0,$a1,loop1<br><br />beq $a0,$a2,loop2<br><br />loop1: sw $a0,36($t0)<br><br />loop2: sw $a1,40($t0)<br><br />jal loop3<br><br />jal loop3<br><br />sw $s5,64($t0)<br><br />ori $a1,$a1,4<br><br />jal loop4<br><br />loop3:sw $a1,56($t0)<br><br />sw $ra,60($t0)<br><br />ori $s5,$s5,5<br><br />jr $ra<br><br />loop4: sw $a1,68($t0)<br><br />sw $ra,72($t0)<br></p>
              </div>
            </details>
<p>（2） 该CPU运行结果</p>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <p>@00003000: $ 4 &lt;= 00000100<br />@00003004: $ 5 &lt;= 00000123<br />@00003008: $ 6 &lt;= 01c80000<br />@0000300c: $ 7 &lt;= ffff0000<br />@00003010: $ 7 &lt;= ffffffff<br />@00003014: $16 &lt;= 01c80100<br />@00003018: $17 &lt;= 000000ff<br />@0000301c: $20 &lt;= fffffffe<br />@00003020: $18 &lt;= fe380100<br />@00003024: $19 &lt;= 00000101<br />@00003028: *00000000 &lt;= 00000100<br />@0000302c: *00000004 &lt;= 00000123<br />@00003030: *00000008 &lt;= 01c80000<br />@00003034: *0000000c &lt;= ffffffff<br />@00003038: *00000010 &lt;= 01c80100<br />@0000303c: *00000014 &lt;= 000000ff<br />@00003040: *00000018 &lt;= fe380100<br />@00003044: *0000002c &lt;= 00000101<br />@00003048: *00000030 &lt;= fffffffe<br />@0000304c: $ 4 &lt;= 00000100<br />@00003050: $ 5 &lt;= ffffffff<br />@00003054: *0000001c &lt;= 00000100<br />@00003058: *00000020 &lt;= ffffffff<br />@0000305c: $ 4 &lt;= 00000001<br />@00003060: $ 5 &lt;= 00000002<br />@00003064: $ 6 &lt;= 00000001<br />@00003074: *00000028 &lt;= 00000002<br />@00003078: $31 &lt;= 0000307c<br />@0000308c: *00000038 &lt;= 00000002<br />@00003090: *0000003c &lt;= 0000307c</p>
              </div>
            </details>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Verilog"><figure class="iseeu highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//testbench模块</span></span><br><span class="line"><span class="meta">`<span class="keyword">timescale</span> 1ns / 1ps</span></span><br><span class="line"><span class="keyword">module</span> mips_tb;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Inputs</span></span><br><span class="line">	<span class="keyword">reg</span> clk;</span><br><span class="line">	<span class="keyword">reg</span> reset;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Instantiate the Unit Under Test (UUT)</span></span><br><span class="line">	mips uut (</span><br><span class="line">		<span class="variable">.clk</span>(clk), </span><br><span class="line">		<span class="variable">.reset</span>(reset)</span><br><span class="line">	);</span><br><span class="line">	<span class="keyword">always</span> #<span class="number">2</span> clk=~clk;</span><br><span class="line">	<span class="keyword">initial</span> <span class="keyword">begin</span></span><br><span class="line">		<span class="comment">// Initialize Inputs</span></span><br><span class="line">		clk = <span class="number">0</span>;</span><br><span class="line">		reset = <span class="number">1</span>;</span><br><span class="line">		#<span class="number">10</span>;</span><br><span class="line">		reset=<span class="number">0</span>;</span><br><span class="line">		<span class="comment">// Wait 100 ns for global reset to finish</span></span><br><span class="line">		#<span class="number">200</span>;</span><br><span class="line">        </span><br><span class="line">		<span class="comment">// Add stimulus here</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">      </span><br><span class="line"><span class="keyword">endmodule</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h3 id="三-思考题"><a class="markdownIt-Anchor" href="#三-思考题"></a> 三、 思考题</h3>
<h4 id="一我们使用提前分支判断的方法尽早产生结果来减少因不确定而带来的开销但实际上这种方法并非总能提高效率请从流水线冒险的角度思考其原因并给出一个指令序列的例子"><a class="markdownIt-Anchor" href="#一我们使用提前分支判断的方法尽早产生结果来减少因不确定而带来的开销但实际上这种方法并非总能提高效率请从流水线冒险的角度思考其原因并给出一个指令序列的例子"></a> （一）我们使用提前分支判断的方法尽早产生结果来减少因不确定而带来的开销，但实际上这种方法并非总能提高效率，请从流水线冒险的角度思考其原因并给出一个指令序列的例子。</h4>
<div class="highlight-container" data-rel="Markdown"><figure class="iseeu highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ori $t0,10</span><br><span class="line">ori $t1,11</span><br><span class="line">add $t2,$t0,$t1</span><br><span class="line">beq $t2,$t1,else</span><br><span class="line">addi $t4,$t4,1</span><br><span class="line">else:</span><br></pre></td></tr></table></figure></div>
<p>​		在类似上述指令的前提下，由于$t2的值还没有生成，所以beq指令会在D级暂停一个周期，之后后面一条指令进入D级。</p>
<p>​		但如果在E级进行beq判断，则beq在D级不需要暂停就可以直接通过转发进入E级，在beq执行后其后面一条延迟槽指令可以直接进入E级参与计算。</p>
<p>​		综上所述，在这种情况之下，addi（延迟槽无关指令）的数据提前一个周期完成了计算。</p>
<h4 id="二-因为延迟槽的存在对于-jal-等需要将指令地址写入寄存器的指令要写回-pc-8请思考为什么这样设计"><a class="markdownIt-Anchor" href="#二-因为延迟槽的存在对于-jal-等需要将指令地址写入寄存器的指令要写回-pc-8请思考为什么这样设计"></a> （二） 因为延迟槽的存在，对于 jal 等需要将指令地址写入寄存器的指令，要写回 PC + 8，请思考为什么这样设计？</h4>
<p>​		因为，jal和jalr后一步会是延迟槽，是必做的一步，所以jr跳回来的是jal和jalr后两步的地方，因此jal和jalr存入RF中的PC+8。</p>
<h4 id="三我们要求大家所有转发数据都来源于流水寄存器而不能是功能部件如-dm-alu-请思考为什么"><a class="markdownIt-Anchor" href="#三我们要求大家所有转发数据都来源于流水寄存器而不能是功能部件如-dm-alu-请思考为什么"></a> （三）我们要求大家所有转发数据都来源于流水寄存器而不能是功能部件（如 DM 、 ALU ），请思考为什么？</h4>
<p>​		由于流水线寄存器为时序逻辑电路，在工业实际生产时数据来源于流水线寄存器时更加稳定，这样有利于转发更有效的进行。同时，从流水线寄存器中获取数据有利于我们更好地掌握不同数据来自的流水线的级数，有利于效率提高。</p>
<h4 id="四-我们为什么要使用-gpr-内部转发该如何实现"><a class="markdownIt-Anchor" href="#四-我们为什么要使用-gpr-内部转发该如何实现"></a> （四） 我们为什么要使用 GPR 内部转发？该如何实现？</h4>
<p>​		通过GPR的内部转发，我们可以将要存入GPR的值提前一个轮回带入了计算，这样也就省略了GRF两个输入对数据外部转发的需要，且实现起来相对简单。</p>
<p>​		GPR 是一个特殊的部件，它既可以视为 D 级的一个部件，<strong>也可以视为 W 级之后的流水线寄存器</strong>。基于这一特性，我们将对 GPR 采用<strong>内部转发</strong>机制。也就是说，当前 GPR 被写入的值会即时反馈到读取端上。</p>
<p>​		具体的说，当读寄存器时的地址与同周期写寄存器的地址相同时，我们将读取的内容改为写寄存器的内容，而不是该地址可以索引到的寄存器文件中的值。</p>
<h4 id="五我们转发时数据的需求者和供给者可能来源于哪些位置共有哪些转发数据通路"><a class="markdownIt-Anchor" href="#五我们转发时数据的需求者和供给者可能来源于哪些位置共有哪些转发数据通路"></a> （五）我们转发时数据的需求者和供给者可能来源于哪些位置？共有哪些转发数据通路？</h4>
<p>只有 RS 和 RT 会被转发。有四个位点是转发的接受端：</p>
<ol>
<li>
<p>NPC 的 RS 输入端</p>
</li>
<li>
<p>CMP 的两个输入端</p>
</li>
<li>
<p>ALU 的输入端</p>
</li>
<li>
<p>DM 的输入端</p>
<p>所以共有6条转发路径，见上方转发说明具体路径。</p>
</li>
</ol>
<h4 id="六在课上测试时我们需要你现场实现新的指令对于这些新的指令你可能需要在原有的数据通路上做哪些扩展或修改提示你可以对指令进行分类思考每一类指令可能修改或扩展哪些位置"><a class="markdownIt-Anchor" href="#六在课上测试时我们需要你现场实现新的指令对于这些新的指令你可能需要在原有的数据通路上做哪些扩展或修改提示你可以对指令进行分类思考每一类指令可能修改或扩展哪些位置"></a> （六）在课上测试时，我们需要你现场实现新的指令，对于这些新的指令，你可能需要在原有的数据通路上做哪些扩展或修改？提示：你可以对指令进行分类，思考每一类指令可能修改或扩展哪些位置。</h4>
<p>总体而言，添加新指令 有以下几个步骤：</p>
<p>1.添加指令前判断所添加指令的数据通路。</p>
<p>2.添加指令前需要判断各指令的D_Tuse_rs，D_Tuse_rt和D_Tnew，之后从而判断其是否需要转发和阻塞的需求，如果需要 转发则确定转发的数据来源。</p>
<p>3.按照各种控制信号的需求修改Controller的编码和相关控制信号的设置。</p>
<p>4.到新指令所要操作的元器件去完成相关指令的功能。</p>
<p>5.完成相关测试及debug</p>
<h4 id="七简要描述你的译码器架构并思考该架构的优势以及不足"><a class="markdownIt-Anchor" href="#七简要描述你的译码器架构并思考该架构的优势以及不足"></a> （七）简要描述你的译码器架构，并思考该架构的优势以及不足。</h4>
<p>​		我的译码器为集中式布局。</p>
<p>​		<strong>集中式译码</strong>：在取指令（F 级）时或者读取寄存器阵列信息（D 级）前，将所有的控制信号全部解析出，然后让其随着流水往后逐级传递。使用这种方法，只需要在初始对指令进行一次译码，减少了后续流水级的逻辑复杂度，但流水级之间需要传递的信号数量很大。</p>
<p>​		集中式译码即在 <code>F</code> 或 <code>D</code> 级进行译码，然后将控制信号流水传递，即 P3/P4 采用的译码方式；分布式译码则只流水传递指令，控制信号在每一级单独译码。</p>
<p>​		集中式译码的好处在于速度更快，关键路径更短；分布式译码关键路径更长，速度较慢（差不了很多）但是译码信息模块化，不需要流水传递控制信号，更适合应试和学习。</p>
<h3 id="选做题"><a class="markdownIt-Anchor" href="#选做题"></a> 选做题</h3>
<h4 id="一请详细描述你的测试方案及测试数据构造策略"><a class="markdownIt-Anchor" href="#一请详细描述你的测试方案及测试数据构造策略"></a> （一）请详细描述你的测试方案及测试数据构造策略。</h4>
<p>​        写了一个随机数生成器来生成一定长度的代码（较短），之后对代码顺序进行优化后测试。相关结果通过与同学对拍来确定是否正确。</p>
<p>​		数据构造策略为确定数据生成的范围之后通过随机数生成器进行大量测试。若出现bug则手动修改类似数据进行进一步测试。</p>
<h4 id="二请评估我们给出的覆盖率分析模型的合理性如有更好的方案可一并提出"><a class="markdownIt-Anchor" href="#二请评估我们给出的覆盖率分析模型的合理性如有更好的方案可一并提出"></a> （二）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。</h4>
<p>​		由于转发比阻塞的效率更高，所以我们在编码时的基本原则是尽可能转发，而在这个模型中，转发的得分明显高于阻塞，合理。</p>
<p>​		本覆盖率分析模型的指令集按需分类，更有利于集中式处理，使效率更高。</p>
<h3 id="四自动化测试模块"><a class="markdownIt-Anchor" href="#四自动化测试模块"></a> 四.自动化测试模块</h3>
<details class="blue" data-header-exclude><summary><i class="fa-solid fa-chevron-right"></i>Folding coding </summary>
              <div class='content'>
              <div class="highlight-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="comment"># 指令集</span></span><br><span class="line">R_type = [<span class="string">&#x27;add&#x27;</span>, <span class="string">&#x27;sub&#x27;</span>, <span class="string">&#x27;addu&#x27;</span>, <span class="string">&#x27;subu&#x27;</span>]</span><br><span class="line"><span class="comment"># R型指令</span></span><br><span class="line">I_type = [<span class="string">&#x27;ori&#x27;</span>, <span class="string">&#x27;andi&#x27;</span>, <span class="string">&#x27;lui&#x27;</span>, <span class="string">&#x27;lw&#x27;</span>, <span class="string">&#x27;sw&#x27;</span>, <span class="string">&#x27;beq&#x27;</span>]</span><br><span class="line"><span class="comment"># I型指令</span></span><br><span class="line">J_type = [<span class="string">&#x27;jal&#x27;</span>, <span class="string">&#x27;j&#x27;</span>]</span><br><span class="line"><span class="comment"># J型指令</span></span><br><span class="line">filename = <span class="string">&quot;D:\\coding_file\\study\\Lesson\\co_lesson\\lesson\\p4\\test.asm&quot;</span></span><br><span class="line"><span class="comment"># 输出文件位置</span></span><br><span class="line">label = [<span class="number">0</span>]</span><br><span class="line"><span class="comment"># 输出label的编号范围，事先存入0防止在第一次输出标签前出现跳转指令</span></span><br><span class="line">cnt = <span class="number">0</span></span><br><span class="line"><span class="comment"># 可执行代码的行数</span></span><br><span class="line">flag = <span class="number">1</span></span><br><span class="line"><span class="comment"># 当前所标出过的编号号码</span></span><br><span class="line">jal = []</span><br><span class="line"><span class="comment"># 使用过的jal对应标签编号</span></span><br><span class="line">R_num = <span class="built_in">len</span>(R_type)</span><br><span class="line">I_num = <span class="built_in">len</span>(I_type)</span><br><span class="line">J_num = <span class="built_in">len</span>(J_type)</span><br><span class="line">num = R_num+I_num+J_num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">get_Code</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># 对应指令生成随机数</span></span><br><span class="line">        self.rs = random.randint(<span class="number">0</span>, <span class="number">31</span>)</span><br><span class="line">        self.rt = random.randint(<span class="number">0</span>, <span class="number">31</span>)</span><br><span class="line">        self.rd = random.randint(<span class="number">0</span>, <span class="number">31</span>)</span><br><span class="line">        self.imm16 = random.randint(<span class="number">0</span>, (<span class="number">1</span> &lt;&lt; <span class="number">16</span>)-<span class="number">1</span>)</span><br><span class="line">        self.imm26 = random.randint(<span class="number">0</span>, (<span class="number">1</span> &lt;&lt; <span class="number">26</span>)-<span class="number">1</span>)</span><br><span class="line">        self.mem = random.randint(<span class="number">0</span>, <span class="number">3071</span>)</span><br><span class="line">        <span class="comment"># 存储指令类型</span></span><br><span class="line">        self.<span class="built_in">list</span> = []</span><br><span class="line">        <span class="comment"># get函数</span></span><br><span class="line">        self.get_R()</span><br><span class="line">        self.get_I()</span><br><span class="line">        self.get_J()</span><br><span class="line">        self.get_Label()</span><br><span class="line">        self.main()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_R</span>(<span class="params">self</span>):</span><br><span class="line">        random1 = random.randint(<span class="number">0</span>, R_num - <span class="number">1</span>)</span><br><span class="line">        type1 = R_type[random1]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type1)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_I</span>(<span class="params">self</span>):</span><br><span class="line">        random2 = random.randint(<span class="number">0</span>, I_num - <span class="number">1</span>)</span><br><span class="line">        type2 = I_type[random2]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type2)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_J</span>(<span class="params">self</span>):</span><br><span class="line">        random3 = random.randint(<span class="number">0</span>, J_num - <span class="number">1</span>)</span><br><span class="line">        type3 = J_type[random3]</span><br><span class="line">        self.<span class="built_in">list</span>.append(type3)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">get_Label</span>(<span class="params">self</span>):</span><br><span class="line">        random4 = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(label)-<span class="number">1</span>)</span><br><span class="line">        ran = label[random4]</span><br><span class="line">        <span class="keyword">return</span> ran</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">main</span>(<span class="params">self</span>):</span><br><span class="line">        sel = random.randint(<span class="number">0</span>, num)</span><br><span class="line">        <span class="comment"># 控制参数类型</span></span><br><span class="line">        <span class="keyword">if</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, R_num):</span><br><span class="line">            <span class="comment"># 通过控制随机数的范围来决定输出各种指令的频率,并用各种指令的数目保证各指令出现概率基本相同</span></span><br><span class="line">            self.code = self.<span class="built_in">list</span>[<span class="number">0</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rd) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                <span class="built_in">str</span>(self.rs) + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(R_num, R_num+I_num):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">1</span>] == <span class="string">&#x27;lw&#x27;</span> <span class="keyword">or</span> self.<span class="built_in">list</span>[<span class="number">1</span>] == <span class="string">&#x27;sw&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16 &lt;&lt; <span class="number">2</span>) + \</span><br><span class="line">                    <span class="string">&#x27;(&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + <span class="string">&#x27;0&#x27;</span>+<span class="string">&#x27;)&#x27;</span>+<span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">1</span>] == <span class="string">&#x27;lui&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                    <span class="string">&#x27;$&#x27;</span> + <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">1</span>] == <span class="string">&#x27;beq&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;label_&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.get_Label()) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">1</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rt) + <span class="string">&#x27;,&#x27;</span> + <span class="string">&#x27;$&#x27;</span> + \</span><br><span class="line">                    <span class="built_in">str</span>(self.rs) + <span class="string">&#x27;,&#x27;</span> + <span class="built_in">str</span>(self.imm16) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> sel <span class="keyword">in</span> <span class="built_in">range</span>(R_num+I_num, num+<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> self.<span class="built_in">list</span>[<span class="number">2</span>] == <span class="string">&#x27;jal&#x27;</span>:</span><br><span class="line">                node = self.get_Label()</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&#x27; &#x27;</span> + <span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(node) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                jal.append(node)</span><br><span class="line">            <span class="keyword">elif</span> self.<span class="built_in">list</span>[<span class="number">2</span>] == <span class="string">&#x27;j&#x27;</span>:</span><br><span class="line">                self.code = self.<span class="built_in">list</span>[<span class="number">2</span>] + <span class="string">&#x27; &#x27;</span> + \</span><br><span class="line">                    <span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(self.get_Label()) + <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">&#x27;label_0&#x27;</span> + <span class="string">&#x27;:&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> cnt <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">30</span>):</span><br><span class="line">        a = get_Code()</span><br><span class="line">        f.write(a.code)</span><br><span class="line">        <span class="keyword">if</span> random.randint(<span class="number">0</span>, <span class="number">3</span>) == <span class="number">1</span> <span class="keyword">and</span> label != []:</span><br><span class="line">          <span class="comment"># 通过控制random范围来决定标签和jr出现的概率</span></span><br><span class="line">            f.write(<span class="string">&#x27;label_&#x27;</span> + <span class="built_in">str</span>(flag) + <span class="string">&#x27;:&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            label.append(flag)</span><br><span class="line">            flag = flag+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> random.randint(<span class="number">0</span>, num+<span class="number">1</span>) == <span class="number">1</span> <span class="keyword">and</span> jal != []:</span><br><span class="line">            f.write(<span class="string">&#x27;jr $ra&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">            jal.pop(random.randint(<span class="number">0</span>, <span class="built_in">len</span>(jal) - <span class="number">1</span>))</span><br><span class="line">        <span class="keyword">if</span> random.randint(<span class="number">0</span>, num+<span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">            f.write(<span class="string">&#x27;nop&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> jal != []:</span><br><span class="line">        ran = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(jal) - <span class="number">1</span>)</span><br><span class="line">        f.write(<span class="string">&#x27;jr $ra&#x27;</span> + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        jal.pop(ran)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure></div>
              </div>
            </details>
<h2 id="五-规范化编码"><a class="markdownIt-Anchor" href="#五-规范化编码"></a> 五、规范化编码</h2>
<h3 id="1-命名风格"><a class="markdownIt-Anchor" href="#1-命名风格"></a> 1、命名风格</h3>
<ul>
<li>
<p>各级之间使用<code>流水级_instr_方向</code>的方式，来有效地对它们进行区分，如：</p>
<p><code>D/E 寄存器的输入端口就可以命名为 D_instr_i</code></p>
</li>
<li>
<p>在顶层模块中，我们需要实例化调用子模块，这个过程会产生很多负责接线的“中间变量”，推荐<code>流水级_wirename</code>的方式，并且将同级的信号尽可能都声明在一起。</p>
</li>
</ul>
<h3 id="2-模块逻辑排布看图说话"><a class="markdownIt-Anchor" href="#2-模块逻辑排布看图说话"></a> 2、模块逻辑排布（看图说话）</h3>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/6.png"
                      alt="img" 
                ></p>
<h3 id="3-常量-字面量与宏"><a class="markdownIt-Anchor" href="#3-常量-字面量与宏"></a> 3、<strong>常量、字面量与宏</strong></h3>
<p>对于指令不同的字段，直接定义 wire 型变量如 op、rs 映射到 instr 的对应位上，直观且简短。</p>
<p>对于控制器译出的信号，如果仅在一个模块内使用，可以使用 localparam 定义。但有很多信号需要被多个模块跨文件使用到（如 alu 的控制信号需要同时在控制器与 alu 出现），并且，我们需要为工程的扩展做好准备，因此更推荐编写一个单独的**宏定义文件（如下）**来供其他的模块用 `include 引用。</p>
<p><img  
                     lazyload
                     src="/images/loading.svg"
                     data-src="https://charles2530.github.io/image/7.png"
                      alt="img" 
                ></p>
<h3 id="4-译码风格"><a class="markdownIt-Anchor" href="#4-译码风格"></a> 4、译码风格</h3>
<ul>
<li><strong>指令驱动型</strong>：整体在一个 case 语句之下，通过判断指令的类型，来对所有的控制信号一一进行赋值。这种方法便于指令的添加，不易遗漏控制信号，但是整体代码量会随指令数量增多而显著增大。</li>
<li><strong>控制信号驱动型</strong>：为每个指令定义一个 wire 型变量，使用或运算描述组合逻辑，对每个控制信号进行单独处理。这种方法在指令数量较多时适用，且代码量易于压缩，缺陷是如错添或漏添了某条指令，很难锁定出现错误的位置。</li>
</ul>

        </div>

        
            <div class="post-copyright-info">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>Title:</strong> P5 Design documents</li>
        <li><strong>Author:</strong> Charles</li>
        <li><strong>Created at
                :</strong> 2022-12-26 21:10:00</li>
        
            <li>
                <strong>Updated at
                    :</strong> 2023-08-15 17:29:47
            </li>
        
        <li>
            <strong>Link:</strong> https://charles2530.github.io/2022/12/26/p5-design-documents/
        </li>
        <li>
            <strong>
                License:
            </strong>
            
            This work is licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a>.
            

        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box">
                
                    <li class="tag-item">
                        <a href="/tags/CO/">#CO</a>&nbsp;
                    </li>
                
            </ul>
        

        
  <div class="recommended-article">
   <div class="recommended-desktop">
    <div class="recommended-article-header">
     <i aria-hidden="true"></i><span>recommend_articles</span>
    </div>
    <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/02/02/geatpy-basis/" title="Geatpy_basis" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p3.jpg" alt="Geatpy_basis" class="!max-w-none">
  <span class="title">Geatpy_basis</span>
</a><a class="recommended-article-item" href="/2023/08/18/javascript-note-10/" title="JavaScript-note-10" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p5.jpg" alt="JavaScript-note-10" class="!max-w-none">
  <span class="title">JavaScript-note-10</span>
</a><a class="recommended-article-item" href="/2023/07/17/swift-note-3/" title="Swift-note-3" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p3.png" alt="Swift-note-3" class="!max-w-none">
  <span class="title">Swift-note-3</span>
</a></div>
   </div>
   <div class="recommended-mobile">
   <div class="recommended-article-header">
     <i aria-hidden="true"></i><span>recommend_articles</span>
   </div>
   <div class="recommended-article-group"><a class="recommended-article-item" href="/2023/02/02/geatpy-basis/" title="Geatpy_basis" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p3.jpg" alt="Geatpy_basis" class="!max-w-none">
  <span class="title">Geatpy_basis</span>
</a><a class="recommended-article-item" href="/2023/08/18/javascript-note-10/" title="JavaScript-note-10" rel="bookmark">
  <img src="https://charles2530.github.io/image/background/p5.jpg" alt="JavaScript-note-10" class="!max-w-none">
  <span class="title">JavaScript-note-10</span>
</a></div>
   </div>
  </div>

        
            <div class="article-nav">
                
                    <div class="article-prev">
                        <a class="prev"
                        rel="prev"
                        href="/2022/12/26/p6-design-documents/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">P6 Design documents</span>
                                <span class="post-nav-item">Prev posts</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next">
                        <a class="next"
                        rel="next"
                        href="/2022/12/26/p4-design-documents/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">P4 Design documents</span>
                                <span class="post-nav-item">Next posts</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
            <div class="comment-container">
                <div class="comments-container pjax">
    <div id="comment-anchor"></div>
    <div class="comment-area-title">
        <i class="fa-solid fa-comments"></i>&nbsp;Comments
    </div>
    

        <!-- 
            
    <div id="gitalk-container"></div>
    <script data-swup-reload-script
            src="//cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.js"></script>
    <script data-swup-reload-script>

        function loadGitalk() {
            let __gitalk__pathname = decodeURI(location.pathname);
            const __gitalk__pathnameLength = __gitalk__pathname.length;
            const __gitalk__pathnameMaxLength = 50;
            if (__gitalk__pathnameLength > __gitalk__pathnameMaxLength) {
                __gitalk__pathname = __gitalk__pathname.substring(0, __gitalk__pathnameMaxLength - 3) + '...';
            }

            try {
                Gitalk && new Gitalk({
                    clientID: '8083299a8ee2aaf23879',
                    clientSecret: 'a8161e81d4872181e884fdb69f7be24916b6a9d0',
                    repo: 'charles2530_issues',
                    owner: 'Charles2530',
                    admin: ['Charles2530'],
                    id: __gitalk__pathname,
                    language: 'en'
                }).render('gitalk-container');

            } catch (e) {
                window.Gitalk = null;
            }
        }

        if ('true') {
            const loadGitalkTimeout = setTimeout(() => {
                loadGitalk();
                clearTimeout(loadGitalkTimeout);
            }, 1000);
        } else {
            window.addEventListener('DOMContentLoaded', loadGitalk);
        }
    </script>



         -->
        <script src="https://utteranc.es/client.js" repo="Charles2530/Charles2530.github.io" issue-term="pathname"
            label="Comment" theme="preferred-color-scheme" crossorigin="anonymous" async>
            </script>
        
</div>
            </div>
        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">On this page</div>
        <div class="page-title">P5 Design documents</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#verilog%E6%B5%81%E6%B0%B4%E7%BA%BFcpu%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3"><span class="nav-text"> Verilog流水线CPU设计文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80-cpu%E8%AE%BE%E8%AE%A1%E6%96%B9%E6%A1%88%E7%BB%BC%E8%BF%B0"><span class="nav-text"> 一、 CPU设计方案综述</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80-%E6%80%BB%E4%BD%93%E8%AE%BE%E8%AE%A1%E6%A6%82%E8%BF%B0"><span class="nav-text"> （一） 总体设计概述</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-%E5%85%B3%E9%94%AE%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89"><span class="nav-text"> （二） 关键模块定义</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#f%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> F级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-pc"><span class="nav-text"> 1. PC</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#d%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> D级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-grf"><span class="nav-text"> 1. GRF</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-ext"><span class="nav-text"> 2. EXT</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-controller"><span class="nav-text"> 3. Controller</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4npc%E4%B8%8B%E4%B8%80%E6%8C%87%E4%BB%A4%E8%AE%A1%E7%AE%97%E5%8D%95%E5%85%83"><span class="nav-text"> 4.NPC（下一指令计算单元）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5b_transferb%E7%B1%BB%E6%8C%87%E4%BB%A4%E6%AF%94%E8%BE%83%E5%8D%95%E5%85%83"><span class="nav-text"> 5.B_transfer(B类指令比较单元)</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#e%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> E级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-alu"><span class="nav-text"> 1. ALU</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#m%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF"><span class="nav-text"> M级流水线</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-dm"><span class="nav-text"> 1. DM</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%84%E7%BA%A7%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> 各级流水线寄存器</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1if_id"><span class="nav-text"> 1.IF_ID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#d_regifid%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> D_Reg（IF&#x2F;ID流水寄存器）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2id_ex"><span class="nav-text"> 2.ID_EX</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#e_regidex%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> E_Reg（ID&#x2F;EX流水寄存器）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#3ex_mem"><span class="nav-text"> 3.EX_MEM</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#m_regexmem%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> M_Reg（EX&#x2F;MEM流水寄存器）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#4mem_wb"><span class="nav-text"> 4.MEM_WB</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#w_regmemwb%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8"><span class="nav-text"> W_Reg（MEM&#x2F;WB流水寄存器）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9A%82%E5%81%9C-%E8%BD%AC%E5%8F%91%E5%A4%84%E7%90%86%E5%8F%8A%E7%9B%B8%E5%85%B3%E5%A4%9A%E8%B7%AF%E9%80%89%E6%8B%A9%E5%99%A8"><span class="nav-text"> 暂停、转发处理及相关多路选择器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%86%B2%E7%AA%81%E7%BB%BC%E5%90%88%E5%8D%95%E5%85%83hazardunit"><span class="nav-text"> （一）.冲突综合单元（HazardUnit)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E6%8E%A7%E5%88%B6%E5%92%8C%E5%86%92%E9%99%A9%E7%AE%80%E8%BF%B0"><span class="nav-text"> （二）.控制和冒险简述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E5%86%92%E9%99%A9%E5%A4%84%E7%90%86"><span class="nav-text"> (三）.冒险处理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91forward"><span class="nav-text"> 转发（forward）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BD%AC%E5%8F%91%E7%9A%84%E6%9E%84%E9%80%A0"><span class="nav-text"> 转发的构造</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9A%82%E5%81%9Cstall"><span class="nav-text"> 暂停（stall）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%98%BB%E5%A1%9E%E7%9A%84%E6%9E%84%E9%80%A0d%E7%BA%A7"><span class="nav-text"> 阻塞的构造（D级）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%9C%9F%E5%80%BC%E8%A1%A8"><span class="nav-text"> 真值表</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C-%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88"><span class="nav-text"> 二、 测试方案</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89-%E6%80%9D%E8%80%83%E9%A2%98"><span class="nav-text"> 三、 思考题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8%E6%8F%90%E5%89%8D%E5%88%86%E6%94%AF%E5%88%A4%E6%96%AD%E7%9A%84%E6%96%B9%E6%B3%95%E5%B0%BD%E6%97%A9%E4%BA%A7%E7%94%9F%E7%BB%93%E6%9E%9C%E6%9D%A5%E5%87%8F%E5%B0%91%E5%9B%A0%E4%B8%8D%E7%A1%AE%E5%AE%9A%E8%80%8C%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%BC%80%E9%94%80%E4%BD%86%E5%AE%9E%E9%99%85%E4%B8%8A%E8%BF%99%E7%A7%8D%E6%96%B9%E6%B3%95%E5%B9%B6%E9%9D%9E%E6%80%BB%E8%83%BD%E6%8F%90%E9%AB%98%E6%95%88%E7%8E%87%E8%AF%B7%E4%BB%8E%E6%B5%81%E6%B0%B4%E7%BA%BF%E5%86%92%E9%99%A9%E7%9A%84%E8%A7%92%E5%BA%A6%E6%80%9D%E8%80%83%E5%85%B6%E5%8E%9F%E5%9B%A0%E5%B9%B6%E7%BB%99%E5%87%BA%E4%B8%80%E4%B8%AA%E6%8C%87%E4%BB%A4%E5%BA%8F%E5%88%97%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-text"> （一）我们使用提前分支判断的方法尽早产生结果来减少因不确定而带来的开销，但实际上这种方法并非总能提高效率，请从流水线冒险的角度思考其原因并给出一个指令序列的例子。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C-%E5%9B%A0%E4%B8%BA%E5%BB%B6%E8%BF%9F%E6%A7%BD%E7%9A%84%E5%AD%98%E5%9C%A8%E5%AF%B9%E4%BA%8E-jal-%E7%AD%89%E9%9C%80%E8%A6%81%E5%B0%86%E6%8C%87%E4%BB%A4%E5%9C%B0%E5%9D%80%E5%86%99%E5%85%A5%E5%AF%84%E5%AD%98%E5%99%A8%E7%9A%84%E6%8C%87%E4%BB%A4%E8%A6%81%E5%86%99%E5%9B%9E-pc-8%E8%AF%B7%E6%80%9D%E8%80%83%E4%B8%BA%E4%BB%80%E4%B9%88%E8%BF%99%E6%A0%B7%E8%AE%BE%E8%AE%A1"><span class="nav-text"> （二） 因为延迟槽的存在，对于 jal 等需要将指令地址写入寄存器的指令，要写回 PC + 8，请思考为什么这样设计？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%89%E6%88%91%E4%BB%AC%E8%A6%81%E6%B1%82%E5%A4%A7%E5%AE%B6%E6%89%80%E6%9C%89%E8%BD%AC%E5%8F%91%E6%95%B0%E6%8D%AE%E9%83%BD%E6%9D%A5%E6%BA%90%E4%BA%8E%E6%B5%81%E6%B0%B4%E5%AF%84%E5%AD%98%E5%99%A8%E8%80%8C%E4%B8%8D%E8%83%BD%E6%98%AF%E5%8A%9F%E8%83%BD%E9%83%A8%E4%BB%B6%E5%A6%82-dm-alu-%E8%AF%B7%E6%80%9D%E8%80%83%E4%B8%BA%E4%BB%80%E4%B9%88"><span class="nav-text"> （三）我们要求大家所有转发数据都来源于流水寄存器而不能是功能部件（如 DM 、 ALU ），请思考为什么？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%9B%9B-%E6%88%91%E4%BB%AC%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8-gpr-%E5%86%85%E9%83%A8%E8%BD%AC%E5%8F%91%E8%AF%A5%E5%A6%82%E4%BD%95%E5%AE%9E%E7%8E%B0"><span class="nav-text"> （四） 我们为什么要使用 GPR 内部转发？该如何实现？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%94%E6%88%91%E4%BB%AC%E8%BD%AC%E5%8F%91%E6%97%B6%E6%95%B0%E6%8D%AE%E7%9A%84%E9%9C%80%E6%B1%82%E8%80%85%E5%92%8C%E4%BE%9B%E7%BB%99%E8%80%85%E5%8F%AF%E8%83%BD%E6%9D%A5%E6%BA%90%E4%BA%8E%E5%93%AA%E4%BA%9B%E4%BD%8D%E7%BD%AE%E5%85%B1%E6%9C%89%E5%93%AA%E4%BA%9B%E8%BD%AC%E5%8F%91%E6%95%B0%E6%8D%AE%E9%80%9A%E8%B7%AF"><span class="nav-text"> （五）我们转发时数据的需求者和供给者可能来源于哪些位置？共有哪些转发数据通路？</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%AD%E5%9C%A8%E8%AF%BE%E4%B8%8A%E6%B5%8B%E8%AF%95%E6%97%B6%E6%88%91%E4%BB%AC%E9%9C%80%E8%A6%81%E4%BD%A0%E7%8E%B0%E5%9C%BA%E5%AE%9E%E7%8E%B0%E6%96%B0%E7%9A%84%E6%8C%87%E4%BB%A4%E5%AF%B9%E4%BA%8E%E8%BF%99%E4%BA%9B%E6%96%B0%E7%9A%84%E6%8C%87%E4%BB%A4%E4%BD%A0%E5%8F%AF%E8%83%BD%E9%9C%80%E8%A6%81%E5%9C%A8%E5%8E%9F%E6%9C%89%E7%9A%84%E6%95%B0%E6%8D%AE%E9%80%9A%E8%B7%AF%E4%B8%8A%E5%81%9A%E5%93%AA%E4%BA%9B%E6%89%A9%E5%B1%95%E6%88%96%E4%BF%AE%E6%94%B9%E6%8F%90%E7%A4%BA%E4%BD%A0%E5%8F%AF%E4%BB%A5%E5%AF%B9%E6%8C%87%E4%BB%A4%E8%BF%9B%E8%A1%8C%E5%88%86%E7%B1%BB%E6%80%9D%E8%80%83%E6%AF%8F%E4%B8%80%E7%B1%BB%E6%8C%87%E4%BB%A4%E5%8F%AF%E8%83%BD%E4%BF%AE%E6%94%B9%E6%88%96%E6%89%A9%E5%B1%95%E5%93%AA%E4%BA%9B%E4%BD%8D%E7%BD%AE"><span class="nav-text"> （六）在课上测试时，我们需要你现场实现新的指令，对于这些新的指令，你可能需要在原有的数据通路上做哪些扩展或修改？提示：你可以对指令进行分类，思考每一类指令可能修改或扩展哪些位置。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%83%E7%AE%80%E8%A6%81%E6%8F%8F%E8%BF%B0%E4%BD%A0%E7%9A%84%E8%AF%91%E7%A0%81%E5%99%A8%E6%9E%B6%E6%9E%84%E5%B9%B6%E6%80%9D%E8%80%83%E8%AF%A5%E6%9E%B6%E6%9E%84%E7%9A%84%E4%BC%98%E5%8A%BF%E4%BB%A5%E5%8F%8A%E4%B8%8D%E8%B6%B3"><span class="nav-text"> （七）简要描述你的译码器架构，并思考该架构的优势以及不足。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%89%E5%81%9A%E9%A2%98"><span class="nav-text"> 选做题</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E8%AF%B7%E8%AF%A6%E7%BB%86%E6%8F%8F%E8%BF%B0%E4%BD%A0%E7%9A%84%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88%E5%8F%8A%E6%B5%8B%E8%AF%95%E6%95%B0%E6%8D%AE%E6%9E%84%E9%80%A0%E7%AD%96%E7%95%A5"><span class="nav-text"> （一）请详细描述你的测试方案及测试数据构造策略。</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8C%E8%AF%B7%E8%AF%84%E4%BC%B0%E6%88%91%E4%BB%AC%E7%BB%99%E5%87%BA%E7%9A%84%E8%A6%86%E7%9B%96%E7%8E%87%E5%88%86%E6%9E%90%E6%A8%A1%E5%9E%8B%E7%9A%84%E5%90%88%E7%90%86%E6%80%A7%E5%A6%82%E6%9C%89%E6%9B%B4%E5%A5%BD%E7%9A%84%E6%96%B9%E6%A1%88%E5%8F%AF%E4%B8%80%E5%B9%B6%E6%8F%90%E5%87%BA"><span class="nav-text"> （二）请评估我们给出的覆盖率分析模型的合理性，如有更好的方案，可一并提出。</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E8%87%AA%E5%8A%A8%E5%8C%96%E6%B5%8B%E8%AF%95%E6%A8%A1%E5%9D%97"><span class="nav-text"> 四.自动化测试模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94-%E8%A7%84%E8%8C%83%E5%8C%96%E7%BC%96%E7%A0%81"><span class="nav-text"> 五、规范化编码</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%91%BD%E5%90%8D%E9%A3%8E%E6%A0%BC"><span class="nav-text"> 1、命名风格</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E6%A8%A1%E5%9D%97%E9%80%BB%E8%BE%91%E6%8E%92%E5%B8%83%E7%9C%8B%E5%9B%BE%E8%AF%B4%E8%AF%9D"><span class="nav-text"> 2、模块逻辑排布（看图说话）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E5%B8%B8%E9%87%8F-%E5%AD%97%E9%9D%A2%E9%87%8F%E4%B8%8E%E5%AE%8F"><span class="nav-text"> 3、常量、字面量与宏</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E8%AF%91%E7%A0%81%E9%A3%8E%E6%A0%BC"><span class="nav-text"> 4、译码风格</span></a></li></ol></li></ol></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2023&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Charles</a>
        </div>
        
            <script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">Visitor Count</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">Total Page Views</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm">Powered by Charles</span>
            <span class="text-sm lg:block">Theme&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.4.4</a></span>
        </div>
        
        
            <div>
                Blog up for <span class="odometer" id="runtime_days" ></span> days <span class="odometer" id="runtime_hours"></span> hrs <span class="odometer" id="runtime_minutes"></span> Min <span class="odometer" id="runtime_seconds"></span> Sec
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
            
                
        
                
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
            <li class="go-comment">
                <i class="fa-regular fa-comments"></i>
            </li>
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-expand-width flex justify-center items-center">
            <i class="fa-regular fa-expand"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        
            <li class="right-bottom-tools rss flex justify-center items-center">
                <a class="flex justify-center items-center"
                   href="/atom.xml"
                   target="_blank"
                >
                <i class="fa-regular fa-rss"></i>
                </a>
            </li>
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="Search..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/SwupScrollPlugin.min.js"></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
        ],
        containers: ["#swup"],
    });

    swup.hooks.on("page:view", () => {
        Global.refresh();
    });

    // if (document.readyState === "complete") {
    //
    // } else {
    //     document.addEventListener("DOMContentLoaded", () => init());
    // }
</script>





            <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/categoryList.js"></script>


    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/localSearch.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/codeBlock.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/lazyload.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/runtime.js"></script>
    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/odometer.min.js"></script>
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/assets/odometer-theme-minimal.css">



  <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/Typed.min.js"></script>
  <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/plugins/typed.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/mermaid.min.js"></script>
    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/plugins/mermaid.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/minimasonry.min.js"></script>
    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/plugins/masonry.js"></script>



<div class="post-scripts" data-swup-reload-script>
    
        <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/libs/anime.min.js"></script>
        <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/tools/tocToggle.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/layouts/toc.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.4.4/source/js/plugins/tabs.js"></script>
    
</div>

                
    <script type="text/x-mathjax-config">
  MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>
</body>

</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/love.js"></script>