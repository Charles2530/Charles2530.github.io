!function(t,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(t||self).SwupScrollPlugin=o()}(this,function(){const t=t=>String(t).split(".").concat(["0","0"]).slice(0,3).join(".");class o{constructor(){this.isSwupPlugin=!0,this.requires={},this.swup=void 0,this.version=void 0}mount(){}unmount(){}_beforeMount(){if(!this.name)throw new Error("You must define a name of plugin when creating a class.")}_afterUnmount(){}_checkRequirements(){return"object"!=typeof this.requires||Object.entries(this.requires).forEach(([o,e])=>{if(!function(o,e,i){const n=function(t,o){var e;if("swup"===t)return null!=(e=o.version)?e:"";{var i;const e=o.findPlugin(t);return null!=(i=null==e?void 0:e.version)?i:""}}(o,i);return!!n&&((o,e)=>e.every(e=>{const[,i,n]=e.match(/^([\D]+)?(.*)$/)||[];var s,r;return((t,o)=>{const e={"":t=>0===t,">":t=>t>0,">=":t=>t>=0,"<":t=>t<0,"<=":t=>t<=0};return(e[o]||e[""])(t)})((r=n,s=t(s=o),r=t(r),s.localeCompare(r,void 0,{numeric:!0})),i||">=")}))(n,e)}(o,e=Array.isArray(e)?e:[e],this.swup)){const t=`${o} ${e.join(", ")}`;throw new Error(`Plugin version mismatch: ${this.name} requires ${t}`)}}),!0}}const e=(t,o=document)=>Array.from(o.querySelectorAll(t));class i extends URL{constructor(t,o=document.baseURI){super(t.toString(),o)}get url(){return this.pathname+this.search}static fromElement(t){const o=t.getAttribute("href")||t.getAttribute("xlink:href");return new i(o)}static fromUrl(t){return new i(t)}}function n(){return n=Object.assign?Object.assign.bind():function(t){for(var o=1;o<arguments.length;o++){var e=arguments[o];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},n.apply(this,arguments)}class s{constructor(t){this._raf=null,this._positionY=0,this._velocityY=0,this._targetPositionY=0,this._targetPositionYWithOffset=0,this._direction=0,this.scrollTo=t=>{if(t&&t.nodeType)this._targetPositionY=Math.round(t.getBoundingClientRect().top+window.pageYOffset);else{if(parseInt(this._targetPositionY)!==this._targetPositionY)return void console.error("Argument must be a number or an element.");this._targetPositionY=Math.round(t)}this._targetPositionY>document.documentElement.scrollHeight-window.innerHeight&&(this._targetPositionY=document.documentElement.scrollHeight-window.innerHeight),this._positionY=document.body.scrollTop||document.documentElement.scrollTop,this._direction=this._positionY>this._targetPositionY?-1:1,this._targetPositionYWithOffset=this._targetPositionY+this._direction,this._velocityY=0,this._positionY!==this._targetPositionY?(this.options.onStart(),this._animate()):this.options.onAlreadyAtPositions()},this._animate=()=>{this._update(),this._render(),1===this._direction&&this._targetPositionY>this._positionY||-1===this._direction&&this._targetPositionY<this._positionY?(this._raf=requestAnimationFrame(this._animate),this.options.onTick()):(this._positionY=this._targetPositionY,this._render(),this._raf=null,this.options.onTick(),this.options.onEnd())},this._update=()=>{const t=this._targetPositionYWithOffset-this._positionY;return this._velocityY+=t*this.options.acceleration,this._velocityY*=this.options.friction,this._positionY+=this._velocityY,Math.abs(t)},this._render=()=>{window.scrollTo(0,this._positionY)},this.options=n({},{onAlreadyAtPositions:()=>{},onCancel:()=>{},onEnd:()=>{},onStart:()=>{},onTick:()=>{},friction:.7,acceleration:.04},t),t&&t.friction&&(this.options.friction=1-t.friction),window.addEventListener("mousewheel",t=>{this._raf&&(this.options.onCancel(),cancelAnimationFrame(this._raf),this._raf=null)},{passive:!0})}}return class extends o{constructor(t){var o;void 0===t&&(t={}),super(),o=this,this.name="ScrollPlugin",this.getAnchorElement=function(t){return void 0===t&&(t=""),"function"==typeof o.options.getAnchorElement?o.options.getAnchorElement(t):"function"==typeof o.swup.getAnchorElement?o.swup.getAnchorElement(t):document.querySelector(t)},this.getOffset=function(t){return void 0===t&&(t=null),"function"==typeof o.options.offset?parseInt(o.options.offset(t),10):parseInt(o.options.offset,10)},this.onSamePage=()=>{this.swup.scrollTo(0,this.shouldAnimate("samePage"))},this.onSamePageWithHash=t=>{this.maybeScrollToAnchor(t.delegateTarget.hash,"samePageWithHash")},this.onTransitionStart=t=>{this.options.doScrollingRightAway&&!this.swup.scrollToElement&&this.doScrollingBetweenPages(t)},this.onContentReplaced=t=>{this.options.doScrollingRightAway&&!this.swup.scrollToElement||this.doScrollingBetweenPages(t),this.restoreScrollContainers(t)},this.doScrollingBetweenPages=t=>{const o=this.swup;if(t&&!o.options.animateHistoryBrowsing)return;if(this.maybeScrollToAnchor(o.scrollToElement,"betweenPages"))return void(o.scrollToElement=null);const e=this.getStoredScrollPositions(this.getCurrentCacheKey())||{},i=e.window&&e.window.top||0;requestAnimationFrame(()=>o.scrollTo(i,this.shouldAnimate("betweenPages")))},this.onWillReplaceContent=()=>{this.storeScrollPositions(this.currentCacheKey),this.currentCacheKey=this.getCurrentCacheKey()},this.onClickLink=t=>{this.maybeResetScrollPositions(t.delegateTarget)},this.options={doScrollingRightAway:!1,animateScroll:{betweenPages:!0,samePageWithHash:!0,samePage:!0},scrollFriction:.3,scrollAcceleration:.04,getAnchorElement:null,offset:0,scrollContainers:"[data-swup-scroll-container]",shouldResetScrollPosition:t=>!0,...t}}mount(){var t=this;const o=this.swup;o._handlers.scrollDone=[],o._handlers.scrollStart=[],this.scrl=new s({onStart:()=>o.triggerEvent("scrollStart"),onEnd:()=>o.triggerEvent("scrollDone"),onCancel:()=>o.triggerEvent("scrollDone"),friction:this.options.scrollFriction,acceleration:this.options.scrollAcceleration}),o.scrollTo=function(e,i){void 0===i&&(i=!0),i?t.scrl.scrollTo(e):(o.triggerEvent("scrollStart"),window.scrollTo(0,e),o.triggerEvent("scrollDone"))},this.scrollPositionsStore={},this.currentCacheKey=this.getCurrentCacheKey(),this.previousScrollRestoration=window.history.scrollRestoration,o.options.animateHistoryBrowsing&&(window.history.scrollRestoration="manual"),o.on("samePage",this.onSamePage),o.on("samePageWithHash",this.onSamePageWithHash),o.on("transitionStart",this.onTransitionStart),o.on("contentReplaced",this.onContentReplaced),o.on("willReplaceContent",this.onWillReplaceContent),o.on("clickLink",this.onClickLink)}unmount(){const t=this.swup;t.scrollTo=null,delete this.scrl,this.scrl=null,t.off("samePage",this.onSamePage),t.off("samePageWithHash",this.onSamePageWithHash),t.off("transitionStart",this.onTransitionStart),t.off("contentReplaced",this.onContentReplaced),t.off("willReplaceContent",this.onWillReplaceContent),t.off("clickLink",this.onClickLink),t._handlers.scrollDone=null,t._handlers.scrollStart=null,window.history.scrollRestoration=this.previousScrollRestoration}shouldAnimate(t){return"boolean"==typeof this.options.animateScroll?this.options.animateScroll:this.options.animateScroll[t]}maybeScrollToAnchor(t,o){if(null==t)return!1;const e=this.getAnchorElement(t);if(!e)return console.warn(`Element ${t} not found`),!1;if(!(e instanceof Element))return console.warn(`Element ${t} is not a DOM node`),!1;const i=e.getBoundingClientRect().top+window.pageYOffset-this.getOffset(e);return this.swup.scrollTo(i,this.shouldAnimate(o)),!0}maybeResetScrollPositions(t){if(!this.options.shouldResetScrollPosition(t))return;const{url:o}=i.fromElement(t);this.resetScrollPositions(o)}storeScrollPositions(t){const o=e(this.options.scrollContainers).map(t=>({top:t.scrollTop,left:t.scrollLeft}));this.scrollPositionsStore[t]={window:{top:window.scrollY,left:window.scrollX},containers:o}}resetScrollPositions(t){const o=this.getResolvedUrl(t);delete this.scrollPositionsStore[o],this.scrollPositionsStore[o]=null}getStoredScrollPositions(t){const o=this.getResolvedUrl(t);return this.scrollPositionsStore[o]}restoreScrollContainers(t){const o=this.getStoredScrollPositions(this.getCurrentCacheKey())||{};null!=o.containers&&e(this.options.scrollContainers).forEach((t,e)=>{const i=o.containers[e];null!=i&&(t.scrollTop=i.top,t.scrollLeft=i.left)})}getCurrentCacheKey(){return this.getResolvedUrl((({hash:t}={})=>location.pathname+location.search+(t?location.hash:""))())}getResolvedUrl(t){return"function"==typeof this.swup.resolveUrl?this.swup.resolveUrl(t):t}}});
//# sourceMappingURL=SwupScrollPlugin.min.js.map
